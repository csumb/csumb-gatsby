version: 0.1
frontend:
  phases:
    preBuild:
      commands:
        - npm install
        - git clone --depth 1 https://$GITHUB_TOKEN@github.com/csumb/web-data.git _data
        - git clone --depth 1 https://$GITHUB_TOKEN@github.com/csumb/web-content.git _web-content
    build:
      commands:
        - set -e
        - node --max_old_space_size=12000 ./node_modules/.bin/gatsby build
        - npm run directoryJson
        - npm run scheduleJson
        - npm run eventJson
        - npm run buildJson
        - npm run configFirebase
        - npm run canary
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
