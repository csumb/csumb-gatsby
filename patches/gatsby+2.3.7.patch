diff --git a/node_modules/gatsby/.DS_Store b/node_modules/gatsby/.DS_Store
new file mode 100644
index 0000000..0696bd0
Binary files /dev/null and b/node_modules/gatsby/.DS_Store differ
diff --git a/node_modules/gatsby/cache-dir/.DS_Store b/node_modules/gatsby/cache-dir/.DS_Store
new file mode 100644
index 0000000..1388993
Binary files /dev/null and b/node_modules/gatsby/cache-dir/.DS_Store differ
diff --git a/node_modules/gatsby/cache-dir/__tests__/find-page.js b/node_modules/gatsby/cache-dir/__tests__/find-page.js
index c998b8e..41c6c12 100644
--- a/node_modules/gatsby/cache-dir/__tests__/find-page.js
+++ b/node_modules/gatsby/cache-dir/__tests__/find-page.js
@@ -8,23 +8,19 @@ describe(`find-page`, () => {
       {
         path: `/about/`,
         componentChunkName: `page-component---src-pages-test-js`,
-        jsonName: `about.json`,
       },
       {
         path: `/about/me/`,
         componentChunkName: `page-component---src-pages-test-js`,
-        jsonName: `about-me.json`,
       },
       {
         path: `/about/the best/`,
         componentChunkName: `page-component---src-pages-test-js`,
-        jsonName: `the-best.json`,
       },
       {
         path: `/app/`,
         matchPath: `/app/*`,
         componentChunkName: `page-component---src-pages-app-js`,
-        jsonName: `app.json`,
       },
     ]
     findPage = pageFinderFactory(newPages)
@@ -58,7 +54,6 @@ describe(`find-page`, () => {
       {
         path: `/about/`,
         componentChunkName: `page-component---src-pages-test-js`,
-        jsonName: `about.json`,
       },
     ]
     const findPage2 = pageFinderFactory(newPages, `/my-test-prefix`)
diff --git a/node_modules/gatsby/cache-dir/__tests__/static-entry.js b/node_modules/gatsby/cache-dir/__tests__/static-entry.js
index 41edef9..6dad7f6 100644
--- a/node_modules/gatsby/cache-dir/__tests__/static-entry.js
+++ b/node_modules/gatsby/cache-dir/__tests__/static-entry.js
@@ -22,29 +22,6 @@ jest.mock(
   }
 )
 
-jest.mock(
-  `../data.json`,
-  () => {
-    return {
-      dataPaths: [
-        {
-          [`about.json`]: `/400/about`,
-        },
-      ],
-      pages: [
-        {
-          path: `/about/`,
-          componentChunkName: `page-component---src-pages-test-js`,
-          jsonName: `about.json`,
-        },
-      ],
-    }
-  },
-  {
-    virtual: true,
-  }
-)
-
 const MOCK_FILE_INFO = {
   [`${process.cwd()}/public/webpack.stats.json`]: `{}`,
   [`${process.cwd()}/public/chunk-map.json`]: `{}`,
diff --git a/node_modules/gatsby/cache-dir/api-runner-browser.js b/node_modules/gatsby/cache-dir/api-runner-browser.js
index 0a4ff8b..f956b04 100644
--- a/node_modules/gatsby/cache-dir/api-runner-browser.js
+++ b/node_modules/gatsby/cache-dir/api-runner-browser.js
@@ -3,6 +3,8 @@ const {
   getResourcesForPathname,
   getResourcesForPathnameSync,
   getResourceURLsForPathname,
+  loadPage,
+  getPage,
 } = require(`./loader`).publicLoader
 
 exports.apiRunner = (api, args = {}, defaultReturn, argTransform) => {
@@ -22,9 +24,14 @@ exports.apiRunner = (api, args = {}, defaultReturn, argTransform) => {
       return undefined
     }
 
+    // Deprecated April 2019. Use `getPage` instead
     args.getResourcesForPathnameSync = getResourcesForPathnameSync
+    // Deprecated April 2019. Use `loadPage` instead
     args.getResourcesForPathname = getResourcesForPathname
+    // Deprecated April 2019. Use resources passed in `onPostPrefetch` instead
     args.getResourceURLsForPathname = getResourceURLsForPathname
+    args.loadPage = loadPage
+    args.getPage = getPage
 
     const result = plugin.plugin[api](args, plugin.options)
     if (result && argTransform) {
diff --git a/node_modules/gatsby/cache-dir/app.js b/node_modules/gatsby/cache-dir/app.js
index a3da15e..28acea0 100644
--- a/node_modules/gatsby/cache-dir/app.js
+++ b/node_modules/gatsby/cache-dir/app.js
@@ -5,9 +5,9 @@ import domReady from "@mikaelkristiansson/domready"
 import socketIo from "./socketIo"
 import emitter from "./emitter"
 import { apiRunner, apiRunnerAsync } from "./api-runner-browser"
-import loader, { setApiRunnerForLoader, postInitialRenderWork } from "./loader"
+import loader, { setApiRunnerForLoader } from "./loader"
+import devLoader from "./dev-loader"
 import syncRequires from "./sync-requires"
-import pages from "./pages.json"
 
 window.___emitter = emitter
 setApiRunnerForLoader(apiRunner)
@@ -46,19 +46,26 @@ apiRunnerAsync(`onClientEntry`).then(() => {
     ReactDOM.render
   )[0]
 
-  loader.addPagesArray(pages)
   loader.addDevRequires(syncRequires)
 
-  loader.getResourcesForPathname(window.location.pathname).then(() => {
-    const preferDefault = m => (m && m.default) || m
-    let Root = preferDefault(require(`./root`))
-    domReady(() => {
-      renderer(<Root />, rootElement, () => {
-        postInitialRenderWork()
-        apiRunner(`onInitialClientRender`)
+  Promise.all([
+    loader.loadPage(window.location.pathname),
+    loader.loadPage(`/dev-404-page/`),
+    loader.loadPage(`/404.html`).catch(err => null),
+    devLoader.loadPages(),
+  ])
+    .then(() => {
+      const preferDefault = m => (m && m.default) || m
+      let Root = preferDefault(require(`./root`))
+      domReady(() => {
+        renderer(<Root />, rootElement, () => {
+          apiRunner(`onInitialClientRender`)
+        })
       })
     })
-  })
+    .catch(err => {
+      console.log(err)
+    })
 })
 
 function supportsServiceWorkers(location, navigator) {
diff --git a/node_modules/gatsby/cache-dir/commonjs/api-runner-browser.js b/node_modules/gatsby/cache-dir/commonjs/api-runner-browser.js
index 04f7157..d020e21 100644
--- a/node_modules/gatsby/cache-dir/commonjs/api-runner-browser.js
+++ b/node_modules/gatsby/cache-dir/commonjs/api-runner-browser.js
@@ -5,7 +5,9 @@ const plugins = require(`./api-runner-browser-plugins`);
 const _require$publicLoader = require(`./loader`).publicLoader,
       getResourcesForPathname = _require$publicLoader.getResourcesForPathname,
       getResourcesForPathnameSync = _require$publicLoader.getResourcesForPathnameSync,
-      getResourceURLsForPathname = _require$publicLoader.getResourceURLsForPathname;
+      getResourceURLsForPathname = _require$publicLoader.getResourceURLsForPathname,
+      loadPage = _require$publicLoader.loadPage,
+      getPage = _require$publicLoader.getPage;
 
 exports.apiRunner = (api, args = {}, defaultReturn, argTransform) => {
   // Hooks for gatsby-cypress's API handler
@@ -22,11 +24,16 @@ exports.apiRunner = (api, args = {}, defaultReturn, argTransform) => {
   let results = plugins.map(plugin => {
     if (!plugin.plugin[api]) {
       return undefined;
-    }
+    } // Deprecated April 2019. Use `getPage` instead
+
+
+    args.getResourcesForPathnameSync = getResourcesForPathnameSync; // Deprecated April 2019. Use `loadPage` instead
+
+    args.getResourcesForPathname = getResourcesForPathname; // Deprecated April 2019. Use resources passed in `onPostPrefetch` instead
 
-    args.getResourcesForPathnameSync = getResourcesForPathnameSync;
-    args.getResourcesForPathname = getResourcesForPathname;
     args.getResourceURLsForPathname = getResourceURLsForPathname;
+    args.loadPage = loadPage;
+    args.getPage = getPage;
     const result = plugin.plugin[api](args, plugin.options);
 
     if (result && argTransform) {
diff --git a/node_modules/gatsby/cache-dir/commonjs/app.js b/node_modules/gatsby/cache-dir/commonjs/app.js
index 24ddf96..1ea6784 100644
--- a/node_modules/gatsby/cache-dir/commonjs/app.js
+++ b/node_modules/gatsby/cache-dir/commonjs/app.js
@@ -18,9 +18,9 @@ var _apiRunnerBrowser = require("./api-runner-browser");
 
 var _loader = _interopRequireWildcard(require("./loader"));
 
-var _syncRequires = _interopRequireDefault(require("./sync-requires"));
+var _devLoader = _interopRequireDefault(require("./dev-loader"));
 
-var _pages = _interopRequireDefault(require("./pages.json"));
+var _syncRequires = _interopRequireDefault(require("./sync-requires"));
 
 window.___emitter = _emitter.default;
 (0, _loader.setApiRunnerForLoader)(_apiRunnerBrowser.apiRunner); // Let the site/plugins run code very early.
@@ -67,20 +67,19 @@ window.___emitter = _emitter.default;
   const rootElement = document.getElementById(`___gatsby`);
   const renderer = (0, _apiRunnerBrowser.apiRunner)(`replaceHydrateFunction`, undefined, _reactDom.default.render)[0];
 
-  _loader.default.addPagesArray(_pages.default);
-
   _loader.default.addDevRequires(_syncRequires.default);
 
-  _loader.default.getResourcesForPathname(window.location.pathname).then(() => {
+  Promise.all([_loader.default.loadPage(window.location.pathname), _loader.default.loadPage(`/dev-404-page/`), _loader.default.loadPage(`/404.html`).catch(err => null), _devLoader.default.loadPages()]).then(() => {
     const preferDefault = m => m && m.default || m;
 
     let Root = preferDefault(require(`./root`));
     (0, _domready.default)(() => {
       renderer(_react.default.createElement(Root, null), rootElement, () => {
-        (0, _loader.postInitialRenderWork)();
         (0, _apiRunnerBrowser.apiRunner)(`onInitialClientRender`);
       });
     });
+  }).catch(err => {
+    console.log(err);
   });
 });
 
diff --git a/node_modules/gatsby/cache-dir/commonjs/dev-loader.js b/node_modules/gatsby/cache-dir/commonjs/dev-loader.js
new file mode 100644
index 0000000..5b80bf3
--- /dev/null
+++ b/node_modules/gatsby/cache-dir/commonjs/dev-loader.js
@@ -0,0 +1,50 @@
+"use strict";
+
+// Initialized by calling loadPages
+let pagesManifest = null;
+
+const fetchPages = () => new Promise((resolve, reject) => {
+  const req = new XMLHttpRequest();
+  req.open(`GET`, `/___pages`, true);
+
+  req.onreadystatechange = () => {
+    if (req.readyState == 4) {
+      if (req.status === 200) {
+        // TODO is this safe? Maybe just do this check in dev mode?
+        const contentType = req.getResponseHeader(`content-type`);
+
+        if (!contentType || !contentType.startsWith(`application/json`)) {
+          reject();
+        } else {
+          resolve(JSON.parse(req.responseText));
+        }
+      } else {
+        reject();
+      }
+    }
+  };
+
+  req.send(null);
+}); // Returns a promise that fetches the `/___pages` resource from the
+// running `gatsby develop` server. It contains a map of all pages on
+// the site (path -> page). Call `getPagesManifest()` to retrieve the
+// pages. Used by dev-404-page to present a list of all pages
+
+
+const loadPages = () => fetchPages().then(pages => {
+  pagesManifest = pages;
+}); // Returns the map of all pages on the site (path -> page)
+
+
+const getPagesManifest = () => {
+  if (pagesManifest === null) {
+    throw new Error(`pages-manifest hasn't been initialized. Ensure the dev-loader/loadPages has been called first`);
+  } else {
+    return pagesManifest;
+  }
+};
+
+module.exports = {
+  loadPages,
+  getPagesManifest
+};
\ No newline at end of file
diff --git a/node_modules/gatsby/cache-dir/commonjs/ensure-resources.js b/node_modules/gatsby/cache-dir/commonjs/ensure-resources.js
index 0d3bb56..7e79b01 100644
--- a/node_modules/gatsby/cache-dir/commonjs/ensure-resources.js
+++ b/node_modules/gatsby/cache-dir/commonjs/ensure-resources.js
@@ -25,7 +25,7 @@ class EnsureResources extends _react.default.Component {
     let location = props.location;
     this.state = {
       location: Object.assign({}, location),
-      pageResources: _loader.default.getResourcesForPathnameSync(location.pathname)
+      pageResources: _loader.default.getPageOr404(location.pathname)
     };
   }
 
@@ -44,7 +44,7 @@ class EnsureResources extends _react.default.Component {
     location
   }, prevState) {
     if (prevState.location !== location) {
-      const pageResources = _loader.default.getResourcesForPathnameSync(location.pathname);
+      const pageResources = _loader.default.getPageOr404(location.pathname);
 
       return {
         pageResources,
@@ -70,14 +70,14 @@ class EnsureResources extends _react.default.Component {
   retryResources(nextProps) {
     const pathname = nextProps.location.pathname;
 
-    if (!_loader.default.getResourcesForPathnameSync(pathname)) {
+    if (!_loader.default.getPage(pathname)) {
       // Store the previous and next location before resolving resources
       const prevLocation = this.props.location;
       this.nextLocation = nextProps.location; // Page resources won't be set in cases where the browser back button
       // or forward button is pushed as we can't wait as normal for resources
       // to load before changing the page.
 
-      _loader.default.getResourcesForPathname(pathname).then(pageResources => {
+      _loader.default.loadPage(pathname).then(pageResources => {
         // The page may have changed since we started this, in which case doesn't update
         if (this.nextLocation !== nextProps.location) {
           return;
diff --git a/node_modules/gatsby/cache-dir/commonjs/find-page.js b/node_modules/gatsby/cache-dir/commonjs/find-page.js
deleted file mode 100644
index 512f379..0000000
--- a/node_modules/gatsby/cache-dir/commonjs/find-page.js
+++ /dev/null
@@ -1,57 +0,0 @@
-"use strict";
-
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-exports.__esModule = true;
-exports.default = void 0;
-
-var _utils = require("@reach/router/lib/utils");
-
-var _stripPrefix = _interopRequireDefault(require("./strip-prefix"));
-
-// TODO add tests especially for handling prefixed links.
-const pageCache = {};
-
-var _default = (pages, pathPrefix = ``) => rawPathname => {
-  let pathname = decodeURIComponent(rawPathname); // Remove the pathPrefix from the pathname.
-
-  let trimmedPathname = (0, _stripPrefix.default)(pathname, pathPrefix); // Remove any hashfragment
-
-  if (trimmedPathname.split(`#`).length > 1) {
-    trimmedPathname = trimmedPathname.split(`#`).slice(0, -1).join(``);
-  } // Remove search query
-
-
-  if (trimmedPathname.split(`?`).length > 1) {
-    trimmedPathname = trimmedPathname.split(`?`).slice(0, -1).join(``);
-  }
-
-  if (pageCache[trimmedPathname]) {
-    return pageCache[trimmedPathname];
-  }
-
-  let foundPage; // Array.prototype.find is not supported in IE so we use this somewhat odd
-  // work around.
-
-  pages.some(page => {
-    let pathToMatch = page.matchPath ? page.matchPath : page.path;
-
-    if ((0, _utils.match)(pathToMatch, trimmedPathname)) {
-      foundPage = page;
-      pageCache[trimmedPathname] = page;
-      return true;
-    } // Finally, try and match request with default document.
-
-
-    if ((0, _utils.match)(`${page.path}index.html`, trimmedPathname)) {
-      foundPage = page;
-      pageCache[trimmedPathname] = page;
-      return true;
-    }
-
-    return false;
-  });
-  return foundPage;
-};
-
-exports.default = _default;
\ No newline at end of file
diff --git a/node_modules/gatsby/cache-dir/commonjs/json-store.js b/node_modules/gatsby/cache-dir/commonjs/json-store.js
index e1d3017..7731643 100644
--- a/node_modules/gatsby/cache-dir/commonjs/json-store.js
+++ b/node_modules/gatsby/cache-dir/commonjs/json-store.js
@@ -7,8 +7,6 @@ exports.default = void 0;
 
 var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));
 
-var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));
-
 var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
 
 var _react = _interopRequireDefault(require("react"));
@@ -78,9 +76,7 @@ class JSONStore extends _react.default.Component {
   render() {
     const data = this.state.pageQueryData[getPathFromProps(this.props)]; // eslint-disable-next-line
 
-    const _this$props = this.props,
-          pages = _this$props.pages,
-          propsWithoutPages = (0, _objectWithoutPropertiesLoose2.default)(_this$props, ["pages"]);
+    const propsWithoutPages = Object.assign({}, this.props);
 
     if (!data) {
       return _react.default.createElement("div", null);
diff --git a/node_modules/gatsby/cache-dir/commonjs/loader.js b/node_modules/gatsby/cache-dir/commonjs/loader.js
index 51dc5a9..d7ba7aa 100644
--- a/node_modules/gatsby/cache-dir/commonjs/loader.js
+++ b/node_modules/gatsby/cache-dir/commonjs/loader.js
@@ -5,163 +5,151 @@ var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefau
 exports.__esModule = true;
 exports.default = exports.publicLoader = exports.setApiRunnerForLoader = exports.postInitialRenderWork = void 0;
 
-var _findPage = _interopRequireDefault(require("./find-page"));
-
 var _emitter = _interopRequireDefault(require("./emitter"));
 
 var _prefetch = _interopRequireDefault(require("./prefetch"));
 
+var _utils = require("@reach/router/lib/utils");
+
+var _stripPrefix = _interopRequireDefault(require("./strip-prefix"));
+
+var _matchPaths = _interopRequireDefault(require("./match-paths.json"));
+
+// Generated during bootstrap
 const preferDefault = m => m && m.default || m;
 
-let devGetPageData;
-let inInitialRender = true;
-let hasFetched = Object.create(null);
+const pageNotFoundPaths = new Set();
+let apiRunner;
 let syncRequires = {};
 let asyncRequires = {};
-let jsonDataPaths = {};
-let fetchHistory = [];
-let fetchingPageResourceMapPromise = null;
-let fetchedPageResourceMap = false;
-/**
- * Indicate if pages manifest is loaded
- *  - in production it is split to separate "pages-manifest" chunk that need to be lazy loaded,
- *  - in development it is part of single "common" chunk and is available from the start.
- */
-
-let hasPageResourceMap = process.env.NODE_ENV !== `production`;
-let apiRunner;
-const failedPaths = {};
-const MAX_HISTORY = 5;
-const jsonPromiseStore = {};
+const fetchedPageData = {};
+const pageDatas = {};
+const fetchPromiseStore = {};
+let devGetPageData;
 
 if (process.env.NODE_ENV !== `production`) {
   devGetPageData = require(`./socketIo`).getPageData;
-}
-/**
- * Fetch resource map (pages data and paths to json files with results of
- *  queries)
- */
-
-
-const fetchPageResourceMap = () => {
-  if (!fetchingPageResourceMapPromise) {
-    fetchingPageResourceMapPromise = new Promise(resolve => {
-      asyncRequires.data().then(({
-        pages,
-        dataPaths
-      }) => {
-        // TODO — expose proper way to access this data from plugins.
-        // Need to come up with an API for plugins to access
-        // site info.
-        window.___dataPaths = dataPaths;
-        queue.addPagesArray(pages);
-        queue.addDataPaths(dataPaths);
-        hasPageResourceMap = true;
-        resolve(fetchedPageResourceMap = true);
-      }).catch(e => {
-        console.warn(`Failed to fetch pages manifest. Gatsby will reload on next navigation.`); // failed to grab pages metadata
-        // for now let's just resolve this - on navigation this will cause missing resources
-        // and will trigger page reload and then it will retry
-        // this can happen with service worker updates when webpack manifest points to old
-        // chunk that no longer exists on server
-
-        resolve(fetchedPageResourceMap = true);
-      });
-    });
-  }
+} // Cache for `cleanAndFindPath()`. In case `match-paths.json` is large
 
-  return fetchingPageResourceMapPromise;
-};
 
-const createJsonURL = jsonName => `${__PATH_PREFIX__}/static/d/${jsonName}.json`;
+const cleanAndFindPathCache = {}; // Given a raw URL path, returns the cleaned version of it (trim off
+// `#` and query params), or if it matches an entry in
+// `match-paths.json`, its matched path is returned
+//
+// E.g `/foo?bar=far` => `/foo`
+//
+// Or if `match-paths.json` contains `{ "/foo*": "/page1", ...}`, then
+// `/foo?bar=far` => `/page1`
 
-const createComponentUrls = componentChunkName => window.___chunkMapping[componentChunkName].map(chunk => __PATH_PREFIX__ + chunk);
+const cleanAndFindPath = rawPathname => {
+  let pathname = decodeURIComponent(rawPathname); // Remove the pathPrefix from the pathname.
 
-const fetchResource = resourceName => {
-  // Find resource
-  let resourceFunction;
+  let trimmedPathname = (0, _stripPrefix.default)(pathname, __PATH_PREFIX__); // Remove any hashfragment
 
-  if (resourceName.slice(0, 12) === `component---`) {
-    resourceFunction = asyncRequires.components[resourceName];
-  } else {
-    if (resourceName in jsonPromiseStore) {
-      resourceFunction = () => jsonPromiseStore[resourceName];
-    } else {
-      resourceFunction = () => {
-        const fetchPromise = new Promise((resolve, reject) => {
-          const url = createJsonURL(jsonDataPaths[resourceName]);
-          const req = new XMLHttpRequest();
-          req.open(`GET`, url, true);
-          req.withCredentials = true;
-
-          req.onreadystatechange = () => {
-            if (req.readyState == 4) {
-              if (req.status === 200) {
-                resolve(JSON.parse(req.responseText));
-              } else {
-                delete jsonPromiseStore[resourceName];
-                reject();
-              }
-            }
-          };
-
-          req.send(null);
-        });
-        jsonPromiseStore[resourceName] = fetchPromise;
-        return fetchPromise;
-      };
+  if (trimmedPathname.split(`#`).length > 1) {
+    trimmedPathname = trimmedPathname.split(`#`).slice(0, -1).join(``);
+  } // Remove search query
+
+
+  if (trimmedPathname.split(`?`).length > 1) {
+    trimmedPathname = trimmedPathname.split(`?`).slice(0, -1).join(``);
+  }
+
+  if (cleanAndFindPathCache[trimmedPathname]) {
+    return cleanAndFindPathCache[trimmedPathname];
+  }
+
+  let foundPath;
+  Object.keys(_matchPaths.default).some(matchPath => {
+    if ((0, _utils.match)(matchPath, trimmedPathname)) {
+      foundPath = _matchPaths.default[matchPath];
+      return foundPath;
+    } // Finally, try and match request with default document.
+
+
+    if (trimmedPathname === `/index.html`) {
+      foundPath = `/`;
+      return foundPath;
     }
-  } // Download the resource
-
-
-  hasFetched[resourceName] = true;
-  return new Promise(resolve => {
-    const fetchPromise = resourceFunction();
-    let failed = false;
-    return fetchPromise.catch(() => {
-      failed = true;
-    }).then(component => {
-      fetchHistory.push({
-        resource: resourceName,
-        succeeded: !failed
-      });
-      fetchHistory = fetchHistory.slice(-MAX_HISTORY);
-      resolve(component);
-    });
+
+    return false;
   });
+
+  if (!foundPath) {
+    foundPath = trimmedPathname;
+  }
+
+  cleanAndFindPathCache[trimmedPathname] = foundPath;
+  return foundPath;
 };
 
-const prefetchResource = resourceName => {
-  if (resourceName.slice(0, 12) === `component---`) {
-    return Promise.all(createComponentUrls(resourceName).map(url => (0, _prefetch.default)(url)));
+const cachedFetch = (resourceName, fetchFn) => {
+  if (resourceName in fetchPromiseStore) {
+    return fetchPromiseStore[resourceName];
   } else {
-    const url = createJsonURL(jsonDataPaths[resourceName]);
-    return (0, _prefetch.default)(url);
+    const promise = fetchFn(resourceName);
+    fetchPromiseStore[resourceName] = promise;
+    return promise.catch(err => {
+      delete fetchPromiseStore[resourceName];
+      return err;
+    });
   }
 };
 
-const getResourceModule = resourceName => fetchResource(resourceName).then(preferDefault);
+const doFetch = url => new Promise((resolve, reject) => {
+  const req = new XMLHttpRequest();
+  req.open(`GET`, url, true);
+  req.withCredentials = true;
 
-const appearsOnLine = () => {
-  const isOnLine = navigator.onLine;
+  req.onreadystatechange = () => {
+    if (req.readyState == 4) {
+      resolve(req);
+    }
+  };
 
-  if (typeof isOnLine === `boolean`) {
-    return isOnLine;
-  } // If no navigator.onLine support assume onLine if any of last N fetches succeeded
+  req.send(null);
+});
 
+const handlePageDataResponse = (path, req) => {
+  fetchedPageData[path] = true;
 
-  const succeededFetch = fetchHistory.find(entry => entry.succeeded);
-  return !!succeededFetch;
-};
+  if (req.status === 200) {
+    const contentType = req.getResponseHeader(`content-type`);
 
-const handleResourceLoadError = (path, message) => {
-  if (!failedPaths[path]) {
-    failedPaths[path] = message;
+    if (!contentType || !contentType.startsWith(`application/json`)) {
+      pageNotFoundPaths.add(path);
+      return null;
+    } else {
+      const pageData = JSON.parse(req.responseText);
+      pageDatas[path] = pageData;
+      return pageData;
+    }
+  } else if (req.status === 404) {
+    pageNotFoundPaths.add(path);
+    return null;
+  } else {
+    throw new Error(`error fetching page`);
   }
+};
 
-  if (appearsOnLine() && window.location.pathname.replace(/\/$/g, ``) !== path.replace(/\/$/g, ``)) {
-    window.location.pathname = path;
-  }
+const fetchPageData = path => {
+  const url = makePageDataUrl(path);
+  return cachedFetch(url, doFetch).then(req => handlePageDataResponse(path, req));
+};
+
+const createComponentUrls = componentChunkName => window.___chunkMapping[componentChunkName].map(chunk => __PATH_PREFIX__ + chunk);
+
+const fetchComponent = chunkName => asyncRequires.components[chunkName]();
+
+const stripSurroundingSlashes = s => {
+  s = s[0] === `/` ? s.slice(1) : s;
+  s = s.endsWith(`/`) ? s.slice(0, -1) : s;
+  return s;
+};
+
+const makePageDataUrl = path => {
+  const fixedPath = path === `/` ? `index` : stripSurroundingSlashes(path);
+  return `${__PATH_PREFIX__}/page-data/${fixedPath}/page-data.json`;
 };
 
 const onPrefetchPathname = pathname => {
@@ -171,42 +159,30 @@ const onPrefetchPathname = pathname => {
     });
     prefetchTriggered[pathname] = true;
   }
-};
-
-const onPostPrefetchPathname = pathname => {
-  if (!prefetchCompleted[pathname]) {
-    apiRunner(`onPostPrefetchPathname`, {
-      pathname
-    });
-    prefetchCompleted[pathname] = true;
-  }
-};
-/**
- * Check if we should fallback to resources for 404 page if resources for a page are not found
- *
- * We can't do that when we don't have full pages manifest - we don't know if page exist or not if we don't have it.
- * We also can't do that on initial render / mount in case we just can't load resources needed for first page.
- * Not falling back to 404 resources will cause "EnsureResources" component to handle scenarios like this with
- * potential reload
- * @param {string} path Path to a page
- */
-
-
-const shouldFallbackTo404Resources = path => (hasPageResourceMap || inInitialRender) && path !== `/404.html`; // Note we're not actively using the path data atm. There
+}; // Note we're not actively using the path data atm. There
 // could be future optimizations however around trying to ensure
 // we load all resources for likely-to-be-visited paths.
 // let pathArray = []
 // let pathCount = {}
 
 
-let findPage;
 let pathScriptsCache = {};
 let prefetchTriggered = {};
 let prefetchCompleted = {};
 let disableCorePrefetching = false;
+
+const onPostPrefetch = url => {
+  if (!prefetchCompleted[url]) {
+    apiRunner(`onPostPrefetch`, {
+      url
+    });
+    prefetchCompleted[url] = true;
+  }
+};
+
 const queue = {
-  addPagesArray: newPages => {
-    findPage = (0, _findPage.default)(newPages, __PATH_PREFIX__);
+  addPageData: pageData => {
+    pageDatas[pageData.path] = pageData;
   },
   addDevRequires: devRequires => {
     syncRequires = devRequires;
@@ -214,16 +190,11 @@ const queue = {
   addProdRequires: prodRequires => {
     asyncRequires = prodRequires;
   },
-  addDataPaths: dataPaths => {
-    jsonDataPaths = dataPaths;
-  },
   // Hovering on a link is a very strong indication the user is going to
   // click on it soon so let's start prefetching resources for this
   // pathname.
-  hovering: path => {
-    queue.getResourcesForPathname(path);
-  },
-  enqueue: path => {
+  hovering: path => queue.loadPage(path),
+  enqueue: rawPath => {
     if (!apiRunner) console.error(`Run setApiRunnerForLoader() before enqueing paths`); // Skip prefetching if we know user is on slow or constrained connection
 
     if (`connection` in navigator) {
@@ -238,170 +209,134 @@ const queue = {
     // prefetching this path.
 
 
-    onPrefetchPathname(path); // If a plugin has disabled core prefetching, stop now.
+    onPrefetchPathname(rawPath); // If a plugin has disabled core prefetching, stop now.
 
     if (disableCorePrefetching.some(a => a)) {
       return false;
     } // Check if the page exists.
 
 
-    let page = findPage(path); // In production, we lazy load page metadata. If that
-    // hasn't been fetched yet, start fetching it now.
-
-    if (process.env.NODE_ENV === `production` && !page && !fetchedPageResourceMap) {
-      // If page wasn't found check and we didn't fetch resources map for
-      // all pages, wait for fetch to complete and try find page again
-      return fetchPageResourceMap().then(() => queue.enqueue(path));
-    }
+    let realPath = cleanAndFindPath(rawPath);
 
-    if (!page) {
-      return false;
+    if (pageDatas[realPath]) {
+      return true;
     }
 
     if (process.env.NODE_ENV !== `production` && process.env.NODE_ENV !== `test`) {
-      devGetPageData(page.path);
-    } // Prefetch resources.
-
+      // Ensure latest version of page data is in the JSON store
+      devGetPageData(realPath);
+    }
 
     if (process.env.NODE_ENV === `production`) {
-      Promise.all([prefetchResource(page.jsonName), prefetchResource(page.componentChunkName)]).then(() => {
+      const pageDataUrl = makePageDataUrl(realPath);
+      (0, _prefetch.default)(pageDataUrl).then(() => // This was just prefetched, so will return a response from
+      // the cache instead of making another request to the server
+      fetchPageData(realPath)).then(pageData => {
         // Tell plugins the path has been successfully prefetched
-        onPostPrefetchPathname(path);
+        const chunkName = pageData.componentChunkName;
+        const componentUrls = createComponentUrls(chunkName);
+        return Promise.all(componentUrls.map(_prefetch.default)).then(() => {
+          const resourceUrls = [pageDataUrl].concat(componentUrls);
+          onPostPrefetch({
+            path: rawPath,
+            resourceUrls
+          });
+        });
       });
     }
 
     return true;
   },
-  getPage: pathname => findPage(pathname),
-  getResourceURLsForPathname: path => {
-    const page = findPage(path);
+  isPageNotFound: pathname => pageNotFoundPaths.has(pathname),
+  loadPageData: rawPath => new Promise((resolve, reject) => {
+    const realPath = cleanAndFindPath(rawPath);
+
+    if (!fetchedPageData[realPath]) {
+      fetchPageData(realPath).then(pageData => {
+        if (process.env.NODE_ENV !== `production`) {
+          devGetPageData(realPath);
+        }
 
-    if (page) {
-      return [...createComponentUrls(page.componentChunkName), createJsonURL(jsonDataPaths[page.jsonName])];
+        resolve(queue.loadPageData(rawPath));
+      });
     } else {
-      return null;
+      if (pageDatas[realPath]) {
+        resolve(pageDatas[realPath]);
+      } else {
+        reject(new Error(`page not found`));
+      }
     }
-  },
-  getResourcesForPathnameSync: path => {
-    const page = findPage(path);
-
-    if (page) {
-      return pathScriptsCache[page.path];
-    } else if (shouldFallbackTo404Resources(path)) {
-      return queue.getResourcesForPathnameSync(`/404.html`);
+  }),
+  loadPage: rawPath => queue.loadPageData(rawPath).then(pageData => {
+    if (process.env.NODE_ENV !== `production`) {
+      const component = syncRequires.components[pageData.componentChunkName];
+      return [pageData, component];
     } else {
-      return null;
-    }
-  },
-  // Get resources (code/data) for a path. Fetches metdata first
-  // if necessary and then the code/data bundles. Used for prefetching
-  // and getting resources for page changes.
-  getResourcesForPathname: path => new Promise((resolve, reject) => {
-    // Production code path
-    if (failedPaths[path]) {
-      handleResourceLoadError(path, `Previously detected load failure for "${path}"`);
-      reject();
-      return;
-    }
-
-    const page = findPage(path); // In production, we lazy load page metadata. If that
-    // hasn't been fetched yet, start fetching it now.
-
-    if (!page && !fetchedPageResourceMap && process.env.NODE_ENV === `production`) {
-      // If page wasn't found check and we didn't fetch resources map for
-      // all pages, wait for fetch to complete and try to get resources again
-      fetchPageResourceMap().then(() => resolve(queue.getResourcesForPathname(path)));
-      return;
+      return cachedFetch(pageData.componentChunkName, fetchComponent).then(preferDefault).then(component => [pageData, component]);
     }
+  }).then(([pageData, component]) => {
+    const page = {
+      componentChunkName: pageData.componentChunkName,
+      path: pageData.path,
+      compilationHash: pageData.compilationHash
+    };
+    const jsonData = {
+      data: pageData.data,
+      pageContext: pageData.pageContext
+    };
+    const pageResources = {
+      component,
+      json: jsonData,
+      page
+    };
+    pathScriptsCache[cleanAndFindPath(rawPath)] = pageResources;
+
+    _emitter.default.emit(`onPostLoadPageResources`, {
+      page: pageResources,
+      pageResources
+    });
 
-    if (!page) {
-      if (shouldFallbackTo404Resources(path)) {
-        console.log(`A page wasn't found for "${path}"`); // Preload the custom 404 page
-
-        resolve(queue.getResourcesForPathname(`/404.html`));
-        return;
-      }
-
-      resolve();
-      return;
-    } // Use the path from the page so the pathScriptsCache uses
-    // the normalized path.
-
-
-    path = page.path; // Check if it's in the cache already.
-
-    if (pathScriptsCache[path]) {
-      _emitter.default.emit(`onPostLoadPageResources`, {
-        page,
-        pageResources: pathScriptsCache[path]
+    if (process.env.NODE_ENV === `production`) {
+      const pageDataUrl = makePageDataUrl(cleanAndFindPath(rawPath));
+      const componentUrls = createComponentUrls(pageData.componentChunkName);
+      const resourceUrls = [pageDataUrl].concat(componentUrls);
+      onPostPrefetch({
+        path: rawPath,
+        resourceUrls
       });
+    }
 
-      resolve(pathScriptsCache[path]);
-      return;
-    } // Nope, we need to load resource(s)
-
-
-    _emitter.default.emit(`onPreLoadPageResources`, {
-      path
-    }); // In development we know the code is loaded already
-    // so we just return with it immediately.
-
-
-    if (process.env.NODE_ENV !== `production`) {
-      const pageResources = {
-        component: syncRequires.components[page.componentChunkName],
-        page // Add to the cache.
-
-      };
-      pathScriptsCache[path] = pageResources;
-      devGetPageData(page.path).then(pageData => {
-        _emitter.default.emit(`onPostLoadPageResources`, {
-          page,
-          pageResources
-        }); // Tell plugins the path has been successfully prefetched
-
+    return pageResources;
+  }).catch(err => null),
+  getPage: rawPath => pathScriptsCache[cleanAndFindPath(rawPath)],
+  getPageOr404: rawPath => {
+    const page = queue.getPage(rawPath);
 
-        onPostPrefetchPathname(path);
-        resolve(pageResources);
-      });
+    if (page) {
+      return page;
+    } else if (rawPath !== `/404.html`) {
+      return queue.getPage(`/404.html`);
     } else {
-      Promise.all([getResourceModule(page.componentChunkName), getResourceModule(page.jsonName)]).then(([component, json]) => {
-        if (!(component && json)) {
-          resolve(null);
-          return;
-        }
-
-        const pageResources = {
-          component,
-          json,
-          page
-        };
-        pageResources.page.jsonURL = createJsonURL(jsonDataPaths[page.jsonName]);
-        pathScriptsCache[path] = pageResources;
-        resolve(pageResources);
-
-        _emitter.default.emit(`onPostLoadPageResources`, {
-          page,
-          pageResources
-        }); // Tell plugins the path has been successfully prefetched
-
-
-        onPostPrefetchPathname(path);
-      });
+      return null;
     }
-  })
-};
+  },
+  getResourceURLsForPathname: path => {
+    const pageData = queue.getPage(path);
 
-const postInitialRenderWork = () => {
-  inInitialRender = false;
+    if (pageData) {
+      // Original implementation also concatenated the jsonDataPath
+      // for the page
+      return createComponentUrls(pageData.componentChunkName);
+    } else {
+      return null;
+    }
+  } // Deprecated April 2019. Used to fetch the pages-manifest. Now it's a
+  // noop
 
-  if (process.env.NODE_ENV === `production`) {
-    // We got all resources needed for first mount,
-    // we can fetch resources for all pages.
-    fetchPageResourceMap();
-  }
 };
 
+const postInitialRenderWork = () => {};
+
 exports.postInitialRenderWork = postInitialRenderWork;
 
 const setApiRunnerForLoader = runner => {
@@ -411,9 +346,18 @@ const setApiRunnerForLoader = runner => {
 
 exports.setApiRunnerForLoader = setApiRunnerForLoader;
 const publicLoader = {
-  getResourcesForPathname: queue.getResourcesForPathname,
+  // Deprecated April 2019. Use `loadPage` instead
+  getResourcesForPathname: queue.loadPage,
+  // Deprecated April 2019. Use `getPage` instead
+  getResourcesForPathnameSync: queue.getPage,
+  // Deprecated April 2019. Query results used to be in a separate
+  // file, but are now included in the page-data.json, which is
+  // already loaded into the browser by the time this function is
+  // called. Use the resource URLs passed in `onPostPrefetch` instead.
   getResourceURLsForPathname: queue.getResourceURLsForPathname,
-  getResourcesForPathnameSync: queue.getResourcesForPathnameSync
+  loadPage: queue.loadPage,
+  getPage: queue.getPage,
+  getPageOr404: queue.getPageOr404
 };
 exports.publicLoader = publicLoader;
 var _default = queue;
diff --git a/node_modules/gatsby/cache-dir/commonjs/navigation.js b/node_modules/gatsby/cache-dir/commonjs/navigation.js
index 9565a00..ea622cb 100644
--- a/node_modules/gatsby/cache-dir/commonjs/navigation.js
+++ b/node_modules/gatsby/cache-dir/commonjs/navigation.js
@@ -34,7 +34,7 @@ function maybeRedirect(pathname) {
 
   if (redirect != null) {
     if (process.env.NODE_ENV !== `production`) {
-      const pageResources = _loader.default.getResourcesForPathnameSync(pathname);
+      const pageResources = _loader.default.getPage(pathname);
 
       if (pageResources != null) {
         console.error(`The route "${pathname}" matches both a page and a redirect; this is probably not intentional.`);
@@ -105,7 +105,16 @@ const navigate = (to, options = {}) => {
     });
   }, 1000);
 
-  _loader.default.getResourcesForPathname(pathname).then(pageResources => {
+  _loader.default.loadPage(pathname).then(pageResources => {
+    // If the loaded page has a different compilation hash to the
+    // window, then a rebuild has occurred on the server. Reload.
+    if (process.env.NODE_ENV === `production` && pageResources) {
+      if (pageResources.page.compilationHash !== window.___compilationHash) {
+        console.log(`compilation has different. window = ${window.___compilationHash}, page = ${pageResources.page.compilationHash}`);
+        window.location = pathname;
+      }
+    }
+
     (0, _router.navigate)(to, options);
     clearTimeout(timeoutId);
   });
diff --git a/node_modules/gatsby/cache-dir/commonjs/production-app.js b/node_modules/gatsby/cache-dir/commonjs/production-app.js
index e4b7b5e..1708915 100644
--- a/node_modules/gatsby/cache-dir/commonjs/production-app.js
+++ b/node_modules/gatsby/cache-dir/commonjs/production-app.js
@@ -14,8 +14,6 @@ var _reactDom = _interopRequireDefault(require("react-dom"));
 
 var _router = require("@reach/router");
 
-var _utils = require("@reach/router/lib/utils");
-
 var _gatsbyReactRouterScroll = require("gatsby-react-router-scroll");
 
 var _domready = _interopRequireDefault(require("@mikaelkristiansson/domready"));
@@ -35,12 +33,9 @@ var _ensureResources = _interopRequireDefault(require("./ensure-resources"));
 window.asyncRequires = _asyncRequires.default;
 window.___emitter = _emitter.default;
 window.___loader = _loader.default;
+window.___compilationHash = window.pageData.compilationHash;
 
-_loader.default.addPagesArray([window.page]);
-
-_loader.default.addDataPaths({
-  [window.page.jsonName]: window.dataPath
-});
+_loader.default.addPageData([window.pageData]);
 
 _loader.default.addProdRequires(_asyncRequires.default);
 
@@ -76,22 +71,21 @@ _loader.default.addProdRequires(_asyncRequires.default);
   }
 
   const _window = window,
-        page = _window.page,
+        pageData = _window.pageData,
         browserLoc = _window.location;
 
   if ( // Make sure the window.page object is defined
-  page && // The canonical path doesn't match the actual path (i.e. the address bar)
-  __PATH_PREFIX__ + page.path !== browserLoc.pathname && ( // ...and if matchPage is specified, it also doesn't match the actual path
-  !page.matchPath || !(0, _utils.match)(__PATH_PREFIX__ + page.matchPath, browserLoc.pathname)) && // Ignore 404 pages, since we want to keep the same URL
-  page.path !== `/404.html` && !page.path.match(/^\/404\/?$/) && // Also ignore the offline shell (since when using the offline plugin, all
+  pageData && // The canonical path doesn't match the actual path (i.e. the address bar)
+  __PATH_PREFIX__ + pageData.path !== browserLoc.pathname && // Ignore 404 pages, since we want to keep the same URL
+  pageData.path !== `/404.html` && !pageData.path.match(/^\/404\/?$/) && // Also ignore the offline shell (since when using the offline plugin, all
   // pages have this canonical path)
-  !page.path.match(/^\/offline-plugin-app-shell-fallback\/?$/)) {
-    (0, _router.navigate)(__PATH_PREFIX__ + page.path + browserLoc.search + browserLoc.hash, {
+  !pageData.path.match(/^\/offline-plugin-app-shell-fallback\/?$/)) {
+    (0, _router.navigate)(__PATH_PREFIX__ + pageData.path + browserLoc.search + browserLoc.hash, {
       replace: true
     });
   }
 
-  _loader.default.getResourcesForPathname(browserLoc.pathname).then(() => {
+  _loader.default.loadPage(browserLoc.pathname).then(() => {
     const Root = () => (0, _react.createElement)(_router.Router, {
       basepath: __PATH_PREFIX__
     }, (0, _react.createElement)(RouteHandler, {
@@ -113,7 +107,6 @@ _loader.default.addProdRequires(_asyncRequires.default);
     const renderer = (0, _apiRunnerBrowser.apiRunner)(`replaceHydrateFunction`, undefined, _reactDom.default.hydrate)[0];
     (0, _domready.default)(() => {
       renderer(_react.default.createElement(NewRoot, null), typeof window !== `undefined` ? document.getElementById(`___gatsby`) : void 0, () => {
-        (0, _loader.postInitialRenderWork)();
         (0, _apiRunnerBrowser.apiRunner)(`onInitialClientRender`);
       });
     });
diff --git a/node_modules/gatsby/cache-dir/commonjs/public-page-renderer-dev.js b/node_modules/gatsby/cache-dir/commonjs/public-page-renderer-dev.js
index 3165a3d..9840046 100644
--- a/node_modules/gatsby/cache-dir/commonjs/public-page-renderer-dev.js
+++ b/node_modules/gatsby/cache-dir/commonjs/public-page-renderer-dev.js
@@ -18,7 +18,7 @@ var _jsonStore = _interopRequireDefault(require("./json-store"));
 const DevPageRenderer = ({
   location
 }) => {
-  const pageResources = _loader.default.getResourcesForPathnameSync(location.pathname);
+  const pageResources = _loader.default.getPage(location.pathname);
 
   return _react.default.createElement(_jsonStore.default, {
     pages: _pages.default,
diff --git a/node_modules/gatsby/cache-dir/commonjs/public-page-renderer-prod.js b/node_modules/gatsby/cache-dir/commonjs/public-page-renderer-prod.js
index 3dab848..dee0d42 100644
--- a/node_modules/gatsby/cache-dir/commonjs/public-page-renderer-prod.js
+++ b/node_modules/gatsby/cache-dir/commonjs/public-page-renderer-prod.js
@@ -16,7 +16,7 @@ var _loader = _interopRequireDefault(require("./loader"));
 const ProdPageRenderer = ({
   location
 }) => {
-  const pageResources = _loader.default.getResourcesForPathnameSync(location.pathname);
+  const pageResources = _loader.default.getPageOr404(location.pathname);
 
   return _react.default.createElement(_pageRenderer.default, Object.assign({
     location,
diff --git a/node_modules/gatsby/cache-dir/commonjs/root.js b/node_modules/gatsby/cache-dir/commonjs/root.js
index b27db5a..e48bc97 100644
--- a/node_modules/gatsby/cache-dir/commonjs/root.js
+++ b/node_modules/gatsby/cache-dir/commonjs/root.js
@@ -19,12 +19,10 @@ var _navigation = require("./navigation");
 
 var _apiRunnerBrowser = require("./api-runner-browser");
 
-var _syncRequires = _interopRequireDefault(require("./sync-requires"));
-
-var _pages = _interopRequireDefault(require("./pages.json"));
-
 var _loader = _interopRequireDefault(require("./loader"));
 
+var _devLoader = _interopRequireDefault(require("./dev-loader"));
+
 var _jsonStore = _interopRequireDefault(require("./json-store"));
 
 var _ensureResources = _interopRequireDefault(require("./ensure-resources"));
@@ -55,12 +53,13 @@ if (window.__webpack_hot_middleware_reporter__ !== undefined) {
 
 class RouteHandler extends _react.default.Component {
   render() {
-    let location = this.props.location; // check if page exists - in dev pages are sync loaded, it's safe to use
-    // loader.getPage
+    let location = this.props.location;
+
+    const pages = _devLoader.default.getPagesManifest();
 
-    let page = _loader.default.getPage(location.pathname);
+    const pagePaths = Object.keys(pages);
 
-    if (page) {
+    if (!_loader.default.isPageNotFound(location.pathname)) {
       return _react.default.createElement(_ensureResources.default, {
         location: location
       }, locationAndPageResources => _react.default.createElement(_navigation.RouteUpdates, {
@@ -68,20 +67,18 @@ class RouteHandler extends _react.default.Component {
       }, _react.default.createElement(_gatsbyReactRouterScroll.ScrollContext, {
         location: location,
         shouldUpdateScroll: _navigation.shouldUpdateScroll
-      }, _react.default.createElement(_jsonStore.default, (0, _extends2.default)({
-        pages: _pages.default
-      }, this.props, locationAndPageResources)))));
+      }, _react.default.createElement(_jsonStore.default, (0, _extends2.default)({}, this.props, locationAndPageResources)))));
     } else {
-      const dev404Page = _pages.default.find(p => /^\/dev-404-page\/?$/.test(p.path));
+      const dev404Page = _loader.default.getPage(`/dev-404-page/`);
 
-      const Dev404Page = _syncRequires.default.components[dev404Page.componentChunkName];
+      const Dev404Page = dev404Page.component;
 
       if (!_loader.default.getPage(`/404.html`)) {
         return _react.default.createElement(_navigation.RouteUpdates, {
           location: location
-        }, _react.default.createElement(Dev404Page, (0, _extends2.default)({
-          pages: _pages.default
-        }, this.props)));
+        }, _react.default.createElement(Dev404Page, (0, _extends2.default)({}, this.props, {
+          pagePaths: pagePaths
+        })));
       }
 
       return _react.default.createElement(_ensureResources.default, {
@@ -89,10 +86,8 @@ class RouteHandler extends _react.default.Component {
       }, locationAndPageResources => _react.default.createElement(_navigation.RouteUpdates, {
         location: location
       }, _react.default.createElement(Dev404Page, (0, _extends2.default)({
-        pages: _pages.default,
-        custom404: _react.default.createElement(_jsonStore.default, (0, _extends2.default)({
-          pages: _pages.default
-        }, this.props, locationAndPageResources))
+        pagePaths: pagePaths,
+        custom404: _react.default.createElement(_jsonStore.default, (0, _extends2.default)({}, this.props, locationAndPageResources))
       }, this.props))));
     }
   }
diff --git a/node_modules/gatsby/cache-dir/commonjs/socketIo.js b/node_modules/gatsby/cache-dir/commonjs/socketIo.js
index 694fc98..acdb734 100644
--- a/node_modules/gatsby/cache-dir/commonjs/socketIo.js
+++ b/node_modules/gatsby/cache-dir/commonjs/socketIo.js
@@ -34,19 +34,19 @@ function socketIo() {
         // eslint-disable-next-line no-undef
         socket = io();
 
-        const didDataChange = (msg, queryData) => !(msg.payload.id in queryData) || JSON.stringify(msg.payload.result) !== JSON.stringify(queryData[msg.payload.id]);
+        const didDataChange = (msg, queryData) => !(msg.payload.id in queryData) || JSON.stringify(msg.payload) !== JSON.stringify(queryData[msg.payload.id]);
 
         socket.on(`message`, msg => {
           if (msg.type === `staticQueryResult`) {
             if (didDataChange(msg, staticQueryData)) {
               staticQueryData = Object.assign({}, staticQueryData, {
-                [msg.payload.id]: msg.payload.result
+                [msg.payload.id]: msg.payload
               });
             }
           } else if (msg.type === `pageQueryResult`) {
             if (didDataChange(msg, pageQueryData)) {
               pageQueryData = Object.assign({}, pageQueryData, {
-                [msg.payload.id]: msg.payload.result
+                [msg.payload.id]: msg.payload
               });
             }
           } else if (msg.type === `overlayError`) {
diff --git a/node_modules/gatsby/cache-dir/commonjs/static-entry.js b/node_modules/gatsby/cache-dir/commonjs/static-entry.js
index 8cd6cb5..76dc0ef 100644
--- a/node_modules/gatsby/cache-dir/commonjs/static-entry.js
+++ b/node_modules/gatsby/cache-dir/commonjs/static-entry.js
@@ -34,16 +34,9 @@ const apiRunner = require(`./api-runner-ssr`);
 
 const syncRequires = require(`./sync-requires`);
 
-const _require5 = require(`./data.json`),
-      dataPaths = _require5.dataPaths,
-      pages = _require5.pages;
+const _require5 = require(`gatsby/package.json`),
+      gatsbyVersion = _require5.version;
 
-const _require6 = require(`gatsby/package.json`),
-      gatsbyVersion = _require6.version; // Speed up looking up pages.
-
-
-const pagesObjectMap = new Map();
-pages.forEach(p => pagesObjectMap.set(p.path, p));
 const stats = JSON.parse(fs.readFileSync(`${process.cwd()}/public/webpack.stats.json`, `utf-8`));
 const chunkMapping = JSON.parse(fs.readFileSync(`${process.cwd()}/public/chunk-map.json`, `utf-8`)); // const testRequireError = require("./test-require-error")
 // For some extremely mysterious reason, webpack adds the above module *after*
@@ -70,7 +63,27 @@ try {
 
 Html = Html && Html.__esModule ? Html.default : Html;
 
-const getPage = path => pagesObjectMap.get(path);
+const getPageDataPath = path => {
+  const fixedPagePath = path === `/` ? `index` : path;
+  return join(`page-data`, fixedPagePath, `page-data.json`);
+};
+
+const getPageDataUrl = pagePath => {
+  const pageDataPath = getPageDataPath(pagePath);
+  return `${__PATH_PREFIX__}/${pageDataPath}`;
+};
+
+const getPageDataFile = pagePath => {
+  const pageDataPath = getPageDataPath(pagePath);
+  return join(process.cwd(), `public`, pageDataPath);
+};
+
+const loadPageDataSync = pagePath => {
+  const pageDataPath = getPageDataPath(pagePath);
+  const pageDataFile = join(process.cwd(), `public`, pageDataPath);
+  const pageDataJson = fs.readFileSync(pageDataFile);
+  return JSON.parse(pageDataJson);
+};
 
 const createElement = React.createElement;
 
@@ -143,26 +156,15 @@ var _default = (pagePath, callback) => {
     postBodyComponents = sanitizeComponents(components);
   };
 
-  const page = getPage(pagePath);
-  let dataAndContext = {};
-
-  if (page.jsonName in dataPaths) {
-    const pathToJsonData = join(process.cwd(), `/public/static/d`, `${dataPaths[page.jsonName]}.json`);
-
-    try {
-      dataAndContext = JSON.parse(fs.readFileSync(pathToJsonData));
-    } catch (e) {
-      console.log(`error`, pathToJsonData, e);
-      process.exit();
-    }
-  }
+  const pageDataRaw = fs.readFileSync(getPageDataFile(pagePath));
+  const pageData = JSON.parse(pageDataRaw);
+  const pageDataUrl = getPageDataUrl(pagePath);
+  const componentChunkName = pageData.componentChunkName;
 
   class RouteHandler extends React.Component {
     render() {
-      const props = Object.assign({}, this.props, dataAndContext, {
-        pathContext: dataAndContext.pageContext
-      });
-      const pageElement = createElement(syncRequires.components[page.componentChunkName], props);
+      const props = Object.assign({}, this.props, pageData);
+      const pageElement = createElement(syncRequires.components[componentChunkName], props);
       const wrappedPage = apiRunner(`wrapPageElement`, {
         element: pageElement,
         props
@@ -221,7 +223,7 @@ var _default = (pagePath, callback) => {
   } // Create paths to scripts
 
 
-  let scriptsAndStyles = flatten([`app`, page.componentChunkName].map(s => {
+  let scriptsAndStyles = flatten([`app`, componentChunkName].map(s => {
     const fetchKey = `assetsByChunkName[${s}]`;
     let chunks = get(stats, fetchKey);
     let namedChunkGroups = get(stats, `namedChunkGroups`);
@@ -269,6 +271,7 @@ var _default = (pagePath, callback) => {
     setPostBodyComponents,
     setBodyProps,
     pathname: pagePath,
+    loadPageDataSync,
     bodyHtml,
     scripts,
     styles,
@@ -284,13 +287,12 @@ var _default = (pagePath, callback) => {
     }));
   });
 
-  if (page.jsonName in dataPaths) {
-    const dataPath = `${__PATH_PREFIX__}/static/d/${dataPaths[page.jsonName]}.json`;
+  if (pageData) {
     headComponents.push(React.createElement("link", {
       as: "fetch",
       rel: "preload",
-      key: dataPath,
-      href: dataPath,
+      key: pageDataUrl,
+      href: pageDataUrl,
       crossOrigin: "use-credentials"
     }));
   }
@@ -315,7 +317,7 @@ var _default = (pagePath, callback) => {
     }
   }); // Add page metadata for the current page
 
-  const windowData = `/*<![CDATA[*/window.page=${JSON.stringify(page)};${page.jsonName in dataPaths ? `window.dataPath="${dataPaths[page.jsonName]}";` : ``}/*]]>*/`;
+  const windowData = `/*<![CDATA[*/window.pageData=${pageDataRaw};/*]]>*/`;
   postBodyComponents.push(React.createElement("script", {
     key: `script-loader`,
     id: `gatsby-script-loader`,
diff --git a/node_modules/gatsby/cache-dir/dev-loader.js b/node_modules/gatsby/cache-dir/dev-loader.js
new file mode 100644
index 0000000..93cdf3c
--- /dev/null
+++ b/node_modules/gatsby/cache-dir/dev-loader.js
@@ -0,0 +1,49 @@
+// Initialized by calling loadPages
+let pagesManifest = null
+
+const fetchPages = () =>
+  new Promise((resolve, reject) => {
+    const req = new XMLHttpRequest()
+    req.open(`GET`, `/___pages`, true)
+    req.onreadystatechange = () => {
+      if (req.readyState == 4) {
+        if (req.status === 200) {
+          // TODO is this safe? Maybe just do this check in dev mode?
+          const contentType = req.getResponseHeader(`content-type`)
+          if (!contentType || !contentType.startsWith(`application/json`)) {
+            reject()
+          } else {
+            resolve(JSON.parse(req.responseText))
+          }
+        } else {
+          reject()
+        }
+      }
+    }
+    req.send(null)
+  })
+
+// Returns a promise that fetches the `/___pages` resource from the
+// running `gatsby develop` server. It contains a map of all pages on
+// the site (path -> page). Call `getPagesManifest()` to retrieve the
+// pages. Used by dev-404-page to present a list of all pages
+const loadPages = () =>
+  fetchPages().then(pages => {
+    pagesManifest = pages
+  })
+
+// Returns the map of all pages on the site (path -> page)
+const getPagesManifest = () => {
+  if (pagesManifest === null) {
+    throw new Error(
+      `pages-manifest hasn't been initialized. Ensure the dev-loader/loadPages has been called first`
+    )
+  } else {
+    return pagesManifest
+  }
+}
+
+module.exports = {
+  loadPages,
+  getPagesManifest,
+}
diff --git a/node_modules/gatsby/cache-dir/ensure-resources.js b/node_modules/gatsby/cache-dir/ensure-resources.js
index 0c37dd5..23270d1 100644
--- a/node_modules/gatsby/cache-dir/ensure-resources.js
+++ b/node_modules/gatsby/cache-dir/ensure-resources.js
@@ -17,7 +17,7 @@ class EnsureResources extends React.Component {
 
     this.state = {
       location: { ...location },
-      pageResources: loader.getResourcesForPathnameSync(location.pathname),
+      pageResources: loader.getPageOr404(location.pathname),
     }
   }
 
@@ -34,9 +34,7 @@ class EnsureResources extends React.Component {
 
   static getDerivedStateFromProps({ location }, prevState) {
     if (prevState.location !== location) {
-      const pageResources = loader.getResourcesForPathnameSync(
-        location.pathname
-      )
+      const pageResources = loader.getPageOr404(location.pathname)
 
       return {
         pageResources,
@@ -62,7 +60,7 @@ class EnsureResources extends React.Component {
   retryResources(nextProps) {
     const { pathname } = nextProps.location
 
-    if (!loader.getResourcesForPathnameSync(pathname)) {
+    if (!loader.getPage(pathname)) {
       // Store the previous and next location before resolving resources
       const prevLocation = this.props.location
       this.nextLocation = nextProps.location
@@ -70,7 +68,7 @@ class EnsureResources extends React.Component {
       // Page resources won't be set in cases where the browser back button
       // or forward button is pushed as we can't wait as normal for resources
       // to load before changing the page.
-      loader.getResourcesForPathname(pathname).then(pageResources => {
+      loader.loadPage(pathname).then(pageResources => {
         // The page may have changed since we started this, in which case doesn't update
         if (this.nextLocation !== nextProps.location) {
           return
diff --git a/node_modules/gatsby/cache-dir/find-page.js b/node_modules/gatsby/cache-dir/find-page.js
deleted file mode 100644
index f25078f..0000000
--- a/node_modules/gatsby/cache-dir/find-page.js
+++ /dev/null
@@ -1,55 +0,0 @@
-// TODO add tests especially for handling prefixed links.
-import { match as matchPath } from "@reach/router/lib/utils"
-import stripPrefix from "./strip-prefix"
-
-const pageCache = {}
-
-export default (pages, pathPrefix = ``) => rawPathname => {
-  let pathname = decodeURIComponent(rawPathname)
-
-  // Remove the pathPrefix from the pathname.
-  let trimmedPathname = stripPrefix(pathname, pathPrefix)
-
-  // Remove any hashfragment
-  if (trimmedPathname.split(`#`).length > 1) {
-    trimmedPathname = trimmedPathname
-      .split(`#`)
-      .slice(0, -1)
-      .join(``)
-  }
-
-  // Remove search query
-  if (trimmedPathname.split(`?`).length > 1) {
-    trimmedPathname = trimmedPathname
-      .split(`?`)
-      .slice(0, -1)
-      .join(``)
-  }
-
-  if (pageCache[trimmedPathname]) {
-    return pageCache[trimmedPathname]
-  }
-
-  let foundPage
-  // Array.prototype.find is not supported in IE so we use this somewhat odd
-  // work around.
-  pages.some(page => {
-    let pathToMatch = page.matchPath ? page.matchPath : page.path
-    if (matchPath(pathToMatch, trimmedPathname)) {
-      foundPage = page
-      pageCache[trimmedPathname] = page
-      return true
-    }
-
-    // Finally, try and match request with default document.
-    if (matchPath(`${page.path}index.html`, trimmedPathname)) {
-      foundPage = page
-      pageCache[trimmedPathname] = page
-      return true
-    }
-
-    return false
-  })
-
-  return foundPage
-}
diff --git a/node_modules/gatsby/cache-dir/json-store.js b/node_modules/gatsby/cache-dir/json-store.js
index 632a559..3c476e9 100644
--- a/node_modules/gatsby/cache-dir/json-store.js
+++ b/node_modules/gatsby/cache-dir/json-store.js
@@ -28,6 +28,7 @@ const getPathFromProps = props =>
 class JSONStore extends React.Component {
   constructor(props) {
     super(props)
+
     this.state = {
       staticQueryData: getStaticQueryData(),
       pageQueryData: getPageQueryData(),
@@ -83,11 +84,10 @@ class JSONStore extends React.Component {
   render() {
     const data = this.state.pageQueryData[getPathFromProps(this.props)]
     // eslint-disable-next-line
-    const { pages, ...propsWithoutPages } = this.props
+    const { ...propsWithoutPages } = this.props
     if (!data) {
       return <div />
     }
-
     return (
       <StaticQueryContext.Provider value={this.state.staticQueryData}>
         <PageRenderer {...propsWithoutPages} {...data} />
diff --git a/node_modules/gatsby/cache-dir/loader.js b/node_modules/gatsby/cache-dir/loader.js
index 0d77a65..fe4d943 100644
--- a/node_modules/gatsby/cache-dir/loader.js
+++ b/node_modules/gatsby/cache-dir/loader.js
@@ -1,166 +1,150 @@
-import pageFinderFactory from "./find-page"
 import emitter from "./emitter"
 import prefetchHelper from "./prefetch"
+import { match } from "@reach/router/lib/utils"
+import stripPrefix from "./strip-prefix"
+// Generated during bootstrap
+import matchPaths from "./match-paths.json"
 
 const preferDefault = m => (m && m.default) || m
 
-let devGetPageData
-let inInitialRender = true
-let hasFetched = Object.create(null)
+const pageNotFoundPaths = new Set()
+
+let apiRunner
 let syncRequires = {}
 let asyncRequires = {}
-let jsonDataPaths = {}
-let fetchHistory = []
-let fetchingPageResourceMapPromise = null
-let fetchedPageResourceMap = false
-/**
- * Indicate if pages manifest is loaded
- *  - in production it is split to separate "pages-manifest" chunk that need to be lazy loaded,
- *  - in development it is part of single "common" chunk and is available from the start.
- */
-let hasPageResourceMap = process.env.NODE_ENV !== `production`
-let apiRunner
-const failedPaths = {}
-const MAX_HISTORY = 5
 
-const jsonPromiseStore = {}
+const fetchedPageData = {}
+const pageDatas = {}
+const fetchPromiseStore = {}
 
+let devGetPageData
 if (process.env.NODE_ENV !== `production`) {
   devGetPageData = require(`./socketIo`).getPageData
 }
 
-/**
- * Fetch resource map (pages data and paths to json files with results of
- *  queries)
- */
-const fetchPageResourceMap = () => {
-  if (!fetchingPageResourceMapPromise) {
-    fetchingPageResourceMapPromise = new Promise(resolve => {
-      asyncRequires
-        .data()
-        .then(({ pages, dataPaths }) => {
-          // TODO — expose proper way to access this data from plugins.
-          // Need to come up with an API for plugins to access
-          // site info.
-          window.___dataPaths = dataPaths
-          queue.addPagesArray(pages)
-          queue.addDataPaths(dataPaths)
-          hasPageResourceMap = true
-          resolve((fetchedPageResourceMap = true))
-        })
-        .catch(e => {
-          console.warn(
-            `Failed to fetch pages manifest. Gatsby will reload on next navigation.`
-          )
-          // failed to grab pages metadata
-          // for now let's just resolve this - on navigation this will cause missing resources
-          // and will trigger page reload and then it will retry
-          // this can happen with service worker updates when webpack manifest points to old
-          // chunk that no longer exists on server
-          resolve((fetchedPageResourceMap = true))
-        })
-    })
+// Cache for `cleanAndFindPath()`. In case `match-paths.json` is large
+const cleanAndFindPathCache = {}
+
+// Given a raw URL path, returns the cleaned version of it (trim off
+// `#` and query params), or if it matches an entry in
+// `match-paths.json`, its matched path is returned
+//
+// E.g `/foo?bar=far` => `/foo`
+//
+// Or if `match-paths.json` contains `{ "/foo*": "/page1", ...}`, then
+// `/foo?bar=far` => `/page1`
+const cleanAndFindPath = rawPathname => {
+  let pathname = decodeURIComponent(rawPathname)
+  // Remove the pathPrefix from the pathname.
+  let trimmedPathname = stripPrefix(pathname, __PATH_PREFIX__)
+  // Remove any hashfragment
+  if (trimmedPathname.split(`#`).length > 1) {
+    trimmedPathname = trimmedPathname
+      .split(`#`)
+      .slice(0, -1)
+      .join(``)
   }
-  return fetchingPageResourceMapPromise
-}
 
-const createJsonURL = jsonName => `${__PATH_PREFIX__}/static/d/${jsonName}.json`
-const createComponentUrls = componentChunkName =>
-  window.___chunkMapping[componentChunkName].map(
-    chunk => __PATH_PREFIX__ + chunk
-  )
-
-const fetchResource = resourceName => {
-  // Find resource
-  let resourceFunction
-  if (resourceName.slice(0, 12) === `component---`) {
-    resourceFunction = asyncRequires.components[resourceName]
-  } else {
-    if (resourceName in jsonPromiseStore) {
-      resourceFunction = () => jsonPromiseStore[resourceName]
-    } else {
-      resourceFunction = () => {
-        const fetchPromise = new Promise((resolve, reject) => {
-          const url = createJsonURL(jsonDataPaths[resourceName])
-          const req = new XMLHttpRequest()
-          req.open(`GET`, url, true)
-          req.withCredentials = true
-          req.onreadystatechange = () => {
-            if (req.readyState == 4) {
-              if (req.status === 200) {
-                resolve(JSON.parse(req.responseText))
-              } else {
-                delete jsonPromiseStore[resourceName]
-                reject()
-              }
-            }
-          }
-          req.send(null)
-        })
-        jsonPromiseStore[resourceName] = fetchPromise
-        return fetchPromise
-      }
-    }
+  // Remove search query
+  if (trimmedPathname.split(`?`).length > 1) {
+    trimmedPathname = trimmedPathname
+      .split(`?`)
+      .slice(0, -1)
+      .join(``)
+  }
+  if (cleanAndFindPathCache[trimmedPathname]) {
+    return cleanAndFindPathCache[trimmedPathname]
   }
 
-  // Download the resource
-  hasFetched[resourceName] = true
-  return new Promise(resolve => {
-    const fetchPromise = resourceFunction()
-    let failed = false
-    return fetchPromise
-      .catch(() => {
-        failed = true
-      })
-      .then(component => {
-        fetchHistory.push({
-          resource: resourceName,
-          succeeded: !failed,
-        })
-
-        fetchHistory = fetchHistory.slice(-MAX_HISTORY)
-
-        resolve(component)
-      })
+  let foundPath
+  Object.keys(matchPaths).some(matchPath => {
+    if (match(matchPath, trimmedPathname)) {
+      foundPath = matchPaths[matchPath]
+      return foundPath
+    }
+    // Finally, try and match request with default document.
+    if (trimmedPathname === `/index.html`) {
+      foundPath = `/`
+      return foundPath
+    }
+    return false
   })
+  if (!foundPath) {
+    foundPath = trimmedPathname
+  }
+  cleanAndFindPathCache[trimmedPathname] = foundPath
+  return foundPath
 }
 
-const prefetchResource = resourceName => {
-  if (resourceName.slice(0, 12) === `component---`) {
-    return Promise.all(
-      createComponentUrls(resourceName).map(url => prefetchHelper(url))
-    )
+const cachedFetch = (resourceName, fetchFn) => {
+  if (resourceName in fetchPromiseStore) {
+    return fetchPromiseStore[resourceName]
   } else {
-    const url = createJsonURL(jsonDataPaths[resourceName])
-    return prefetchHelper(url)
+    const promise = fetchFn(resourceName)
+    fetchPromiseStore[resourceName] = promise
+    return promise.catch(err => {
+      delete fetchPromiseStore[resourceName]
+      return err
+    })
   }
 }
 
-const getResourceModule = resourceName =>
-  fetchResource(resourceName).then(preferDefault)
+const doFetch = url =>
+  new Promise((resolve, reject) => {
+    const req = new XMLHttpRequest()
+    req.open(`GET`, url, true)
+    req.withCredentials = true
+    req.onreadystatechange = () => {
+      if (req.readyState == 4) {
+        resolve(req)
+      }
+    }
+    req.send(null)
+  })
 
-const appearsOnLine = () => {
-  const isOnLine = navigator.onLine
-  if (typeof isOnLine === `boolean`) {
-    return isOnLine
+const handlePageDataResponse = (path, req) => {
+  fetchedPageData[path] = true
+  if (req.status === 200) {
+    const contentType = req.getResponseHeader(`content-type`)
+    if (!contentType || !contentType.startsWith(`application/json`)) {
+      pageNotFoundPaths.add(path)
+      return null
+    } else {
+      const pageData = JSON.parse(req.responseText)
+      pageDatas[path] = pageData
+      return pageData
+    }
+  } else if (req.status === 404) {
+    pageNotFoundPaths.add(path)
+    return null
+  } else {
+    throw new Error(`error fetching page`)
   }
+}
 
-  // If no navigator.onLine support assume onLine if any of last N fetches succeeded
-  const succeededFetch = fetchHistory.find(entry => entry.succeeded)
-  return !!succeededFetch
+const fetchPageData = path => {
+  const url = makePageDataUrl(path)
+  return cachedFetch(url, doFetch).then(req =>
+    handlePageDataResponse(path, req)
+  )
 }
 
-const handleResourceLoadError = (path, message) => {
-  if (!failedPaths[path]) {
-    failedPaths[path] = message
-  }
+const createComponentUrls = componentChunkName =>
+  window.___chunkMapping[componentChunkName].map(
+    chunk => __PATH_PREFIX__ + chunk
+  )
 
-  if (
-    appearsOnLine() &&
-    window.location.pathname.replace(/\/$/g, ``) !== path.replace(/\/$/g, ``)
-  ) {
-    window.location.pathname = path
-  }
+const fetchComponent = chunkName => asyncRequires.components[chunkName]()
+
+const stripSurroundingSlashes = s => {
+  s = s[0] === `/` ? s.slice(1) : s
+  s = s.endsWith(`/`) ? s.slice(0, -1) : s
+  return s
+}
+
+const makePageDataUrl = path => {
+  const fixedPath = path === `/` ? `index` : stripSurroundingSlashes(path)
+  return `${__PATH_PREFIX__}/page-data/${fixedPath}/page-data.json`
 }
 
 const onPrefetchPathname = pathname => {
@@ -170,40 +154,27 @@ const onPrefetchPathname = pathname => {
   }
 }
 
-const onPostPrefetchPathname = pathname => {
-  if (!prefetchCompleted[pathname]) {
-    apiRunner(`onPostPrefetchPathname`, { pathname })
-    prefetchCompleted[pathname] = true
-  }
-}
-
-/**
- * Check if we should fallback to resources for 404 page if resources for a page are not found
- *
- * We can't do that when we don't have full pages manifest - we don't know if page exist or not if we don't have it.
- * We also can't do that on initial render / mount in case we just can't load resources needed for first page.
- * Not falling back to 404 resources will cause "EnsureResources" component to handle scenarios like this with
- * potential reload
- * @param {string} path Path to a page
- */
-const shouldFallbackTo404Resources = path =>
-  (hasPageResourceMap || inInitialRender) && path !== `/404.html`
-
 // Note we're not actively using the path data atm. There
 // could be future optimizations however around trying to ensure
 // we load all resources for likely-to-be-visited paths.
 // let pathArray = []
 // let pathCount = {}
 
-let findPage
 let pathScriptsCache = {}
 let prefetchTriggered = {}
 let prefetchCompleted = {}
 let disableCorePrefetching = false
 
+const onPostPrefetch = url => {
+  if (!prefetchCompleted[url]) {
+    apiRunner(`onPostPrefetch`, { url })
+    prefetchCompleted[url] = true
+  }
+}
+
 const queue = {
-  addPagesArray: newPages => {
-    findPage = pageFinderFactory(newPages, __PATH_PREFIX__)
+  addPageData: pageData => {
+    pageDatas[pageData.path] = pageData
   },
   addDevRequires: devRequires => {
     syncRequires = devRequires
@@ -211,16 +182,11 @@ const queue = {
   addProdRequires: prodRequires => {
     asyncRequires = prodRequires
   },
-  addDataPaths: dataPaths => {
-    jsonDataPaths = dataPaths
-  },
   // Hovering on a link is a very strong indication the user is going to
   // click on it soon so let's start prefetching resources for this
   // pathname.
-  hovering: path => {
-    queue.getResourcesForPathname(path)
-  },
-  enqueue: path => {
+  hovering: path => queue.loadPage(path),
+  enqueue: rawPath => {
     if (!apiRunner)
       console.error(`Run setApiRunnerForLoader() before enqueing paths`)
 
@@ -236,7 +202,7 @@ const queue = {
 
     // Tell plugins with custom prefetching logic that they should start
     // prefetching this path.
-    onPrefetchPathname(path)
+    onPrefetchPathname(rawPath)
 
     // If a plugin has disabled core prefetching, stop now.
     if (disableCorePrefetching.some(a => a)) {
@@ -244,204 +210,164 @@ const queue = {
     }
 
     // Check if the page exists.
-    let page = findPage(path)
+    let realPath = cleanAndFindPath(rawPath)
 
-    // In production, we lazy load page metadata. If that
-    // hasn't been fetched yet, start fetching it now.
-    if (
-      process.env.NODE_ENV === `production` &&
-      !page &&
-      !fetchedPageResourceMap
-    ) {
-      // If page wasn't found check and we didn't fetch resources map for
-      // all pages, wait for fetch to complete and try find page again
-      return fetchPageResourceMap().then(() => queue.enqueue(path))
-    }
-
-    if (!page) {
-      return false
+    if (pageDatas[realPath]) {
+      return true
     }
 
     if (
       process.env.NODE_ENV !== `production` &&
       process.env.NODE_ENV !== `test`
     ) {
-      devGetPageData(page.path)
+      // Ensure latest version of page data is in the JSON store
+      devGetPageData(realPath)
     }
 
-    // Prefetch resources.
     if (process.env.NODE_ENV === `production`) {
-      Promise.all([
-        prefetchResource(page.jsonName),
-        prefetchResource(page.componentChunkName),
-      ]).then(() => {
-        // Tell plugins the path has been successfully prefetched
-        onPostPrefetchPathname(path)
-      })
+      const pageDataUrl = makePageDataUrl(realPath)
+      prefetchHelper(pageDataUrl)
+        .then(() =>
+          // This was just prefetched, so will return a response from
+          // the cache instead of making another request to the server
+          fetchPageData(realPath)
+        )
+        .then(pageData => {
+          // Tell plugins the path has been successfully prefetched
+          const chunkName = pageData.componentChunkName
+          const componentUrls = createComponentUrls(chunkName)
+          return Promise.all(componentUrls.map(prefetchHelper)).then(() => {
+            const resourceUrls = [pageDataUrl].concat(componentUrls)
+            onPostPrefetch({
+              path: rawPath,
+              resourceUrls,
+            })
+          })
+        })
     }
 
     return true
   },
 
-  getPage: pathname => findPage(pathname),
-
-  getResourceURLsForPathname: path => {
-    const page = findPage(path)
-    if (page) {
-      return [
-        ...createComponentUrls(page.componentChunkName),
-        createJsonURL(jsonDataPaths[page.jsonName]),
-      ]
-    } else {
-      return null
-    }
-  },
-
-  getResourcesForPathnameSync: path => {
-    const page = findPage(path)
-    if (page) {
-      return pathScriptsCache[page.path]
-    } else if (shouldFallbackTo404Resources(path)) {
-      return queue.getResourcesForPathnameSync(`/404.html`)
-    } else {
-      return null
-    }
-  },
+  isPageNotFound: pathname => pageNotFoundPaths.has(pathname),
 
-  // Get resources (code/data) for a path. Fetches metdata first
-  // if necessary and then the code/data bundles. Used for prefetching
-  // and getting resources for page changes.
-  getResourcesForPathname: path =>
+  loadPageData: rawPath =>
     new Promise((resolve, reject) => {
-      // Production code path
-      if (failedPaths[path]) {
-        handleResourceLoadError(
-          path,
-          `Previously detected load failure for "${path}"`
-        )
-        reject()
-        return
-      }
-      const page = findPage(path)
-
-      // In production, we lazy load page metadata. If that
-      // hasn't been fetched yet, start fetching it now.
-      if (
-        !page &&
-        !fetchedPageResourceMap &&
-        process.env.NODE_ENV === `production`
-      ) {
-        // If page wasn't found check and we didn't fetch resources map for
-        // all pages, wait for fetch to complete and try to get resources again
-        fetchPageResourceMap().then(() =>
-          resolve(queue.getResourcesForPathname(path))
-        )
-        return
-      }
-
-      if (!page) {
-        if (shouldFallbackTo404Resources(path)) {
-          console.log(`A page wasn't found for "${path}"`)
-
-          // Preload the custom 404 page
-          resolve(queue.getResourcesForPathname(`/404.html`))
-          return
-        }
-
-        resolve()
-        return
-      }
-
-      // Use the path from the page so the pathScriptsCache uses
-      // the normalized path.
-      path = page.path
-
-      // Check if it's in the cache already.
-      if (pathScriptsCache[path]) {
-        emitter.emit(`onPostLoadPageResources`, {
-          page,
-          pageResources: pathScriptsCache[path],
+      const realPath = cleanAndFindPath(rawPath)
+      if (!fetchedPageData[realPath]) {
+        fetchPageData(realPath).then(pageData => {
+          if (process.env.NODE_ENV !== `production`) {
+            devGetPageData(realPath)
+          }
+          resolve(queue.loadPageData(rawPath))
         })
-        resolve(pathScriptsCache[path])
-        return
+      } else {
+        if (pageDatas[realPath]) {
+          resolve(pageDatas[realPath])
+        } else {
+          reject(new Error(`page not found`))
+        }
       }
+    }),
 
-      // Nope, we need to load resource(s)
-      emitter.emit(`onPreLoadPageResources`, {
-        path,
+  loadPage: rawPath =>
+    queue
+      .loadPageData(rawPath)
+      .then(pageData => {
+        if (process.env.NODE_ENV !== `production`) {
+          const component = syncRequires.components[pageData.componentChunkName]
+          return [pageData, component]
+        } else {
+          return cachedFetch(pageData.componentChunkName, fetchComponent)
+            .then(preferDefault)
+            .then(component => [pageData, component])
+        }
       })
+      .then(([pageData, component]) => {
+        const page = {
+          componentChunkName: pageData.componentChunkName,
+          path: pageData.path,
+          compilationHash: pageData.compilationHash,
+        }
+
+        const jsonData = {
+          data: pageData.data,
+          pageContext: pageData.pageContext,
+        }
 
-      // In development we know the code is loaded already
-      // so we just return with it immediately.
-      if (process.env.NODE_ENV !== `production`) {
         const pageResources = {
-          component: syncRequires.components[page.componentChunkName],
+          component,
+          json: jsonData,
           page,
         }
 
-        // Add to the cache.
-        pathScriptsCache[path] = pageResources
-        devGetPageData(page.path).then(pageData => {
-          emitter.emit(`onPostLoadPageResources`, {
-            page,
-            pageResources,
+        pathScriptsCache[cleanAndFindPath(rawPath)] = pageResources
+        emitter.emit(`onPostLoadPageResources`, {
+          page: pageResources,
+          pageResources,
+        })
+        if (process.env.NODE_ENV === `production`) {
+          const pageDataUrl = makePageDataUrl(cleanAndFindPath(rawPath))
+          const componentUrls = createComponentUrls(pageData.componentChunkName)
+          const resourceUrls = [pageDataUrl].concat(componentUrls)
+          onPostPrefetch({
+            path: rawPath,
+            resourceUrls,
           })
-          // Tell plugins the path has been successfully prefetched
-          onPostPrefetchPathname(path)
+        }
 
-          resolve(pageResources)
-        })
-      } else {
-        Promise.all([
-          getResourceModule(page.componentChunkName),
-          getResourceModule(page.jsonName),
-        ]).then(([component, json]) => {
-          if (!(component && json)) {
-            resolve(null)
-            return
-          }
+        return pageResources
+      })
+      .catch(err => null),
 
-          const pageResources = {
-            component,
-            json,
-            page,
-          }
-          pageResources.page.jsonURL = createJsonURL(
-            jsonDataPaths[page.jsonName]
-          )
-          pathScriptsCache[path] = pageResources
-          resolve(pageResources)
-
-          emitter.emit(`onPostLoadPageResources`, {
-            page,
-            pageResources,
-          })
+  getPage: rawPath => pathScriptsCache[cleanAndFindPath(rawPath)],
 
-          // Tell plugins the path has been successfully prefetched
-          onPostPrefetchPathname(path)
-        })
-      }
-    }),
-}
+  getPageOr404: rawPath => {
+    const page = queue.getPage(rawPath)
+    if (page) {
+      return page
+    } else if (rawPath !== `/404.html`) {
+      return queue.getPage(`/404.html`)
+    } else {
+      return null
+    }
+  },
 
-export const postInitialRenderWork = () => {
-  inInitialRender = false
-  if (process.env.NODE_ENV === `production`) {
-    // We got all resources needed for first mount,
-    // we can fetch resources for all pages.
-    fetchPageResourceMap()
-  }
+  getResourceURLsForPathname: path => {
+    const pageData = queue.getPage(path)
+    if (pageData) {
+      // Original implementation also concatenated the jsonDataPath
+      // for the page
+      return createComponentUrls(pageData.componentChunkName)
+    } else {
+      return null
+    }
+  },
 }
 
+// Deprecated April 2019. Used to fetch the pages-manifest. Now it's a
+// noop
+export const postInitialRenderWork = () => {}
+
 export const setApiRunnerForLoader = runner => {
   apiRunner = runner
   disableCorePrefetching = apiRunner(`disableCorePrefetching`)
 }
 
 export const publicLoader = {
-  getResourcesForPathname: queue.getResourcesForPathname,
+  // Deprecated April 2019. Use `loadPage` instead
+  getResourcesForPathname: queue.loadPage,
+  // Deprecated April 2019. Use `getPage` instead
+  getResourcesForPathnameSync: queue.getPage,
+  // Deprecated April 2019. Query results used to be in a separate
+  // file, but are now included in the page-data.json, which is
+  // already loaded into the browser by the time this function is
+  // called. Use the resource URLs passed in `onPostPrefetch` instead.
   getResourceURLsForPathname: queue.getResourceURLsForPathname,
-  getResourcesForPathnameSync: queue.getResourcesForPathnameSync,
+
+  loadPage: queue.loadPage,
+  getPage: queue.getPage,
+  getPageOr404: queue.getPageOr404,
 }
 
 export default queue
diff --git a/node_modules/gatsby/cache-dir/navigation.js b/node_modules/gatsby/cache-dir/navigation.js
index 6289cc2..5acdbef 100644
--- a/node_modules/gatsby/cache-dir/navigation.js
+++ b/node_modules/gatsby/cache-dir/navigation.js
@@ -18,7 +18,7 @@ function maybeRedirect(pathname) {
 
   if (redirect != null) {
     if (process.env.NODE_ENV !== `production`) {
-      const pageResources = loader.getResourcesForPathnameSync(pathname)
+      const pageResources = loader.getPage(pathname)
 
       if (pageResources != null) {
         console.error(
@@ -81,7 +81,19 @@ const navigate = (to, options = {}) => {
     })
   }, 1000)
 
-  loader.getResourcesForPathname(pathname).then(pageResources => {
+  loader.loadPage(pathname).then(pageResources => {
+    // If the loaded page has a different compilation hash to the
+    // window, then a rebuild has occurred on the server. Reload.
+    if (process.env.NODE_ENV === `production` && pageResources) {
+      if (pageResources.page.compilationHash !== window.___compilationHash) {
+        console.log(
+          `compilation has different. window = ${
+            window.___compilationHash
+          }, page = ${pageResources.page.compilationHash}`
+        )
+        window.location = pathname
+      }
+    }
     reachNavigate(to, options)
     clearTimeout(timeoutId)
   })
diff --git a/node_modules/gatsby/cache-dir/production-app.js b/node_modules/gatsby/cache-dir/production-app.js
index c3067b6..0b8d06c 100644
--- a/node_modules/gatsby/cache-dir/production-app.js
+++ b/node_modules/gatsby/cache-dir/production-app.js
@@ -2,7 +2,6 @@ import { apiRunner, apiRunnerAsync } from "./api-runner-browser"
 import React, { createElement } from "react"
 import ReactDOM from "react-dom"
 import { Router, navigate } from "@reach/router"
-import { match } from "@reach/router/lib/utils"
 import { ScrollContext } from "gatsby-react-router-scroll"
 import domReady from "@mikaelkristiansson/domready"
 import {
@@ -13,15 +12,15 @@ import {
 import emitter from "./emitter"
 import PageRenderer from "./page-renderer"
 import asyncRequires from "./async-requires"
-import loader, { setApiRunnerForLoader, postInitialRenderWork } from "./loader"
+import loader, { setApiRunnerForLoader } from "./loader"
 import EnsureResources from "./ensure-resources"
 
 window.asyncRequires = asyncRequires
 window.___emitter = emitter
 window.___loader = loader
+window.___compilationHash = window.pageData.compilationHash
 
-loader.addPagesArray([window.page])
-loader.addDataPaths({ [window.page.jsonName]: window.dataPath })
+loader.addPageData([window.pageData])
 loader.addProdRequires(asyncRequires)
 setApiRunnerForLoader(apiRunner)
 
@@ -61,29 +60,26 @@ apiRunnerAsync(`onClientEntry`).then(() => {
     }
   }
 
-  const { page, location: browserLoc } = window
+  const { pageData, location: browserLoc } = window
   if (
     // Make sure the window.page object is defined
-    page &&
+    pageData &&
     // The canonical path doesn't match the actual path (i.e. the address bar)
-    __PATH_PREFIX__ + page.path !== browserLoc.pathname &&
-    // ...and if matchPage is specified, it also doesn't match the actual path
-    (!page.matchPath ||
-      !match(__PATH_PREFIX__ + page.matchPath, browserLoc.pathname)) &&
+    __PATH_PREFIX__ + pageData.path !== browserLoc.pathname &&
     // Ignore 404 pages, since we want to keep the same URL
-    page.path !== `/404.html` &&
-    !page.path.match(/^\/404\/?$/) &&
+    pageData.path !== `/404.html` &&
+    !pageData.path.match(/^\/404\/?$/) &&
     // Also ignore the offline shell (since when using the offline plugin, all
     // pages have this canonical path)
-    !page.path.match(/^\/offline-plugin-app-shell-fallback\/?$/)
+    !pageData.path.match(/^\/offline-plugin-app-shell-fallback\/?$/)
   ) {
     navigate(
-      __PATH_PREFIX__ + page.path + browserLoc.search + browserLoc.hash,
+      __PATH_PREFIX__ + pageData.path + browserLoc.search + browserLoc.hash,
       { replace: true }
     )
   }
 
-  loader.getResourcesForPathname(browserLoc.pathname).then(() => {
+  loader.loadPage(browserLoc.pathname).then(() => {
     const Root = () =>
       createElement(
         Router,
@@ -117,7 +113,6 @@ apiRunnerAsync(`onClientEntry`).then(() => {
           ? document.getElementById(`___gatsby`)
           : void 0,
         () => {
-          postInitialRenderWork()
           apiRunner(`onInitialClientRender`)
         }
       )
diff --git a/node_modules/gatsby/cache-dir/public-page-renderer-dev.js b/node_modules/gatsby/cache-dir/public-page-renderer-dev.js
index 5d283d0..b274fd7 100644
--- a/node_modules/gatsby/cache-dir/public-page-renderer-dev.js
+++ b/node_modules/gatsby/cache-dir/public-page-renderer-dev.js
@@ -6,7 +6,7 @@ import loader from "./loader"
 import JSONStore from "./json-store"
 
 const DevPageRenderer = ({ location }) => {
-  const pageResources = loader.getResourcesForPathnameSync(location.pathname)
+  const pageResources = loader.getPage(location.pathname)
   return React.createElement(JSONStore, {
     pages,
     location,
diff --git a/node_modules/gatsby/cache-dir/public-page-renderer-prod.js b/node_modules/gatsby/cache-dir/public-page-renderer-prod.js
index 9734692..dc814f8 100644
--- a/node_modules/gatsby/cache-dir/public-page-renderer-prod.js
+++ b/node_modules/gatsby/cache-dir/public-page-renderer-prod.js
@@ -5,7 +5,7 @@ import InternalPageRenderer from "./page-renderer"
 import loader from "./loader"
 
 const ProdPageRenderer = ({ location }) => {
-  const pageResources = loader.getResourcesForPathnameSync(location.pathname)
+  const pageResources = loader.getPageOr404(location.pathname)
   return React.createElement(InternalPageRenderer, {
     location,
     pageResources,
diff --git a/node_modules/gatsby/cache-dir/root.js b/node_modules/gatsby/cache-dir/root.js
index e4c0147..247e430 100644
--- a/node_modules/gatsby/cache-dir/root.js
+++ b/node_modules/gatsby/cache-dir/root.js
@@ -8,9 +8,8 @@ import {
   RouteUpdates,
 } from "./navigation"
 import { apiRunner } from "./api-runner-browser"
-import syncRequires from "./sync-requires"
-import pages from "./pages.json"
 import loader from "./loader"
+import devLoader from "./dev-loader"
 import JSONStore from "./json-store"
 import EnsureResources from "./ensure-resources"
 
@@ -38,12 +37,10 @@ navigationInit()
 class RouteHandler extends React.Component {
   render() {
     let { location } = this.props
+    const pages = devLoader.getPagesManifest()
+    const pagePaths = Object.keys(pages)
 
-    // check if page exists - in dev pages are sync loaded, it's safe to use
-    // loader.getPage
-    let page = loader.getPage(location.pathname)
-
-    if (page) {
+    if (!loader.isPageNotFound(location.pathname)) {
       return (
         <EnsureResources location={location}>
           {locationAndPageResources => (
@@ -52,24 +49,20 @@ class RouteHandler extends React.Component {
                 location={location}
                 shouldUpdateScroll={shouldUpdateScroll}
               >
-                <JSONStore
-                  pages={pages}
-                  {...this.props}
-                  {...locationAndPageResources}
-                />
+                <JSONStore {...this.props} {...locationAndPageResources} />
               </ScrollContext>
             </RouteUpdates>
           )}
         </EnsureResources>
       )
     } else {
-      const dev404Page = pages.find(p => /^\/dev-404-page\/?$/.test(p.path))
-      const Dev404Page = syncRequires.components[dev404Page.componentChunkName]
+      const dev404Page = loader.getPage(`/dev-404-page/`)
+      const Dev404Page = dev404Page.component
 
       if (!loader.getPage(`/404.html`)) {
         return (
           <RouteUpdates location={location}>
-            <Dev404Page pages={pages} {...this.props} />
+            <Dev404Page {...this.props} pagePaths={pagePaths} />
           </RouteUpdates>
         )
       }
@@ -79,13 +72,9 @@ class RouteHandler extends React.Component {
           {locationAndPageResources => (
             <RouteUpdates location={location}>
               <Dev404Page
-                pages={pages}
+                pagePaths={pagePaths}
                 custom404={
-                  <JSONStore
-                    pages={pages}
-                    {...this.props}
-                    {...locationAndPageResources}
-                  />
+                  <JSONStore {...this.props} {...locationAndPageResources} />
                 }
                 {...this.props}
               />
diff --git a/node_modules/gatsby/cache-dir/socketIo.js b/node_modules/gatsby/cache-dir/socketIo.js
index 978f7db..1548f39 100644
--- a/node_modules/gatsby/cache-dir/socketIo.js
+++ b/node_modules/gatsby/cache-dir/socketIo.js
@@ -20,7 +20,7 @@ export default function socketIo() {
 
         const didDataChange = (msg, queryData) =>
           !(msg.payload.id in queryData) ||
-          JSON.stringify(msg.payload.result) !==
+          JSON.stringify(msg.payload) !==
             JSON.stringify(queryData[msg.payload.id])
 
         socket.on(`message`, msg => {
@@ -28,14 +28,14 @@ export default function socketIo() {
             if (didDataChange(msg, staticQueryData)) {
               staticQueryData = {
                 ...staticQueryData,
-                [msg.payload.id]: msg.payload.result,
+                [msg.payload.id]: msg.payload,
               }
             }
           } else if (msg.type === `pageQueryResult`) {
             if (didDataChange(msg, pageQueryData)) {
               pageQueryData = {
                 ...pageQueryData,
-                [msg.payload.id]: msg.payload.result,
+                [msg.payload.id]: msg.payload,
               }
             }
           } else if (msg.type === `overlayError`) {
diff --git a/node_modules/gatsby/cache-dir/static-entry.js b/node_modules/gatsby/cache-dir/static-entry.js
index aa3b9cf..6f92417 100644
--- a/node_modules/gatsby/cache-dir/static-entry.js
+++ b/node_modules/gatsby/cache-dir/static-entry.js
@@ -7,13 +7,8 @@ const { get, merge, isObject, flatten, uniqBy } = require(`lodash`)
 
 const apiRunner = require(`./api-runner-ssr`)
 const syncRequires = require(`./sync-requires`)
-const { dataPaths, pages } = require(`./data.json`)
 const { version: gatsbyVersion } = require(`gatsby/package.json`)
 
-// Speed up looking up pages.
-const pagesObjectMap = new Map()
-pages.forEach(p => pagesObjectMap.set(p.path, p))
-
 const stats = JSON.parse(
   fs.readFileSync(`${process.cwd()}/public/webpack.stats.json`, `utf-8`)
 )
@@ -45,7 +40,27 @@ try {
 
 Html = Html && Html.__esModule ? Html.default : Html
 
-const getPage = path => pagesObjectMap.get(path)
+const getPageDataPath = path => {
+  const fixedPagePath = path === `/` ? `index` : path
+  return join(`page-data`, fixedPagePath, `page-data.json`)
+}
+
+const getPageDataUrl = pagePath => {
+  const pageDataPath = getPageDataPath(pagePath)
+  return `${__PATH_PREFIX__}/${pageDataPath}`
+}
+
+const getPageDataFile = pagePath => {
+  const pageDataPath = getPageDataPath(pagePath)
+  return join(process.cwd(), `public`, pageDataPath)
+}
+
+const loadPageDataSync = pagePath => {
+  const pageDataPath = getPageDataPath(pagePath)
+  const pageDataFile = join(process.cwd(), `public`, pageDataPath)
+  const pageDataJson = fs.readFileSync(pageDataFile)
+  return JSON.parse(pageDataJson)
+}
 
 const createElement = React.createElement
 
@@ -122,33 +137,20 @@ export default (pagePath, callback) => {
     postBodyComponents = sanitizeComponents(components)
   }
 
-  const page = getPage(pagePath)
-
-  let dataAndContext = {}
-  if (page.jsonName in dataPaths) {
-    const pathToJsonData = join(
-      process.cwd(),
-      `/public/static/d`,
-      `${dataPaths[page.jsonName]}.json`
-    )
-    try {
-      dataAndContext = JSON.parse(fs.readFileSync(pathToJsonData))
-    } catch (e) {
-      console.log(`error`, pathToJsonData, e)
-      process.exit()
-    }
-  }
+  const pageDataRaw = fs.readFileSync(getPageDataFile(pagePath))
+  const pageData = JSON.parse(pageDataRaw)
+  const pageDataUrl = getPageDataUrl(pagePath)
+  const { componentChunkName } = pageData
 
   class RouteHandler extends React.Component {
     render() {
       const props = {
         ...this.props,
-        ...dataAndContext,
-        pathContext: dataAndContext.pageContext,
+        ...pageData,
       }
 
       const pageElement = createElement(
-        syncRequires.components[page.componentChunkName],
+        syncRequires.components[componentChunkName],
         props
       )
 
@@ -212,7 +214,7 @@ export default (pagePath, callback) => {
 
   // Create paths to scripts
   let scriptsAndStyles = flatten(
-    [`app`, page.componentChunkName].map(s => {
+    [`app`, componentChunkName].map(s => {
       const fetchKey = `assetsByChunkName[${s}]`
 
       let chunks = get(stats, fetchKey)
@@ -266,6 +268,7 @@ export default (pagePath, callback) => {
     setPostBodyComponents,
     setBodyProps,
     pathname: pagePath,
+    loadPageDataSync,
     bodyHtml,
     scripts,
     styles,
@@ -287,16 +290,13 @@ export default (pagePath, callback) => {
       )
     })
 
-  if (page.jsonName in dataPaths) {
-    const dataPath = `${__PATH_PREFIX__}/static/d/${
-      dataPaths[page.jsonName]
-    }.json`
+  if (pageData) {
     headComponents.push(
       <link
         as="fetch"
         rel="preload"
-        key={dataPath}
-        href={dataPath}
+        key={pageDataUrl}
+        href={pageDataUrl}
         crossOrigin="use-credentials"
       />
     )
@@ -334,11 +334,7 @@ export default (pagePath, callback) => {
     })
 
   // Add page metadata for the current page
-  const windowData = `/*<![CDATA[*/window.page=${JSON.stringify(page)};${
-    page.jsonName in dataPaths
-      ? `window.dataPath="${dataPaths[page.jsonName]}";`
-      : ``
-  }/*]]>*/`
+  const windowData = `/*<![CDATA[*/window.pageData=${pageDataRaw};/*]]>*/`
 
   postBodyComponents.push(
     <script
diff --git a/node_modules/gatsby/dist/.DS_Store b/node_modules/gatsby/dist/.DS_Store
new file mode 100644
index 0000000..bab6cd0
Binary files /dev/null and b/node_modules/gatsby/dist/.DS_Store differ
diff --git a/node_modules/gatsby/dist/bin/gatsby.js b/node_modules/gatsby/dist/bin/gatsby.js
old mode 100755
new mode 100644
diff --git a/node_modules/gatsby/dist/bootstrap/index.js b/node_modules/gatsby/dist/bootstrap/index.js
index 5caa051..145f91c 100644
--- a/node_modules/gatsby/dist/bootstrap/index.js
+++ b/node_modules/gatsby/dist/bootstrap/index.js
@@ -18,8 +18,6 @@ const del = require(`del`);
 
 const path = require(`path`);
 
-const convertHrtime = require(`convert-hrtime`);
-
 const Promise = require(`bluebird`);
 
 const telemetry = require(`gatsby-telemetry`);
@@ -58,19 +56,13 @@ process.on(`unhandledRejection`, (reason, p) => {
   report.panic(reason);
 });
 
-const _require3 = require(`../internal-plugins/query-runner/query-watcher`),
+const _require3 = require(`../query/query-watcher`),
       extractQueries = _require3.extractQueries;
 
-const _require4 = require(`../internal-plugins/query-runner/page-query-runner`),
-      runInitialQueries = _require4.runInitialQueries;
-
-const queryQueue = require(`../internal-plugins/query-runner/query-queue`);
-
-const _require5 = require(`../internal-plugins/query-runner/pages-writer`),
-      writePages = _require5.writePages;
+const writeJsRequires = require(`./write-js-requires`);
 
-const _require6 = require(`../internal-plugins/query-runner/redirects-writer`),
-      writeRedirects = _require6.writeRedirects; // Override console.log to add the source file + line number.
+const _require4 = require(`./redirects-writer`),
+      writeRedirects = _require4.writeRedirects; // Override console.log to add the source file + line number.
 // Useful for debugging if you lose a console.log somewhere.
 // Otherwise leave commented out.
 // require(`./log-line-function`)
@@ -164,8 +156,11 @@ function () {
     const hashes = yield Promise.all([md5File(`package.json`), Promise.resolve(md5File(`${program.directory}/gatsby-config.js`).catch(() => {})), // ignore as this file isn't required),
     Promise.resolve(md5File(`${program.directory}/gatsby-node.js`).catch(() => {}))]);
     const pluginsHash = crypto.createHash(`md5`).update(JSON.stringify(pluginVersions.concat(hashes))).digest(`hex`);
-    let state = store.getState();
-    const oldPluginsHash = state && state.status ? state.status.PLUGINS_HASH : ``; // Check if anything has changed. If it has, delete the site's .cache
+
+    const _store$getState = store.getState(),
+          status = _store$getState.status;
+
+    const oldPluginsHash = status ? status.PLUGINS_HASH : ``; // Check if anything has changed. If it has, delete the site's .cache
     // directory and tell reducers to empty themselves.
     //
     // Also if the hash isn't there, then delete things just in case something
@@ -413,99 +408,17 @@ function () {
     });
     activity.start();
     yield extractQueries();
-    activity.end(); // Start the createPages hot reloader.
-
-    if (process.env.NODE_ENV !== `production`) {
-      require(`./page-hot-reloader`)(graphqlRunner);
-    } // Run queries
-
-
-    activity = report.activityTimer(`run graphql queries`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    const startQueries = process.hrtime();
-    queryQueue.on(`task_finish`, () => {
-      const stats = queryQueue.getStats();
-      activity.setStatus(`${stats.total}/${stats.peak} ${(stats.total / convertHrtime(process.hrtime(startQueries)).seconds).toFixed(2)} queries/second`);
-    }); // HACKY!!! TODO: REMOVE IN NEXT REFACTOR
-
-    emitter.emit(`START_QUERY_QUEUE`); // END HACKY
-
-    runInitialQueries(activity);
-    yield new Promise(resolve => queryQueue.on(`drain`, resolve));
     activity.end();
 
-    require(`../redux/actions`).boundActionCreators.setProgramStatus(`BOOTSTRAP_QUERY_RUNNING_FINISHED`); // Write out files.
-
-
-    activity = report.activityTimer(`write out page data`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-
     try {
-      yield writePages();
+      yield writeJsRequires.writeAll(store.getState());
     } catch (err) {
       report.panic(`Failed to write out page data`, err);
     }
 
-    activity.end(); // Write out redirects.
+    yield writeRedirects(); // onPostBootstrap
 
-    activity = report.activityTimer(`write out redirect data`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    yield writeRedirects();
-    activity.end();
-    let onEndJob;
-
-    const checkJobsDone = _.debounce(
-    /*#__PURE__*/
-    function () {
-      var _ref2 = (0, _asyncToGenerator2.default)(function* (resolve) {
-        const state = store.getState();
-
-        if (state.jobs.active.length === 0) {
-          emitter.off(`END_JOB`, onEndJob);
-          yield finishBootstrap(bootstrapSpan);
-          resolve({
-            graphqlRunner
-          });
-        }
-      });
-
-      return function (_x2) {
-        return _ref2.apply(this, arguments);
-      };
-    }(), 100);
-
-    if (store.getState().jobs.active.length === 0) {
-      yield finishBootstrap(bootstrapSpan);
-      return {
-        graphqlRunner
-      };
-    } else {
-      return new Promise(resolve => {
-        // Wait until all side effect jobs are finished.
-        onEndJob = () => checkJobsDone(resolve);
-
-        emitter.on(`END_JOB`, onEndJob);
-      });
-    }
-  });
-
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
-
-const finishBootstrap =
-/*#__PURE__*/
-function () {
-  var _ref3 = (0, _asyncToGenerator2.default)(function* (bootstrapSpan) {
-    // onPostBootstrap
-    const activity = report.activityTimer(`onPostBootstrap`, {
+    activity = report.activityTimer(`onPostBootstrap`, {
       parentSpan: bootstrapSpan
     });
     activity.start();
@@ -521,10 +434,13 @@ function () {
     require(`../redux/actions`).boundActionCreators.setProgramStatus(`BOOTSTRAP_FINISHED`);
 
     bootstrapSpan.finish();
+    return {
+      graphqlRunner
+    };
   });
 
-  return function finishBootstrap(_x3) {
-    return _ref3.apply(this, arguments);
+  return function (_x) {
+    return _ref.apply(this, arguments);
   };
 }();
 //# sourceMappingURL=index.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/bootstrap/index.js.map b/node_modules/gatsby/dist/bootstrap/index.js.map
index 1cc757a..813241e 100644
--- a/node_modules/gatsby/dist/bootstrap/index.js.map
+++ b/node_modules/gatsby/dist/bootstrap/index.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/bootstrap/index.js"],"names":["_","require","slash","fs","md5File","crypto","del","path","convertHrtime","Promise","telemetry","apiRunnerNode","getBrowserslist","graphql","store","emitter","loadPlugins","loadThemes","report","getConfigFile","tracer","globalTracer","preferDefault","nodeTracking","withResolverContext","startAutosave","process","on","reason","p","panic","extractQueries","runInitialQueries","queryQueue","writePages","writeRedirects","module","exports","args","spanArgs","parentSpan","childOf","bootstrapSpan","startSpan","directory","program","browserslist","dispatch","type","payload","activity","activityTimer","start","config","__experimentalThemes","themes","polyfill","warn","end","flattenedPlugins","decorateEvent","plugins","map","name","version","span","env","NODE_ENV","pluginVersions","hashes","all","resolve","catch","pluginsHash","createHash","update","JSON","stringify","concat","digest","state","getState","oldPluginsHash","status","PLUGINS_HASH","info","stripIndent","cacheDirectory","remove","emptyDir","e","error","ensureDir","GATSBY_DB_NODES","loki","dbSaveFile","saveFile","dirname","trackDbNodes","srcDir","__dirname","siteDir","tryRequire","copy","clobber","ensureDirSync","err","hasAPIFile","plugin","skipSSR","undefined","envAPIs","join","Array","isArray","length","ssrPlugins","filter","options","pluginOptions","browserPlugins","browserPluginsRequires","browserAPIRunner","sSRAPIRunner","readFileSync","ssrPluginsRequires","writeFileSync","build","extensions","apiResults","traceId","flattenDeep","graphqlRunner","query","context","schema","waitForCascadingActions","rebuildWithSitePage","startQueries","hrtime","stats","getStats","setStatus","total","peak","seconds","toFixed","emit","boundActionCreators","setProgramStatus","onEndJob","checkJobsDone","debounce","jobs","active","off","finishBootstrap","log","uptime","finish"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst _ = require(`lodash`)\nconst slash = require(`slash`)\nconst fs = require(`fs-extra`)\nconst md5File = require(`md5-file/promise`)\nconst crypto = require(`crypto`)\nconst del = require(`del`)\nconst path = require(`path`)\nconst convertHrtime = require(`convert-hrtime`)\nconst Promise = require(`bluebird`)\nconst telemetry = require(`gatsby-telemetry`)\n\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst getBrowserslist = require(`../utils/browserslist`)\nconst { graphql } = require(`graphql`)\nconst { store, emitter } = require(`../redux`)\nconst loadPlugins = require(`./load-plugins`)\nconst loadThemes = require(`./load-themes`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst getConfigFile = require(`./get-config-file`)\nconst tracer = require(`opentracing`).globalTracer()\nconst preferDefault = require(`./prefer-default`)\nconst nodeTracking = require(`../db/node-tracking`)\nconst withResolverContext = require(`../schema/context`)\nrequire(`../db`).startAutosave()\n\n// Show stack trace on unhandled promises.\nprocess.on(`unhandledRejection`, (reason, p) => {\n  report.panic(reason)\n})\n\nconst {\n  extractQueries,\n} = require(`../internal-plugins/query-runner/query-watcher`)\nconst {\n  runInitialQueries,\n} = require(`../internal-plugins/query-runner/page-query-runner`)\nconst queryQueue = require(`../internal-plugins/query-runner/query-queue`)\nconst { writePages } = require(`../internal-plugins/query-runner/pages-writer`)\nconst {\n  writeRedirects,\n} = require(`../internal-plugins/query-runner/redirects-writer`)\n\n// Override console.log to add the source file + line number.\n// Useful for debugging if you lose a console.log somewhere.\n// Otherwise leave commented out.\n// require(`./log-line-function`)\n\ntype BootstrapArgs = {\n  directory: string,\n  prefixPaths?: boolean,\n  parentSpan: Object,\n}\n\nmodule.exports = async (args: BootstrapArgs) => {\n  const spanArgs = args.parentSpan ? { childOf: args.parentSpan } : {}\n  const bootstrapSpan = tracer.startSpan(`bootstrap`, spanArgs)\n\n  // Start plugin runner which listens to the store\n  // and invokes Gatsby API based on actions.\n  require(`../redux/plugin-runner`)\n\n  const directory = slash(args.directory)\n\n  const program = {\n    ...args,\n    browserslist: getBrowserslist(directory),\n    // Fix program directory path for windows env.\n    directory,\n  }\n\n  store.dispatch({\n    type: `SET_PROGRAM`,\n    payload: program,\n  })\n\n  // Try opening the site's gatsby-config.js file.\n  let activity = report.activityTimer(`open and validate gatsby-configs`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  let config = await preferDefault(\n    getConfigFile(program.directory, `gatsby-config`)\n  )\n\n  // theme gatsby configs can be functions or objects\n  if (config && config.__experimentalThemes) {\n    const themes = await loadThemes(config)\n    config = themes.config\n\n    store.dispatch({\n      type: `SET_RESOLVED_THEMES`,\n      payload: themes.themes,\n    })\n  }\n\n  if (config && config.polyfill) {\n    report.warn(\n      `Support for custom Promise polyfills has been removed in Gatsby v2. We only support Babel 7's new automatic polyfilling behavior.`\n    )\n  }\n\n  store.dispatch({\n    type: `SET_SITE_CONFIG`,\n    payload: config,\n  })\n\n  activity.end()\n\n  activity = report.activityTimer(`load plugins`)\n  activity.start()\n  const flattenedPlugins = await loadPlugins(config, program.directory)\n  activity.end()\n\n  telemetry.decorateEvent(`BUILD_END`, {\n    plugins: flattenedPlugins.map(p => `${p.name}@${p.version}`),\n  })\n\n  // onPreInit\n  activity = report.activityTimer(`onPreInit`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPreInit`, { parentSpan: activity.span })\n  activity.end()\n\n  // During builds, delete html and css files from the public directory as we don't want\n  // deleted pages and styles from previous builds to stick around.\n  if (process.env.NODE_ENV === `production`) {\n    activity = report.activityTimer(\n      `delete html and css files from previous builds`,\n      {\n        parentSpan: bootstrapSpan,\n      }\n    )\n    activity.start()\n    await del([\n      `public/*.{html,css}`,\n      `public/**/*.{html,css}`,\n      `!public/static`,\n      `!public/static/**/*.{html,css}`,\n    ])\n    activity.end()\n  }\n\n  activity = report.activityTimer(`initialize cache`)\n  activity.start()\n  // Check if any plugins have been updated since our last run. If so\n  // we delete the cache is there's likely been changes\n  // since the previous run.\n  //\n  // We do this by creating a hash of all the version numbers of installed\n  // plugins, the site's package.json, gatsby-config.js, and gatsby-node.js.\n  // The last, gatsby-node.js, is important as many gatsby sites put important\n  // logic in there e.g. generating slugs for custom pages.\n  const pluginVersions = flattenedPlugins.map(p => p.version)\n  const hashes = await Promise.all([\n    md5File(`package.json`),\n    Promise.resolve(\n      md5File(`${program.directory}/gatsby-config.js`).catch(() => {})\n    ), // ignore as this file isn't required),\n    Promise.resolve(\n      md5File(`${program.directory}/gatsby-node.js`).catch(() => {})\n    ), // ignore as this file isn't required),\n  ])\n  const pluginsHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(pluginVersions.concat(hashes)))\n    .digest(`hex`)\n  let state = store.getState()\n  const oldPluginsHash = state && state.status ? state.status.PLUGINS_HASH : ``\n\n  // Check if anything has changed. If it has, delete the site's .cache\n  // directory and tell reducers to empty themselves.\n  //\n  // Also if the hash isn't there, then delete things just in case something\n  // is weird.\n  if (oldPluginsHash && pluginsHash !== oldPluginsHash) {\n    report.info(report.stripIndent`\n      One or more of your plugins have changed since the last time you ran Gatsby. As\n      a precaution, we're deleting your site's cache to ensure there's not any stale\n      data\n    `)\n  }\n  const cacheDirectory = `${program.directory}/.cache`\n  if (!oldPluginsHash || pluginsHash !== oldPluginsHash) {\n    try {\n      // Attempt to empty dir if remove fails,\n      // like when directory is mount point\n      await fs.remove(cacheDirectory).catch(() => fs.emptyDir(cacheDirectory))\n    } catch (e) {\n      report.error(`Failed to remove .cache files.`, e)\n    }\n    // Tell reducers to delete their data (the store will already have\n    // been loaded from the file system cache).\n    store.dispatch({\n      type: `DELETE_CACHE`,\n    })\n  }\n\n  // Update the store with the new plugins hash.\n  store.dispatch({\n    type: `UPDATE_PLUGINS_HASH`,\n    payload: pluginsHash,\n  })\n\n  // Now that we know the .cache directory is safe, initialize the cache\n  // directory.\n  await fs.ensureDir(cacheDirectory)\n\n  // Ensure the public/static directory\n  await fs.ensureDir(`${program.directory}/public/static`)\n\n  activity.end()\n\n  if (process.env.GATSBY_DB_NODES === `loki`) {\n    const loki = require(`../db/loki`)\n    // Start the nodes database (in memory loki js with interval disk\n    // saves). If data was saved from a previous build, it will be\n    // loaded here\n    activity = report.activityTimer(`start nodes db`, {\n      parentSpan: bootstrapSpan,\n    })\n    activity.start()\n    const dbSaveFile = `${cacheDirectory}/loki/loki.db`\n    try {\n      await loki.start({\n        saveFile: dbSaveFile,\n      })\n    } catch (e) {\n      report.error(\n        `Error starting DB. Perhaps try deleting ${path.dirname(dbSaveFile)}`\n      )\n    }\n    activity.end()\n  }\n\n  // By now, our nodes database has been loaded, so ensure that we\n  // have tracked all inline objects\n  nodeTracking.trackDbNodes()\n\n  // Copy our site files to the root of the site.\n  activity = report.activityTimer(`copy gatsby files`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  const srcDir = `${__dirname}/../../cache-dir`\n  const siteDir = cacheDirectory\n  const tryRequire = `${__dirname}/../utils/test-require-error.js`\n  try {\n    await fs.copy(srcDir, siteDir, {\n      clobber: true,\n    })\n    await fs.copy(tryRequire, `${siteDir}/test-require-error.js`, {\n      clobber: true,\n    })\n    await fs.ensureDirSync(`${cacheDirectory}/json`)\n\n    // Ensure .cache/fragments exists and is empty. We want fragments to be\n    // added on every run in response to data as fragments can only be added if\n    // the data used to create the schema they're dependent on is available.\n    await fs.emptyDir(`${cacheDirectory}/fragments`)\n  } catch (err) {\n    report.panic(`Unable to copy site files to .cache`, err)\n  }\n\n  // Find plugins which implement gatsby-browser and gatsby-ssr and write\n  // out api-runners for them.\n  const hasAPIFile = (env, plugin) => {\n    // The plugin loader has disabled SSR APIs for this plugin. Usually due to\n    // multiple implementations of an API that can only be implemented once\n    if (env === `ssr` && plugin.skipSSR === true) return undefined\n\n    const envAPIs = plugin[`${env}APIs`]\n\n    // Always include gatsby-browser.js files if they exists as they're\n    // a handy place to include global styles and other global imports.\n    try {\n      if (env === `browser`) {\n        return slash(\n          require.resolve(path.join(plugin.resolve, `gatsby-${env}`))\n        )\n      }\n    } catch (e) {\n      // ignore\n    }\n\n    if (envAPIs && Array.isArray(envAPIs) && envAPIs.length > 0) {\n      return slash(path.join(plugin.resolve, `gatsby-${env}`))\n    }\n    return undefined\n  }\n\n  const ssrPlugins = _.filter(\n    flattenedPlugins.map(plugin => {\n      return {\n        resolve: hasAPIFile(`ssr`, plugin),\n        options: plugin.pluginOptions,\n      }\n    }),\n    plugin => plugin.resolve\n  )\n\n  const browserPlugins = _.filter(\n    flattenedPlugins.map(plugin => {\n      return {\n        resolve: hasAPIFile(`browser`, plugin),\n        options: plugin.pluginOptions,\n      }\n    }),\n    plugin => plugin.resolve\n  )\n\n  const browserPluginsRequires = browserPlugins\n    .map(\n      plugin =>\n        `{\n      plugin: require('${plugin.resolve}'),\n      options: ${JSON.stringify(plugin.options)},\n    }`\n    )\n    .join(`,`)\n\n  const browserAPIRunner = `module.exports = [${browserPluginsRequires}]\\n`\n\n  let sSRAPIRunner = ``\n\n  try {\n    sSRAPIRunner = fs.readFileSync(`${siteDir}/api-runner-ssr.js`, `utf-8`)\n  } catch (err) {\n    report.panic(`Failed to read ${siteDir}/api-runner-ssr.js`, err)\n  }\n\n  const ssrPluginsRequires = ssrPlugins\n    .map(\n      plugin =>\n        `{\n      plugin: require('${plugin.resolve}'),\n      options: ${JSON.stringify(plugin.options)},\n    }`\n    )\n    .join(`,`)\n  sSRAPIRunner = `var plugins = [${ssrPluginsRequires}]\\n${sSRAPIRunner}`\n\n  fs.writeFileSync(\n    `${siteDir}/api-runner-browser-plugins.js`,\n    browserAPIRunner,\n    `utf-8`\n  )\n  fs.writeFileSync(`${siteDir}/api-runner-ssr.js`, sSRAPIRunner, `utf-8`)\n\n  activity.end()\n  /**\n   * Start the main bootstrap processes.\n   */\n\n  // onPreBootstrap\n  activity = report.activityTimer(`onPreBootstrap`)\n  activity.start()\n  await apiRunnerNode(`onPreBootstrap`)\n  activity.end()\n\n  // Source nodes\n  activity = report.activityTimer(`source and transform nodes`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../utils/source-nodes`)({ parentSpan: activity.span })\n  activity.end()\n\n  // Create Schema.\n  activity = report.activityTimer(`building schema`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../schema`).build({ parentSpan: activity.span })\n  activity.end()\n\n  // Collect resolvable extensions and attach to program.\n  const extensions = [`.mjs`, `.js`, `.jsx`, `.wasm`, `.json`]\n  // Change to this being an action and plugins implement `onPreBootstrap`\n  // for adding extensions.\n  const apiResults = await apiRunnerNode(`resolvableExtensions`, {\n    traceId: `initial-resolvableExtensions`,\n    parentSpan: bootstrapSpan,\n  })\n\n  store.dispatch({\n    type: `SET_PROGRAM_EXTENSIONS`,\n    payload: _.flattenDeep([extensions, apiResults]),\n  })\n\n  const graphqlRunner = (query, context = {}) => {\n    const schema = store.getState().schema\n    return graphql(\n      schema,\n      query,\n      context,\n      withResolverContext(context, schema),\n      context\n    )\n  }\n\n  // Collect pages.\n  activity = report.activityTimer(`createPages`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`createPages`, {\n    graphql: graphqlRunner,\n    traceId: `initial-createPages`,\n    waitForCascadingActions: true,\n    parentSpan: activity.span,\n  })\n  activity.end()\n\n  // A variant on createPages for plugins that want to\n  // have full control over adding/removing pages. The normal\n  // \"createPages\" API is called every time (during development)\n  // that data changes.\n  activity = report.activityTimer(`createPagesStatefully`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`createPagesStatefully`, {\n    graphql: graphqlRunner,\n    traceId: `initial-createPagesStatefully`,\n    waitForCascadingActions: true,\n    parentSpan: activity.span,\n  })\n  activity.end()\n\n  activity = report.activityTimer(`onPreExtractQueries`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPreExtractQueries`, { parentSpan: activity.span })\n  activity.end()\n\n  // Update Schema for SitePage.\n  activity = report.activityTimer(`update schema`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../schema`).rebuildWithSitePage({ parentSpan: activity.span })\n  activity.end()\n\n  // Extract queries\n  activity = report.activityTimer(`extract queries from components`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await extractQueries()\n  activity.end()\n\n  // Start the createPages hot reloader.\n  if (process.env.NODE_ENV !== `production`) {\n    require(`./page-hot-reloader`)(graphqlRunner)\n  }\n\n  // Run queries\n  activity = report.activityTimer(`run graphql queries`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  const startQueries = process.hrtime()\n  queryQueue.on(`task_finish`, () => {\n    const stats = queryQueue.getStats()\n    activity.setStatus(\n      `${stats.total}/${stats.peak} ${(\n        stats.total / convertHrtime(process.hrtime(startQueries)).seconds\n      ).toFixed(2)} queries/second`\n    )\n  })\n  // HACKY!!! TODO: REMOVE IN NEXT REFACTOR\n  emitter.emit(`START_QUERY_QUEUE`)\n  // END HACKY\n  runInitialQueries(activity)\n  await new Promise(resolve => queryQueue.on(`drain`, resolve))\n  activity.end()\n\n  require(`../redux/actions`).boundActionCreators.setProgramStatus(\n    `BOOTSTRAP_QUERY_RUNNING_FINISHED`\n  )\n\n  // Write out files.\n  activity = report.activityTimer(`write out page data`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  try {\n    await writePages()\n  } catch (err) {\n    report.panic(`Failed to write out page data`, err)\n  }\n  activity.end()\n\n  // Write out redirects.\n  activity = report.activityTimer(`write out redirect data`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await writeRedirects()\n  activity.end()\n\n  let onEndJob\n\n  const checkJobsDone = _.debounce(async resolve => {\n    const state = store.getState()\n    if (state.jobs.active.length === 0) {\n      emitter.off(`END_JOB`, onEndJob)\n\n      await finishBootstrap(bootstrapSpan)\n      resolve({ graphqlRunner })\n    }\n  }, 100)\n\n  if (store.getState().jobs.active.length === 0) {\n    await finishBootstrap(bootstrapSpan)\n    return { graphqlRunner }\n  } else {\n    return new Promise(resolve => {\n      // Wait until all side effect jobs are finished.\n      onEndJob = () => checkJobsDone(resolve)\n      emitter.on(`END_JOB`, onEndJob)\n    })\n  }\n}\n\nconst finishBootstrap = async bootstrapSpan => {\n  // onPostBootstrap\n  const activity = report.activityTimer(`onPostBootstrap`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPostBootstrap`, { parentSpan: activity.span })\n  activity.end()\n\n  report.log(``)\n  report.info(`bootstrap finished - ${process.uptime()} s`)\n  report.log(``)\n  emitter.emit(`BOOTSTRAP_FINISHED`)\n  require(`../redux/actions`).boundActionCreators.setProgramStatus(\n    `BOOTSTRAP_FINISHED`\n  )\n\n  bootstrapSpan.finish()\n}\n"],"file":"index.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/bootstrap/index.js"],"names":["_","require","slash","fs","md5File","crypto","del","path","Promise","telemetry","apiRunnerNode","getBrowserslist","graphql","store","emitter","loadPlugins","loadThemes","report","getConfigFile","tracer","globalTracer","preferDefault","nodeTracking","withResolverContext","startAutosave","process","on","reason","p","panic","extractQueries","writeJsRequires","writeRedirects","module","exports","args","spanArgs","parentSpan","childOf","bootstrapSpan","startSpan","directory","program","browserslist","dispatch","type","payload","activity","activityTimer","start","config","__experimentalThemes","themes","polyfill","warn","end","flattenedPlugins","decorateEvent","plugins","map","name","version","span","env","NODE_ENV","pluginVersions","hashes","all","resolve","catch","pluginsHash","createHash","update","JSON","stringify","concat","digest","getState","status","oldPluginsHash","PLUGINS_HASH","info","stripIndent","cacheDirectory","remove","emptyDir","e","error","ensureDir","GATSBY_DB_NODES","loki","dbSaveFile","saveFile","dirname","trackDbNodes","srcDir","__dirname","siteDir","tryRequire","copy","clobber","ensureDirSync","err","hasAPIFile","plugin","skipSSR","undefined","envAPIs","join","Array","isArray","length","ssrPlugins","filter","options","pluginOptions","browserPlugins","browserPluginsRequires","browserAPIRunner","sSRAPIRunner","readFileSync","ssrPluginsRequires","writeFileSync","build","extensions","apiResults","traceId","flattenDeep","graphqlRunner","query","context","schema","waitForCascadingActions","rebuildWithSitePage","writeAll","log","uptime","emit","boundActionCreators","setProgramStatus","finish"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst _ = require(`lodash`)\nconst slash = require(`slash`)\nconst fs = require(`fs-extra`)\nconst md5File = require(`md5-file/promise`)\nconst crypto = require(`crypto`)\nconst del = require(`del`)\nconst path = require(`path`)\nconst Promise = require(`bluebird`)\nconst telemetry = require(`gatsby-telemetry`)\n\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst getBrowserslist = require(`../utils/browserslist`)\nconst { graphql } = require(`graphql`)\nconst { store, emitter } = require(`../redux`)\nconst loadPlugins = require(`./load-plugins`)\nconst loadThemes = require(`./load-themes`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst getConfigFile = require(`./get-config-file`)\nconst tracer = require(`opentracing`).globalTracer()\nconst preferDefault = require(`./prefer-default`)\nconst nodeTracking = require(`../db/node-tracking`)\nconst withResolverContext = require(`../schema/context`)\nrequire(`../db`).startAutosave()\n\n// Show stack trace on unhandled promises.\nprocess.on(`unhandledRejection`, (reason, p) => {\n  report.panic(reason)\n})\n\nconst { extractQueries } = require(`../query/query-watcher`)\nconst writeJsRequires = require(`./write-js-requires`)\nconst { writeRedirects } = require(`./redirects-writer`)\n\n// Override console.log to add the source file + line number.\n// Useful for debugging if you lose a console.log somewhere.\n// Otherwise leave commented out.\n// require(`./log-line-function`)\n\ntype BootstrapArgs = {\n  directory: string,\n  prefixPaths?: boolean,\n  parentSpan: Object,\n}\n\nmodule.exports = async (args: BootstrapArgs) => {\n  const spanArgs = args.parentSpan ? { childOf: args.parentSpan } : {}\n  const bootstrapSpan = tracer.startSpan(`bootstrap`, spanArgs)\n\n  // Start plugin runner which listens to the store\n  // and invokes Gatsby API based on actions.\n  require(`../redux/plugin-runner`)\n\n  const directory = slash(args.directory)\n\n  const program = {\n    ...args,\n    browserslist: getBrowserslist(directory),\n    // Fix program directory path for windows env.\n    directory,\n  }\n\n  store.dispatch({\n    type: `SET_PROGRAM`,\n    payload: program,\n  })\n\n  // Try opening the site's gatsby-config.js file.\n  let activity = report.activityTimer(`open and validate gatsby-configs`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  let config = await preferDefault(\n    getConfigFile(program.directory, `gatsby-config`)\n  )\n\n  // theme gatsby configs can be functions or objects\n  if (config && config.__experimentalThemes) {\n    const themes = await loadThemes(config)\n    config = themes.config\n\n    store.dispatch({\n      type: `SET_RESOLVED_THEMES`,\n      payload: themes.themes,\n    })\n  }\n\n  if (config && config.polyfill) {\n    report.warn(\n      `Support for custom Promise polyfills has been removed in Gatsby v2. We only support Babel 7's new automatic polyfilling behavior.`\n    )\n  }\n\n  store.dispatch({\n    type: `SET_SITE_CONFIG`,\n    payload: config,\n  })\n\n  activity.end()\n\n  activity = report.activityTimer(`load plugins`)\n  activity.start()\n  const flattenedPlugins = await loadPlugins(config, program.directory)\n  activity.end()\n\n  telemetry.decorateEvent(`BUILD_END`, {\n    plugins: flattenedPlugins.map(p => `${p.name}@${p.version}`),\n  })\n\n  // onPreInit\n  activity = report.activityTimer(`onPreInit`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPreInit`, { parentSpan: activity.span })\n  activity.end()\n\n  // During builds, delete html and css files from the public directory as we don't want\n  // deleted pages and styles from previous builds to stick around.\n  if (process.env.NODE_ENV === `production`) {\n    activity = report.activityTimer(\n      `delete html and css files from previous builds`,\n      {\n        parentSpan: bootstrapSpan,\n      }\n    )\n    activity.start()\n    await del([\n      `public/*.{html,css}`,\n      `public/**/*.{html,css}`,\n      `!public/static`,\n      `!public/static/**/*.{html,css}`,\n    ])\n    activity.end()\n  }\n\n  activity = report.activityTimer(`initialize cache`)\n  activity.start()\n  // Check if any plugins have been updated since our last run. If so\n  // we delete the cache is there's likely been changes\n  // since the previous run.\n  //\n  // We do this by creating a hash of all the version numbers of installed\n  // plugins, the site's package.json, gatsby-config.js, and gatsby-node.js.\n  // The last, gatsby-node.js, is important as many gatsby sites put important\n  // logic in there e.g. generating slugs for custom pages.\n  const pluginVersions = flattenedPlugins.map(p => p.version)\n  const hashes = await Promise.all([\n    md5File(`package.json`),\n    Promise.resolve(\n      md5File(`${program.directory}/gatsby-config.js`).catch(() => {})\n    ), // ignore as this file isn't required),\n    Promise.resolve(\n      md5File(`${program.directory}/gatsby-node.js`).catch(() => {})\n    ), // ignore as this file isn't required),\n  ])\n  const pluginsHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(pluginVersions.concat(hashes)))\n    .digest(`hex`)\n  const { status } = store.getState()\n  const oldPluginsHash = status ? status.PLUGINS_HASH : ``\n\n  // Check if anything has changed. If it has, delete the site's .cache\n  // directory and tell reducers to empty themselves.\n  //\n  // Also if the hash isn't there, then delete things just in case something\n  // is weird.\n  if (oldPluginsHash && pluginsHash !== oldPluginsHash) {\n    report.info(report.stripIndent`\n      One or more of your plugins have changed since the last time you ran Gatsby. As\n      a precaution, we're deleting your site's cache to ensure there's not any stale\n      data\n    `)\n  }\n  const cacheDirectory = `${program.directory}/.cache`\n  if (!oldPluginsHash || pluginsHash !== oldPluginsHash) {\n    try {\n      // Attempt to empty dir if remove fails,\n      // like when directory is mount point\n      await fs.remove(cacheDirectory).catch(() => fs.emptyDir(cacheDirectory))\n    } catch (e) {\n      report.error(`Failed to remove .cache files.`, e)\n    }\n    // Tell reducers to delete their data (the store will already have\n    // been loaded from the file system cache).\n    store.dispatch({\n      type: `DELETE_CACHE`,\n    })\n  }\n\n  // Update the store with the new plugins hash.\n  store.dispatch({\n    type: `UPDATE_PLUGINS_HASH`,\n    payload: pluginsHash,\n  })\n\n  // Now that we know the .cache directory is safe, initialize the cache\n  // directory.\n  await fs.ensureDir(cacheDirectory)\n\n  // Ensure the public/static directory\n  await fs.ensureDir(`${program.directory}/public/static`)\n\n  activity.end()\n\n  if (process.env.GATSBY_DB_NODES === `loki`) {\n    const loki = require(`../db/loki`)\n    // Start the nodes database (in memory loki js with interval disk\n    // saves). If data was saved from a previous build, it will be\n    // loaded here\n    activity = report.activityTimer(`start nodes db`, {\n      parentSpan: bootstrapSpan,\n    })\n    activity.start()\n    const dbSaveFile = `${cacheDirectory}/loki/loki.db`\n    try {\n      await loki.start({\n        saveFile: dbSaveFile,\n      })\n    } catch (e) {\n      report.error(\n        `Error starting DB. Perhaps try deleting ${path.dirname(dbSaveFile)}`\n      )\n    }\n    activity.end()\n  }\n\n  // By now, our nodes database has been loaded, so ensure that we\n  // have tracked all inline objects\n  nodeTracking.trackDbNodes()\n\n  // Copy our site files to the root of the site.\n  activity = report.activityTimer(`copy gatsby files`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  const srcDir = `${__dirname}/../../cache-dir`\n  const siteDir = cacheDirectory\n  const tryRequire = `${__dirname}/../utils/test-require-error.js`\n  try {\n    await fs.copy(srcDir, siteDir, {\n      clobber: true,\n    })\n    await fs.copy(tryRequire, `${siteDir}/test-require-error.js`, {\n      clobber: true,\n    })\n    await fs.ensureDirSync(`${cacheDirectory}/json`)\n\n    // Ensure .cache/fragments exists and is empty. We want fragments to be\n    // added on every run in response to data as fragments can only be added if\n    // the data used to create the schema they're dependent on is available.\n    await fs.emptyDir(`${cacheDirectory}/fragments`)\n  } catch (err) {\n    report.panic(`Unable to copy site files to .cache`, err)\n  }\n\n  // Find plugins which implement gatsby-browser and gatsby-ssr and write\n  // out api-runners for them.\n  const hasAPIFile = (env, plugin) => {\n    // The plugin loader has disabled SSR APIs for this plugin. Usually due to\n    // multiple implementations of an API that can only be implemented once\n    if (env === `ssr` && plugin.skipSSR === true) return undefined\n\n    const envAPIs = plugin[`${env}APIs`]\n\n    // Always include gatsby-browser.js files if they exists as they're\n    // a handy place to include global styles and other global imports.\n    try {\n      if (env === `browser`) {\n        return slash(\n          require.resolve(path.join(plugin.resolve, `gatsby-${env}`))\n        )\n      }\n    } catch (e) {\n      // ignore\n    }\n\n    if (envAPIs && Array.isArray(envAPIs) && envAPIs.length > 0) {\n      return slash(path.join(plugin.resolve, `gatsby-${env}`))\n    }\n    return undefined\n  }\n\n  const ssrPlugins = _.filter(\n    flattenedPlugins.map(plugin => {\n      return {\n        resolve: hasAPIFile(`ssr`, plugin),\n        options: plugin.pluginOptions,\n      }\n    }),\n    plugin => plugin.resolve\n  )\n\n  const browserPlugins = _.filter(\n    flattenedPlugins.map(plugin => {\n      return {\n        resolve: hasAPIFile(`browser`, plugin),\n        options: plugin.pluginOptions,\n      }\n    }),\n    plugin => plugin.resolve\n  )\n\n  const browserPluginsRequires = browserPlugins\n    .map(\n      plugin =>\n        `{\n      plugin: require('${plugin.resolve}'),\n      options: ${JSON.stringify(plugin.options)},\n    }`\n    )\n    .join(`,`)\n\n  const browserAPIRunner = `module.exports = [${browserPluginsRequires}]\\n`\n\n  let sSRAPIRunner = ``\n\n  try {\n    sSRAPIRunner = fs.readFileSync(`${siteDir}/api-runner-ssr.js`, `utf-8`)\n  } catch (err) {\n    report.panic(`Failed to read ${siteDir}/api-runner-ssr.js`, err)\n  }\n\n  const ssrPluginsRequires = ssrPlugins\n    .map(\n      plugin =>\n        `{\n      plugin: require('${plugin.resolve}'),\n      options: ${JSON.stringify(plugin.options)},\n    }`\n    )\n    .join(`,`)\n  sSRAPIRunner = `var plugins = [${ssrPluginsRequires}]\\n${sSRAPIRunner}`\n\n  fs.writeFileSync(\n    `${siteDir}/api-runner-browser-plugins.js`,\n    browserAPIRunner,\n    `utf-8`\n  )\n  fs.writeFileSync(`${siteDir}/api-runner-ssr.js`, sSRAPIRunner, `utf-8`)\n\n  activity.end()\n  /**\n   * Start the main bootstrap processes.\n   */\n\n  // onPreBootstrap\n  activity = report.activityTimer(`onPreBootstrap`)\n  activity.start()\n  await apiRunnerNode(`onPreBootstrap`)\n  activity.end()\n\n  // Source nodes\n  activity = report.activityTimer(`source and transform nodes`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../utils/source-nodes`)({ parentSpan: activity.span })\n  activity.end()\n\n  // Create Schema.\n  activity = report.activityTimer(`building schema`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../schema`).build({ parentSpan: activity.span })\n  activity.end()\n\n  // Collect resolvable extensions and attach to program.\n  const extensions = [`.mjs`, `.js`, `.jsx`, `.wasm`, `.json`]\n  // Change to this being an action and plugins implement `onPreBootstrap`\n  // for adding extensions.\n  const apiResults = await apiRunnerNode(`resolvableExtensions`, {\n    traceId: `initial-resolvableExtensions`,\n    parentSpan: bootstrapSpan,\n  })\n\n  store.dispatch({\n    type: `SET_PROGRAM_EXTENSIONS`,\n    payload: _.flattenDeep([extensions, apiResults]),\n  })\n\n  const graphqlRunner = (query, context = {}) => {\n    const schema = store.getState().schema\n    return graphql(\n      schema,\n      query,\n      context,\n      withResolverContext(context, schema),\n      context\n    )\n  }\n\n  // Collect pages.\n  activity = report.activityTimer(`createPages`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`createPages`, {\n    graphql: graphqlRunner,\n    traceId: `initial-createPages`,\n    waitForCascadingActions: true,\n    parentSpan: activity.span,\n  })\n  activity.end()\n\n  // A variant on createPages for plugins that want to\n  // have full control over adding/removing pages. The normal\n  // \"createPages\" API is called every time (during development)\n  // that data changes.\n  activity = report.activityTimer(`createPagesStatefully`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`createPagesStatefully`, {\n    graphql: graphqlRunner,\n    traceId: `initial-createPagesStatefully`,\n    waitForCascadingActions: true,\n    parentSpan: activity.span,\n  })\n  activity.end()\n\n  activity = report.activityTimer(`onPreExtractQueries`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPreExtractQueries`, { parentSpan: activity.span })\n  activity.end()\n\n  // Update Schema for SitePage.\n  activity = report.activityTimer(`update schema`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../schema`).rebuildWithSitePage({ parentSpan: activity.span })\n  activity.end()\n\n  // Extract queries\n  activity = report.activityTimer(`extract queries from components`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await extractQueries()\n  activity.end()\n\n  try {\n    await writeJsRequires.writeAll(store.getState())\n  } catch (err) {\n    report.panic(`Failed to write out page data`, err)\n  }\n\n  await writeRedirects()\n\n  // onPostBootstrap\n  activity = report.activityTimer(`onPostBootstrap`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPostBootstrap`, { parentSpan: activity.span })\n  activity.end()\n\n  report.log(``)\n  report.info(`bootstrap finished - ${process.uptime()} s`)\n  report.log(``)\n  emitter.emit(`BOOTSTRAP_FINISHED`)\n  require(`../redux/actions`).boundActionCreators.setProgramStatus(\n    `BOOTSTRAP_FINISHED`\n  )\n\n  bootstrapSpan.finish()\n\n  return { graphqlRunner }\n}\n"],"file":"index.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/bootstrap/load-plugins/load.js b/node_modules/gatsby/dist/bootstrap/load-plugins/load.js
index e420686..3b27b89 100644
--- a/node_modules/gatsby/dist/bootstrap/load-plugins/load.js
+++ b/node_modules/gatsby/dist/bootstrap/load-plugins/load.js
@@ -158,7 +158,7 @@ module.exports = (config = {}, rootDir = null) => {
   }; // Add internal plugins
 
 
-  const internalPlugins = [`../../internal-plugins/dev-404-page`, `../../internal-plugins/load-babel-config`, `../../internal-plugins/internal-data-bridge`, `../../internal-plugins/prod-404`, `../../internal-plugins/query-runner`, `../../internal-plugins/webpack-theme-component-shadowing`];
+  const internalPlugins = [`../../internal-plugins/dev-404-page`, `../../internal-plugins/load-babel-config`, `../../internal-plugins/internal-data-bridge`, `../../internal-plugins/prod-404`, `../../internal-plugins/webpack-theme-component-shadowing`];
   internalPlugins.forEach(relPath => {
     const absPath = path.join(__dirname, relPath);
     plugins.push(processPlugin(absPath));
diff --git a/node_modules/gatsby/dist/bootstrap/load-plugins/load.js.map b/node_modules/gatsby/dist/bootstrap/load-plugins/load.js.map
index 7745f9c..28da09f 100644
--- a/node_modules/gatsby/dist/bootstrap/load-plugins/load.js.map
+++ b/node_modules/gatsby/dist/bootstrap/load-plugins/load.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/bootstrap/load-plugins/load.js"],"names":["_","require","slash","fs","path","crypto","glob","warnOnIncompatiblePeerDependency","store","existsSync","sync","createNodeId","createRequireFromPath","createFileContentHash","root","globPattern","hash","createHash","files","nodir","forEach","filepath","update","readFileSync","digest","createPluginId","name","pluginObject","JSON","stringify","options","resolvePlugin","pluginName","rootDir","resolvedPath","resolve","packageJSON","parse","id","version","Error","requireSource","dirname","err","module","exports","config","plugins","processPlugin","plugin","isString","info","pluginOptions","subplugins","p","push","merge","internalPlugins","relPath","absPath","join","__dirname","process","cwd","program","getState","directory","pathCheck"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst slash = require(`slash`)\nconst fs = require(`fs`)\nconst path = require(`path`)\nconst crypto = require(`crypto`)\nconst glob = require(`glob`)\nconst { warnOnIncompatiblePeerDependency } = require(`./validate`)\nconst { store } = require(`../../redux`)\nconst existsSync = require(`fs-exists-cached`).sync\nconst createNodeId = require(`../../utils/create-node-id`)\nconst createRequireFromPath = require(`../../utils/create-require-from-path`)\n\nfunction createFileContentHash(root, globPattern) {\n  const hash = crypto.createHash(`md5`)\n  const files = glob.sync(`${root}/${globPattern}`, { nodir: true })\n\n  files.forEach(filepath => {\n    hash.update(fs.readFileSync(filepath))\n  })\n\n  return hash.digest(`hex`)\n}\n\n/**\n * Make sure key is unique to plugin options. E.g there could\n * be multiple source-filesystem plugins, with different names\n * (docs, blogs).\n * @param {*} name Name of the plugin\n * @param {*} pluginObject\n */\nconst createPluginId = (name, pluginObject = null) =>\n  createNodeId(\n    name + (pluginObject ? JSON.stringify(pluginObject.options) : ``),\n    `Plugin`\n  )\n\n/**\n * @typedef {Object} PluginInfo\n * @property {string} resolve The absolute path to the plugin\n * @property {string} name The plugin name\n * @property {string} version The plugin version (can be content hash)\n */\n\n/**\n * resolvePlugin\n * @param {string} pluginName\n * This can be a name of a local plugin, the name of a plugin located in\n * node_modules, or a Gatsby internal plugin. In the last case the pluginName\n * will be an absolute path.\n * @param {string} rootDir\n * This is the project location, from which are found the plugins\n * @return {PluginInfo}\n */\nfunction resolvePlugin(pluginName, rootDir) {\n  // Only find plugins when we're not given an absolute path\n  if (!existsSync(pluginName)) {\n    // Find the plugin in the local plugins folder\n    const resolvedPath = slash(path.resolve(`./plugins/${pluginName}`))\n\n    if (existsSync(resolvedPath)) {\n      if (existsSync(`${resolvedPath}/package.json`)) {\n        const packageJSON = JSON.parse(\n          fs.readFileSync(`${resolvedPath}/package.json`, `utf-8`)\n        )\n        const name = packageJSON.name || pluginName\n        warnOnIncompatiblePeerDependency(name, packageJSON)\n\n        return {\n          resolve: resolvedPath,\n          name,\n          id: createPluginId(name),\n          version:\n            packageJSON.version || createFileContentHash(resolvedPath, `**`),\n        }\n      } else {\n        // Make package.json a requirement for local plugins too\n        throw new Error(`Plugin ${pluginName} requires a package.json file`)\n      }\n    }\n  }\n\n  /**\n   * Here we have an absolute path to an internal plugin, or a name of a module\n   * which should be located in node_modules.\n   */\n  try {\n    const requireSource =\n      rootDir !== null\n        ? createRequireFromPath(`${rootDir}/:internal:`)\n        : require\n    const resolvedPath = slash(path.dirname(requireSource.resolve(pluginName)))\n\n    const packageJSON = JSON.parse(\n      fs.readFileSync(`${resolvedPath}/package.json`, `utf-8`)\n    )\n    warnOnIncompatiblePeerDependency(packageJSON.name, packageJSON)\n\n    return {\n      resolve: resolvedPath,\n      id: createPluginId(packageJSON.name),\n      name: packageJSON.name,\n      version: packageJSON.version,\n    }\n  } catch (err) {\n    throw new Error(\n      `Unable to find plugin \"${pluginName}\". Perhaps you need to install its package?`\n    )\n  }\n}\n\nmodule.exports = (config = {}, rootDir = null) => {\n  // Instantiate plugins.\n  const plugins = []\n\n  // Create fake little site with a plugin for testing this\n  // w/ snapshots. Move plugin processing to its own module.\n  // Also test adding to redux store.\n  const processPlugin = plugin => {\n    if (_.isString(plugin)) {\n      const info = resolvePlugin(plugin, rootDir)\n\n      return {\n        ...info,\n        pluginOptions: {\n          plugins: [],\n        },\n      }\n    } else {\n      plugin.options = plugin.options || {}\n\n      // Plugins can have plugins.\n      const subplugins = []\n      if (plugin.options.plugins) {\n        plugin.options.plugins.forEach(p => {\n          subplugins.push(processPlugin(p))\n        })\n\n        plugin.options.plugins = subplugins\n      }\n\n      // Add some default values for tests as we don't actually\n      // want to try to load anything during tests.\n      if (plugin.resolve === `___TEST___`) {\n        const name = `TEST`\n\n        return {\n          id: createPluginId(name, plugin),\n          name,\n          pluginOptions: {\n            plugins: [],\n          },\n        }\n      }\n\n      const info = resolvePlugin(plugin.resolve, rootDir)\n\n      return {\n        ...info,\n        id: createPluginId(info.name, plugin),\n        pluginOptions: _.merge({ plugins: [] }, plugin.options),\n      }\n    }\n  }\n\n  // Add internal plugins\n  const internalPlugins = [\n    `../../internal-plugins/dev-404-page`,\n    `../../internal-plugins/load-babel-config`,\n    `../../internal-plugins/internal-data-bridge`,\n    `../../internal-plugins/prod-404`,\n    `../../internal-plugins/query-runner`,\n    `../../internal-plugins/webpack-theme-component-shadowing`,\n  ]\n  internalPlugins.forEach(relPath => {\n    const absPath = path.join(__dirname, relPath)\n    plugins.push(processPlugin(absPath))\n  })\n\n  // Add plugins from the site config.\n  if (config.plugins) {\n    config.plugins.forEach(plugin => {\n      plugins.push(processPlugin(plugin))\n    })\n  }\n\n  // Add the site's default \"plugin\" i.e. gatsby-x files in root of site.\n  plugins.push({\n    resolve: slash(process.cwd()),\n    id: createPluginId(`default-site-plugin`),\n    name: `default-site-plugin`,\n    version: createFileContentHash(process.cwd(), `gatsby-*`),\n    pluginOptions: {\n      plugins: [],\n    },\n  })\n\n  const program = store.getState().program\n  plugins.push(\n    processPlugin({\n      resolve: require.resolve(`gatsby-plugin-page-creator`),\n      options: {\n        path: slash(path.join(program.directory, `src/pages`)),\n        pathCheck: false,\n      },\n    })\n  )\n\n  return plugins\n}\n"],"file":"load.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/bootstrap/load-plugins/load.js"],"names":["_","require","slash","fs","path","crypto","glob","warnOnIncompatiblePeerDependency","store","existsSync","sync","createNodeId","createRequireFromPath","createFileContentHash","root","globPattern","hash","createHash","files","nodir","forEach","filepath","update","readFileSync","digest","createPluginId","name","pluginObject","JSON","stringify","options","resolvePlugin","pluginName","rootDir","resolvedPath","resolve","packageJSON","parse","id","version","Error","requireSource","dirname","err","module","exports","config","plugins","processPlugin","plugin","isString","info","pluginOptions","subplugins","p","push","merge","internalPlugins","relPath","absPath","join","__dirname","process","cwd","program","getState","directory","pathCheck"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst slash = require(`slash`)\nconst fs = require(`fs`)\nconst path = require(`path`)\nconst crypto = require(`crypto`)\nconst glob = require(`glob`)\nconst { warnOnIncompatiblePeerDependency } = require(`./validate`)\nconst { store } = require(`../../redux`)\nconst existsSync = require(`fs-exists-cached`).sync\nconst createNodeId = require(`../../utils/create-node-id`)\nconst createRequireFromPath = require(`../../utils/create-require-from-path`)\n\nfunction createFileContentHash(root, globPattern) {\n  const hash = crypto.createHash(`md5`)\n  const files = glob.sync(`${root}/${globPattern}`, { nodir: true })\n\n  files.forEach(filepath => {\n    hash.update(fs.readFileSync(filepath))\n  })\n\n  return hash.digest(`hex`)\n}\n\n/**\n * Make sure key is unique to plugin options. E.g there could\n * be multiple source-filesystem plugins, with different names\n * (docs, blogs).\n * @param {*} name Name of the plugin\n * @param {*} pluginObject\n */\nconst createPluginId = (name, pluginObject = null) =>\n  createNodeId(\n    name + (pluginObject ? JSON.stringify(pluginObject.options) : ``),\n    `Plugin`\n  )\n\n/**\n * @typedef {Object} PluginInfo\n * @property {string} resolve The absolute path to the plugin\n * @property {string} name The plugin name\n * @property {string} version The plugin version (can be content hash)\n */\n\n/**\n * resolvePlugin\n * @param {string} pluginName\n * This can be a name of a local plugin, the name of a plugin located in\n * node_modules, or a Gatsby internal plugin. In the last case the pluginName\n * will be an absolute path.\n * @param {string} rootDir\n * This is the project location, from which are found the plugins\n * @return {PluginInfo}\n */\nfunction resolvePlugin(pluginName, rootDir) {\n  // Only find plugins when we're not given an absolute path\n  if (!existsSync(pluginName)) {\n    // Find the plugin in the local plugins folder\n    const resolvedPath = slash(path.resolve(`./plugins/${pluginName}`))\n\n    if (existsSync(resolvedPath)) {\n      if (existsSync(`${resolvedPath}/package.json`)) {\n        const packageJSON = JSON.parse(\n          fs.readFileSync(`${resolvedPath}/package.json`, `utf-8`)\n        )\n        const name = packageJSON.name || pluginName\n        warnOnIncompatiblePeerDependency(name, packageJSON)\n\n        return {\n          resolve: resolvedPath,\n          name,\n          id: createPluginId(name),\n          version:\n            packageJSON.version || createFileContentHash(resolvedPath, `**`),\n        }\n      } else {\n        // Make package.json a requirement for local plugins too\n        throw new Error(`Plugin ${pluginName} requires a package.json file`)\n      }\n    }\n  }\n\n  /**\n   * Here we have an absolute path to an internal plugin, or a name of a module\n   * which should be located in node_modules.\n   */\n  try {\n    const requireSource =\n      rootDir !== null\n        ? createRequireFromPath(`${rootDir}/:internal:`)\n        : require\n    const resolvedPath = slash(path.dirname(requireSource.resolve(pluginName)))\n\n    const packageJSON = JSON.parse(\n      fs.readFileSync(`${resolvedPath}/package.json`, `utf-8`)\n    )\n    warnOnIncompatiblePeerDependency(packageJSON.name, packageJSON)\n\n    return {\n      resolve: resolvedPath,\n      id: createPluginId(packageJSON.name),\n      name: packageJSON.name,\n      version: packageJSON.version,\n    }\n  } catch (err) {\n    throw new Error(\n      `Unable to find plugin \"${pluginName}\". Perhaps you need to install its package?`\n    )\n  }\n}\n\nmodule.exports = (config = {}, rootDir = null) => {\n  // Instantiate plugins.\n  const plugins = []\n\n  // Create fake little site with a plugin for testing this\n  // w/ snapshots. Move plugin processing to its own module.\n  // Also test adding to redux store.\n  const processPlugin = plugin => {\n    if (_.isString(plugin)) {\n      const info = resolvePlugin(plugin, rootDir)\n\n      return {\n        ...info,\n        pluginOptions: {\n          plugins: [],\n        },\n      }\n    } else {\n      plugin.options = plugin.options || {}\n\n      // Plugins can have plugins.\n      const subplugins = []\n      if (plugin.options.plugins) {\n        plugin.options.plugins.forEach(p => {\n          subplugins.push(processPlugin(p))\n        })\n\n        plugin.options.plugins = subplugins\n      }\n\n      // Add some default values for tests as we don't actually\n      // want to try to load anything during tests.\n      if (plugin.resolve === `___TEST___`) {\n        const name = `TEST`\n\n        return {\n          id: createPluginId(name, plugin),\n          name,\n          pluginOptions: {\n            plugins: [],\n          },\n        }\n      }\n\n      const info = resolvePlugin(plugin.resolve, rootDir)\n\n      return {\n        ...info,\n        id: createPluginId(info.name, plugin),\n        pluginOptions: _.merge({ plugins: [] }, plugin.options),\n      }\n    }\n  }\n\n  // Add internal plugins\n  const internalPlugins = [\n    `../../internal-plugins/dev-404-page`,\n    `../../internal-plugins/load-babel-config`,\n    `../../internal-plugins/internal-data-bridge`,\n    `../../internal-plugins/prod-404`,\n    `../../internal-plugins/webpack-theme-component-shadowing`,\n  ]\n  internalPlugins.forEach(relPath => {\n    const absPath = path.join(__dirname, relPath)\n    plugins.push(processPlugin(absPath))\n  })\n\n  // Add plugins from the site config.\n  if (config.plugins) {\n    config.plugins.forEach(plugin => {\n      plugins.push(processPlugin(plugin))\n    })\n  }\n\n  // Add the site's default \"plugin\" i.e. gatsby-x files in root of site.\n  plugins.push({\n    resolve: slash(process.cwd()),\n    id: createPluginId(`default-site-plugin`),\n    name: `default-site-plugin`,\n    version: createFileContentHash(process.cwd(), `gatsby-*`),\n    pluginOptions: {\n      plugins: [],\n    },\n  })\n\n  const program = store.getState().program\n  plugins.push(\n    processPlugin({\n      resolve: require.resolve(`gatsby-plugin-page-creator`),\n      options: {\n        path: slash(path.join(program.directory, `src/pages`)),\n        pathCheck: false,\n      },\n    })\n  )\n\n  return plugins\n}\n"],"file":"load.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/redirects-writer.js b/node_modules/gatsby/dist/bootstrap/redirects-writer.js
similarity index 93%
rename from node_modules/gatsby/dist/internal-plugins/query-runner/redirects-writer.js
rename to node_modules/gatsby/dist/bootstrap/redirects-writer.js
index 32ab10e..647cff8 100644
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/redirects-writer.js
+++ b/node_modules/gatsby/dist/bootstrap/redirects-writer.js
@@ -10,9 +10,9 @@ var _crypto = _interopRequireDefault(require("crypto"));
 
 var _fsExtra = _interopRequireDefault(require("fs-extra"));
 
-var _redux = require("../../redux/");
+var _redux = require("../redux/");
 
-var _path = require("../../utils/path");
+var _path = require("../utils/path");
 
 let lastHash = null;
 
diff --git a/node_modules/gatsby/dist/bootstrap/redirects-writer.js.map b/node_modules/gatsby/dist/bootstrap/redirects-writer.js.map
new file mode 100644
index 0000000..15a0b13
--- /dev/null
+++ b/node_modules/gatsby/dist/bootstrap/redirects-writer.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/bootstrap/redirects-writer.js"],"names":["lastHash","writeRedirects","bootstrapFinished","store","getState","program","redirects","browserRedirects","filter","r","redirectInBrowser","newHash","crypto","createHash","update","JSON","stringify","digest","Promise","resolve","fs","writeFile","directory","exports","oldRedirects","debouncedWriteRedirects","_","debounce","isEqual","Redirects","emitter","on"],"mappings":";;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA,IAAIA,QAAQ,GAAG,IAAf;;AAEA,MAAMC,cAAc;AAAA;AAAA;AAAA,6CAAG,aAAY;AACjCC,IAAAA,iBAAiB,GAAG,IAApB;;AADiC,0BAGJC,aAAMC,QAAN,EAHI;AAAA,QAG3BC,OAH2B,mBAG3BA,OAH2B;AAAA,QAGlBC,SAHkB,mBAGlBA,SAHkB,EAKjC;;;AACA,UAAMC,gBAAgB,GAAGD,SAAS,CAACE,MAAV,CAAiBC,CAAC,IAAIA,CAAC,CAACC,iBAAxB,CAAzB;;AAEA,UAAMC,OAAO,GAAGC,gBACbC,UADa,CACD,KADC,EAEbC,MAFa,CAENC,IAAI,CAACC,SAAL,CAAeT,gBAAf,CAFM,EAGbU,MAHa,CAGL,KAHK,CAAhB;;AAKA,QAAIN,OAAO,KAAKX,QAAhB,EAA0B;AACxB,aAAOkB,OAAO,CAACC,OAAR,EAAP;AACD;;AAEDnB,IAAAA,QAAQ,GAAGW,OAAX;AAEA,iBAAaS,iBAAGC,SAAH,CACX,oBAAShB,OAAO,CAACiB,SAAjB,EAA6B,uBAA7B,CADW,EAEXP,IAAI,CAACC,SAAL,CAAeT,gBAAf,EAAiC,IAAjC,EAAuC,CAAvC,CAFW,CAAb;AAID,GAvBmB;;AAAA,kBAAdN,cAAc;AAAA;AAAA;AAAA,GAApB;;AAyBAsB,OAAO,CAACtB,cAAR,GAAyBA,cAAzB;AAEA,IAAIC,iBAAiB,GAAG,KAAxB;AACA,IAAIsB,YAAJ;;AACA,MAAMC,uBAAuB,GAAGC,gBAAEC,QAAF,CAAW,MAAM;AAC/C;AACA,MACEzB,iBAAiB,IACjB,CAACwB,gBAAEE,OAAF,CAAUJ,YAAV,EAAwBrB,aAAMC,QAAN,GAAiBE,SAAzC,CAFH,EAGE;AACAL,IAAAA,cAAc;AACduB,IAAAA,YAAY,GAAGrB,aAAMC,QAAN,GAAiByB,SAAhC;AACD;AACF,CAT+B,EAS7B,GAT6B,CAAhC;;AAWAC,eAAQC,EAAR,CAAY,iBAAZ,EAA8B,MAAM;AAClCN,EAAAA,uBAAuB;AACxB,CAFD","sourcesContent":["import _ from \"lodash\"\nimport crypto from \"crypto\"\nimport fs from \"fs-extra\"\nimport { store, emitter } from \"../redux/\"\nimport { joinPath } from \"../utils/path\"\n\nlet lastHash = null\n\nconst writeRedirects = async () => {\n  bootstrapFinished = true\n\n  let { program, redirects } = store.getState()\n\n  // Filter for redirects that are meant for the browser.\n  const browserRedirects = redirects.filter(r => r.redirectInBrowser)\n\n  const newHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(browserRedirects))\n    .digest(`hex`)\n\n  if (newHash === lastHash) {\n    return Promise.resolve()\n  }\n\n  lastHash = newHash\n\n  return await fs.writeFile(\n    joinPath(program.directory, `.cache/redirects.json`),\n    JSON.stringify(browserRedirects, null, 2)\n  )\n}\n\nexports.writeRedirects = writeRedirects\n\nlet bootstrapFinished = false\nlet oldRedirects\nconst debouncedWriteRedirects = _.debounce(() => {\n  // Don't write redirects again until bootstrap has finished.\n  if (\n    bootstrapFinished &&\n    !_.isEqual(oldRedirects, store.getState().redirects)\n  ) {\n    writeRedirects()\n    oldRedirects = store.getState().Redirects\n  }\n}, 250)\n\nemitter.on(`CREATE_REDIRECT`, () => {\n  debouncedWriteRedirects()\n})\n"],"file":"redirects-writer.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/bootstrap/write-js-requires.js b/node_modules/gatsby/dist/bootstrap/write-js-requires.js
new file mode 100644
index 0000000..0c2ae19
--- /dev/null
+++ b/node_modules/gatsby/dist/bootstrap/write-js-requires.js
@@ -0,0 +1,88 @@
+"use strict";
+
+var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
+
+var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
+
+var _path = require("../utils/path");
+
+const _ = require(`lodash`);
+
+const fs = require(`fs-extra`);
+
+const _require = require(`../redux`),
+      store = _require.store,
+      emitter = _require.emitter;
+
+const writeAll =
+/*#__PURE__*/
+function () {
+  var _ref = (0, _asyncToGenerator2.default)(function* (state) {
+    let program = state.program,
+        pages = state.pages,
+        matchPaths = state.matchPaths;
+    pages = [...pages.values()];
+    let components = [];
+    pages.forEach(p => {
+      components.push({
+        componentChunkName: p.componentChunkName,
+        component: p.component
+      });
+    });
+    components = _.uniqBy(components, c => c.componentChunkName); // Create file with sync requires of components/json files.
+
+    let syncRequires = `const { hot } = require("react-hot-loader/root")
+
+// prefer default export if available
+const preferDefault = m => m && m.default || m
+\n\n`;
+    syncRequires += `exports.components = {\n${components.map(c => `  "${c.componentChunkName}": hot(preferDefault(require("${(0, _path.joinPath)(c.component)}")))`).join(`,\n`)}
+}\n\n`; // Create file with async requires of components/json files.
+
+    let asyncRequires = `// prefer default export if available
+const preferDefault = m => m && m.default || m
+\n`;
+    asyncRequires += `exports.components = {\n${components.map(c => `  "${c.componentChunkName}": () => import("${(0, _path.joinPath)(c.component)}" /* webpackChunkName: "${c.componentChunkName}" */)`).join(`,\n`)}
+}\n\n`;
+
+    const writeAndMove = (file, data) => {
+      const destination = (0, _path.joinPath)(program.directory, `.cache`, file);
+      const tmp = `${destination}.${Date.now()}`;
+      return fs.writeFile(tmp, data).then(() => fs.move(tmp, destination, {
+        overwrite: true
+      }));
+    };
+
+    return yield Promise.all([// writeAndMove(`pages.json`, JSON.stringify(pagesData, null, 4)),
+    writeAndMove(`sync-requires.js`, syncRequires), writeAndMove(`async-requires.js`, asyncRequires), writeAndMove(`match-paths.json`, JSON.stringify(matchPaths, null, 4))]);
+  });
+
+  return function writeAll(_x) {
+    return _ref.apply(this, arguments);
+  };
+}();
+
+const debouncedWriteAll = _.debounce(() => writeAll(store.getState()), 500, {
+  leading: true
+});
+
+const startPageListener = () => {
+  emitter.on(`CREATE_PAGE`, () => {
+    debouncedWriteAll();
+  });
+  emitter.on(`CREATE_PAGE_END`, () => {
+    debouncedWriteAll();
+  });
+  emitter.on(`DELETE_PAGE`, () => {
+    debouncedWriteAll();
+  });
+  emitter.on(`DELETE_PAGE_BY_PATH`, () => {
+    debouncedWriteAll();
+  });
+};
+
+module.exports = {
+  writeAll,
+  startPageListener
+};
+//# sourceMappingURL=write-js-requires.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/bootstrap/write-js-requires.js.map b/node_modules/gatsby/dist/bootstrap/write-js-requires.js.map
new file mode 100644
index 0000000..a2270f9
--- /dev/null
+++ b/node_modules/gatsby/dist/bootstrap/write-js-requires.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/bootstrap/write-js-requires.js"],"names":["_","require","fs","store","emitter","writeAll","state","program","pages","matchPaths","values","components","forEach","p","push","componentChunkName","component","uniqBy","c","syncRequires","map","join","asyncRequires","writeAndMove","file","data","destination","directory","tmp","Date","now","writeFile","then","move","overwrite","Promise","all","JSON","stringify","debouncedWriteAll","debounce","getState","leading","startPageListener","on","module","exports"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst fs = require(`fs-extra`)\nimport { joinPath } from \"../utils/path\"\nconst { store, emitter } = require(`../redux`)\n\nconst writeAll = async state => {\n  let { program, pages, matchPaths } = state\n  pages = [...pages.values()]\n\n  let components = []\n  pages.forEach(p => {\n    components.push({\n      componentChunkName: p.componentChunkName,\n      component: p.component,\n    })\n  })\n\n  components = _.uniqBy(components, c => c.componentChunkName)\n\n  // Create file with sync requires of components/json files.\n  let syncRequires = `const { hot } = require(\"react-hot-loader/root\")\n\n// prefer default export if available\nconst preferDefault = m => m && m.default || m\n\\n\\n`\n  syncRequires += `exports.components = {\\n${components\n    .map(\n      c =>\n        `  \"${c.componentChunkName}\": hot(preferDefault(require(\"${joinPath(\n          c.component\n        )}\")))`\n    )\n    .join(`,\\n`)}\n}\\n\\n`\n\n  // Create file with async requires of components/json files.\n  let asyncRequires = `// prefer default export if available\nconst preferDefault = m => m && m.default || m\n\\n`\n  asyncRequires += `exports.components = {\\n${components\n    .map(\n      c =>\n        `  \"${c.componentChunkName}\": () => import(\"${joinPath(\n          c.component\n        )}\" /* webpackChunkName: \"${c.componentChunkName}\" */)`\n    )\n    .join(`,\\n`)}\n}\\n\\n`\n\n  const writeAndMove = (file, data) => {\n    const destination = joinPath(program.directory, `.cache`, file)\n    const tmp = `${destination}.${Date.now()}`\n    return fs\n      .writeFile(tmp, data)\n      .then(() => fs.move(tmp, destination, { overwrite: true }))\n  }\n\n  return await Promise.all([\n    // writeAndMove(`pages.json`, JSON.stringify(pagesData, null, 4)),\n    writeAndMove(`sync-requires.js`, syncRequires),\n    writeAndMove(`async-requires.js`, asyncRequires),\n    writeAndMove(`match-paths.json`, JSON.stringify(matchPaths, null, 4)),\n  ])\n}\n\nconst debouncedWriteAll = _.debounce(() => writeAll(store.getState()), 500, {\n  leading: true,\n})\n\nconst startPageListener = () => {\n  emitter.on(`CREATE_PAGE`, () => {\n    debouncedWriteAll()\n  })\n\n  emitter.on(`CREATE_PAGE_END`, () => {\n    debouncedWriteAll()\n  })\n\n  emitter.on(`DELETE_PAGE`, () => {\n    debouncedWriteAll()\n  })\n\n  emitter.on(`DELETE_PAGE_BY_PATH`, () => {\n    debouncedWriteAll()\n  })\n}\n\nmodule.exports = {\n  writeAll,\n  startPageListener,\n}\n"],"file":"write-js-requires.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/commands/build-html.js b/node_modules/gatsby/dist/commands/build-html.js
index 6ae293a..6f20c5a 100644
--- a/node_modules/gatsby/dist/commands/build-html.js
+++ b/node_modules/gatsby/dist/commands/build-html.js
@@ -8,68 +8,96 @@ const webpack = require(`webpack`);
 
 const fs = require(`fs`);
 
-const debug = require(`debug`)(`gatsby:html`);
-
 const webpackConfig = require(`../utils/webpack.config`);
 
-const _require = require(`../redux`),
-      store = _require.store;
-
-const _require2 = require(`gatsby-cli/lib/reporter/errors`),
-      createErrorFromString = _require2.createErrorFromString;
+const _require = require(`gatsby-cli/lib/reporter/errors`),
+      createErrorFromString = _require.createErrorFromString;
 
 const renderHTMLQueue = require(`../utils/html-renderer-queue`);
 
 const telemetry = require(`gatsby-telemetry`);
 
-module.exports =
+const runWebpack = compilerConfig => new Promise((resolve, reject) => {
+  webpack(compilerConfig).run((e, stats) => {
+    if (e) {
+      reject(e);
+    } else {
+      resolve(stats);
+    }
+  });
+});
+
+const doBuildRenderer =
 /*#__PURE__*/
 function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (program, activity) {
+  var _ref = (0, _asyncToGenerator2.default)(function* (program, webpackConfig) {
     const directory = program.directory;
-    debug(`generating static HTML`); // Reduce pages objects to an array of paths.
+    const stats = yield runWebpack(webpackConfig);
+    const outputFile = `${directory}/public/render-page.js`;
+
+    if (stats.hasErrors()) {
+      let webpackErrors = stats.toJson().errors.filter(Boolean);
+      const error = webpackErrors.length ? createErrorFromString(webpackErrors[0], `${outputFile}.map`) : new Error(`There was an issue while building the site: ` + `\n\n${stats.toString()}`);
+      throw error;
+    }
+  });
 
-    const pages = Array.from(store.getState().pages.values(), page => page.path);
+  return function doBuildRenderer(_x, _x2) {
+    return _ref.apply(this, arguments);
+  };
+}();
+
+const buildRenderer =
+/*#__PURE__*/
+function () {
+  var _ref2 = (0, _asyncToGenerator2.default)(function* (program, stage) {
+    const directory = program.directory;
+    const config = yield webpackConfig(program, directory, stage, null);
+    yield doBuildRenderer(program, config);
+  });
+
+  return function buildRenderer(_x3, _x4) {
+    return _ref2.apply(this, arguments);
+  };
+}();
+
+function buildPages(_x5) {
+  return _buildPages.apply(this, arguments);
+}
+
+function _buildPages() {
+  _buildPages = (0, _asyncToGenerator2.default)(function* ({
+    program,
+    pagePaths,
+    activity
+  }) {
+    const directory = program.directory;
     telemetry.decorateEvent(`BUILD_END`, {
       siteMeasurements: {
-        pagesCount: pages.length
+        pagesCount: pagePaths.length
       }
-    }); // Static site generation.
-
-    const compilerConfig = yield webpackConfig(program, directory, `build-html`, null);
-    return new Promise((resolve, reject) => {
-      webpack(compilerConfig).run((e, stats) => {
-        if (e) {
-          return reject(e);
-        }
-
-        const outputFile = `${directory}/public/render-page.js`;
-
-        if (stats.hasErrors()) {
-          let webpackErrors = stats.toJson().errors.filter(Boolean);
-          return reject(webpackErrors.length ? createErrorFromString(webpackErrors[0], `${outputFile}.map`) : new Error(`There was an issue while building the site: ` + `\n\n${stats.toString()}`));
-        }
-
-        return renderHTMLQueue(outputFile, pages, activity).then(() => {
-          // Remove the temp JS bundle file built for the static-site-generator-plugin
-          try {
-            fs.unlinkSync(outputFile);
-            fs.unlinkSync(`${outputFile}.map`);
-          } catch (e) {// This function will fail on Windows with no further consequences.
-          }
-
-          return resolve(null, stats);
-        }).catch(e => {
-          const prettyError = createErrorFromString(e.stack, `${outputFile}.map`);
-          prettyError.context = e.context;
-          reject(prettyError);
-        });
-      });
     });
+    const outputFile = `${directory}/public/render-page.js`;
+
+    try {
+      yield renderHTMLQueue(outputFile, pagePaths, activity);
+
+      try {
+        yield fs.unlink(outputFile);
+        yield fs.unlink(`${outputFile}.map`);
+      } catch (e) {// This function will fail on Windows with no further consequences.
+      }
+    } catch (e) {
+      const prettyError = createErrorFromString(e.stack, `${outputFile}.map`);
+      prettyError.context = e.context;
+      throw prettyError;
+    }
   });
+  return _buildPages.apply(this, arguments);
+}
 
-  return function (_x, _x2) {
-    return _ref.apply(this, arguments);
-  };
-}();
+module.exports = {
+  buildRenderer,
+  buildPages
+};
 //# sourceMappingURL=build-html.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/commands/build-html.js.map b/node_modules/gatsby/dist/commands/build-html.js.map
index 3fe7735..d68bab5 100644
--- a/node_modules/gatsby/dist/commands/build-html.js.map
+++ b/node_modules/gatsby/dist/commands/build-html.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/build-html.js"],"names":["webpack","require","fs","debug","webpackConfig","store","createErrorFromString","renderHTMLQueue","telemetry","module","exports","program","activity","directory","pages","Array","from","getState","values","page","path","decorateEvent","siteMeasurements","pagesCount","length","compilerConfig","Promise","resolve","reject","run","e","stats","outputFile","hasErrors","webpackErrors","toJson","errors","filter","Boolean","Error","toString","then","unlinkSync","catch","prettyError","stack","context"],"mappings":"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","sourcesContent":["/* @flow */\nconst webpack = require(`webpack`)\nconst fs = require(`fs`)\nconst debug = require(`debug`)(`gatsby:html`)\n\nconst webpackConfig = require(`../utils/webpack.config`)\nconst { store } = require(`../redux`)\nconst { createErrorFromString } = require(`gatsby-cli/lib/reporter/errors`)\nconst renderHTMLQueue = require(`../utils/html-renderer-queue`)\nconst telemetry = require(`gatsby-telemetry`)\n\nmodule.exports = async (program: any, activity: any) => {\n  const { directory } = program\n\n  debug(`generating static HTML`)\n  // Reduce pages objects to an array of paths.\n  const pages = Array.from(store.getState().pages.values(), page => page.path)\n  telemetry.decorateEvent(`BUILD_END`, {\n    siteMeasurements: { pagesCount: pages.length },\n  })\n\n  // Static site generation.\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `build-html`,\n    null\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((e, stats) => {\n      if (e) {\n        return reject(e)\n      }\n      const outputFile = `${directory}/public/render-page.js`\n      if (stats.hasErrors()) {\n        let webpackErrors = stats.toJson().errors.filter(Boolean)\n        return reject(\n          webpackErrors.length\n            ? createErrorFromString(webpackErrors[0], `${outputFile}.map`)\n            : new Error(\n                `There was an issue while building the site: ` +\n                  `\\n\\n${stats.toString()}`\n              )\n        )\n      }\n\n      return renderHTMLQueue(outputFile, pages, activity)\n        .then(() => {\n          // Remove the temp JS bundle file built for the static-site-generator-plugin\n          try {\n            fs.unlinkSync(outputFile)\n            fs.unlinkSync(`${outputFile}.map`)\n          } catch (e) {\n            // This function will fail on Windows with no further consequences.\n          }\n          return resolve(null, stats)\n        })\n        .catch(e => {\n          const prettyError = createErrorFromString(\n            e.stack,\n            `${outputFile}.map`\n          )\n          prettyError.context = e.context\n          reject(prettyError)\n        })\n    })\n  })\n}\n"],"file":"build-html.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/build-html.js"],"names":["webpack","require","fs","webpackConfig","createErrorFromString","renderHTMLQueue","telemetry","runWebpack","compilerConfig","Promise","resolve","reject","run","e","stats","doBuildRenderer","program","directory","outputFile","hasErrors","webpackErrors","toJson","errors","filter","Boolean","error","length","Error","toString","buildRenderer","stage","config","buildPages","pagePaths","activity","decorateEvent","siteMeasurements","pagesCount","unlink","prettyError","stack","context","module","exports"],"mappings":"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","sourcesContent":["/* @flow */\nconst webpack = require(`webpack`)\nconst fs = require(`fs`)\n\nconst webpackConfig = require(`../utils/webpack.config`)\nconst { createErrorFromString } = require(`gatsby-cli/lib/reporter/errors`)\nconst renderHTMLQueue = require(`../utils/html-renderer-queue`)\nconst telemetry = require(`gatsby-telemetry`)\n\nconst runWebpack = compilerConfig =>\n  new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((e, stats) => {\n      if (e) {\n        reject(e)\n      } else {\n        resolve(stats)\n      }\n    })\n  })\n\nconst doBuildRenderer = async (program, webpackConfig) => {\n  const { directory } = program\n  const stats = await runWebpack(webpackConfig)\n  const outputFile = `${directory}/public/render-page.js`\n  if (stats.hasErrors()) {\n    let webpackErrors = stats.toJson().errors.filter(Boolean)\n    const error = webpackErrors.length\n      ? createErrorFromString(webpackErrors[0], `${outputFile}.map`)\n      : new Error(\n          `There was an issue while building the site: ` +\n            `\\n\\n${stats.toString()}`\n        )\n    throw error\n  }\n}\n\nconst buildRenderer = async (program, stage) => {\n  const { directory } = program\n  const config = await webpackConfig(program, directory, stage, null)\n  await doBuildRenderer(program, config)\n}\n\nasync function buildPages({ program, pagePaths, activity }) {\n  const { directory } = program\n  telemetry.decorateEvent(`BUILD_END`, {\n    siteMeasurements: { pagesCount: pagePaths.length },\n  })\n\n  const outputFile = `${directory}/public/render-page.js`\n  try {\n    await renderHTMLQueue(outputFile, pagePaths, activity)\n    try {\n      await fs.unlink(outputFile)\n      await fs.unlink(`${outputFile}.map`)\n    } catch (e) {\n      // This function will fail on Windows with no further consequences.\n    }\n  } catch (e) {\n    const prettyError = createErrorFromString(e.stack, `${outputFile}.map`)\n    prettyError.context = e.context\n    throw prettyError\n  }\n}\n\nmodule.exports = {\n  buildRenderer,\n  buildPages,\n}\n"],"file":"build-html.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/commands/build-javascript.js b/node_modules/gatsby/dist/commands/build-javascript.js
index 12487b5..349f0bd 100644
--- a/node_modules/gatsby/dist/commands/build-javascript.js
+++ b/node_modules/gatsby/dist/commands/build-javascript.js
@@ -28,7 +28,7 @@ function () {
           return;
         }
 
-        resolve();
+        resolve(stats);
       });
     });
   });
diff --git a/node_modules/gatsby/dist/commands/build-javascript.js.map b/node_modules/gatsby/dist/commands/build-javascript.js.map
index 9a12ee1..9ed3093 100644
--- a/node_modules/gatsby/dist/commands/build-javascript.js.map
+++ b/node_modules/gatsby/dist/commands/build-javascript.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/build-javascript.js"],"names":["webpack","require","webpackConfig","module","exports","program","directory","compilerConfig","Promise","resolve","reject","run","err","stats","jsonStats","toJson","errors","length"],"mappings":";;;;;;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMC,aAAa,GAAGD,OAAO,CAAE,yBAAF,CAA7B;;AAEAE,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAMC,OAAN,EAAiB;AAAA,UACxBC,SADwB,GACVD,OADU,CACxBC,SADwB;AAGhC,UAAMC,cAAc,SAASL,aAAa,CACxCG,OADwC,EAExCC,SAFwC,EAGvC,kBAHuC,CAA1C;AAMA,WAAO,IAAIE,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCV,MAAAA,OAAO,CAACO,cAAD,CAAP,CAAwBI,GAAxB,CAA4B,CAACC,GAAD,EAAMC,KAAN,KAAgB;AAC1C,YAAID,GAAJ,EAAS;AACPF,UAAAA,MAAM,CAACE,GAAD,CAAN;AACA;AACD;;AAED,cAAME,SAAS,GAAGD,KAAK,CAACE,MAAN,EAAlB;;AACA,YAAID,SAAS,CAACE,MAAV,IAAoBF,SAAS,CAACE,MAAV,CAAiBC,MAAjB,GAA0B,CAAlD,EAAqD;AACnDP,UAAAA,MAAM,CAACI,SAAS,CAACE,MAAX,CAAN;AACA;AACD;;AAEDP,QAAAA,OAAO;AACR,OAbD;AAcD,KAfM,CAAP;AAgBD,GAzBD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\nconst webpack = require(`webpack`)\nconst webpackConfig = require(`../utils/webpack.config`)\n\nmodule.exports = async program => {\n  const { directory } = program\n\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `build-javascript`\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((err, stats) => {\n      if (err) {\n        reject(err)\n        return\n      }\n\n      const jsonStats = stats.toJson()\n      if (jsonStats.errors && jsonStats.errors.length > 0) {\n        reject(jsonStats.errors)\n        return\n      }\n\n      resolve()\n    })\n  })\n}\n"],"file":"build-javascript.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/build-javascript.js"],"names":["webpack","require","webpackConfig","module","exports","program","directory","compilerConfig","Promise","resolve","reject","run","err","stats","jsonStats","toJson","errors","length"],"mappings":";;;;;;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMC,aAAa,GAAGD,OAAO,CAAE,yBAAF,CAA7B;;AAEAE,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAMC,OAAN,EAAiB;AAAA,UACxBC,SADwB,GACVD,OADU,CACxBC,SADwB;AAGhC,UAAMC,cAAc,SAASL,aAAa,CACxCG,OADwC,EAExCC,SAFwC,EAGvC,kBAHuC,CAA1C;AAMA,WAAO,IAAIE,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCV,MAAAA,OAAO,CAACO,cAAD,CAAP,CAAwBI,GAAxB,CAA4B,CAACC,GAAD,EAAMC,KAAN,KAAgB;AAC1C,YAAID,GAAJ,EAAS;AACPF,UAAAA,MAAM,CAACE,GAAD,CAAN;AACA;AACD;;AAED,cAAME,SAAS,GAAGD,KAAK,CAACE,MAAN,EAAlB;;AACA,YAAID,SAAS,CAACE,MAAV,IAAoBF,SAAS,CAACE,MAAV,CAAiBC,MAAjB,GAA0B,CAAlD,EAAqD;AACnDP,UAAAA,MAAM,CAACI,SAAS,CAACE,MAAX,CAAN;AACA;AACD;;AAEDP,QAAAA,OAAO,CAACI,KAAD,CAAP;AACD,OAbD;AAcD,KAfM,CAAP;AAgBD,GAzBD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\nconst webpack = require(`webpack`)\nconst webpackConfig = require(`../utils/webpack.config`)\n\nmodule.exports = async program => {\n  const { directory } = program\n\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `build-javascript`\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((err, stats) => {\n      if (err) {\n        reject(err)\n        return\n      }\n\n      const jsonStats = stats.toJson()\n      if (jsonStats.errors && jsonStats.errors.length > 0) {\n        reject(jsonStats.errors)\n        return\n      }\n\n      resolve(stats)\n    })\n  })\n}\n"],"file":"build-javascript.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/commands/build.js b/node_modules/gatsby/dist/commands/build.js
index 0a53bcc..04389d3 100644
--- a/node_modules/gatsby/dist/commands/build.js
+++ b/node_modules/gatsby/dist/commands/build.js
@@ -4,6 +4,10 @@ var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefau
 
 var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
 
+const _ = require(`lodash`);
+
+const path = require(`path`);
+
 const report = require(`gatsby-cli/lib/reporter`);
 
 const buildHTML = require(`./build-html`);
@@ -29,15 +33,48 @@ const signalExit = require(`signal-exit`);
 
 const telemetry = require(`gatsby-telemetry`);
 
+const queryRunner = require(`../query`);
+
+const _require3 = require(`../redux`),
+      store = _require3.store,
+      emitter = _require3.emitter;
+
+const db = require(`../db`);
+
+const pageDataUtil = require(`../utils/page-data`);
+
 function reportFailure(msg, err) {
   report.log(``);
   report.panic(msg, err);
 }
 
+const handleChangedCompilationHash =
+/*#__PURE__*/
+function () {
+  var _ref = (0, _asyncToGenerator2.default)(function* (state, pageQueryIds, newHash) {
+    const publicDir = path.join(state.program.directory, `public`);
+
+    const stalePaths = _.difference([...state.pages.keys()], pageQueryIds);
+
+    yield pageDataUtil.rewriteCompilationHashes({
+      publicDir
+    }, stalePaths, newHash);
+    store.dispatch({
+      type: `SET_WEBPACK_COMPILATION_HASH`,
+      payload: newHash
+    });
+  });
+
+  return function handleChangedCompilationHash(_x, _x2, _x3) {
+    return _ref.apply(this, arguments);
+  };
+}();
+
 module.exports =
 /*#__PURE__*/
 function () {
   var _build = (0, _asyncToGenerator2.default)(function* (program) {
+    let activity;
     initTracer(program.openTracingConfigFile);
     telemetry.trackCli(`BUILD_START`);
     signalExit(() => {
@@ -46,11 +83,25 @@ function () {
     const buildSpan = tracer.startSpan(`build`);
     buildSpan.setTag(`directory`, program.directory);
 
-    const _ref = yield bootstrap(Object.assign({}, program, {
+    const _ref2 = yield bootstrap(Object.assign({}, program, {
       parentSpan: buildSpan
     })),
-          graphqlRunner = _ref.graphqlRunner;
+          graphqlRunner = _ref2.graphqlRunner;
+
+    const queryIds = queryRunner.calcBootstrapDirtyQueryIds(store.getState());
+
+    const _queryRunner$groupQue = queryRunner.groupQueryIds(queryIds),
+          staticQueryIds = _queryRunner$groupQue.staticQueryIds,
+          pageQueryIds = _queryRunner$groupQue.pageQueryIds;
 
+    activity = report.activityTimer(`run static queries`, {
+      parentSpan: buildSpan
+    });
+    activity.start();
+    yield queryRunner.processStaticQueries(staticQueryIds, {
+      activity
+    });
+    activity.end();
     yield apiRunnerNode(`onPreBuild`, {
       graphql: graphqlRunner,
       parentSpan: buildSpan
@@ -58,26 +109,70 @@ function () {
     // an equivalent static directory within public.
 
     copyStaticDirs();
-    let activity;
     activity = report.activityTimer(`Building production JavaScript and CSS bundles`, {
       parentSpan: buildSpan
     });
     activity.start();
-    yield buildProductionBundle(program).catch(err => {
+    const stats = yield buildProductionBundle(program).catch(err => {
       reportFailure(`Generating JavaScript bundles failed`, err);
     });
     activity.end();
+    const webpackCompilationHash = stats.hash;
+
+    if (webpackCompilationHash !== store.getState().webpackCompilationHash) {
+      activity = report.activityTimer(`Rewriting compilation hashes`, {
+        parentSpan: buildSpan
+      });
+      activity.start();
+      yield handleChangedCompilationHash(store.getState(), pageQueryIds, webpackCompilationHash);
+      activity.end();
+    }
+
+    activity = report.activityTimer(`run page queries`);
+    activity.start();
+    yield queryRunner.processPageQueries(pageQueryIds, {
+      activity
+    });
+    activity.end();
+
+    const waitJobsFinished = () => new Promise((resolve, reject) => {
+      const onEndJob = () => {
+        if (store.getState().jobs.active.length === 0) {
+          resolve();
+          emitter.off(`END_JOB`, onEndJob);
+        }
+      };
+
+      emitter.on(`END_JOB`, onEndJob);
+      onEndJob();
+    });
+
+    yield waitJobsFinished();
+    yield db.saveState();
+
+    require(`../redux/actions`).boundActionCreators.setProgramStatus(`BOOTSTRAP_QUERY_RUNNING_FINISHED`);
+
     activity = report.activityTimer(`Building static HTML for pages`, {
       parentSpan: buildSpan
     });
     activity.start();
-    yield buildHTML(program, activity).catch(err => {
+
+    try {
+      yield buildHTML.buildRenderer(program, `build-html`);
+      const pagePaths = [...store.getState().pages.keys()];
+      yield buildHTML.buildPages({
+        program,
+        pagePaths,
+        activity
+      });
+    } catch (err) {
       reportFailure(report.stripIndent`
         Building static HTML failed${err.context && err.context.path ? ` for path "${chalk.bold(err.context.path)}"` : ``}
 
         See our docs page on debugging HTML builds for help https://gatsby.dev/debug-html
       `, err);
-    });
+    }
+
     activity.end();
     yield apiRunnerNode(`onPostBuild`, {
       graphql: graphqlRunner,
@@ -88,7 +183,7 @@ function () {
     yield stopTracer();
   });
 
-  return function build(_x) {
+  return function build(_x4) {
     return _build.apply(this, arguments);
   };
 }();
diff --git a/node_modules/gatsby/dist/commands/build.js.map b/node_modules/gatsby/dist/commands/build.js.map
index 6d862b3..b370d2a 100644
--- a/node_modules/gatsby/dist/commands/build.js.map
+++ b/node_modules/gatsby/dist/commands/build.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/build.js"],"names":["report","require","buildHTML","buildProductionBundle","bootstrap","apiRunnerNode","copyStaticDirs","initTracer","stopTracer","chalk","tracer","globalTracer","signalExit","telemetry","reportFailure","msg","err","log","panic","module","exports","program","openTracingConfigFile","trackCli","buildSpan","startSpan","setTag","directory","parentSpan","graphqlRunner","graphql","activity","activityTimer","start","catch","end","stripIndent","context","path","bold","info","process","uptime","finish","build"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst report = require(`gatsby-cli/lib/reporter`)\nconst buildHTML = require(`./build-html`)\nconst buildProductionBundle = require(`./build-javascript`)\nconst bootstrap = require(`../bootstrap`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst { copyStaticDirs } = require(`../utils/get-static-dir`)\nconst { initTracer, stopTracer } = require(`../utils/tracer`)\nconst chalk = require(`chalk`)\nconst tracer = require(`opentracing`).globalTracer()\nconst signalExit = require(`signal-exit`)\nconst telemetry = require(`gatsby-telemetry`)\n\nfunction reportFailure(msg, err: Error) {\n  report.log(``)\n  report.panic(msg, err)\n}\n\ntype BuildArgs = {\n  directory: string,\n  sitePackageJson: object,\n  prefixPaths: boolean,\n  noUglify: boolean,\n  openTracingConfigFile: string,\n}\n\nmodule.exports = async function build(program: BuildArgs) {\n  initTracer(program.openTracingConfigFile)\n\n  telemetry.trackCli(`BUILD_START`)\n  signalExit(() => {\n    telemetry.trackCli(`BUILD_END`)\n  })\n\n  const buildSpan = tracer.startSpan(`build`)\n  buildSpan.setTag(`directory`, program.directory)\n\n  const { graphqlRunner } = await bootstrap({\n    ...program,\n    parentSpan: buildSpan,\n  })\n\n  await apiRunnerNode(`onPreBuild`, {\n    graphql: graphqlRunner,\n    parentSpan: buildSpan,\n  })\n\n  // Copy files from the static directory to\n  // an equivalent static directory within public.\n  copyStaticDirs()\n\n  let activity\n  activity = report.activityTimer(\n    `Building production JavaScript and CSS bundles`,\n    { parentSpan: buildSpan }\n  )\n  activity.start()\n  await buildProductionBundle(program).catch(err => {\n    reportFailure(`Generating JavaScript bundles failed`, err)\n  })\n  activity.end()\n\n  activity = report.activityTimer(`Building static HTML for pages`, {\n    parentSpan: buildSpan,\n  })\n  activity.start()\n  await buildHTML(program, activity).catch(err => {\n    reportFailure(\n      report.stripIndent`\n        Building static HTML failed${\n          err.context && err.context.path\n            ? ` for path \"${chalk.bold(err.context.path)}\"`\n            : ``\n        }\n\n        See our docs page on debugging HTML builds for help https://gatsby.dev/debug-html\n      `,\n      err\n    )\n  })\n  activity.end()\n\n  await apiRunnerNode(`onPostBuild`, {\n    graphql: graphqlRunner,\n    parentSpan: buildSpan,\n  })\n\n  report.info(`Done building in ${process.uptime()} sec`)\n\n  buildSpan.finish()\n  await stopTracer()\n}\n"],"file":"build.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/build.js"],"names":["_","require","path","report","buildHTML","buildProductionBundle","bootstrap","apiRunnerNode","copyStaticDirs","initTracer","stopTracer","chalk","tracer","globalTracer","signalExit","telemetry","queryRunner","store","emitter","db","pageDataUtil","reportFailure","msg","err","log","panic","handleChangedCompilationHash","state","pageQueryIds","newHash","publicDir","join","program","directory","stalePaths","difference","pages","keys","rewriteCompilationHashes","dispatch","type","payload","module","exports","activity","openTracingConfigFile","trackCli","buildSpan","startSpan","setTag","parentSpan","graphqlRunner","queryIds","calcBootstrapDirtyQueryIds","getState","groupQueryIds","staticQueryIds","activityTimer","start","processStaticQueries","end","graphql","stats","catch","webpackCompilationHash","hash","processPageQueries","waitJobsFinished","Promise","resolve","reject","onEndJob","jobs","active","length","off","on","saveState","boundActionCreators","setProgramStatus","buildRenderer","pagePaths","buildPages","stripIndent","context","bold","info","process","uptime","finish","build"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst _ = require(`lodash`)\nconst path = require(`path`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst buildHTML = require(`./build-html`)\nconst buildProductionBundle = require(`./build-javascript`)\nconst bootstrap = require(`../bootstrap`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst { copyStaticDirs } = require(`../utils/get-static-dir`)\nconst { initTracer, stopTracer } = require(`../utils/tracer`)\nconst chalk = require(`chalk`)\nconst tracer = require(`opentracing`).globalTracer()\nconst signalExit = require(`signal-exit`)\nconst telemetry = require(`gatsby-telemetry`)\nconst queryRunner = require(`../query`)\nconst { store, emitter } = require(`../redux`)\nconst db = require(`../db`)\nconst pageDataUtil = require(`../utils/page-data`)\n\nfunction reportFailure(msg, err: Error) {\n  report.log(``)\n  report.panic(msg, err)\n}\n\ntype BuildArgs = {\n  directory: string,\n  sitePackageJson: object,\n  prefixPaths: boolean,\n  noUglify: boolean,\n  openTracingConfigFile: string,\n}\n\nconst handleChangedCompilationHash = async (state, pageQueryIds, newHash) => {\n  const publicDir = path.join(state.program.directory, `public`)\n  const stalePaths = _.difference([...state.pages.keys()], pageQueryIds)\n  await pageDataUtil.rewriteCompilationHashes(\n    { publicDir },\n    stalePaths,\n    newHash\n  )\n  store.dispatch({\n    type: `SET_WEBPACK_COMPILATION_HASH`,\n    payload: newHash,\n  })\n}\n\nmodule.exports = async function build(program: BuildArgs) {\n  let activity\n  initTracer(program.openTracingConfigFile)\n\n  telemetry.trackCli(`BUILD_START`)\n  signalExit(() => {\n    telemetry.trackCli(`BUILD_END`)\n  })\n\n  const buildSpan = tracer.startSpan(`build`)\n  buildSpan.setTag(`directory`, program.directory)\n\n  const { graphqlRunner } = await bootstrap({\n    ...program,\n    parentSpan: buildSpan,\n  })\n\n  const queryIds = queryRunner.calcBootstrapDirtyQueryIds(store.getState())\n  const { staticQueryIds, pageQueryIds } = queryRunner.groupQueryIds(queryIds)\n\n  activity = report.activityTimer(`run static queries`, {\n    parentSpan: buildSpan,\n  })\n  activity.start()\n  await queryRunner.processStaticQueries(staticQueryIds, { activity })\n  activity.end()\n\n  await apiRunnerNode(`onPreBuild`, {\n    graphql: graphqlRunner,\n    parentSpan: buildSpan,\n  })\n\n  // Copy files from the static directory to\n  // an equivalent static directory within public.\n  copyStaticDirs()\n\n  activity = report.activityTimer(\n    `Building production JavaScript and CSS bundles`,\n    { parentSpan: buildSpan }\n  )\n  activity.start()\n  const stats = await buildProductionBundle(program).catch(err => {\n    reportFailure(`Generating JavaScript bundles failed`, err)\n  })\n  activity.end()\n\n  const webpackCompilationHash = stats.hash\n  if (webpackCompilationHash !== store.getState().webpackCompilationHash) {\n    activity = report.activityTimer(`Rewriting compilation hashes`, {\n      parentSpan: buildSpan,\n    })\n    activity.start()\n    await handleChangedCompilationHash(\n      store.getState(),\n      pageQueryIds,\n      webpackCompilationHash\n    )\n    activity.end()\n  }\n\n  activity = report.activityTimer(`run page queries`)\n  activity.start()\n  await queryRunner.processPageQueries(pageQueryIds, { activity })\n  activity.end()\n\n  const waitJobsFinished = () =>\n    new Promise((resolve, reject) => {\n      const onEndJob = () => {\n        if (store.getState().jobs.active.length === 0) {\n          resolve()\n          emitter.off(`END_JOB`, onEndJob)\n        }\n      }\n      emitter.on(`END_JOB`, onEndJob)\n      onEndJob()\n    })\n\n  await waitJobsFinished()\n\n  await db.saveState()\n\n  require(`../redux/actions`).boundActionCreators.setProgramStatus(\n    `BOOTSTRAP_QUERY_RUNNING_FINISHED`\n  )\n\n  activity = report.activityTimer(`Building static HTML for pages`, {\n    parentSpan: buildSpan,\n  })\n  activity.start()\n  try {\n    await buildHTML.buildRenderer(program, `build-html`)\n    const pagePaths = [...store.getState().pages.keys()]\n    await buildHTML.buildPages({ program, pagePaths, activity })\n  } catch (err) {\n    reportFailure(\n      report.stripIndent`\n        Building static HTML failed${\n          err.context && err.context.path\n            ? ` for path \"${chalk.bold(err.context.path)}\"`\n            : ``\n        }\n\n        See our docs page on debugging HTML builds for help https://gatsby.dev/debug-html\n      `,\n      err\n    )\n  }\n  activity.end()\n\n  await apiRunnerNode(`onPostBuild`, {\n    graphql: graphqlRunner,\n    parentSpan: buildSpan,\n  })\n\n  report.info(`Done building in ${process.uptime()} sec`)\n\n  buildSpan.finish()\n  await stopTracer()\n}\n"],"file":"build.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/commands/develop-html.js b/node_modules/gatsby/dist/commands/develop-html.js
deleted file mode 100644
index 7acd08d..0000000
--- a/node_modules/gatsby/dist/commands/develop-html.js
+++ /dev/null
@@ -1,59 +0,0 @@
-"use strict";
-
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
-const fs = require(`fs`);
-
-const webpack = require(`webpack`);
-
-const _require = require(`gatsby-cli/lib/reporter/errors`),
-      createErrorFromString = _require.createErrorFromString;
-
-const debug = require(`debug`)(`gatsby:html`);
-
-const webpackConfig = require(`../utils/webpack.config`);
-
-const renderHTMLQueue = require(`../utils/html-renderer-queue`);
-
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (program) {
-    const directory = program.directory;
-    debug(`generating static HTML`); // Static site generation.
-
-    const compilerConfig = yield webpackConfig(program, directory, `develop-html`, null);
-    return new Promise((resolve, reject) => {
-      webpack(compilerConfig).run((e, stats) => {
-        if (e) {
-          return reject(e);
-        }
-
-        const outputFile = `${directory}/public/render-page.js`;
-
-        if (stats.hasErrors()) {
-          let webpackErrors = stats.toJson().errors;
-          console.log(`here`, webpackErrors[0]);
-          return reject(createErrorFromString(webpackErrors[0], `${outputFile}.map`));
-        }
-
-        return renderHTMLQueue(outputFile, [`/`]).then(() => {
-          // Remove the temp JS bundle file built for the static-site-generator-plugin
-          try {
-            fs.unlinkSync(outputFile);
-          } catch (e) {// This function will fail on Windows with no further consequences.
-          }
-
-          return resolve(null, stats);
-        });
-      });
-    });
-  });
-
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
-//# sourceMappingURL=develop-html.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/commands/develop-html.js.map b/node_modules/gatsby/dist/commands/develop-html.js.map
deleted file mode 100644
index 6d5f268..0000000
--- a/node_modules/gatsby/dist/commands/develop-html.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../src/commands/develop-html.js"],"names":["fs","require","webpack","createErrorFromString","debug","webpackConfig","renderHTMLQueue","module","exports","program","directory","compilerConfig","Promise","resolve","reject","run","e","stats","outputFile","hasErrors","webpackErrors","toJson","errors","console","log","then","unlinkSync"],"mappings":";;;;;;AACA,MAAMA,EAAE,GAAGC,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAE,SAAF,CAAvB;;iBACkCA,OAAO,CAAE,gCAAF,C;MAAjCE,qB,YAAAA,qB;;AACR,MAAMC,KAAK,GAAGH,OAAO,CAAE,OAAF,CAAP,CAAkB,aAAlB,CAAd;;AACA,MAAMI,aAAa,GAAGJ,OAAO,CAAE,yBAAF,CAA7B;;AACA,MAAMK,eAAe,GAAGL,OAAO,CAAE,8BAAF,CAA/B;;AAEAM,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAOC,OAAP,EAAwB;AAAA,UAC/BC,SAD+B,GACjBD,OADiB,CAC/BC,SAD+B;AAGvCN,IAAAA,KAAK,CAAE,wBAAF,CAAL,CAHuC,CAKvC;;AACA,UAAMO,cAAc,SAASN,aAAa,CACxCI,OADwC,EAExCC,SAFwC,EAGvC,cAHuC,EAIxC,IAJwC,CAA1C;AAOA,WAAO,IAAIE,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCZ,MAAAA,OAAO,CAACS,cAAD,CAAP,CAAwBI,GAAxB,CAA4B,CAACC,CAAD,EAAIC,KAAJ,KAAc;AACxC,YAAID,CAAJ,EAAO;AACL,iBAAOF,MAAM,CAACE,CAAD,CAAb;AACD;;AACD,cAAME,UAAU,GAAI,GAAER,SAAU,wBAAhC;;AACA,YAAIO,KAAK,CAACE,SAAN,EAAJ,EAAuB;AACrB,cAAIC,aAAa,GAAGH,KAAK,CAACI,MAAN,GAAeC,MAAnC;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAa,MAAb,EAAoBJ,aAAa,CAAC,CAAD,CAAjC;AACA,iBAAON,MAAM,CACXX,qBAAqB,CAACiB,aAAa,CAAC,CAAD,CAAd,EAAoB,GAAEF,UAAW,MAAjC,CADV,CAAb;AAGD;;AAED,eAAOZ,eAAe,CAACY,UAAD,EAAa,CAAE,GAAF,CAAb,CAAf,CAAmCO,IAAnC,CAAwC,MAAM;AACnD;AACA,cAAI;AACFzB,YAAAA,EAAE,CAAC0B,UAAH,CAAcR,UAAd;AACD,WAFD,CAEE,OAAOF,CAAP,EAAU,CACV;AACD;;AAED,iBAAOH,OAAO,CAAC,IAAD,EAAOI,KAAP,CAAd;AACD,SATM,CAAP;AAUD,OAvBD;AAwBD,KAzBM,CAAP;AA0BD,GAvCD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\nconst fs = require(`fs`)\nconst webpack = require(`webpack`)\nconst { createErrorFromString } = require(`gatsby-cli/lib/reporter/errors`)\nconst debug = require(`debug`)(`gatsby:html`)\nconst webpackConfig = require(`../utils/webpack.config`)\nconst renderHTMLQueue = require(`../utils/html-renderer-queue`)\n\nmodule.exports = async (program: any) => {\n  const { directory } = program\n\n  debug(`generating static HTML`)\n\n  // Static site generation.\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `develop-html`,\n    null\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((e, stats) => {\n      if (e) {\n        return reject(e)\n      }\n      const outputFile = `${directory}/public/render-page.js`\n      if (stats.hasErrors()) {\n        let webpackErrors = stats.toJson().errors\n        console.log(`here`, webpackErrors[0])\n        return reject(\n          createErrorFromString(webpackErrors[0], `${outputFile}.map`)\n        )\n      }\n\n      return renderHTMLQueue(outputFile, [`/`]).then(() => {\n        // Remove the temp JS bundle file built for the static-site-generator-plugin\n        try {\n          fs.unlinkSync(outputFile)\n        } catch (e) {\n          // This function will fail on Windows with no further consequences.\n        }\n\n        return resolve(null, stats)\n      })\n    })\n  })\n}\n"],"file":"develop-html.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/commands/develop.js b/node_modules/gatsby/dist/commands/develop.js
index bbc225e..7fe5a9f 100644
--- a/node_modules/gatsby/dist/commands/develop.js
+++ b/node_modules/gatsby/dist/commands/develop.js
@@ -34,12 +34,13 @@ const webpackConfig = require(`../utils/webpack.config`);
 const bootstrap = require(`../bootstrap`);
 
 const _require2 = require(`../redux`),
-      store = _require2.store;
+      store = _require2.store,
+      emitter = _require2.emitter;
 
 const _require3 = require(`../utils/get-static-dir`),
       syncStaticDir = _require3.syncStaticDir;
 
-const developHtml = require(`./develop-html`);
+const buildHTML = require(`./build-html`);
 
 const _require4 = require(`../utils/path`),
       withBasePath = _require4.withBasePath;
@@ -71,6 +72,14 @@ const apiRunnerNode = require(`../utils/api-runner-node`);
 
 const telemetry = require(`gatsby-telemetry`);
 
+const queryRunner = require(`../query`);
+
+const queryWatcher = require(`../query/query-watcher`);
+
+const writeJsRequires = require(`../bootstrap/write-js-requires`);
+
+const db = require(`../db`);
+
 const detectPortInUseAndPrompt = require(`../utils/detect-port-in-use-and-prompt`);
 
 const onExit = require(`signal-exit`); // const isInteractive = process.stdout.isTTY
@@ -90,11 +99,106 @@ const rlInterface = rl.createInterface({
 rlInterface.on(`SIGINT`, () => {
   process.exit();
 });
+
+function startQueryListener() {
+  const processing = new Set();
+  const waiting = new Map();
+  const betterQueueOptions = {
+    priority: (job, cb) => {
+      const activePaths = Array.from(websocketManager.activePaths.values());
+
+      if (job.id && activePaths.includes(job.id)) {
+        cb(null, 10);
+      } else {
+        cb(null, 1);
+      }
+    },
+    merge: (oldTask, newTask, cb) => {
+      cb(null, newTask);
+    },
+    filter: (job, cb) => {
+      if (processing.has(job.id)) {
+        waiting.set(job.id, job);
+        cb(`already running`);
+      } else {
+        cb(null, job);
+      }
+    }
+  };
+
+  const postHandler =
+  /*#__PURE__*/
+  function () {
+    var _ref = (0, _asyncToGenerator2.default)(function* ({
+      queryJob,
+      result
+    }) {
+      if (queryJob.isPage) {
+        websocketManager.emitPageData(Object.assign({}, result, {
+          id: queryJob.id
+        }));
+      } else {
+        websocketManager.emitStaticQueryData(Object.assign({}, result, {
+          id: queryJob.id
+        }));
+      }
+
+      processing.delete(queryJob.id);
+
+      if (waiting.has(queryJob.id)) {
+        queue.push(waiting.get(queryJob.id));
+        waiting.delete(queryJob.id);
+      }
+    });
+
+    return function postHandler(_x) {
+      return _ref.apply(this, arguments);
+    };
+  }();
+
+  const queue = queryRunner.createQueue({
+    postHandler,
+    betterQueueOptions
+  });
+  queryRunner.startListener(queue);
+}
+
+const runPageQueries =
+/*#__PURE__*/
+function () {
+  var _ref2 = (0, _asyncToGenerator2.default)(function* (queryIds) {
+    let activity = report.activityTimer(`run page queries`);
+    activity.start();
+    yield queryRunner.processPageQueries(queryIds, {
+      activity
+    });
+    activity.end();
+
+    require(`../redux/actions`).boundActionCreators.setProgramStatus(`BOOTSTRAP_QUERY_RUNNING_FINISHED`);
+  });
+
+  return function runPageQueries(_x2) {
+    return _ref2.apply(this, arguments);
+  };
+}();
+
+const waitJobsFinished = () => new Promise((resolve, reject) => {
+  const onEndJob = () => {
+    if (store.getState().jobs.active.length === 0) {
+      resolve();
+      emitter.off(`END_JOB`, onEndJob);
+    }
+  };
+
+  emitter.on(`END_JOB`, onEndJob);
+  onEndJob();
+});
+
 onExit(() => {
   telemetry.trackCli(`DEVELOP_STOP`);
 });
 
-function startServer(_x) {
+function startServer(_x3) {
   return _startServer.apply(this, arguments);
 }
 
@@ -103,21 +207,35 @@ function _startServer() {
     const directory = program.directory;
     const directoryPath = withBasePath(directory);
 
-    const createIndexHtml = () => developHtml(program).catch(err => {
-      if (err.name !== `WebpackError`) {
-        report.panic(err);
-        return;
-      }
+    const createIndexHtml =
+    /*#__PURE__*/
+    function () {
+      var _ref6 = (0, _asyncToGenerator2.default)(function* () {
+        try {
+          yield buildHTML.buildRenderer(program, `develop-html`);
+          yield buildHTML.buildPages({
+            program,
+            pagePaths: [`/`]
+          });
+        } catch (err) {
+          if (err.name !== `WebpackError`) {
+            report.panic(err);
+            return;
+          }
 
-      report.panic(report.stripIndent`
+          report.panic(report.stripIndent`
           There was an error compiling the html.js component for the development server.
 
           See our docs page on debugging HTML builds for help https://gatsby.dev/debug-html
         `, err);
-    }); // Start bootstrap process.
+        }
+      });
 
+      return function createIndexHtml() {
+        return _ref6.apply(this, arguments);
+      };
+    }();
 
-    yield bootstrap(program);
     yield createIndexHtml();
     const devConfig = yield webpackConfig(program, directory, `develop`, program.port);
     const compiler = webpack(devConfig);
@@ -153,7 +271,35 @@ function _startServer() {
         }
 
       };
-    })); // Allow requests from any origin. Avoids CORS issues when using the `--host` flag.
+    }));
+
+    const mapToObject = map => {
+      const obj = {};
+
+      for (var _iterator = map, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
+        var _ref7;
+
+        if (_isArray) {
+          if (_i >= _iterator.length) break;
+          _ref7 = _iterator[_i++];
+        } else {
+          _i = _iterator.next();
+          if (_i.done) break;
+          _ref7 = _i.value;
+        }
+
+        let _ref8 = _ref7,
+            key = _ref8[0],
+            value = _ref8[1];
+        obj[key] = value;
+      }
+
+      return obj;
+    };
+
+    app.get(`/___pages`, (req, res) => {
+      res.json(mapToObject(store.getState().pages));
+    }); // Allow requests from any origin. Avoids CORS issues when using the `--host` flag.
 
     app.use((req, res, next) => {
       res.header(`Access-Control-Allow-Origin`, `*`);
@@ -271,7 +417,7 @@ function _startServer() {
 module.exports =
 /*#__PURE__*/
 function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (program) {
+  var _ref3 = (0, _asyncToGenerator2.default)(function* (program) {
     initTracer(program.openTracingConfigFile);
     telemetry.trackCli(`DEVELOP_START`);
     telemetry.startBackgroundUpdate();
@@ -294,14 +440,9 @@ function () {
       });
     }
 
-    let compiler;
-    yield new Promise(resolve => {
+    program.port = yield new Promise(resolve => {
       detectPortInUseAndPrompt(port, rlInterface, newPort => {
-        program.port = newPort;
-        startServer(program).then(([c, l]) => {
-          compiler = c;
-          resolve();
-        });
+        resolve(newPort);
       });
     });
 
@@ -407,7 +548,37 @@ function () {
           console.log();
         }
       });
-    }
+    } // Start bootstrap process.
+
+
+    const _ref4 = yield bootstrap(program),
+          graphqlRunner = _ref4.graphqlRunner; // Start the createPages hot reloader.
+
+
+    require(`../bootstrap/page-hot-reloader`)(graphqlRunner);
+
+    const queryIds = queryRunner.calcBootstrapDirtyQueryIds(store.getState());
+
+    const _queryRunner$groupQue = queryRunner.groupQueryIds(queryIds),
+          staticQueryIds = _queryRunner$groupQue.staticQueryIds,
+          pageQueryIds = _queryRunner$groupQue.pageQueryIds;
+
+    let activity = report.activityTimer(`run static queries`);
+    activity.start();
+    yield queryRunner.processStaticQueries(staticQueryIds, {
+      activity
+    });
+    activity.end();
+    yield runPageQueries(pageQueryIds);
+    yield waitJobsFinished();
+    yield writeJsRequires.startPageListener();
+    yield db.saveState();
+    db.startAutosave();
+    startQueryListener();
+    queryWatcher.startWatchDeletePage();
+
+    const _ref5 = yield startServer(program),
+          compiler = _ref5[0];
 
     let isFirstCompile = true; // "done" event fires when Webpack has finished recompiling the bundle.
     // Whether or not you have warnings or errors, you will get this event.
@@ -464,8 +635,8 @@ function () {
     });
   });
 
-  return function (_x2) {
-    return _ref.apply(this, arguments);
+  return function (_x4) {
+    return _ref3.apply(this, arguments);
   };
 }();
 //# sourceMappingURL=develop.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/commands/develop.js.map b/node_modules/gatsby/dist/commands/develop.js.map
index 72eb3e4..68c2bcb 100644
--- a/node_modules/gatsby/dist/commands/develop.js.map
+++ b/node_modules/gatsby/dist/commands/develop.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/develop.js"],"names":["url","require","glob","fs","openurl","chokidar","express","graphqlHTTP","graphqlPlayground","default","formatError","request","rl","webpack","webpackConfig","bootstrap","store","syncStaticDir","developHtml","withBasePath","report","launchEditor","formatWebpackMessages","chalk","address","withResolverContext","sourceNodes","websocketManager","getSslCert","slash","initTracer","apiRunnerNode","telemetry","detectPortInUseAndPrompt","onExit","setTimeout","rlInterface","createInterface","input","process","stdin","output","stdout","on","exit","trackCli","startServer","program","directory","directoryPath","createIndexHtml","catch","err","name","panic","stripIndent","devConfig","port","compiler","app","use","expressMiddleware","log","path","heartbeat","env","GATSBY_GRAPHQL_IDE","get","endpoint","schema","getState","graphiql","context","stack","split","req","res","next","header","post","enableRefresh","ENABLE_GATSBY_REFRESH_ENDPOINT","refreshToken","GATSBY_REFRESH_TOKEN","authorizedRefresh","headers","authorization","console","end","query","fileName","lineNumber","index","logLevel","publicPath","stats","developMiddleware","config","proxy","prefix","proxiedUrl","originalUrl","pipe","message","error","status","sendFile","server","Server","ssl","createServer","init","socket","getSocket","listener","listen","host","code","watchGlobs","map","watch","to","emit","module","exports","openTracingConfigFile","startBackgroundUpdate","parseInt","https","sitePackageJson","replace","certFile","keyFile","Promise","resolve","newPort","then","c","l","prepareUrls","protocol","formatUrl","hostname","format","pathname","prettyPrintUrl","bold","isUnspecifiedHost","lanUrlForConfig","lanUrlForTerminal","ip","test","undefined","_e","localUrlForTerminal","localUrlForBrowser","printInstructions","appName","urls","useYarn","cyan","printDeprecationWarnings","deprecatedApis","fixMap","boundActionCreators","newName","docsLink","pathContext","deprecatedLocations","forEach","api","sync","nodir","file","fileText","readFileSync","matchingApis","filter","indexOf","push","length","yellow","isFirstCompile","hooks","done","tapAsync","messages","toJson","isSuccessful","errors","open"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst url = require(`url`)\nconst glob = require(`glob`)\nconst fs = require(`fs`)\nconst openurl = require(`better-opn`)\nconst chokidar = require(`chokidar`)\nconst express = require(`express`)\nconst graphqlHTTP = require(`express-graphql`)\nconst graphqlPlayground = require(`graphql-playground-middleware-express`)\n  .default\nconst { formatError } = require(`graphql`)\nconst request = require(`request`)\nconst rl = require(`readline`)\nconst webpack = require(`webpack`)\nconst webpackConfig = require(`../utils/webpack.config`)\nconst bootstrap = require(`../bootstrap`)\nconst { store } = require(`../redux`)\nconst { syncStaticDir } = require(`../utils/get-static-dir`)\nconst developHtml = require(`./develop-html`)\nconst { withBasePath } = require(`../utils/path`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst launchEditor = require(`react-dev-utils/launchEditor`)\nconst formatWebpackMessages = require(`react-dev-utils/formatWebpackMessages`)\nconst chalk = require(`chalk`)\nconst address = require(`address`)\nconst withResolverContext = require(`../schema/context`)\nconst sourceNodes = require(`../utils/source-nodes`)\nconst websocketManager = require(`../utils/websocket-manager`)\nconst getSslCert = require(`../utils/get-ssl-cert`)\nconst slash = require(`slash`)\nconst { initTracer } = require(`../utils/tracer`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst telemetry = require(`gatsby-telemetry`)\nconst detectPortInUseAndPrompt = require(`../utils/detect-port-in-use-and-prompt`)\nconst onExit = require(`signal-exit`)\n\n// const isInteractive = process.stdout.isTTY\n\n// Watch the static directory and copy files to public as they're added or\n// changed. Wait 10 seconds so copying doesn't interfere with the regular\n// bootstrap.\nsetTimeout(() => {\n  syncStaticDir()\n}, 10000)\n\nconst rlInterface = rl.createInterface({\n  input: process.stdin,\n  output: process.stdout,\n})\n\n// Quit immediately on hearing ctrl-c\nrlInterface.on(`SIGINT`, () => {\n  process.exit()\n})\n\nonExit(() => {\n  telemetry.trackCli(`DEVELOP_STOP`)\n})\n\nasync function startServer(program) {\n  const directory = program.directory\n  const directoryPath = withBasePath(directory)\n  const createIndexHtml = () =>\n    developHtml(program).catch(err => {\n      if (err.name !== `WebpackError`) {\n        report.panic(err)\n        return\n      }\n      report.panic(\n        report.stripIndent`\n          There was an error compiling the html.js component for the development server.\n\n          See our docs page on debugging HTML builds for help https://gatsby.dev/debug-html\n        `,\n        err\n      )\n    })\n\n  // Start bootstrap process.\n  await bootstrap(program)\n\n  await createIndexHtml()\n\n  const devConfig = await webpackConfig(\n    program,\n    directory,\n    `develop`,\n    program.port\n  )\n\n  const compiler = webpack(devConfig)\n\n  /**\n   * Set up the express app.\n   **/\n  const app = express()\n  app.use(telemetry.expressMiddleware(`DEVELOP`))\n  app.use(\n    require(`webpack-hot-middleware`)(compiler, {\n      log: false,\n      path: `/__webpack_hmr`,\n      heartbeat: 10 * 1000,\n    })\n  )\n\n  if (process.env.GATSBY_GRAPHQL_IDE === `playground`) {\n    app.get(\n      `/___graphql`,\n      graphqlPlayground({\n        endpoint: `/___graphql`,\n      }),\n      () => {}\n    )\n  }\n\n  app.use(\n    `/___graphql`,\n    graphqlHTTP(() => {\n      const schema = store.getState().schema\n      return {\n        schema,\n        graphiql:\n          process.env.GATSBY_GRAPHQL_IDE === `playground` ? false : true,\n        context: withResolverContext({}, schema),\n        formatError(err) {\n          return {\n            ...formatError(err),\n            stack: err.stack ? err.stack.split(`\\n`) : [],\n          }\n        },\n      }\n    })\n  )\n\n  // Allow requests from any origin. Avoids CORS issues when using the `--host` flag.\n  app.use((req, res, next) => {\n    res.header(`Access-Control-Allow-Origin`, `*`)\n    res.header(\n      `Access-Control-Allow-Headers`,\n      `Origin, X-Requested-With, Content-Type, Accept`\n    )\n    next()\n  })\n\n  /**\n   * Refresh external data sources.\n   * This behavior is disabled by default, but the ENABLE_REFRESH_ENDPOINT env var enables it\n   * If no GATSBY_REFRESH_TOKEN env var is available, then no Authorization header is required\n   **/\n  app.post(`/__refresh`, (req, res) => {\n    const enableRefresh = process.env.ENABLE_GATSBY_REFRESH_ENDPOINT\n    const refreshToken = process.env.GATSBY_REFRESH_TOKEN\n    const authorizedRefresh =\n      !refreshToken || req.headers.authorization === refreshToken\n\n    if (enableRefresh && authorizedRefresh) {\n      console.log(`Refreshing source data`)\n      sourceNodes()\n    }\n    res.end()\n  })\n\n  app.get(`/__open-stack-frame-in-editor`, (req, res) => {\n    launchEditor(req.query.fileName, req.query.lineNumber)\n    res.end()\n  })\n\n  // Disable directory indexing i.e. serving index.html from a directory.\n  // This can lead to serving stale html files during development.\n  //\n  // We serve by default an empty index.html that sets up the dev environment.\n  app.use(require(`./develop-static`)(`public`, { index: false }))\n\n  app.use(\n    require(`webpack-dev-middleware`)(compiler, {\n      logLevel: `trace`,\n      publicPath: devConfig.output.publicPath,\n      stats: `errors-only`,\n    })\n  )\n\n  // Expose access to app for advanced use cases\n  const { developMiddleware } = store.getState().config\n\n  if (developMiddleware) {\n    developMiddleware(app)\n  }\n\n  // Set up API proxy.\n  const { proxy } = store.getState().config\n  if (proxy) {\n    const { prefix, url } = proxy\n    app.use(`${prefix}/*`, (req, res) => {\n      const proxiedUrl = url + req.originalUrl\n      req\n        .pipe(\n          request(proxiedUrl).on(`error`, err => {\n            const message = `Error when trying to proxy request \"${\n              req.originalUrl\n            }\" to \"${proxiedUrl}\"`\n\n            report.error(message, err)\n            res.status(500).end()\n          })\n        )\n        .pipe(res)\n    })\n  }\n\n  await apiRunnerNode(`onCreateDevServer`, { app })\n\n  // Render an HTML page and serve it.\n  app.use((req, res, next) => {\n    res.sendFile(directoryPath(`public/index.html`), err => {\n      if (err) {\n        res.status(500).end()\n      }\n    })\n  })\n\n  /**\n   * Set up the HTTP server and socket.io.\n   **/\n  let server = require(`http`).Server(app)\n\n  // If a SSL cert exists in program, use it with `createServer`.\n  if (program.ssl) {\n    server = require(`https`).createServer(program.ssl, app)\n  }\n  websocketManager.init({ server, directory: program.directory })\n  const socket = websocketManager.getSocket()\n\n  const listener = server.listen(program.port, program.host, err => {\n    if (err) {\n      if (err.code === `EADDRINUSE`) {\n        // eslint-disable-next-line max-len\n        report.panic(\n          `Unable to start Gatsby on port ${\n            program.port\n          } as there's already a process listening on that port.`\n        )\n        return\n      }\n\n      report.panic(`There was a problem starting the development server`, err)\n    }\n  })\n\n  // Register watcher that rebuilds index.html every time html.js changes.\n  const watchGlobs = [`src/html.js`, `plugins/**/gatsby-ssr.js`].map(path =>\n    slash(directoryPath(path))\n  )\n\n  chokidar.watch(watchGlobs).on(`change`, async () => {\n    await createIndexHtml()\n    socket.to(`clients`).emit(`reload`)\n  })\n\n  return [compiler, listener]\n}\n\nmodule.exports = async (program: any) => {\n  initTracer(program.openTracingConfigFile)\n  telemetry.trackCli(`DEVELOP_START`)\n  telemetry.startBackgroundUpdate()\n\n  const port =\n    typeof program.port === `string` ? parseInt(program.port, 10) : program.port\n\n  // In order to enable custom ssl, --cert-file --key-file and -https flags must all be\n  // used together\n  if ((program[`cert-file`] || program[`key-file`]) && !program.https) {\n    report.panic(\n      `for custom ssl --https, --cert-file, and --key-file must be used together`\n    )\n  }\n\n  // Check if https is enabled, then create or get SSL cert.\n  // Certs are named after `name` inside the project's package.json.\n  // Scoped names are converted from @npm/package-name to npm--package-name\n  if (program.https) {\n    program.ssl = await getSslCert({\n      name: program.sitePackageJson.name.replace(`@`, ``).replace(`/`, `--`),\n      certFile: program[`cert-file`],\n      keyFile: program[`key-file`],\n      directory: program.directory,\n    })\n  }\n\n  let compiler\n  await new Promise(resolve => {\n    detectPortInUseAndPrompt(port, rlInterface, newPort => {\n      program.port = newPort\n      startServer(program).then(([c, l]) => {\n        compiler = c\n        resolve()\n      })\n    })\n  })\n\n  function prepareUrls(protocol, host, port) {\n    const formatUrl = hostname =>\n      url.format({\n        protocol,\n        hostname,\n        port,\n        pathname: `/`,\n      })\n    const prettyPrintUrl = hostname =>\n      url.format({\n        protocol,\n        hostname,\n        port: chalk.bold(port),\n        pathname: `/`,\n      })\n\n    const isUnspecifiedHost = host === `0.0.0.0` || host === `::`\n    let lanUrlForConfig, lanUrlForTerminal\n    if (isUnspecifiedHost) {\n      try {\n        // This can only return an IPv4 address\n        lanUrlForConfig = address.ip()\n        if (lanUrlForConfig) {\n          // Check if the address is a private ip\n          // https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces\n          if (\n            /^10[.]|^172[.](1[6-9]|2[0-9]|3[0-1])[.]|^192[.]168[.]/.test(\n              lanUrlForConfig\n            )\n          ) {\n            // Address is private, format it for later use\n            lanUrlForTerminal = prettyPrintUrl(lanUrlForConfig)\n          } else {\n            // Address is not private, so we will discard it\n            lanUrlForConfig = undefined\n          }\n        }\n      } catch (_e) {\n        // ignored\n      }\n    }\n    // TODO collect errors (GraphQL + Webpack) in Redux so we\n    // can clear terminal and print them out on every compile.\n    // Borrow pretty printing code from webpack plugin.\n    const localUrlForTerminal = prettyPrintUrl(host)\n    const localUrlForBrowser = formatUrl(host)\n    return {\n      lanUrlForConfig,\n      lanUrlForTerminal,\n      localUrlForTerminal,\n      localUrlForBrowser,\n    }\n  }\n\n  function printInstructions(appName, urls, useYarn) {\n    console.log()\n    console.log(`You can now view ${chalk.bold(appName)} in the browser.`)\n    console.log()\n\n    if (urls.lanUrlForTerminal) {\n      console.log(\n        `  ${chalk.bold(`Local:`)}            ${urls.localUrlForTerminal}`\n      )\n      console.log(\n        `  ${chalk.bold(`On Your Network:`)}  ${urls.lanUrlForTerminal}`\n      )\n    } else {\n      console.log(`  ${urls.localUrlForTerminal}`)\n    }\n\n    console.log()\n    console.log(\n      `View ${\n        process.env.GATSBY_GRAPHQL_IDE === `playground`\n          ? `the GraphQL Playground`\n          : `GraphiQL`\n      }, an in-browser IDE, to explore your site's data and schema`\n    )\n    console.log()\n    console.log(`  ${urls.localUrlForTerminal}___graphql`)\n\n    console.log()\n    console.log(`Note that the development build is not optimized.`)\n    console.log(\n      `To create a production build, use ` + `${chalk.cyan(`npm run build`)}`\n    )\n    console.log()\n  }\n\n  function printDeprecationWarnings() {\n    const deprecatedApis = [`boundActionCreators`, `pathContext`]\n    const fixMap = {\n      boundActionCreators: {\n        newName: `actions`,\n        docsLink: `https://gatsby.dev/boundActionCreators`,\n      },\n      pathContext: {\n        newName: `pageContext`,\n        docsLink: `https://gatsby.dev/pathContext`,\n      },\n    }\n    const deprecatedLocations = {}\n    deprecatedApis.forEach(api => (deprecatedLocations[api] = []))\n\n    glob\n      .sync(`{,!(node_modules|public)/**/}*.js`, { nodir: true })\n      .forEach(file => {\n        const fileText = fs.readFileSync(file)\n        const matchingApis = deprecatedApis.filter(\n          api => fileText.indexOf(api) !== -1\n        )\n        matchingApis.forEach(api => deprecatedLocations[api].push(file))\n      })\n\n    deprecatedApis.forEach(api => {\n      if (deprecatedLocations[api].length) {\n        console.log(\n          `%s %s %s %s`,\n          chalk.cyan(api),\n          chalk.yellow(`is deprecated. Please use`),\n          chalk.cyan(fixMap[api].newName),\n          chalk.yellow(\n            `instead. For migration instructions, see ${\n              fixMap[api].docsLink\n            }\\nCheck the following files:`\n          )\n        )\n        console.log()\n        deprecatedLocations[api].forEach(file => console.log(file))\n        console.log()\n      }\n    })\n  }\n\n  let isFirstCompile = true\n  // \"done\" event fires when Webpack has finished recompiling the bundle.\n  // Whether or not you have warnings or errors, you will get this event.\n  compiler.hooks.done.tapAsync(`print getsby instructions`, (stats, done) => {\n    // We have switched off the default Webpack output in WebpackDevServer\n    // options so we are going to \"massage\" the warnings and errors and present\n    // them in a readable focused way.\n    const messages = formatWebpackMessages(stats.toJson({}, true))\n    const urls = prepareUrls(\n      program.ssl ? `https` : `http`,\n      program.host,\n      program.port\n    )\n    const isSuccessful = !messages.errors.length\n    // if (isSuccessful) {\n    // console.log(chalk.green(`Compiled successfully!`))\n    // }\n    // if (isSuccessful && (isInteractive || isFirstCompile)) {\n    if (isSuccessful && isFirstCompile) {\n      printInstructions(program.sitePackageJson.name, urls, program.useYarn)\n      printDeprecationWarnings()\n      if (program.open) {\n        Promise.resolve(openurl(urls.localUrlForBrowser)).catch(err =>\n          console.log(\n            `${chalk.yellow(\n              `warn`\n            )} Browser not opened because no browser was found`\n          )\n        )\n      }\n    }\n\n    isFirstCompile = false\n\n    // If errors exist, only show errors.\n    // if (messages.errors.length) {\n    // // Only keep the first error. Others are often indicative\n    // // of the same problem, but confuse the reader with noise.\n    // if (messages.errors.length > 1) {\n    // messages.errors.length = 1\n    // }\n    // console.log(chalk.red(\"Failed to compile.\\n\"))\n    // console.log(messages.errors.join(\"\\n\\n\"))\n    // return\n    // }\n\n    // Show warnings if no errors were found.\n    // if (messages.warnings.length) {\n    // console.log(chalk.yellow(\"Compiled with warnings.\\n\"))\n    // console.log(messages.warnings.join(\"\\n\\n\"))\n\n    // // Teach some ESLint tricks.\n    // console.log(\n    // \"\\nSearch for the \" +\n    // chalk.underline(chalk.yellow(\"keywords\")) +\n    // \" to learn more about each warning.\"\n    // )\n    // console.log(\n    // \"To ignore, add \" +\n    // chalk.cyan(\"// eslint-disable-next-line\") +\n    // \" to the line before.\\n\"\n    // )\n    // }\n\n    done()\n  })\n}\n"],"file":"develop.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/develop.js"],"names":["url","require","glob","fs","openurl","chokidar","express","graphqlHTTP","graphqlPlayground","default","formatError","request","rl","webpack","webpackConfig","bootstrap","store","emitter","syncStaticDir","buildHTML","withBasePath","report","launchEditor","formatWebpackMessages","chalk","address","withResolverContext","sourceNodes","websocketManager","getSslCert","slash","initTracer","apiRunnerNode","telemetry","queryRunner","queryWatcher","writeJsRequires","db","detectPortInUseAndPrompt","onExit","setTimeout","rlInterface","createInterface","input","process","stdin","output","stdout","on","exit","startQueryListener","processing","Set","waiting","Map","betterQueueOptions","priority","job","cb","activePaths","Array","from","values","id","includes","merge","oldTask","newTask","filter","has","set","postHandler","queryJob","result","isPage","emitPageData","emitStaticQueryData","delete","queue","push","get","createQueue","startListener","runPageQueries","queryIds","activity","activityTimer","start","processPageQueries","end","boundActionCreators","setProgramStatus","waitJobsFinished","Promise","resolve","reject","onEndJob","getState","jobs","active","length","off","trackCli","startServer","program","directory","directoryPath","createIndexHtml","buildRenderer","buildPages","pagePaths","err","name","panic","stripIndent","devConfig","port","compiler","app","use","expressMiddleware","log","path","heartbeat","env","GATSBY_GRAPHQL_IDE","endpoint","schema","graphiql","context","stack","split","mapToObject","map","obj","key","value","req","res","json","pages","next","header","post","enableRefresh","ENABLE_GATSBY_REFRESH_ENDPOINT","refreshToken","GATSBY_REFRESH_TOKEN","authorizedRefresh","headers","authorization","console","query","fileName","lineNumber","index","logLevel","publicPath","stats","developMiddleware","config","proxy","prefix","proxiedUrl","originalUrl","pipe","message","error","status","sendFile","server","Server","ssl","createServer","init","socket","getSocket","listener","listen","host","code","watchGlobs","watch","to","emit","module","exports","openTracingConfigFile","startBackgroundUpdate","parseInt","https","sitePackageJson","replace","certFile","keyFile","newPort","prepareUrls","protocol","formatUrl","hostname","format","pathname","prettyPrintUrl","bold","isUnspecifiedHost","lanUrlForConfig","lanUrlForTerminal","ip","test","undefined","_e","localUrlForTerminal","localUrlForBrowser","printInstructions","appName","urls","useYarn","cyan","printDeprecationWarnings","deprecatedApis","fixMap","newName","docsLink","pathContext","deprecatedLocations","forEach","api","sync","nodir","file","fileText","readFileSync","matchingApis","indexOf","yellow","graphqlRunner","calcBootstrapDirtyQueryIds","groupQueryIds","staticQueryIds","pageQueryIds","processStaticQueries","startPageListener","saveState","startAutosave","startWatchDeletePage","isFirstCompile","hooks","done","tapAsync","messages","toJson","isSuccessful","errors","open","catch"],"mappings":";;;;;;AAEA,MAAMA,GAAG,GAAGC,OAAO,CAAE,KAAF,CAAnB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAE,MAAF,CAApB;;AACA,MAAME,EAAE,GAAGF,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAMG,OAAO,GAAGH,OAAO,CAAE,YAAF,CAAvB;;AACA,MAAMI,QAAQ,GAAGJ,OAAO,CAAE,UAAF,CAAxB;;AACA,MAAMK,OAAO,GAAGL,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMM,WAAW,GAAGN,OAAO,CAAE,iBAAF,CAA3B;;AACA,MAAMO,iBAAiB,GAAGP,OAAO,CAAE,uCAAF,CAAP,CACvBQ,OADH;;iBAEwBR,OAAO,CAAE,SAAF,C;MAAvBS,W,YAAAA,W;;AACR,MAAMC,OAAO,GAAGV,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMW,EAAE,GAAGX,OAAO,CAAE,UAAF,CAAlB;;AACA,MAAMY,OAAO,GAAGZ,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMa,aAAa,GAAGb,OAAO,CAAE,yBAAF,CAA7B;;AACA,MAAMc,SAAS,GAAGd,OAAO,CAAE,cAAF,CAAzB;;kBAC2BA,OAAO,CAAE,UAAF,C;MAA1Be,K,aAAAA,K;MAAOC,O,aAAAA,O;;kBACWhB,OAAO,CAAE,yBAAF,C;MAAzBiB,a,aAAAA,a;;AACR,MAAMC,SAAS,GAAGlB,OAAO,CAAE,cAAF,CAAzB;;kBACyBA,OAAO,CAAE,eAAF,C;MAAxBmB,Y,aAAAA,Y;;AACR,MAAMC,MAAM,GAAGpB,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMqB,YAAY,GAAGrB,OAAO,CAAE,8BAAF,CAA5B;;AACA,MAAMsB,qBAAqB,GAAGtB,OAAO,CAAE,uCAAF,CAArC;;AACA,MAAMuB,KAAK,GAAGvB,OAAO,CAAE,OAAF,CAArB;;AACA,MAAMwB,OAAO,GAAGxB,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMyB,mBAAmB,GAAGzB,OAAO,CAAE,mBAAF,CAAnC;;AACA,MAAM0B,WAAW,GAAG1B,OAAO,CAAE,uBAAF,CAA3B;;AACA,MAAM2B,gBAAgB,GAAG3B,OAAO,CAAE,4BAAF,CAAhC;;AACA,MAAM4B,UAAU,GAAG5B,OAAO,CAAE,uBAAF,CAA1B;;AACA,MAAM6B,KAAK,GAAG7B,OAAO,CAAE,OAAF,CAArB;;kBACuBA,OAAO,CAAE,iBAAF,C;MAAtB8B,U,aAAAA,U;;AACR,MAAMC,aAAa,GAAG/B,OAAO,CAAE,0BAAF,CAA7B;;AACA,MAAMgC,SAAS,GAAGhC,OAAO,CAAE,kBAAF,CAAzB;;AACA,MAAMiC,WAAW,GAAGjC,OAAO,CAAE,UAAF,CAA3B;;AACA,MAAMkC,YAAY,GAAGlC,OAAO,CAAE,wBAAF,CAA5B;;AACA,MAAMmC,eAAe,GAAGnC,OAAO,CAAE,gCAAF,CAA/B;;AACA,MAAMoC,EAAE,GAAGpC,OAAO,CAAE,OAAF,CAAlB;;AACA,MAAMqC,wBAAwB,GAAGrC,OAAO,CAAE,wCAAF,CAAxC;;AACA,MAAMsC,MAAM,GAAGtC,OAAO,CAAE,aAAF,CAAtB,C,CAEA;AAEA;AACA;AACA;;;AACAuC,UAAU,CAAC,MAAM;AACftB,EAAAA,aAAa;AACd,CAFS,EAEP,KAFO,CAAV;AAIA,MAAMuB,WAAW,GAAG7B,EAAE,CAAC8B,eAAH,CAAmB;AACrCC,EAAAA,KAAK,EAAEC,OAAO,CAACC,KADsB;AAErCC,EAAAA,MAAM,EAAEF,OAAO,CAACG;AAFqB,CAAnB,CAApB,C,CAKA;;AACAN,WAAW,CAACO,EAAZ,CAAgB,QAAhB,EAAyB,MAAM;AAC7BJ,EAAAA,OAAO,CAACK,IAAR;AACD,CAFD;;AAIA,SAASC,kBAAT,GAA8B;AAC5B,QAAMC,UAAU,GAAG,IAAIC,GAAJ,EAAnB;AACA,QAAMC,OAAO,GAAG,IAAIC,GAAJ,EAAhB;AAEA,QAAMC,kBAAkB,GAAG;AACzBC,IAAAA,QAAQ,EAAE,CAACC,GAAD,EAAMC,EAAN,KAAa;AACrB,YAAMC,WAAW,GAAGC,KAAK,CAACC,IAAN,CAAWjC,gBAAgB,CAAC+B,WAAjB,CAA6BG,MAA7B,EAAX,CAApB;;AACA,UAAIL,GAAG,CAACM,EAAJ,IAAUJ,WAAW,CAACK,QAAZ,CAAqBP,GAAG,CAACM,EAAzB,CAAd,EAA4C;AAC1CL,QAAAA,EAAE,CAAC,IAAD,EAAO,EAAP,CAAF;AACD,OAFD,MAEO;AACLA,QAAAA,EAAE,CAAC,IAAD,EAAO,CAAP,CAAF;AACD;AACF,KARwB;AASzBO,IAAAA,KAAK,EAAE,CAACC,OAAD,EAAUC,OAAV,EAAmBT,EAAnB,KAA0B;AAC/BA,MAAAA,EAAE,CAAC,IAAD,EAAOS,OAAP,CAAF;AACD,KAXwB;AAYzBC,IAAAA,MAAM,EAAE,CAACX,GAAD,EAAMC,EAAN,KAAa;AACnB,UAAIP,UAAU,CAACkB,GAAX,CAAeZ,GAAG,CAACM,EAAnB,CAAJ,EAA4B;AAC1BV,QAAAA,OAAO,CAACiB,GAAR,CAAYb,GAAG,CAACM,EAAhB,EAAoBN,GAApB;AACAC,QAAAA,EAAE,CAAE,iBAAF,CAAF;AACD,OAHD,MAGO;AACLA,QAAAA,EAAE,CAAC,IAAD,EAAOD,GAAP,CAAF;AACD;AACF;AAnBwB,GAA3B;;AAsBA,QAAMc,WAAW;AAAA;AAAA;AAAA,+CAAG,WAAO;AAAEC,MAAAA,QAAF;AAAYC,MAAAA;AAAZ,KAAP,EAAgC;AAClD,UAAID,QAAQ,CAACE,MAAb,EAAqB;AACnB9C,QAAAA,gBAAgB,CAAC+C,YAAjB,mBACKF,MADL;AAEEV,UAAAA,EAAE,EAAES,QAAQ,CAACT;AAFf;AAID,OALD,MAKO;AACLnC,QAAAA,gBAAgB,CAACgD,mBAAjB,mBACKH,MADL;AAEEV,UAAAA,EAAE,EAAES,QAAQ,CAACT;AAFf;AAID;;AACDZ,MAAAA,UAAU,CAAC0B,MAAX,CAAkBL,QAAQ,CAACT,EAA3B;;AACA,UAAIV,OAAO,CAACgB,GAAR,CAAYG,QAAQ,CAACT,EAArB,CAAJ,EAA8B;AAC5Be,QAAAA,KAAK,CAACC,IAAN,CAAW1B,OAAO,CAAC2B,GAAR,CAAYR,QAAQ,CAACT,EAArB,CAAX;AACAV,QAAAA,OAAO,CAACwB,MAAR,CAAeL,QAAQ,CAACT,EAAxB;AACD;AACF,KAjBgB;;AAAA,oBAAXQ,WAAW;AAAA;AAAA;AAAA,KAAjB;;AAmBA,QAAMO,KAAK,GAAG5C,WAAW,CAAC+C,WAAZ,CAAwB;AAAEV,IAAAA,WAAF;AAAehB,IAAAA;AAAf,GAAxB,CAAd;AACArB,EAAAA,WAAW,CAACgD,aAAZ,CAA0BJ,KAA1B;AACD;;AAED,MAAMK,cAAc;AAAA;AAAA;AAAA,8CAAG,WAAMC,QAAN,EAAkB;AACvC,QAAIC,QAAQ,GAAGhE,MAAM,CAACiE,aAAP,CAAsB,kBAAtB,CAAf;AACAD,IAAAA,QAAQ,CAACE,KAAT;AACA,UAAMrD,WAAW,CAACsD,kBAAZ,CAA+BJ,QAA/B,EAAyC;AAAEC,MAAAA;AAAF,KAAzC,CAAN;AACAA,IAAAA,QAAQ,CAACI,GAAT;;AAEAxF,IAAAA,OAAO,CAAE,kBAAF,CAAP,CAA4ByF,mBAA5B,CAAgDC,gBAAhD,CACG,kCADH;AAGD,GATmB;;AAAA,kBAAdR,cAAc;AAAA;AAAA;AAAA,GAApB;;AAWA,MAAMS,gBAAgB,GAAG,MACvB,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAC/B,QAAMC,QAAQ,GAAG,MAAM;AACrB,QAAIhF,KAAK,CAACiF,QAAN,GAAiBC,IAAjB,CAAsBC,MAAtB,CAA6BC,MAA7B,KAAwC,CAA5C,EAA+C;AAC7CN,MAAAA,OAAO;AACP7E,MAAAA,OAAO,CAACoF,GAAR,CAAa,SAAb,EAAuBL,QAAvB;AACD;AACF,GALD;;AAMA/E,EAAAA,OAAO,CAAC+B,EAAR,CAAY,SAAZ,EAAsBgD,QAAtB;AACAA,EAAAA,QAAQ;AACT,CATD,CADF;;AAYAzD,MAAM,CAAC,MAAM;AACXN,EAAAA,SAAS,CAACqE,QAAV,CAAoB,cAApB;AACD,CAFK,CAAN;;SAIeC,W;;;;;iDAAf,WAA2BC,OAA3B,EAAoC;AAClC,UAAMC,SAAS,GAAGD,OAAO,CAACC,SAA1B;AACA,UAAMC,aAAa,GAAGtF,YAAY,CAACqF,SAAD,CAAlC;;AACA,UAAME,eAAe;AAAA;AAAA;AAAA,kDAAG,aAAY;AAClC,YAAI;AACF,gBAAMxF,SAAS,CAACyF,aAAV,CAAwBJ,OAAxB,EAAkC,cAAlC,CAAN;AACA,gBAAMrF,SAAS,CAAC0F,UAAV,CAAqB;AAAEL,YAAAA,OAAF;AAAWM,YAAAA,SAAS,EAAE,CAAE,GAAF;AAAtB,WAArB,CAAN;AACD,SAHD,CAGE,OAAOC,GAAP,EAAY;AACZ,cAAIA,GAAG,CAACC,IAAJ,KAAc,cAAlB,EAAiC;AAC/B3F,YAAAA,MAAM,CAAC4F,KAAP,CAAaF,GAAb;AACA;AACD;;AACD1F,UAAAA,MAAM,CAAC4F,KAAP,CACE5F,MAAM,CAAC6F,WAAY;;;;SADrB,EAMEH,GANF;AAQD;AACF,OAlBoB;;AAAA,sBAAfJ,eAAe;AAAA;AAAA;AAAA,OAArB;;AAoBA,UAAMA,eAAe,EAArB;AAEA,UAAMQ,SAAS,SAASrG,aAAa,CACnC0F,OADmC,EAEnCC,SAFmC,EAGlC,SAHkC,EAInCD,OAAO,CAACY,IAJ2B,CAArC;AAOA,UAAMC,QAAQ,GAAGxG,OAAO,CAACsG,SAAD,CAAxB;AAEA;;;;AAGA,UAAMG,GAAG,GAAGhH,OAAO,EAAnB;AACAgH,IAAAA,GAAG,CAACC,GAAJ,CAAQtF,SAAS,CAACuF,iBAAV,CAA6B,SAA7B,CAAR;AACAF,IAAAA,GAAG,CAACC,GAAJ,CACEtH,OAAO,CAAE,wBAAF,CAAP,CAAkCoH,QAAlC,EAA4C;AAC1CI,MAAAA,GAAG,EAAE,KADqC;AAE1CC,MAAAA,IAAI,EAAG,gBAFmC;AAG1CC,MAAAA,SAAS,EAAE,KAAK;AAH0B,KAA5C,CADF;;AAQA,QAAI/E,OAAO,CAACgF,GAAR,CAAYC,kBAAZ,KAAoC,YAAxC,EAAqD;AACnDP,MAAAA,GAAG,CAACtC,GAAJ,CACG,aADH,EAEExE,iBAAiB,CAAC;AAChBsH,QAAAA,QAAQ,EAAG;AADK,OAAD,CAFnB,EAKE,MAAM,CAAE,CALV;AAOD;;AAEDR,IAAAA,GAAG,CAACC,GAAJ,CACG,aADH,EAEEhH,WAAW,CAAC,MAAM;AAChB,YAAMwH,MAAM,GAAG/G,KAAK,CAACiF,QAAN,GAAiB8B,MAAhC;AACA,aAAO;AACLA,QAAAA,MADK;AAELC,QAAAA,QAAQ,EACNpF,OAAO,CAACgF,GAAR,CAAYC,kBAAZ,KAAoC,YAApC,GAAkD,KAAlD,GAA0D,IAHvD;AAILI,QAAAA,OAAO,EAAEvG,mBAAmB,CAAC,EAAD,EAAKqG,MAAL,CAJvB;;AAKLrH,QAAAA,WAAW,CAACqG,GAAD,EAAM;AACf,mCACKrG,WAAW,CAACqG,GAAD,CADhB;AAEEmB,YAAAA,KAAK,EAAEnB,GAAG,CAACmB,KAAJ,GAAYnB,GAAG,CAACmB,KAAJ,CAAUC,KAAV,CAAiB,IAAjB,CAAZ,GAAoC;AAF7C;AAID;;AAVI,OAAP;AAYD,KAdU,CAFb;;AAmBA,UAAMC,WAAW,GAAGC,GAAG,IAAI;AACzB,YAAMC,GAAG,GAAG,EAAZ;;AACA,2BAAyBD,GAAzB,kHAA8B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,YAApBE,GAAoB;AAAA,YAAfC,KAAe;AAC5BF,QAAAA,GAAG,CAACC,GAAD,CAAH,GAAWC,KAAX;AACD;;AACD,aAAOF,GAAP;AACD,KAND;;AAQAhB,IAAAA,GAAG,CAACtC,GAAJ,CAAS,WAAT,EAAqB,CAACyD,GAAD,EAAMC,GAAN,KAAc;AACjCA,MAAAA,GAAG,CAACC,IAAJ,CAASP,WAAW,CAACpH,KAAK,CAACiF,QAAN,GAAiB2C,KAAlB,CAApB;AACD,KAFD,EApFkC,CAwFlC;;AACAtB,IAAAA,GAAG,CAACC,GAAJ,CAAQ,CAACkB,GAAD,EAAMC,GAAN,EAAWG,IAAX,KAAoB;AAC1BH,MAAAA,GAAG,CAACI,MAAJ,CAAY,6BAAZ,EAA2C,GAA3C;AACAJ,MAAAA,GAAG,CAACI,MAAJ,CACG,8BADH,EAEG,gDAFH;AAIAD,MAAAA,IAAI;AACL,KAPD;AASA;;;;;;AAKAvB,IAAAA,GAAG,CAACyB,IAAJ,CAAU,YAAV,EAAuB,CAACN,GAAD,EAAMC,GAAN,KAAc;AACnC,YAAMM,aAAa,GAAGpG,OAAO,CAACgF,GAAR,CAAYqB,8BAAlC;AACA,YAAMC,YAAY,GAAGtG,OAAO,CAACgF,GAAR,CAAYuB,oBAAjC;AACA,YAAMC,iBAAiB,GACrB,CAACF,YAAD,IAAiBT,GAAG,CAACY,OAAJ,CAAYC,aAAZ,KAA8BJ,YADjD;;AAGA,UAAIF,aAAa,IAAII,iBAArB,EAAwC;AACtCG,QAAAA,OAAO,CAAC9B,GAAR,CAAa,wBAAb;AACA9F,QAAAA,WAAW;AACZ;;AACD+G,MAAAA,GAAG,CAACjD,GAAJ;AACD,KAXD;AAaA6B,IAAAA,GAAG,CAACtC,GAAJ,CAAS,+BAAT,EAAyC,CAACyD,GAAD,EAAMC,GAAN,KAAc;AACrDpH,MAAAA,YAAY,CAACmH,GAAG,CAACe,KAAJ,CAAUC,QAAX,EAAqBhB,GAAG,CAACe,KAAJ,CAAUE,UAA/B,CAAZ;AACAhB,MAAAA,GAAG,CAACjD,GAAJ;AACD,KAHD,EApHkC,CAyHlC;AACA;AACA;AACA;;AACA6B,IAAAA,GAAG,CAACC,GAAJ,CAAQtH,OAAO,CAAE,kBAAF,CAAP,CAA6B,QAA7B,EAAsC;AAAE0J,MAAAA,KAAK,EAAE;AAAT,KAAtC,CAAR;AAEArC,IAAAA,GAAG,CAACC,GAAJ,CACEtH,OAAO,CAAE,wBAAF,CAAP,CAAkCoH,QAAlC,EAA4C;AAC1CuC,MAAAA,QAAQ,EAAG,OAD+B;AAE1CC,MAAAA,UAAU,EAAE1C,SAAS,CAACrE,MAAV,CAAiB+G,UAFa;AAG1CC,MAAAA,KAAK,EAAG;AAHkC,KAA5C,CADF,EA/HkC,CAuIlC;;AAvIkC,UAwI1BC,iBAxI0B,GAwIJ/I,KAAK,CAACiF,QAAN,GAAiB+D,MAxIb,CAwI1BD,iBAxI0B;;AA0IlC,QAAIA,iBAAJ,EAAuB;AACrBA,MAAAA,iBAAiB,CAACzC,GAAD,CAAjB;AACD,KA5IiC,CA8IlC;;;AA9IkC,UA+I1B2C,KA/I0B,GA+IhBjJ,KAAK,CAACiF,QAAN,GAAiB+D,MA/ID,CA+I1BC,KA/I0B;;AAgJlC,QAAIA,KAAJ,EAAW;AAAA,YACDC,MADC,GACeD,KADf,CACDC,MADC;AAAA,YACOlK,GADP,GACeiK,KADf,CACOjK,GADP;AAETsH,MAAAA,GAAG,CAACC,GAAJ,CAAS,GAAE2C,MAAO,IAAlB,EAAuB,CAACzB,GAAD,EAAMC,GAAN,KAAc;AACnC,cAAMyB,UAAU,GAAGnK,GAAG,GAAGyI,GAAG,CAAC2B,WAA7B;AACA3B,QAAAA,GAAG,CACA4B,IADH,CAEI1J,OAAO,CAACwJ,UAAD,CAAP,CAAoBnH,EAApB,CAAwB,OAAxB,EAAgC+D,GAAG,IAAI;AACrC,gBAAMuD,OAAO,GAAI,uCACf7B,GAAG,CAAC2B,WACL,SAAQD,UAAW,GAFpB;AAIA9I,UAAAA,MAAM,CAACkJ,KAAP,CAAaD,OAAb,EAAsBvD,GAAtB;AACA2B,UAAAA,GAAG,CAAC8B,MAAJ,CAAW,GAAX,EAAgB/E,GAAhB;AACD,SAPD,CAFJ,EAWG4E,IAXH,CAWQ3B,GAXR;AAYD,OAdD;AAeD;;AAED,UAAM1G,aAAa,CAAE,mBAAF,EAAsB;AAAEsF,MAAAA;AAAF,KAAtB,CAAnB,CAnKkC,CAqKlC;;AACAA,IAAAA,GAAG,CAACC,GAAJ,CAAQ,CAACkB,GAAD,EAAMC,GAAN,EAAWG,IAAX,KAAoB;AAC1BH,MAAAA,GAAG,CAAC+B,QAAJ,CAAa/D,aAAa,CAAE,mBAAF,CAA1B,EAAiDK,GAAG,IAAI;AACtD,YAAIA,GAAJ,EAAS;AACP2B,UAAAA,GAAG,CAAC8B,MAAJ,CAAW,GAAX,EAAgB/E,GAAhB;AACD;AACF,OAJD;AAKD,KAND;AAQA;;;;AAGA,QAAIiF,MAAM,GAAGzK,OAAO,CAAE,MAAF,CAAP,CAAgB0K,MAAhB,CAAuBrD,GAAvB,CAAb,CAjLkC,CAmLlC;;;AACA,QAAId,OAAO,CAACoE,GAAZ,EAAiB;AACfF,MAAAA,MAAM,GAAGzK,OAAO,CAAE,OAAF,CAAP,CAAiB4K,YAAjB,CAA8BrE,OAAO,CAACoE,GAAtC,EAA2CtD,GAA3C,CAAT;AACD;;AACD1F,IAAAA,gBAAgB,CAACkJ,IAAjB,CAAsB;AAAEJ,MAAAA,MAAF;AAAUjE,MAAAA,SAAS,EAAED,OAAO,CAACC;AAA7B,KAAtB;AACA,UAAMsE,MAAM,GAAGnJ,gBAAgB,CAACoJ,SAAjB,EAAf;AAEA,UAAMC,QAAQ,GAAGP,MAAM,CAACQ,MAAP,CAAc1E,OAAO,CAACY,IAAtB,EAA4BZ,OAAO,CAAC2E,IAApC,EAA0CpE,GAAG,IAAI;AAChE,UAAIA,GAAJ,EAAS;AACP,YAAIA,GAAG,CAACqE,IAAJ,KAAc,YAAlB,EAA+B;AAC7B;AACA/J,UAAAA,MAAM,CAAC4F,KAAP,CACG,kCACCT,OAAO,CAACY,IACT,uDAHH;AAKA;AACD;;AAED/F,QAAAA,MAAM,CAAC4F,KAAP,CAAc,qDAAd,EAAoEF,GAApE;AACD;AACF,KAdgB,CAAjB,CA1LkC,CA0MlC;;AACA,UAAMsE,UAAU,GAAG,CAAE,aAAF,EAAiB,0BAAjB,EAA4ChD,GAA5C,CAAgDX,IAAI,IACrE5F,KAAK,CAAC4E,aAAa,CAACgB,IAAD,CAAd,CADY,CAAnB;AAIArH,IAAAA,QAAQ,CAACiL,KAAT,CAAeD,UAAf,EAA2BrI,EAA3B,CAA+B,QAA/B;AAAA;AAAA,oCAAwC,aAAY;AAClD,YAAM2D,eAAe,EAArB;AACAoE,MAAAA,MAAM,CAACQ,EAAP,CAAW,SAAX,EAAqBC,IAArB,CAA2B,QAA3B;AACD,KAHD;AAKA,WAAO,CAACnE,QAAD,EAAW4D,QAAX,CAAP;AACD,G;;;;AAEDQ,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,8CAAiB,WAAOlF,OAAP,EAAwB;AACvCzE,IAAAA,UAAU,CAACyE,OAAO,CAACmF,qBAAT,CAAV;AACA1J,IAAAA,SAAS,CAACqE,QAAV,CAAoB,eAApB;AACArE,IAAAA,SAAS,CAAC2J,qBAAV;AAEA,UAAMxE,IAAI,GACR,OAAOZ,OAAO,CAACY,IAAf,KAAyB,QAAzB,GAAmCyE,QAAQ,CAACrF,OAAO,CAACY,IAAT,EAAe,EAAf,CAA3C,GAAgEZ,OAAO,CAACY,IAD1E,CALuC,CAQvC;AACA;;AACA,QAAI,CAACZ,OAAO,CAAE,WAAF,CAAP,IAAwBA,OAAO,CAAE,UAAF,CAAhC,KAAiD,CAACA,OAAO,CAACsF,KAA9D,EAAqE;AACnEzK,MAAAA,MAAM,CAAC4F,KAAP,CACG,2EADH;AAGD,KAdsC,CAgBvC;AACA;AACA;;;AACA,QAAIT,OAAO,CAACsF,KAAZ,EAAmB;AACjBtF,MAAAA,OAAO,CAACoE,GAAR,SAAoB/I,UAAU,CAAC;AAC7BmF,QAAAA,IAAI,EAAER,OAAO,CAACuF,eAAR,CAAwB/E,IAAxB,CAA6BgF,OAA7B,CAAsC,GAAtC,EAA2C,EAA3C,EAA8CA,OAA9C,CAAuD,GAAvD,EAA4D,IAA5D,CADuB;AAE7BC,QAAAA,QAAQ,EAAEzF,OAAO,CAAE,WAAF,CAFY;AAG7B0F,QAAAA,OAAO,EAAE1F,OAAO,CAAE,UAAF,CAHa;AAI7BC,QAAAA,SAAS,EAAED,OAAO,CAACC;AAJU,OAAD,CAA9B;AAMD;;AAEDD,IAAAA,OAAO,CAACY,IAAR,SAAqB,IAAIvB,OAAJ,CAAYC,OAAO,IAAI;AAC1CxD,MAAAA,wBAAwB,CAAC8E,IAAD,EAAO3E,WAAP,EAAoB0J,OAAO,IAAI;AACrDrG,QAAAA,OAAO,CAACqG,OAAD,CAAP;AACD,OAFuB,CAAxB;AAGD,KAJoB,CAArB;;AAMA,aAASC,WAAT,CAAqBC,QAArB,EAA+BlB,IAA/B,EAAqC/D,IAArC,EAA2C;AACzC,YAAMkF,SAAS,GAAGC,QAAQ,IACxBvM,GAAG,CAACwM,MAAJ,CAAW;AACTH,QAAAA,QADS;AAETE,QAAAA,QAFS;AAGTnF,QAAAA,IAHS;AAITqF,QAAAA,QAAQ,EAAG;AAJF,OAAX,CADF;;AAOA,YAAMC,cAAc,GAAGH,QAAQ,IAC7BvM,GAAG,CAACwM,MAAJ,CAAW;AACTH,QAAAA,QADS;AAETE,QAAAA,QAFS;AAGTnF,QAAAA,IAAI,EAAE5F,KAAK,CAACmL,IAAN,CAAWvF,IAAX,CAHG;AAITqF,QAAAA,QAAQ,EAAG;AAJF,OAAX,CADF;;AAQA,YAAMG,iBAAiB,GAAGzB,IAAI,KAAM,SAAV,IAAsBA,IAAI,KAAM,IAA1D;AACA,UAAI0B,eAAJ,EAAqBC,iBAArB;;AACA,UAAIF,iBAAJ,EAAuB;AACrB,YAAI;AACF;AACAC,UAAAA,eAAe,GAAGpL,OAAO,CAACsL,EAAR,EAAlB;;AACA,cAAIF,eAAJ,EAAqB;AACnB;AACA;AACA,gBACE,wDAAwDG,IAAxD,CACEH,eADF,CADF,EAIE;AACA;AACAC,cAAAA,iBAAiB,GAAGJ,cAAc,CAACG,eAAD,CAAlC;AACD,aAPD,MAOO;AACL;AACAA,cAAAA,eAAe,GAAGI,SAAlB;AACD;AACF;AACF,SAlBD,CAkBE,OAAOC,EAAP,EAAW,CACX;AACD;AACF,OAxCwC,CAyCzC;AACA;AACA;;;AACA,YAAMC,mBAAmB,GAAGT,cAAc,CAACvB,IAAD,CAA1C;AACA,YAAMiC,kBAAkB,GAAGd,SAAS,CAACnB,IAAD,CAApC;AACA,aAAO;AACL0B,QAAAA,eADK;AAELC,QAAAA,iBAFK;AAGLK,QAAAA,mBAHK;AAILC,QAAAA;AAJK,OAAP;AAMD;;AAED,aAASC,iBAAT,CAA2BC,OAA3B,EAAoCC,IAApC,EAA0CC,OAA1C,EAAmD;AACjDjE,MAAAA,OAAO,CAAC9B,GAAR;AACA8B,MAAAA,OAAO,CAAC9B,GAAR,CAAa,oBAAmBjG,KAAK,CAACmL,IAAN,CAAWW,OAAX,CAAoB,kBAApD;AACA/D,MAAAA,OAAO,CAAC9B,GAAR;;AAEA,UAAI8F,IAAI,CAACT,iBAAT,EAA4B;AAC1BvD,QAAAA,OAAO,CAAC9B,GAAR,CACG,KAAIjG,KAAK,CAACmL,IAAN,CAAY,QAAZ,CAAqB,eAAcY,IAAI,CAACJ,mBAAoB,EADnE;AAGA5D,QAAAA,OAAO,CAAC9B,GAAR,CACG,KAAIjG,KAAK,CAACmL,IAAN,CAAY,kBAAZ,CAA+B,KAAIY,IAAI,CAACT,iBAAkB,EADjE;AAGD,OAPD,MAOO;AACLvD,QAAAA,OAAO,CAAC9B,GAAR,CAAa,KAAI8F,IAAI,CAACJ,mBAAoB,EAA1C;AACD;;AAED5D,MAAAA,OAAO,CAAC9B,GAAR;AACA8B,MAAAA,OAAO,CAAC9B,GAAR,CACG,QACC7E,OAAO,CAACgF,GAAR,CAAYC,kBAAZ,KAAoC,YAApC,GACK,wBADL,GAEK,UACN,6DALH;AAOA0B,MAAAA,OAAO,CAAC9B,GAAR;AACA8B,MAAAA,OAAO,CAAC9B,GAAR,CAAa,KAAI8F,IAAI,CAACJ,mBAAoB,YAA1C;AAEA5D,MAAAA,OAAO,CAAC9B,GAAR;AACA8B,MAAAA,OAAO,CAAC9B,GAAR,CAAa,mDAAb;AACA8B,MAAAA,OAAO,CAAC9B,GAAR,CACG,oCAAD,GAAwC,GAAEjG,KAAK,CAACiM,IAAN,CAAY,eAAZ,CAA4B,EADxE;AAGAlE,MAAAA,OAAO,CAAC9B,GAAR;AACD;;AAED,aAASiG,wBAAT,GAAoC;AAClC,YAAMC,cAAc,GAAG,CAAE,qBAAF,EAAyB,aAAzB,CAAvB;AACA,YAAMC,MAAM,GAAG;AACblI,QAAAA,mBAAmB,EAAE;AACnBmI,UAAAA,OAAO,EAAG,SADS;AAEnBC,UAAAA,QAAQ,EAAG;AAFQ,SADR;AAKbC,QAAAA,WAAW,EAAE;AACXF,UAAAA,OAAO,EAAG,aADC;AAEXC,UAAAA,QAAQ,EAAG;AAFA;AALA,OAAf;AAUA,YAAME,mBAAmB,GAAG,EAA5B;AACAL,MAAAA,cAAc,CAACM,OAAf,CAAuBC,GAAG,IAAKF,mBAAmB,CAACE,GAAD,CAAnB,GAA2B,EAA1D;AAEAhO,MAAAA,IAAI,CACDiO,IADH,CACS,mCADT,EAC6C;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAD7C,EAEGH,OAFH,CAEWI,IAAI,IAAI;AACf,cAAMC,QAAQ,GAAGnO,EAAE,CAACoO,YAAH,CAAgBF,IAAhB,CAAjB;AACA,cAAMG,YAAY,GAAGb,cAAc,CAACvJ,MAAf,CACnB8J,GAAG,IAAII,QAAQ,CAACG,OAAT,CAAiBP,GAAjB,MAA0B,CAAC,CADf,CAArB;AAGAM,QAAAA,YAAY,CAACP,OAAb,CAAqBC,GAAG,IAAIF,mBAAmB,CAACE,GAAD,CAAnB,CAAyBnJ,IAAzB,CAA8BsJ,IAA9B,CAA5B;AACD,OARH;AAUAV,MAAAA,cAAc,CAACM,OAAf,CAAuBC,GAAG,IAAI;AAC5B,YAAIF,mBAAmB,CAACE,GAAD,CAAnB,CAAyB9H,MAA7B,EAAqC;AACnCmD,UAAAA,OAAO,CAAC9B,GAAR,CACG,aADH,EAEEjG,KAAK,CAACiM,IAAN,CAAWS,GAAX,CAFF,EAGE1M,KAAK,CAACkN,MAAN,CAAc,2BAAd,CAHF,EAIElN,KAAK,CAACiM,IAAN,CAAWG,MAAM,CAACM,GAAD,CAAN,CAAYL,OAAvB,CAJF,EAKErM,KAAK,CAACkN,MAAN,CACG,4CACCd,MAAM,CAACM,GAAD,CAAN,CAAYJ,QACb,8BAHH,CALF;AAWAvE,UAAAA,OAAO,CAAC9B,GAAR;AACAuG,UAAAA,mBAAmB,CAACE,GAAD,CAAnB,CAAyBD,OAAzB,CAAiCI,IAAI,IAAI9E,OAAO,CAAC9B,GAAR,CAAY4G,IAAZ,CAAzC;AACA9E,UAAAA,OAAO,CAAC9B,GAAR;AACD;AACF,OAjBD;AAkBD,KAtKsC,CAwKvC;;;AAxKuC,wBAyKP1G,SAAS,CAACyF,OAAD,CAzKF;AAAA,UAyK/BmI,aAzK+B,SAyK/BA,aAzK+B,EA2KvC;;;AACA1O,IAAAA,OAAO,CAAE,gCAAF,CAAP,CAA0C0O,aAA1C;;AAEA,UAAMvJ,QAAQ,GAAGlD,WAAW,CAAC0M,0BAAZ,CAAuC5N,KAAK,CAACiF,QAAN,EAAvC,CAAjB;;AA9KuC,kCA+KE/D,WAAW,CAAC2M,aAAZ,CAA0BzJ,QAA1B,CA/KF;AAAA,UA+K/B0J,cA/K+B,yBA+K/BA,cA/K+B;AAAA,UA+KfC,YA/Ke,yBA+KfA,YA/Ke;;AAgLvC,QAAI1J,QAAQ,GAAGhE,MAAM,CAACiE,aAAP,CAAsB,oBAAtB,CAAf;AACAD,IAAAA,QAAQ,CAACE,KAAT;AACA,UAAMrD,WAAW,CAAC8M,oBAAZ,CAAiCF,cAAjC,EAAiD;AAAEzJ,MAAAA;AAAF,KAAjD,CAAN;AACAA,IAAAA,QAAQ,CAACI,GAAT;AAEA,UAAMN,cAAc,CAAC4J,YAAD,CAApB;AACA,UAAMnJ,gBAAgB,EAAtB;AACA,UAAMxD,eAAe,CAAC6M,iBAAhB,EAAN;AACA,UAAM5M,EAAE,CAAC6M,SAAH,EAAN;AACA7M,IAAAA,EAAE,CAAC8M,aAAH;AACAjM,IAAAA,kBAAkB;AAClBf,IAAAA,YAAY,CAACiN,oBAAb;;AA3LuC,wBA6Ld7I,WAAW,CAACC,OAAD,CA7LG;AAAA,UA6LhCa,QA7LgC;;AA+LvC,QAAIgI,cAAc,GAAG,IAArB,CA/LuC,CAiMvC;AACA;;AACAhI,IAAAA,QAAQ,CAACiI,KAAT,CAAeC,IAAf,CAAoBC,QAApB,CAA8B,2BAA9B,EAA0D,CAAC1F,KAAD,EAAQyF,IAAR,KAAiB;AACzE;AACA;AACA;AACA,YAAME,QAAQ,GAAGlO,qBAAqB,CAACuI,KAAK,CAAC4F,MAAN,CAAa,EAAb,EAAiB,IAAjB,CAAD,CAAtC;AACA,YAAMnC,IAAI,GAAGnB,WAAW,CACtB5F,OAAO,CAACoE,GAAR,GAAe,OAAf,GAAyB,MADH,EAEtBpE,OAAO,CAAC2E,IAFc,EAGtB3E,OAAO,CAACY,IAHc,CAAxB;AAKA,YAAMuI,YAAY,GAAG,CAACF,QAAQ,CAACG,MAAT,CAAgBxJ,MAAtC,CAVyE,CAWzE;AACA;AACA;AACA;;AACA,UAAIuJ,YAAY,IAAIN,cAApB,EAAoC;AAClChC,QAAAA,iBAAiB,CAAC7G,OAAO,CAACuF,eAAR,CAAwB/E,IAAzB,EAA+BuG,IAA/B,EAAqC/G,OAAO,CAACgH,OAA7C,CAAjB;AACAE,QAAAA,wBAAwB;;AACxB,YAAIlH,OAAO,CAACqJ,IAAZ,EAAkB;AAChBhK,UAAAA,OAAO,CAACC,OAAR,CAAgB1F,OAAO,CAACmN,IAAI,CAACH,kBAAN,CAAvB,EAAkD0C,KAAlD,CAAwD/I,GAAG,IACzDwC,OAAO,CAAC9B,GAAR,CACG,GAAEjG,KAAK,CAACkN,MAAN,CACA,MADA,CAED,kDAHJ,CADF;AAOD;AACF;;AAEDW,MAAAA,cAAc,GAAG,KAAjB,CA7ByE,CA+BzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAE,MAAAA,IAAI;AACL,KA9DD;AA+DD,GAlQD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\n\nconst url = require(`url`)\nconst glob = require(`glob`)\nconst fs = require(`fs`)\nconst openurl = require(`better-opn`)\nconst chokidar = require(`chokidar`)\nconst express = require(`express`)\nconst graphqlHTTP = require(`express-graphql`)\nconst graphqlPlayground = require(`graphql-playground-middleware-express`)\n  .default\nconst { formatError } = require(`graphql`)\nconst request = require(`request`)\nconst rl = require(`readline`)\nconst webpack = require(`webpack`)\nconst webpackConfig = require(`../utils/webpack.config`)\nconst bootstrap = require(`../bootstrap`)\nconst { store, emitter } = require(`../redux`)\nconst { syncStaticDir } = require(`../utils/get-static-dir`)\nconst buildHTML = require(`./build-html`)\nconst { withBasePath } = require(`../utils/path`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst launchEditor = require(`react-dev-utils/launchEditor`)\nconst formatWebpackMessages = require(`react-dev-utils/formatWebpackMessages`)\nconst chalk = require(`chalk`)\nconst address = require(`address`)\nconst withResolverContext = require(`../schema/context`)\nconst sourceNodes = require(`../utils/source-nodes`)\nconst websocketManager = require(`../utils/websocket-manager`)\nconst getSslCert = require(`../utils/get-ssl-cert`)\nconst slash = require(`slash`)\nconst { initTracer } = require(`../utils/tracer`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst telemetry = require(`gatsby-telemetry`)\nconst queryRunner = require(`../query`)\nconst queryWatcher = require(`../query/query-watcher`)\nconst writeJsRequires = require(`../bootstrap/write-js-requires`)\nconst db = require(`../db`)\nconst detectPortInUseAndPrompt = require(`../utils/detect-port-in-use-and-prompt`)\nconst onExit = require(`signal-exit`)\n\n// const isInteractive = process.stdout.isTTY\n\n// Watch the static directory and copy files to public as they're added or\n// changed. Wait 10 seconds so copying doesn't interfere with the regular\n// bootstrap.\nsetTimeout(() => {\n  syncStaticDir()\n}, 10000)\n\nconst rlInterface = rl.createInterface({\n  input: process.stdin,\n  output: process.stdout,\n})\n\n// Quit immediately on hearing ctrl-c\nrlInterface.on(`SIGINT`, () => {\n  process.exit()\n})\n\nfunction startQueryListener() {\n  const processing = new Set()\n  const waiting = new Map()\n\n  const betterQueueOptions = {\n    priority: (job, cb) => {\n      const activePaths = Array.from(websocketManager.activePaths.values())\n      if (job.id && activePaths.includes(job.id)) {\n        cb(null, 10)\n      } else {\n        cb(null, 1)\n      }\n    },\n    merge: (oldTask, newTask, cb) => {\n      cb(null, newTask)\n    },\n    filter: (job, cb) => {\n      if (processing.has(job.id)) {\n        waiting.set(job.id, job)\n        cb(`already running`)\n      } else {\n        cb(null, job)\n      }\n    },\n  }\n\n  const postHandler = async ({ queryJob, result }) => {\n    if (queryJob.isPage) {\n      websocketManager.emitPageData({\n        ...result,\n        id: queryJob.id,\n      })\n    } else {\n      websocketManager.emitStaticQueryData({\n        ...result,\n        id: queryJob.id,\n      })\n    }\n    processing.delete(queryJob.id)\n    if (waiting.has(queryJob.id)) {\n      queue.push(waiting.get(queryJob.id))\n      waiting.delete(queryJob.id)\n    }\n  }\n\n  const queue = queryRunner.createQueue({ postHandler, betterQueueOptions })\n  queryRunner.startListener(queue)\n}\n\nconst runPageQueries = async queryIds => {\n  let activity = report.activityTimer(`run page queries`)\n  activity.start()\n  await queryRunner.processPageQueries(queryIds, { activity })\n  activity.end()\n\n  require(`../redux/actions`).boundActionCreators.setProgramStatus(\n    `BOOTSTRAP_QUERY_RUNNING_FINISHED`\n  )\n}\n\nconst waitJobsFinished = () =>\n  new Promise((resolve, reject) => {\n    const onEndJob = () => {\n      if (store.getState().jobs.active.length === 0) {\n        resolve()\n        emitter.off(`END_JOB`, onEndJob)\n      }\n    }\n    emitter.on(`END_JOB`, onEndJob)\n    onEndJob()\n  })\n\nonExit(() => {\n  telemetry.trackCli(`DEVELOP_STOP`)\n})\n\nasync function startServer(program) {\n  const directory = program.directory\n  const directoryPath = withBasePath(directory)\n  const createIndexHtml = async () => {\n    try {\n      await buildHTML.buildRenderer(program, `develop-html`)\n      await buildHTML.buildPages({ program, pagePaths: [`/`] })\n    } catch (err) {\n      if (err.name !== `WebpackError`) {\n        report.panic(err)\n        return\n      }\n      report.panic(\n        report.stripIndent`\n          There was an error compiling the html.js component for the development server.\n\n          See our docs page on debugging HTML builds for help https://gatsby.dev/debug-html\n        `,\n        err\n      )\n    }\n  }\n\n  await createIndexHtml()\n\n  const devConfig = await webpackConfig(\n    program,\n    directory,\n    `develop`,\n    program.port\n  )\n\n  const compiler = webpack(devConfig)\n\n  /**\n   * Set up the express app.\n   **/\n  const app = express()\n  app.use(telemetry.expressMiddleware(`DEVELOP`))\n  app.use(\n    require(`webpack-hot-middleware`)(compiler, {\n      log: false,\n      path: `/__webpack_hmr`,\n      heartbeat: 10 * 1000,\n    })\n  )\n\n  if (process.env.GATSBY_GRAPHQL_IDE === `playground`) {\n    app.get(\n      `/___graphql`,\n      graphqlPlayground({\n        endpoint: `/___graphql`,\n      }),\n      () => {}\n    )\n  }\n\n  app.use(\n    `/___graphql`,\n    graphqlHTTP(() => {\n      const schema = store.getState().schema\n      return {\n        schema,\n        graphiql:\n          process.env.GATSBY_GRAPHQL_IDE === `playground` ? false : true,\n        context: withResolverContext({}, schema),\n        formatError(err) {\n          return {\n            ...formatError(err),\n            stack: err.stack ? err.stack.split(`\\n`) : [],\n          }\n        },\n      }\n    })\n  )\n\n  const mapToObject = map => {\n    const obj = {}\n    for (let [key, value] of map) {\n      obj[key] = value\n    }\n    return obj\n  }\n\n  app.get(`/___pages`, (req, res) => {\n    res.json(mapToObject(store.getState().pages))\n  })\n\n  // Allow requests from any origin. Avoids CORS issues when using the `--host` flag.\n  app.use((req, res, next) => {\n    res.header(`Access-Control-Allow-Origin`, `*`)\n    res.header(\n      `Access-Control-Allow-Headers`,\n      `Origin, X-Requested-With, Content-Type, Accept`\n    )\n    next()\n  })\n\n  /**\n   * Refresh external data sources.\n   * This behavior is disabled by default, but the ENABLE_REFRESH_ENDPOINT env var enables it\n   * If no GATSBY_REFRESH_TOKEN env var is available, then no Authorization header is required\n   **/\n  app.post(`/__refresh`, (req, res) => {\n    const enableRefresh = process.env.ENABLE_GATSBY_REFRESH_ENDPOINT\n    const refreshToken = process.env.GATSBY_REFRESH_TOKEN\n    const authorizedRefresh =\n      !refreshToken || req.headers.authorization === refreshToken\n\n    if (enableRefresh && authorizedRefresh) {\n      console.log(`Refreshing source data`)\n      sourceNodes()\n    }\n    res.end()\n  })\n\n  app.get(`/__open-stack-frame-in-editor`, (req, res) => {\n    launchEditor(req.query.fileName, req.query.lineNumber)\n    res.end()\n  })\n\n  // Disable directory indexing i.e. serving index.html from a directory.\n  // This can lead to serving stale html files during development.\n  //\n  // We serve by default an empty index.html that sets up the dev environment.\n  app.use(require(`./develop-static`)(`public`, { index: false }))\n\n  app.use(\n    require(`webpack-dev-middleware`)(compiler, {\n      logLevel: `trace`,\n      publicPath: devConfig.output.publicPath,\n      stats: `errors-only`,\n    })\n  )\n\n  // Expose access to app for advanced use cases\n  const { developMiddleware } = store.getState().config\n\n  if (developMiddleware) {\n    developMiddleware(app)\n  }\n\n  // Set up API proxy.\n  const { proxy } = store.getState().config\n  if (proxy) {\n    const { prefix, url } = proxy\n    app.use(`${prefix}/*`, (req, res) => {\n      const proxiedUrl = url + req.originalUrl\n      req\n        .pipe(\n          request(proxiedUrl).on(`error`, err => {\n            const message = `Error when trying to proxy request \"${\n              req.originalUrl\n            }\" to \"${proxiedUrl}\"`\n\n            report.error(message, err)\n            res.status(500).end()\n          })\n        )\n        .pipe(res)\n    })\n  }\n\n  await apiRunnerNode(`onCreateDevServer`, { app })\n\n  // Render an HTML page and serve it.\n  app.use((req, res, next) => {\n    res.sendFile(directoryPath(`public/index.html`), err => {\n      if (err) {\n        res.status(500).end()\n      }\n    })\n  })\n\n  /**\n   * Set up the HTTP server and socket.io.\n   **/\n  let server = require(`http`).Server(app)\n\n  // If a SSL cert exists in program, use it with `createServer`.\n  if (program.ssl) {\n    server = require(`https`).createServer(program.ssl, app)\n  }\n  websocketManager.init({ server, directory: program.directory })\n  const socket = websocketManager.getSocket()\n\n  const listener = server.listen(program.port, program.host, err => {\n    if (err) {\n      if (err.code === `EADDRINUSE`) {\n        // eslint-disable-next-line max-len\n        report.panic(\n          `Unable to start Gatsby on port ${\n            program.port\n          } as there's already a process listening on that port.`\n        )\n        return\n      }\n\n      report.panic(`There was a problem starting the development server`, err)\n    }\n  })\n\n  // Register watcher that rebuilds index.html every time html.js changes.\n  const watchGlobs = [`src/html.js`, `plugins/**/gatsby-ssr.js`].map(path =>\n    slash(directoryPath(path))\n  )\n\n  chokidar.watch(watchGlobs).on(`change`, async () => {\n    await createIndexHtml()\n    socket.to(`clients`).emit(`reload`)\n  })\n\n  return [compiler, listener]\n}\n\nmodule.exports = async (program: any) => {\n  initTracer(program.openTracingConfigFile)\n  telemetry.trackCli(`DEVELOP_START`)\n  telemetry.startBackgroundUpdate()\n\n  const port =\n    typeof program.port === `string` ? parseInt(program.port, 10) : program.port\n\n  // In order to enable custom ssl, --cert-file --key-file and -https flags must all be\n  // used together\n  if ((program[`cert-file`] || program[`key-file`]) && !program.https) {\n    report.panic(\n      `for custom ssl --https, --cert-file, and --key-file must be used together`\n    )\n  }\n\n  // Check if https is enabled, then create or get SSL cert.\n  // Certs are named after `name` inside the project's package.json.\n  // Scoped names are converted from @npm/package-name to npm--package-name\n  if (program.https) {\n    program.ssl = await getSslCert({\n      name: program.sitePackageJson.name.replace(`@`, ``).replace(`/`, `--`),\n      certFile: program[`cert-file`],\n      keyFile: program[`key-file`],\n      directory: program.directory,\n    })\n  }\n\n  program.port = await new Promise(resolve => {\n    detectPortInUseAndPrompt(port, rlInterface, newPort => {\n      resolve(newPort)\n    })\n  })\n\n  function prepareUrls(protocol, host, port) {\n    const formatUrl = hostname =>\n      url.format({\n        protocol,\n        hostname,\n        port,\n        pathname: `/`,\n      })\n    const prettyPrintUrl = hostname =>\n      url.format({\n        protocol,\n        hostname,\n        port: chalk.bold(port),\n        pathname: `/`,\n      })\n\n    const isUnspecifiedHost = host === `0.0.0.0` || host === `::`\n    let lanUrlForConfig, lanUrlForTerminal\n    if (isUnspecifiedHost) {\n      try {\n        // This can only return an IPv4 address\n        lanUrlForConfig = address.ip()\n        if (lanUrlForConfig) {\n          // Check if the address is a private ip\n          // https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces\n          if (\n            /^10[.]|^172[.](1[6-9]|2[0-9]|3[0-1])[.]|^192[.]168[.]/.test(\n              lanUrlForConfig\n            )\n          ) {\n            // Address is private, format it for later use\n            lanUrlForTerminal = prettyPrintUrl(lanUrlForConfig)\n          } else {\n            // Address is not private, so we will discard it\n            lanUrlForConfig = undefined\n          }\n        }\n      } catch (_e) {\n        // ignored\n      }\n    }\n    // TODO collect errors (GraphQL + Webpack) in Redux so we\n    // can clear terminal and print them out on every compile.\n    // Borrow pretty printing code from webpack plugin.\n    const localUrlForTerminal = prettyPrintUrl(host)\n    const localUrlForBrowser = formatUrl(host)\n    return {\n      lanUrlForConfig,\n      lanUrlForTerminal,\n      localUrlForTerminal,\n      localUrlForBrowser,\n    }\n  }\n\n  function printInstructions(appName, urls, useYarn) {\n    console.log()\n    console.log(`You can now view ${chalk.bold(appName)} in the browser.`)\n    console.log()\n\n    if (urls.lanUrlForTerminal) {\n      console.log(\n        `  ${chalk.bold(`Local:`)}            ${urls.localUrlForTerminal}`\n      )\n      console.log(\n        `  ${chalk.bold(`On Your Network:`)}  ${urls.lanUrlForTerminal}`\n      )\n    } else {\n      console.log(`  ${urls.localUrlForTerminal}`)\n    }\n\n    console.log()\n    console.log(\n      `View ${\n        process.env.GATSBY_GRAPHQL_IDE === `playground`\n          ? `the GraphQL Playground`\n          : `GraphiQL`\n      }, an in-browser IDE, to explore your site's data and schema`\n    )\n    console.log()\n    console.log(`  ${urls.localUrlForTerminal}___graphql`)\n\n    console.log()\n    console.log(`Note that the development build is not optimized.`)\n    console.log(\n      `To create a production build, use ` + `${chalk.cyan(`npm run build`)}`\n    )\n    console.log()\n  }\n\n  function printDeprecationWarnings() {\n    const deprecatedApis = [`boundActionCreators`, `pathContext`]\n    const fixMap = {\n      boundActionCreators: {\n        newName: `actions`,\n        docsLink: `https://gatsby.dev/boundActionCreators`,\n      },\n      pathContext: {\n        newName: `pageContext`,\n        docsLink: `https://gatsby.dev/pathContext`,\n      },\n    }\n    const deprecatedLocations = {}\n    deprecatedApis.forEach(api => (deprecatedLocations[api] = []))\n\n    glob\n      .sync(`{,!(node_modules|public)/**/}*.js`, { nodir: true })\n      .forEach(file => {\n        const fileText = fs.readFileSync(file)\n        const matchingApis = deprecatedApis.filter(\n          api => fileText.indexOf(api) !== -1\n        )\n        matchingApis.forEach(api => deprecatedLocations[api].push(file))\n      })\n\n    deprecatedApis.forEach(api => {\n      if (deprecatedLocations[api].length) {\n        console.log(\n          `%s %s %s %s`,\n          chalk.cyan(api),\n          chalk.yellow(`is deprecated. Please use`),\n          chalk.cyan(fixMap[api].newName),\n          chalk.yellow(\n            `instead. For migration instructions, see ${\n              fixMap[api].docsLink\n            }\\nCheck the following files:`\n          )\n        )\n        console.log()\n        deprecatedLocations[api].forEach(file => console.log(file))\n        console.log()\n      }\n    })\n  }\n\n  // Start bootstrap process.\n  const { graphqlRunner } = await bootstrap(program)\n\n  // Start the createPages hot reloader.\n  require(`../bootstrap/page-hot-reloader`)(graphqlRunner)\n\n  const queryIds = queryRunner.calcBootstrapDirtyQueryIds(store.getState())\n  const { staticQueryIds, pageQueryIds } = queryRunner.groupQueryIds(queryIds)\n  let activity = report.activityTimer(`run static queries`)\n  activity.start()\n  await queryRunner.processStaticQueries(staticQueryIds, { activity })\n  activity.end()\n\n  await runPageQueries(pageQueryIds)\n  await waitJobsFinished()\n  await writeJsRequires.startPageListener()\n  await db.saveState()\n  db.startAutosave()\n  startQueryListener()\n  queryWatcher.startWatchDeletePage()\n\n  const [compiler] = await startServer(program)\n\n  let isFirstCompile = true\n\n  // \"done\" event fires when Webpack has finished recompiling the bundle.\n  // Whether or not you have warnings or errors, you will get this event.\n  compiler.hooks.done.tapAsync(`print getsby instructions`, (stats, done) => {\n    // We have switched off the default Webpack output in WebpackDevServer\n    // options so we are going to \"massage\" the warnings and errors and present\n    // them in a readable focused way.\n    const messages = formatWebpackMessages(stats.toJson({}, true))\n    const urls = prepareUrls(\n      program.ssl ? `https` : `http`,\n      program.host,\n      program.port\n    )\n    const isSuccessful = !messages.errors.length\n    // if (isSuccessful) {\n    // console.log(chalk.green(`Compiled successfully!`))\n    // }\n    // if (isSuccessful && (isInteractive || isFirstCompile)) {\n    if (isSuccessful && isFirstCompile) {\n      printInstructions(program.sitePackageJson.name, urls, program.useYarn)\n      printDeprecationWarnings()\n      if (program.open) {\n        Promise.resolve(openurl(urls.localUrlForBrowser)).catch(err =>\n          console.log(\n            `${chalk.yellow(\n              `warn`\n            )} Browser not opened because no browser was found`\n          )\n        )\n      }\n    }\n\n    isFirstCompile = false\n\n    // If errors exist, only show errors.\n    // if (messages.errors.length) {\n    // // Only keep the first error. Others are often indicative\n    // // of the same problem, but confuse the reader with noise.\n    // if (messages.errors.length > 1) {\n    // messages.errors.length = 1\n    // }\n    // console.log(chalk.red(\"Failed to compile.\\n\"))\n    // console.log(messages.errors.join(\"\\n\\n\"))\n    // return\n    // }\n\n    // Show warnings if no errors were found.\n    // if (messages.warnings.length) {\n    // console.log(chalk.yellow(\"Compiled with warnings.\\n\"))\n    // console.log(messages.warnings.join(\"\\n\\n\"))\n\n    // // Teach some ESLint tricks.\n    // console.log(\n    // \"\\nSearch for the \" +\n    // chalk.underline(chalk.yellow(\"keywords\")) +\n    // \" to learn more about each warning.\"\n    // )\n    // console.log(\n    // \"To ignore, add \" +\n    // chalk.cyan(\"// eslint-disable-next-line\") +\n    // \" to the line before.\\n\"\n    // )\n    // }\n\n    done()\n  })\n}\n"],"file":"develop.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/commands/repl.js b/node_modules/gatsby/dist/commands/repl.js
index a05de8e..01ab12a 100644
--- a/node_modules/gatsby/dist/commands/repl.js
+++ b/node_modules/gatsby/dist/commands/repl.js
@@ -31,7 +31,6 @@ function () {
           schema = _store$getState.schema,
           config = _store$getState.config,
           babelrc = _store$getState.babelrc,
-          jsonDataPaths = _store$getState.jsonDataPaths,
           pages = _store$getState.pages,
           components = _store$getState.components,
           staticQueryComponents = _store$getState.staticQueryComponents;
@@ -59,7 +58,6 @@ function () {
 
     _.context.babelrc = babelrc;
     _.context.components = components;
-    _.context.dataPaths = jsonDataPaths;
     _.context.getNode = getNode;
     _.context.getNodes = getNodes;
     _.context.getNodesByType = getNodesByType;
diff --git a/node_modules/gatsby/dist/commands/repl.js.map b/node_modules/gatsby/dist/commands/repl.js.map
index eadfa46..e81fbfd 100644
--- a/node_modules/gatsby/dist/commands/repl.js.map
+++ b/node_modules/gatsby/dist/commands/repl.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/repl.js"],"names":["repl","require","graphql","bootstrap","loadNodeContent","getNodes","getNode","getNodesByType","store","module","exports","program","getState","schema","config","babelrc","jsonDataPaths","pages","components","staticQueryComponents","nodes","query","result","console","log","JSON","stringify","_","start","prompt","context","dataPaths","entries","siteConfig","staticQueries","on","process","exit"],"mappings":";;;;;;AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;iBACoBA,OAAO,CAAE,SAAF,C;MAAnBC,O,YAAAA,O;;AACR,MAAMC,SAAS,GAAGF,OAAO,CAAE,cAAF,CAAzB;;kBAMIA,OAAO,CAAE,aAAF,C;MAJTG,e,aAAAA,e;MACAC,Q,aAAAA,Q;MACAC,O,aAAAA,O;MACAC,c,aAAAA,c;;kBAEgBN,OAAO,CAAE,UAAF,C;MAAjBO,K,aAAAA,K;;AAERC,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAMC,OAAN,EAAiB;AAChC;AACA,UAAMR,SAAS,CAACQ,OAAD,CAAf,CAFgC,CAIhC;;AAJgC,4BAa5BH,KAAK,CAACI,QAAN,EAb4B;AAAA,UAM9BC,MAN8B,mBAM9BA,MAN8B;AAAA,UAO9BC,MAP8B,mBAO9BA,MAP8B;AAAA,UAQ9BC,OAR8B,mBAQ9BA,OAR8B;AAAA,UAS9BC,aAT8B,mBAS9BA,aAT8B;AAAA,UAU9BC,KAV8B,mBAU9BA,KAV8B;AAAA,UAW9BC,UAX8B,mBAW9BA,UAX8B;AAAA,UAY9BC,qBAZ8B,mBAY9BA,qBAZ8B;;AAehC,UAAMC,KAAK,GAAGf,QAAQ,EAAtB;;AAEA,UAAMgB,KAAK;AAAA;AAAA;AAAA,kDAAG,WAAMA,MAAN,EAAe;AAC3B,cAAMC,MAAM,SAASpB,OAAO,CAACW,MAAD,EAASQ,MAAT,EAAgB,EAAhB,EAAoB,EAApB,EAAwB,EAAxB,CAA5B;AACAE,QAAAA,OAAO,CAACC,GAAR,CAAa,iBAAgBC,IAAI,CAACC,SAAL,CAAeJ,MAAf,CAAuB,EAApD;AACD,OAHU;;AAAA;AAAA;AAAA;AAAA,OAAX,CAjBgC,CAsBhC;;;AACA,UAAMK,CAAC,GAAG3B,IAAI,CAAC4B,KAAL,CAAW;AACnBC,MAAAA,MAAM,EAAG;AADU,KAAX,CAAV,CAvBgC,CA2BhC;;;AACAF,IAAAA,CAAC,CAACG,OAAF,CAAUf,OAAV,GAAoBA,OAApB;AACAY,IAAAA,CAAC,CAACG,OAAF,CAAUZ,UAAV,GAAuBA,UAAvB;AACAS,IAAAA,CAAC,CAACG,OAAF,CAAUC,SAAV,GAAsBf,aAAtB;AACAW,IAAAA,CAAC,CAACG,OAAF,CAAUxB,OAAV,GAAoBA,OAApB;AACAqB,IAAAA,CAAC,CAACG,OAAF,CAAUzB,QAAV,GAAqBA,QAArB;AACAsB,IAAAA,CAAC,CAACG,OAAF,CAAUvB,cAAV,GAA2BA,cAA3B;AACAoB,IAAAA,CAAC,CAACG,OAAF,CAAU1B,eAAV,GAA4BA,eAA5B;AACAuB,IAAAA,CAAC,CAACG,OAAF,CAAUV,KAAV,GAAkB,CAAC,GAAGA,KAAK,CAACY,OAAN,EAAJ,CAAlB;AACAL,IAAAA,CAAC,CAACG,OAAF,CAAUb,KAAV,GAAkB,CAAC,GAAGA,KAAK,CAACe,OAAN,EAAJ,CAAlB;AACAL,IAAAA,CAAC,CAACG,OAAF,CAAU5B,OAAV,GAAoBmB,KAApB;AACAM,IAAAA,CAAC,CAACG,OAAF,CAAUjB,MAAV,GAAmBA,MAAnB;AACAc,IAAAA,CAAC,CAACG,OAAF,CAAUG,UAAV,GAAuBnB,MAAvB;AACAa,IAAAA,CAAC,CAACG,OAAF,CAAUI,aAAV,GAA0Bf,qBAA1B;;AAEAQ,IAAAA,CAAC,CAACQ,EAAF,CAAM,MAAN,EAAa,MAAMC,OAAO,CAACC,IAAR,CAAa,CAAb,CAAnB;AACD,GA3CD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["const repl = require(`repl`)\nconst { graphql } = require(`graphql`)\nconst bootstrap = require(`../bootstrap`)\nconst {\n  loadNodeContent,\n  getNodes,\n  getNode,\n  getNodesByType,\n} = require(`../db/nodes`)\nconst { store } = require(`../redux`)\n\nmodule.exports = async program => {\n  // run bootstrap\n  await bootstrap(program)\n\n  // get all the goodies from the store\n  const {\n    schema,\n    config,\n    babelrc,\n    jsonDataPaths,\n    pages,\n    components,\n    staticQueryComponents,\n  } = store.getState()\n\n  const nodes = getNodes()\n\n  const query = async query => {\n    const result = await graphql(schema, query, {}, {}, {})\n    console.log(`query result: ${JSON.stringify(result)}`)\n  }\n\n  // init new repl\n  const _ = repl.start({\n    prompt: `gatsby > `,\n  })\n\n  // set some globals to make life easier\n  _.context.babelrc = babelrc\n  _.context.components = components\n  _.context.dataPaths = jsonDataPaths\n  _.context.getNode = getNode\n  _.context.getNodes = getNodes\n  _.context.getNodesByType = getNodesByType\n  _.context.loadNodeContent = loadNodeContent\n  _.context.nodes = [...nodes.entries()]\n  _.context.pages = [...pages.entries()]\n  _.context.graphql = query\n  _.context.schema = schema\n  _.context.siteConfig = config\n  _.context.staticQueries = staticQueryComponents\n\n  _.on(`exit`, () => process.exit(0))\n}\n"],"file":"repl.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/repl.js"],"names":["repl","require","graphql","bootstrap","loadNodeContent","getNodes","getNode","getNodesByType","store","module","exports","program","getState","schema","config","babelrc","pages","components","staticQueryComponents","nodes","query","result","console","log","JSON","stringify","_","start","prompt","context","entries","siteConfig","staticQueries","on","process","exit"],"mappings":";;;;;;AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;iBACoBA,OAAO,CAAE,SAAF,C;MAAnBC,O,YAAAA,O;;AACR,MAAMC,SAAS,GAAGF,OAAO,CAAE,cAAF,CAAzB;;kBAMIA,OAAO,CAAE,aAAF,C;MAJTG,e,aAAAA,e;MACAC,Q,aAAAA,Q;MACAC,O,aAAAA,O;MACAC,c,aAAAA,c;;kBAEgBN,OAAO,CAAE,UAAF,C;MAAjBO,K,aAAAA,K;;AAERC,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAMC,OAAN,EAAiB;AAChC;AACA,UAAMR,SAAS,CAACQ,OAAD,CAAf,CAFgC,CAIhC;;AAJgC,4BAY5BH,KAAK,CAACI,QAAN,EAZ4B;AAAA,UAM9BC,MAN8B,mBAM9BA,MAN8B;AAAA,UAO9BC,MAP8B,mBAO9BA,MAP8B;AAAA,UAQ9BC,OAR8B,mBAQ9BA,OAR8B;AAAA,UAS9BC,KAT8B,mBAS9BA,KAT8B;AAAA,UAU9BC,UAV8B,mBAU9BA,UAV8B;AAAA,UAW9BC,qBAX8B,mBAW9BA,qBAX8B;;AAchC,UAAMC,KAAK,GAAGd,QAAQ,EAAtB;;AAEA,UAAMe,KAAK;AAAA;AAAA;AAAA,kDAAG,WAAMA,MAAN,EAAe;AAC3B,cAAMC,MAAM,SAASnB,OAAO,CAACW,MAAD,EAASO,MAAT,EAAgB,EAAhB,EAAoB,EAApB,EAAwB,EAAxB,CAA5B;AACAE,QAAAA,OAAO,CAACC,GAAR,CAAa,iBAAgBC,IAAI,CAACC,SAAL,CAAeJ,MAAf,CAAuB,EAApD;AACD,OAHU;;AAAA;AAAA;AAAA;AAAA,OAAX,CAhBgC,CAqBhC;;;AACA,UAAMK,CAAC,GAAG1B,IAAI,CAAC2B,KAAL,CAAW;AACnBC,MAAAA,MAAM,EAAG;AADU,KAAX,CAAV,CAtBgC,CA0BhC;;;AACAF,IAAAA,CAAC,CAACG,OAAF,CAAUd,OAAV,GAAoBA,OAApB;AACAW,IAAAA,CAAC,CAACG,OAAF,CAAUZ,UAAV,GAAuBA,UAAvB;AACAS,IAAAA,CAAC,CAACG,OAAF,CAAUvB,OAAV,GAAoBA,OAApB;AACAoB,IAAAA,CAAC,CAACG,OAAF,CAAUxB,QAAV,GAAqBA,QAArB;AACAqB,IAAAA,CAAC,CAACG,OAAF,CAAUtB,cAAV,GAA2BA,cAA3B;AACAmB,IAAAA,CAAC,CAACG,OAAF,CAAUzB,eAAV,GAA4BA,eAA5B;AACAsB,IAAAA,CAAC,CAACG,OAAF,CAAUV,KAAV,GAAkB,CAAC,GAAGA,KAAK,CAACW,OAAN,EAAJ,CAAlB;AACAJ,IAAAA,CAAC,CAACG,OAAF,CAAUb,KAAV,GAAkB,CAAC,GAAGA,KAAK,CAACc,OAAN,EAAJ,CAAlB;AACAJ,IAAAA,CAAC,CAACG,OAAF,CAAU3B,OAAV,GAAoBkB,KAApB;AACAM,IAAAA,CAAC,CAACG,OAAF,CAAUhB,MAAV,GAAmBA,MAAnB;AACAa,IAAAA,CAAC,CAACG,OAAF,CAAUE,UAAV,GAAuBjB,MAAvB;AACAY,IAAAA,CAAC,CAACG,OAAF,CAAUG,aAAV,GAA0Bd,qBAA1B;;AAEAQ,IAAAA,CAAC,CAACO,EAAF,CAAM,MAAN,EAAa,MAAMC,OAAO,CAACC,IAAR,CAAa,CAAb,CAAnB;AACD,GAzCD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["const repl = require(`repl`)\nconst { graphql } = require(`graphql`)\nconst bootstrap = require(`../bootstrap`)\nconst {\n  loadNodeContent,\n  getNodes,\n  getNode,\n  getNodesByType,\n} = require(`../db/nodes`)\nconst { store } = require(`../redux`)\n\nmodule.exports = async program => {\n  // run bootstrap\n  await bootstrap(program)\n\n  // get all the goodies from the store\n  const {\n    schema,\n    config,\n    babelrc,\n    pages,\n    components,\n    staticQueryComponents,\n  } = store.getState()\n\n  const nodes = getNodes()\n\n  const query = async query => {\n    const result = await graphql(schema, query, {}, {}, {})\n    console.log(`query result: ${JSON.stringify(result)}`)\n  }\n\n  // init new repl\n  const _ = repl.start({\n    prompt: `gatsby > `,\n  })\n\n  // set some globals to make life easier\n  _.context.babelrc = babelrc\n  _.context.components = components\n  _.context.getNode = getNode\n  _.context.getNodes = getNodes\n  _.context.getNodesByType = getNodesByType\n  _.context.loadNodeContent = loadNodeContent\n  _.context.nodes = [...nodes.entries()]\n  _.context.pages = [...pages.entries()]\n  _.context.graphql = query\n  _.context.schema = schema\n  _.context.siteConfig = config\n  _.context.staticQueries = staticQueryComponents\n\n  _.on(`exit`, () => process.exit(0))\n}\n"],"file":"repl.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/db/index.js b/node_modules/gatsby/dist/db/index.js
index 65d46f6..8899c05 100644
--- a/node_modules/gatsby/dist/db/index.js
+++ b/node_modules/gatsby/dist/db/index.js
@@ -44,37 +44,17 @@ function _saveState() {
 
 const saveStateDebounced = _.debounce(saveState, 1000);
 /**
- * Sets up listeners so that once bootstrap has finished, all
- * databases save their state to disk. If we're in `develop` mode,
- * then any new event triggers a debounced save as well.
+ * Starts listening to redux actions and triggers a database save to
+ * disk upon any action (debounced to every 1 second)
  */
 
 
 function startAutosave() {
-  // During development, once bootstrap is finished, persist state on changes.
-  let bootstrapFinished = false;
-
-  if (process.env.gatsby_executing_command === `develop`) {
-    emitter.on(`BOOTSTRAP_FINISHED`, () => {
-      bootstrapFinished = true;
-      saveState();
-    });
-    emitter.on(`*`, () => {
-      if (bootstrapFinished) {
-        saveStateDebounced();
-      }
-    });
-  } // During builds, persist state once bootstrap has finished.
-
-
-  if (process.env.gatsby_executing_command === `build`) {
-    emitter.on(`BOOTSTRAP_FINISHED`, () => {
-      saveState();
-    });
-  }
+  emitter.on(`*`, () => saveStateDebounced());
 }
 
 module.exports = {
-  startAutosave
+  startAutosave,
+  saveState
 };
 //# sourceMappingURL=index.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/db/index.js.map b/node_modules/gatsby/dist/db/index.js.map
index 22c8129..ba7aac8 100644
--- a/node_modules/gatsby/dist/db/index.js.map
+++ b/node_modules/gatsby/dist/db/index.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/db/index.js"],"names":["_","require","report","redux","emitter","dbs","process","env","GATSBY_DB_NODES","push","saveInProgress","saveState","Promise","all","map","db","err","warn","message","saveStateDebounced","debounce","startAutosave","bootstrapFinished","gatsby_executing_command","on","module","exports"],"mappings":";;;;;;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAME,KAAK,GAAGF,OAAO,CAAE,UAAF,CAArB;;MACQG,O,GAAYD,K,CAAZC,O,EAER;AACA;;AACA,MAAMC,GAAG,GAAG,CAACF,KAAD,CAAZ;;AACA,IAAIG,OAAO,CAACC,GAAR,CAAYC,eAAZ,KAAiC,MAArC,EAA4C;AAC1CH,EAAAA,GAAG,CAACI,IAAJ,CAASR,OAAO,CAAE,QAAF,CAAhB;AACD,C,CAED;;;AACA,IAAIS,cAAc,GAAG,KAArB;;SACeC,S;;;;;+CAAf,aAA2B;AACzB,QAAID,cAAJ,EAAoB;AACpBA,IAAAA,cAAc,GAAG,IAAjB;;AAEA,QAAI;AACF,YAAME,OAAO,CAACC,GAAR,CAAYR,GAAG,CAACS,GAAJ,CAAQC,EAAE,IAAIA,EAAE,CAACJ,SAAH,EAAd,CAAZ,CAAN;AACD,KAFD,CAEE,OAAOK,GAAP,EAAY;AACZd,MAAAA,MAAM,CAACe,IAAP,CAAa,2BAA2BD,GAAG,IAAIA,GAAG,CAACE,OAAZ,IAAwBF,GAAI,EAAnE;AACD;;AAEDN,IAAAA,cAAc,GAAG,KAAjB;AACD,G;;;;AACD,MAAMS,kBAAkB,GAAGnB,CAAC,CAACoB,QAAF,CAAWT,SAAX,EAAsB,IAAtB,CAA3B;AAEA;;;;;;;AAKA,SAASU,aAAT,GAAyB;AACvB;AACA,MAAIC,iBAAiB,GAAG,KAAxB;;AACA,MAAIhB,OAAO,CAACC,GAAR,CAAYgB,wBAAZ,KAA0C,SAA9C,EAAwD;AACtDnB,IAAAA,OAAO,CAACoB,EAAR,CAAY,oBAAZ,EAAiC,MAAM;AACrCF,MAAAA,iBAAiB,GAAG,IAApB;AACAX,MAAAA,SAAS;AACV,KAHD;AAIAP,IAAAA,OAAO,CAACoB,EAAR,CAAY,GAAZ,EAAgB,MAAM;AACpB,UAAIF,iBAAJ,EAAuB;AACrBH,QAAAA,kBAAkB;AACnB;AACF,KAJD;AAKD,GAbsB,CAevB;;;AACA,MAAIb,OAAO,CAACC,GAAR,CAAYgB,wBAAZ,KAA0C,OAA9C,EAAsD;AACpDnB,IAAAA,OAAO,CAACoB,EAAR,CAAY,oBAAZ,EAAiC,MAAM;AACrCb,MAAAA,SAAS;AACV,KAFD;AAGD;AACF;;AAEDc,MAAM,CAACC,OAAP,GAAiB;AACfL,EAAAA;AADe,CAAjB","sourcesContent":["const _ = require(`lodash`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst redux = require(`../redux`)\nconst { emitter } = redux\n\n// Even if we are using loki, we still include redux in the list of\n// dbs since it still has pages, config, etc.\nconst dbs = [redux]\nif (process.env.GATSBY_DB_NODES === `loki`) {\n  dbs.push(require(`./loki`))\n}\n\n// calls `saveState()` on all DBs\nlet saveInProgress = false\nasync function saveState() {\n  if (saveInProgress) return\n  saveInProgress = true\n\n  try {\n    await Promise.all(dbs.map(db => db.saveState()))\n  } catch (err) {\n    report.warn(`Error persisting state: ${(err && err.message) || err}`)\n  }\n\n  saveInProgress = false\n}\nconst saveStateDebounced = _.debounce(saveState, 1000)\n\n/**\n * Sets up listeners so that once bootstrap has finished, all\n * databases save their state to disk. If we're in `develop` mode,\n * then any new event triggers a debounced save as well.\n */\nfunction startAutosave() {\n  // During development, once bootstrap is finished, persist state on changes.\n  let bootstrapFinished = false\n  if (process.env.gatsby_executing_command === `develop`) {\n    emitter.on(`BOOTSTRAP_FINISHED`, () => {\n      bootstrapFinished = true\n      saveState()\n    })\n    emitter.on(`*`, () => {\n      if (bootstrapFinished) {\n        saveStateDebounced()\n      }\n    })\n  }\n\n  // During builds, persist state once bootstrap has finished.\n  if (process.env.gatsby_executing_command === `build`) {\n    emitter.on(`BOOTSTRAP_FINISHED`, () => {\n      saveState()\n    })\n  }\n}\n\nmodule.exports = {\n  startAutosave,\n}\n"],"file":"index.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/db/index.js"],"names":["_","require","report","redux","emitter","dbs","process","env","GATSBY_DB_NODES","push","saveInProgress","saveState","Promise","all","map","db","err","warn","message","saveStateDebounced","debounce","startAutosave","on","module","exports"],"mappings":";;;;;;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAME,KAAK,GAAGF,OAAO,CAAE,UAAF,CAArB;;MACQG,O,GAAYD,K,CAAZC,O,EAER;AACA;;AACA,MAAMC,GAAG,GAAG,CAACF,KAAD,CAAZ;;AACA,IAAIG,OAAO,CAACC,GAAR,CAAYC,eAAZ,KAAiC,MAArC,EAA4C;AAC1CH,EAAAA,GAAG,CAACI,IAAJ,CAASR,OAAO,CAAE,QAAF,CAAhB;AACD,C,CAED;;;AACA,IAAIS,cAAc,GAAG,KAArB;;SACeC,S;;;;;+CAAf,aAA2B;AACzB,QAAID,cAAJ,EAAoB;AACpBA,IAAAA,cAAc,GAAG,IAAjB;;AAEA,QAAI;AACF,YAAME,OAAO,CAACC,GAAR,CAAYR,GAAG,CAACS,GAAJ,CAAQC,EAAE,IAAIA,EAAE,CAACJ,SAAH,EAAd,CAAZ,CAAN;AACD,KAFD,CAEE,OAAOK,GAAP,EAAY;AACZd,MAAAA,MAAM,CAACe,IAAP,CAAa,2BAA2BD,GAAG,IAAIA,GAAG,CAACE,OAAZ,IAAwBF,GAAI,EAAnE;AACD;;AAEDN,IAAAA,cAAc,GAAG,KAAjB;AACD,G;;;;AACD,MAAMS,kBAAkB,GAAGnB,CAAC,CAACoB,QAAF,CAAWT,SAAX,EAAsB,IAAtB,CAA3B;AAEA;;;;;;AAIA,SAASU,aAAT,GAAyB;AACvBjB,EAAAA,OAAO,CAACkB,EAAR,CAAY,GAAZ,EAAgB,MAAMH,kBAAkB,EAAxC;AACD;;AAEDI,MAAM,CAACC,OAAP,GAAiB;AACfH,EAAAA,aADe;AAEfV,EAAAA;AAFe,CAAjB","sourcesContent":["const _ = require(`lodash`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst redux = require(`../redux`)\nconst { emitter } = redux\n\n// Even if we are using loki, we still include redux in the list of\n// dbs since it still has pages, config, etc.\nconst dbs = [redux]\nif (process.env.GATSBY_DB_NODES === `loki`) {\n  dbs.push(require(`./loki`))\n}\n\n// calls `saveState()` on all DBs\nlet saveInProgress = false\nasync function saveState() {\n  if (saveInProgress) return\n  saveInProgress = true\n\n  try {\n    await Promise.all(dbs.map(db => db.saveState()))\n  } catch (err) {\n    report.warn(`Error persisting state: ${(err && err.message) || err}`)\n  }\n\n  saveInProgress = false\n}\nconst saveStateDebounced = _.debounce(saveState, 1000)\n\n/**\n * Starts listening to redux actions and triggers a database save to\n * disk upon any action (debounced to every 1 second)\n */\nfunction startAutosave() {\n  emitter.on(`*`, () => saveStateDebounced())\n}\n\nmodule.exports = {\n  startAutosave,\n  saveState,\n}\n"],"file":"index.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/dev-404-page/raw_dev-404-page.js b/node_modules/gatsby/dist/internal-plugins/dev-404-page/raw_dev-404-page.js
index d233131..aefadc8 100644
--- a/node_modules/gatsby/dist/internal-plugins/dev-404-page/raw_dev-404-page.js
+++ b/node_modules/gatsby/dist/internal-plugins/dev-404-page/raw_dev-404-page.js
@@ -21,8 +21,8 @@ class Dev404Page extends React.Component {
 
   render() {
     const { pathname } = this.props.location
-    const pages = this.props.pages.filter(
-      p => !/^\/dev-404-page\/$/.test(p.path)
+    const paths = this.props.pagePaths.filter(
+      p => !/^\/dev-404-page\/$/.test(p)
     )
     let newFilePath
     if (pathname === `/`) {
@@ -62,17 +62,17 @@ class Dev404Page extends React.Component {
           and this page will automatically refresh to show the new page
           component you created.
         </p>
-        {pages.length > 0 && (
+        {paths.length > 0 && (
           <div>
             <p>
               If you were trying to reach another page, perhaps you can find it
               below.
             </p>
-            <h2>Pages ({pages.length})</h2>
+            <h2>Pages ({paths.length})</h2>
             <ul>
-              {pages.map(page => (
-                <li key={page.path}>
-                  <Link to={page.path}>{page.path}</Link>
+              {paths.map(path => (
+                <li key={path}>
+                  <Link to={path}>{path}</Link>
                 </li>
               ))}
             </ul>
diff --git a/node_modules/gatsby/dist/internal-plugins/dev-404-page/raw_dev-404-page.js.map b/node_modules/gatsby/dist/internal-plugins/dev-404-page/raw_dev-404-page.js.map
index 0b18a91..e435599 100644
--- a/node_modules/gatsby/dist/internal-plugins/dev-404-page/raw_dev-404-page.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/dev-404-page/raw_dev-404-page.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/dev-404-page/raw_dev-404-page.js"],"names":["Dev404Page","React","Component","constructor","props","state","showCustom404","bind","setState","render","pathname","location","pages","filter","p","test","path","newFilePath","slice","custom404","length","map","page","PropTypes","arrayOf","object","element"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AAEA,MAAMA,UAAN,SAAyBC,eAAMC,SAA/B,CAAyC;AAOvCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,SAAKC,KAAL,GAAa;AAAEC,MAAAA,aAAa,EAAE;AAAjB,KAAb;AACA,SAAKA,aAAL,GAAqB,KAAKA,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAArB;AACD;;AAEDD,EAAAA,aAAa,GAAG;AACd,SAAKE,QAAL,CAAc;AAAEF,MAAAA,aAAa,EAAE;AAAjB,KAAd;AACD;;AAEDG,EAAAA,MAAM,GAAG;AAAA,UACCC,QADD,GACc,KAAKN,KAAL,CAAWO,QADzB,CACCD,QADD;AAEP,UAAME,KAAK,GAAG,KAAKR,KAAL,CAAWQ,KAAX,CAAiBC,MAAjB,CACZC,CAAC,IAAI,CAAC,qBAAqBC,IAArB,CAA0BD,CAAC,CAACE,IAA5B,CADM,CAAd;AAGA,QAAIC,WAAJ;;AACA,QAAIP,QAAQ,KAAM,GAAlB,EAAsB;AACpBO,MAAAA,WAAW,GAAI,oBAAf;AACD,KAFD,MAEO,IAAIP,QAAQ,CAACQ,KAAT,CAAe,CAAC,CAAhB,MAAwB,GAA5B,EAAgC;AACrCD,MAAAA,WAAW,GAAI,YAAWP,QAAQ,CAACQ,KAAT,CAAe,CAAf,EAAkB,CAAC,CAAnB,CAAsB,KAAhD;AACD,KAFM,MAEA;AACLD,MAAAA,WAAW,GAAI,YAAWP,QAAS,KAAnC;AACD;;AAED,WAAO,KAAKL,KAAL,CAAWC,aAAX,GACL,KAAKF,KAAL,CAAWe,SADN,GAGL,0CACE,0EADF,EAEE,wCACI,4BADJ,EAEE,2CAAOT,QAAP,CAFF,CAFF,EAMG,KAAKN,KAAL,CAAWe,SAAX,GACC,wCACE;AAAQ,MAAA,OAAO,EAAE,KAAKb;AAAtB,iCADF,CADD,GAOC,wCACI,iHADJ,EAEE,8DAFF,MAbJ,EAkBE,iGAEI,GAFJ,EAGE,2CAAOW,WAAP,CAHF,EAII,GAJJ,yFAlBF,EA0BGL,KAAK,CAACQ,MAAN,GAAe,CAAf,IACC,0CACE,mHADF,EAKE,oDAAYR,KAAK,CAACQ,MAAlB,MALF,EAME,yCACGR,KAAK,CAACS,GAAN,CAAUC,IAAI,IACb;AAAI,MAAA,GAAG,EAAEA,IAAI,CAACN;AAAd,OACE,6BAAC,YAAD;AAAM,MAAA,EAAE,EAAEM,IAAI,CAACN;AAAf,OAAsBM,IAAI,CAACN,IAA3B,CADF,CADD,CADH,CANF,CA3BJ,CAHF;AA+CD;;AA9EsC;;8BAAnChB,U,eACe;AACjBY,EAAAA,KAAK,EAAEW,mBAAUC,OAAV,CAAkBD,mBAAUE,MAA5B,CADU;AAEjBN,EAAAA,SAAS,EAAEI,mBAAUG,OAFJ;AAGjBf,EAAAA,QAAQ,EAAEY,mBAAUE;AAHH,C;eAgFNzB,U","sourcesContent":["import React from \"react\"\nimport PropTypes from \"prop-types\"\nimport { Link } from \"gatsby\"\n\nclass Dev404Page extends React.Component {\n  static propTypes = {\n    pages: PropTypes.arrayOf(PropTypes.object),\n    custom404: PropTypes.element,\n    location: PropTypes.object,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = { showCustom404: false }\n    this.showCustom404 = this.showCustom404.bind(this)\n  }\n\n  showCustom404() {\n    this.setState({ showCustom404: true })\n  }\n\n  render() {\n    const { pathname } = this.props.location\n    const pages = this.props.pages.filter(\n      p => !/^\\/dev-404-page\\/$/.test(p.path)\n    )\n    let newFilePath\n    if (pathname === `/`) {\n      newFilePath = `src/pages/index.js`\n    } else if (pathname.slice(-1) === `/`) {\n      newFilePath = `src/pages${pathname.slice(0, -1)}.js`\n    } else {\n      newFilePath = `src/pages${pathname}.js`\n    }\n\n    return this.state.showCustom404 ? (\n      this.props.custom404\n    ) : (\n      <div>\n        <h1>Gatsby.js development 404 page</h1>\n        <p>\n          {`There's not a page yet at `}\n          <code>{pathname}</code>\n        </p>\n        {this.props.custom404 ? (\n          <p>\n            <button onClick={this.showCustom404}>\n              Preview custom 404 page\n            </button>\n          </p>\n        ) : (\n          <p>\n            {`A custom 404 page wasn't detected - if you would like to add one, create a component in your site directory at `}\n            <code>src/pages/404.js</code>.\n          </p>\n        )}\n        <p>\n          Create a React.js component in your site directory at\n          {` `}\n          <code>{newFilePath}</code>\n          {` `}\n          and this page will automatically refresh to show the new page\n          component you created.\n        </p>\n        {pages.length > 0 && (\n          <div>\n            <p>\n              If you were trying to reach another page, perhaps you can find it\n              below.\n            </p>\n            <h2>Pages ({pages.length})</h2>\n            <ul>\n              {pages.map(page => (\n                <li key={page.path}>\n                  <Link to={page.path}>{page.path}</Link>\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n      </div>\n    )\n  }\n}\n\nexport default Dev404Page\n"],"file":"raw_dev-404-page.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/dev-404-page/raw_dev-404-page.js"],"names":["Dev404Page","React","Component","constructor","props","state","showCustom404","bind","setState","render","pathname","location","paths","pagePaths","filter","p","test","newFilePath","slice","custom404","length","map","path","pages","PropTypes","arrayOf","object","element"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AAEA,MAAMA,UAAN,SAAyBC,eAAMC,SAA/B,CAAyC;AAOvCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,SAAKC,KAAL,GAAa;AAAEC,MAAAA,aAAa,EAAE;AAAjB,KAAb;AACA,SAAKA,aAAL,GAAqB,KAAKA,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAArB;AACD;;AAEDD,EAAAA,aAAa,GAAG;AACd,SAAKE,QAAL,CAAc;AAAEF,MAAAA,aAAa,EAAE;AAAjB,KAAd;AACD;;AAEDG,EAAAA,MAAM,GAAG;AAAA,UACCC,QADD,GACc,KAAKN,KAAL,CAAWO,QADzB,CACCD,QADD;AAEP,UAAME,KAAK,GAAG,KAAKR,KAAL,CAAWS,SAAX,CAAqBC,MAArB,CACZC,CAAC,IAAI,CAAC,qBAAqBC,IAArB,CAA0BD,CAA1B,CADM,CAAd;AAGA,QAAIE,WAAJ;;AACA,QAAIP,QAAQ,KAAM,GAAlB,EAAsB;AACpBO,MAAAA,WAAW,GAAI,oBAAf;AACD,KAFD,MAEO,IAAIP,QAAQ,CAACQ,KAAT,CAAe,CAAC,CAAhB,MAAwB,GAA5B,EAAgC;AACrCD,MAAAA,WAAW,GAAI,YAAWP,QAAQ,CAACQ,KAAT,CAAe,CAAf,EAAkB,CAAC,CAAnB,CAAsB,KAAhD;AACD,KAFM,MAEA;AACLD,MAAAA,WAAW,GAAI,YAAWP,QAAS,KAAnC;AACD;;AAED,WAAO,KAAKL,KAAL,CAAWC,aAAX,GACL,KAAKF,KAAL,CAAWe,SADN,GAGL,0CACE,0EADF,EAEE,wCACI,4BADJ,EAEE,2CAAOT,QAAP,CAFF,CAFF,EAMG,KAAKN,KAAL,CAAWe,SAAX,GACC,wCACE;AAAQ,MAAA,OAAO,EAAE,KAAKb;AAAtB,iCADF,CADD,GAOC,wCACI,iHADJ,EAEE,8DAFF,MAbJ,EAkBE,iGAEI,GAFJ,EAGE,2CAAOW,WAAP,CAHF,EAII,GAJJ,yFAlBF,EA0BGL,KAAK,CAACQ,MAAN,GAAe,CAAf,IACC,0CACE,mHADF,EAKE,oDAAYR,KAAK,CAACQ,MAAlB,MALF,EAME,yCACGR,KAAK,CAACS,GAAN,CAAUC,IAAI,IACb;AAAI,MAAA,GAAG,EAAEA;AAAT,OACE,6BAAC,YAAD;AAAM,MAAA,EAAE,EAAEA;AAAV,OAAiBA,IAAjB,CADF,CADD,CADH,CANF,CA3BJ,CAHF;AA+CD;;AA9EsC;;8BAAnCtB,U,eACe;AACjBuB,EAAAA,KAAK,EAAEC,mBAAUC,OAAV,CAAkBD,mBAAUE,MAA5B,CADU;AAEjBP,EAAAA,SAAS,EAAEK,mBAAUG,OAFJ;AAGjBhB,EAAAA,QAAQ,EAAEa,mBAAUE;AAHH,C;eAgFN1B,U","sourcesContent":["import React from \"react\"\nimport PropTypes from \"prop-types\"\nimport { Link } from \"gatsby\"\n\nclass Dev404Page extends React.Component {\n  static propTypes = {\n    pages: PropTypes.arrayOf(PropTypes.object),\n    custom404: PropTypes.element,\n    location: PropTypes.object,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = { showCustom404: false }\n    this.showCustom404 = this.showCustom404.bind(this)\n  }\n\n  showCustom404() {\n    this.setState({ showCustom404: true })\n  }\n\n  render() {\n    const { pathname } = this.props.location\n    const paths = this.props.pagePaths.filter(\n      p => !/^\\/dev-404-page\\/$/.test(p)\n    )\n    let newFilePath\n    if (pathname === `/`) {\n      newFilePath = `src/pages/index.js`\n    } else if (pathname.slice(-1) === `/`) {\n      newFilePath = `src/pages${pathname.slice(0, -1)}.js`\n    } else {\n      newFilePath = `src/pages${pathname}.js`\n    }\n\n    return this.state.showCustom404 ? (\n      this.props.custom404\n    ) : (\n      <div>\n        <h1>Gatsby.js development 404 page</h1>\n        <p>\n          {`There's not a page yet at `}\n          <code>{pathname}</code>\n        </p>\n        {this.props.custom404 ? (\n          <p>\n            <button onClick={this.showCustom404}>\n              Preview custom 404 page\n            </button>\n          </p>\n        ) : (\n          <p>\n            {`A custom 404 page wasn't detected - if you would like to add one, create a component in your site directory at `}\n            <code>src/pages/404.js</code>.\n          </p>\n        )}\n        <p>\n          Create a React.js component in your site directory at\n          {` `}\n          <code>{newFilePath}</code>\n          {` `}\n          and this page will automatically refresh to show the new page\n          component you created.\n        </p>\n        {paths.length > 0 && (\n          <div>\n            <p>\n              If you were trying to reach another page, perhaps you can find it\n              below.\n            </p>\n            <h2>Pages ({paths.length})</h2>\n            <ul>\n              {paths.map(path => (\n                <li key={path}>\n                  <Link to={path}>{path}</Link>\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n      </div>\n    )\n  }\n}\n\nexport default Dev404Page\n"],"file":"raw_dev-404-page.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/better-queue-custom-store.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/better-queue-custom-store.js.map
deleted file mode 100644
index 50c2cb3..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/better-queue-custom-store.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/better-queue-custom-store.js"],"names":["MemoryStoreWithPriorityBuckets","uuid","queueMap","Map","tasks","taskIdToPriority","running","priorityKeys","updatePriorityKeys","Array","from","keys","sort","a","b","addTaskWithPriority","taskId","priority","needToUpdatePriorityKeys","priorityTasks","get","set","push","connect","cb","size","getTask","deleteTask","delete","splice","indexOf","putTask","task","oldTask","oldPriority","oldPriorityTasks","length","takeFirstN","n","lockId","remainingTasks","haveSomeTasks","tasksToRun","taskWithSamePriority","grabbedTaskIds","forEach","takeLastN","reverse","deleteCount","Math","min","getRunningTasks","getLock","releaseLock","module","exports"],"mappings":"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","sourcesContent":["function MemoryStoreWithPriorityBuckets() {\n  let uuid = 0\n\n  /**\n   * Task ids grouped by priority\n   */\n  const queueMap = new Map()\n\n  /**\n   * Task id to task lookup\n   */\n  const tasks = new Map()\n\n  /**\n   * Task id to priority lookup\n   */\n  const taskIdToPriority = new Map()\n\n  /**\n   * Lock to running tasks object\n   */\n  const running = {}\n\n  let priorityKeys = []\n  const updatePriorityKeys = () => {\n    priorityKeys = Array.from(queueMap.keys()).sort((a, b) => b - a)\n  }\n\n  const addTaskWithPriority = (taskId, priority) => {\n    let needToUpdatePriorityKeys = false\n    let priorityTasks = queueMap.get(priority)\n    if (!priorityTasks) {\n      priorityTasks = []\n      queueMap.set(priority, priorityTasks)\n      needToUpdatePriorityKeys = true\n    }\n\n    taskIdToPriority.set(taskId, priority)\n    priorityTasks.push(taskId)\n    return needToUpdatePriorityKeys\n  }\n\n  return {\n    connect: function(cb) {\n      cb(null, tasks.size)\n    },\n    getTask: function(taskId, cb) {\n      cb(null, tasks.get(taskId))\n    },\n    deleteTask: function(taskId, cb) {\n      if (tasks.get(taskId)) {\n        tasks.delete(taskId)\n        const priority = taskIdToPriority.get(taskId)\n        const priorityTasks = queueMap.get(priority)\n        priorityTasks.splice(priorityTasks.indexOf(taskId), 1)\n        taskIdToPriority.delete(taskId)\n      }\n      cb()\n    },\n    putTask: function(taskId, task, priority = 0, cb) {\n      const oldTask = tasks.get(taskId)\n      tasks.set(taskId, task)\n      let needToUpdatePriorityKeys = false\n      if (oldTask) {\n        const oldPriority = taskIdToPriority.get(taskId)\n\n        if (oldPriority !== priority) {\n          const oldPriorityTasks = queueMap.get(oldPriority)\n          oldPriorityTasks.splice(oldPriorityTasks.indexOf(taskId), 1)\n\n          if (\n            addTaskWithPriority(taskId, priority) ||\n            oldPriority.length === 0\n          ) {\n            needToUpdatePriorityKeys = true\n          }\n        }\n      } else {\n        needToUpdatePriorityKeys = addTaskWithPriority(taskId, priority)\n      }\n\n      if (needToUpdatePriorityKeys) {\n        updatePriorityKeys()\n      }\n      cb()\n    },\n    takeFirstN: function(n, cb) {\n      const lockId = uuid++\n      let remainingTasks = n\n      let needToUpdatePriorityKeys = false\n      let haveSomeTasks = false\n      const tasksToRun = {}\n\n      for (let priority of priorityKeys) {\n        const taskWithSamePriority = queueMap.get(priority)\n        const grabbedTaskIds = taskWithSamePriority.splice(0, remainingTasks)\n        grabbedTaskIds.forEach(taskId => {\n          // add task to task that will run\n          // and remove it from waiting list\n          tasksToRun[taskId] = tasks.get(taskId)\n          tasks.delete(taskId)\n          taskIdToPriority.delete(taskId)\n          haveSomeTasks = true\n        })\n\n        remainingTasks -= grabbedTaskIds.length\n        if (taskWithSamePriority.length === 0) {\n          queueMap.delete(priority)\n          needToUpdatePriorityKeys = true\n        }\n        if (remainingTasks <= 0) {\n          break\n        }\n      }\n\n      if (needToUpdatePriorityKeys) {\n        updatePriorityKeys()\n      }\n\n      if (haveSomeTasks) {\n        running[lockId] = tasksToRun\n      }\n\n      cb(null, lockId)\n    },\n    takeLastN: function(n, cb) {\n      // This is not really used by Gatsby, but will be implemented for\n      // completion in easiest possible way (so not very performant).\n      // Mostly done so generic test suite used by other stores passes.\n      // This is mostly C&P from takeFirstN, with array reversal and different\n      // splice args\n      const lockId = uuid++\n      let remainingTasks = n\n      let needToUpdatePriorityKeys = false\n      let haveSomeTasks = false\n      const tasksToRun = {}\n\n      for (let priority of priorityKeys.reverse()) {\n        const taskWithSamePriority = queueMap.get(priority)\n        const deleteCount = Math.min(\n          remainingTasks,\n          taskWithSamePriority.length\n        )\n        const grabbedTaskIds = taskWithSamePriority.splice(\n          taskWithSamePriority.length - deleteCount,\n          deleteCount\n        )\n        grabbedTaskIds.forEach(taskId => {\n          // add task to task that will run\n          // and remove it from waiting list\n          tasksToRun[taskId] = tasks.get(taskId)\n          tasks.delete(taskId)\n          taskIdToPriority.delete(taskId)\n          haveSomeTasks = true\n        })\n\n        remainingTasks -= grabbedTaskIds.length\n        if (taskWithSamePriority.length === 0) {\n          queueMap.delete(priority)\n          needToUpdatePriorityKeys = true\n        }\n        if (remainingTasks <= 0) {\n          break\n        }\n      }\n\n      if (needToUpdatePriorityKeys) {\n        updatePriorityKeys()\n      }\n\n      if (haveSomeTasks) {\n        running[lockId] = tasksToRun\n      }\n\n      cb(null, lockId)\n    },\n    getRunningTasks: function(cb) {\n      cb(null, running)\n    },\n    getLock: function(lockId, cb) {\n      cb(null, running[lockId])\n    },\n    releaseLock: function(lockId, cb) {\n      delete running[lockId]\n      cb()\n    },\n  }\n}\n\nmodule.exports = MemoryStoreWithPriorityBuckets\n"],"file":"better-queue-custom-store.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/file-parser.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/file-parser.js.map
deleted file mode 100644
index ef204be..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/file-parser.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/file-parser.js"],"names":["fs","require","crypto","_","getGraphQLTag","report","apiRunnerNode","boundActionCreators","generateQueryName","def","hash","file","name","value","camelCase","kind","warnForUnknownQueryVariable","varName","usageFunction","warn","parseToAst","filePath","fileStr","ast","transpiled","filename","contents","length","item","tmp","error","queryExtractionGraphQLError","componentPath","undefined","queryExtractionBabelError","warnForGlobalTag","findGraphQLTags","text","Promise","resolve","reject","then","queries","documentLocations","WeakMap","extractStaticQuery","taggedTemplateExpressPath","isHook","gqlAst","isGlobal","definitions","forEach","set","node","start","loc","map","d","isStaticQuery","push","JSXElement","path","openingElement","traverse","JSXAttribute","jsxPath","TaggedTemplateExpression","templatePath","Identifier","identifierPath","found","VariableDeclarator","varPath","id","init","type","CallExpression","hookPath","callee","get","referencesImport","ExportNamedDeclaration","state","innerPath","uniqueQueries","uniqBy","q","catch","cache","FileParser","parseFile","readFile","err","indexOf","createHash","update","digest","astDefinitions","queryExtractedBabelSuccess","parseFiles","files","documents","Map","all","doc"],"mappings":"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","sourcesContent":["// @flow\nconst fs = require(`fs-extra`)\nconst crypto = require(`crypto`)\nconst _ = require(`lodash`)\n\n// Traverse is a es6 module...\nimport traverse from \"@babel/traverse\"\nconst getGraphQLTag = require(`babel-plugin-remove-graphql-queries`)\n  .getGraphQLTag\nconst report = require(`gatsby-cli/lib/reporter`)\n\nimport type { DocumentNode, DefinitionNode } from \"graphql\"\nimport { babelParseToAst } from \"../../utils/babel-parse-to-ast\"\n\nconst apiRunnerNode = require(`../../utils/api-runner-node`)\nconst { boundActionCreators } = require(`../../redux/actions`)\n\n/**\n * Add autogenerated query name if it wasn't defined by user.\n */\nconst generateQueryName = ({ def, hash, file }) => {\n  if (!def.name || !def.name.value) {\n    def.name = {\n      value: `${_.camelCase(file)}${hash}`,\n      kind: `Name`,\n    }\n  }\n  return def\n}\n\nconst warnForUnknownQueryVariable = (varName, file, usageFunction) =>\n  report.warn(\n    `\\nWe were unable to find the declaration of variable \"${varName}\", which you passed as the \"query\" prop into the ${usageFunction} declaration in \"${file}\".\n\nPerhaps the variable name has a typo?\n\nAlso note that we are currently unable to use queries defined in files other than the file where the ${usageFunction} is defined. If you're attempting to import the query, please move it into \"${file}\". If being able to import queries from another file is an important capability for you, we invite your help fixing it.\\n`\n  )\n\nasync function parseToAst(filePath, fileStr) {\n  let ast\n\n  // Preprocess and attempt to parse source; return an AST if we can, log an\n  // error if we can't.\n  const transpiled = await apiRunnerNode(`preprocessSource`, {\n    filename: filePath,\n    contents: fileStr,\n  })\n  if (transpiled && transpiled.length) {\n    for (const item of transpiled) {\n      try {\n        const tmp = babelParseToAst(item, filePath)\n        ast = tmp\n        break\n      } catch (error) {\n        report.error(error)\n        boundActionCreators.queryExtractionGraphQLError({\n          componentPath: filePath,\n        })\n        continue\n      }\n    }\n    if (ast === undefined) {\n      report.error(`Failed to parse preprocessed file ${filePath}`)\n      boundActionCreators.queryExtractionGraphQLError({\n        componentPath: filePath,\n      })\n\n      return null\n    }\n  } else {\n    try {\n      ast = babelParseToAst(fileStr, filePath)\n    } catch (error) {\n      boundActionCreators.queryExtractionBabelError({\n        componentPath: filePath,\n        error,\n      })\n      report.error(\n        `There was a problem parsing \"${filePath}\"; any GraphQL ` +\n          `fragments or queries in this file were not processed. \\n` +\n          `This may indicate a syntax error in the code, or it may be a file type ` +\n          `that Gatsby does not know how to parse.`\n      )\n\n      return null\n    }\n  }\n\n  return ast\n}\n\nconst warnForGlobalTag = file =>\n  report.warn(\n    `Using the global \\`graphql\\` tag is deprecated, and will not be supported in v3.\\n` +\n      `Import it instead like:  import { graphql } from 'gatsby' in file:\\n` +\n      file\n  )\n\nasync function findGraphQLTags(file, text): Promise<Array<DefinitionNode>> {\n  return new Promise((resolve, reject) => {\n    parseToAst(file, text)\n      .then(ast => {\n        let queries = []\n        if (!ast) {\n          resolve(queries)\n          return\n        }\n\n        /**\n         * A map of graphql documents to unique locations.\n         *\n         * A graphql document's unique location is made of:\n         *\n         *  - the location of the graphql template literal that contains the document, and\n         *  - the document's location within the graphql template literal\n         *\n         * This is used to prevent returning duplicated documents.\n         */\n        const documentLocations = new WeakMap()\n\n        const extractStaticQuery = (\n          taggedTemplateExpressPath,\n          isHook = false\n        ) => {\n          const { ast: gqlAst, text, hash, isGlobal } = getGraphQLTag(\n            taggedTemplateExpressPath\n          )\n          if (!gqlAst) return\n\n          if (isGlobal) warnForGlobalTag(file)\n\n          gqlAst.definitions.forEach(def => {\n            documentLocations.set(\n              def,\n              `${taggedTemplateExpressPath.node.start}-${def.loc.start}`\n            )\n            generateQueryName({\n              def,\n              hash,\n              file,\n            })\n          })\n\n          const definitions = [...gqlAst.definitions].map(d => {\n            d.isStaticQuery = true\n            d.isHook = isHook\n            d.text = text\n            d.hash = hash\n            return d\n          })\n\n          queries.push(...definitions)\n        }\n\n        // Look for queries in <StaticQuery /> elements.\n        traverse(ast, {\n          JSXElement(path) {\n            if (path.node.openingElement.name.name !== `StaticQuery`) {\n              return\n            }\n\n            // astexplorer.com link I (@kyleamathews) used when prototyping this algorithm\n            // https://astexplorer.net/#/gist/ab5d71c0f08f287fbb840bf1dd8b85ff/2f188345d8e5a4152fe7c96f0d52dbcc6e9da466\n            path.traverse({\n              JSXAttribute(jsxPath) {\n                if (jsxPath.node.name.name !== `query`) {\n                  return\n                }\n                jsxPath.traverse({\n                  // Assume the query is inline in the component and extract that.\n                  TaggedTemplateExpression(templatePath) {\n                    extractStaticQuery(templatePath)\n                  },\n                  // Also see if it's a variable that's passed in as a prop\n                  // and if it is, go find it.\n                  Identifier(identifierPath) {\n                    if (identifierPath.node.name !== `graphql`) {\n                      const varName = identifierPath.node.name\n                      let found = false\n                      traverse(ast, {\n                        VariableDeclarator(varPath) {\n                          if (\n                            varPath.node.id.name === varName &&\n                            varPath.node.init.type ===\n                              `TaggedTemplateExpression`\n                          ) {\n                            varPath.traverse({\n                              TaggedTemplateExpression(templatePath) {\n                                found = true\n                                extractStaticQuery(templatePath)\n                              },\n                            })\n                          }\n                        },\n                      })\n                      if (!found) {\n                        warnForUnknownQueryVariable(\n                          varName,\n                          file,\n                          `<StaticQuery>`\n                        )\n                      }\n                    }\n                  },\n                })\n              },\n            })\n            return\n          },\n        })\n\n        // Look for queries in useStaticQuery hooks.\n        traverse(ast, {\n          CallExpression(hookPath) {\n            if (\n              hookPath.node.callee.name !== `useStaticQuery` ||\n              !hookPath.get(`callee`).referencesImport(`gatsby`)\n            ) {\n              return\n            }\n\n            hookPath.traverse({\n              // Assume the query is inline in the component and extract that.\n              TaggedTemplateExpression(templatePath) {\n                extractStaticQuery(templatePath, true)\n              },\n              // // Also see if it's a variable that's passed in as a prop\n              // // and if it is, go find it.\n              Identifier(identifierPath) {\n                if (\n                  identifierPath.node.name !== `graphql` &&\n                  identifierPath.node.name !== `useStaticQuery`\n                ) {\n                  const varName = identifierPath.node.name\n                  let found = false\n                  traverse(ast, {\n                    VariableDeclarator(varPath) {\n                      if (\n                        varPath.node.id.name === varName &&\n                        varPath.node.init.type === `TaggedTemplateExpression`\n                      ) {\n                        varPath.traverse({\n                          TaggedTemplateExpression(templatePath) {\n                            found = true\n                            extractStaticQuery(templatePath, true)\n                          },\n                        })\n                      }\n                    },\n                  })\n                  if (!found) {\n                    warnForUnknownQueryVariable(varName, file, `useStaticQuery`)\n                  }\n                }\n              },\n            })\n          },\n        })\n\n        // Look for exported page queries\n        traverse(ast, {\n          ExportNamedDeclaration(path, state) {\n            path.traverse({\n              TaggedTemplateExpression(innerPath) {\n                const { ast: gqlAst, isGlobal, hash } = getGraphQLTag(innerPath)\n                if (!gqlAst) return\n\n                if (isGlobal) warnForGlobalTag(file)\n\n                gqlAst.definitions.forEach(def => {\n                  documentLocations.set(\n                    def,\n                    `${innerPath.node.start}-${def.loc.start}`\n                  )\n                  generateQueryName({\n                    def,\n                    hash,\n                    file,\n                  })\n                })\n\n                queries.push(...gqlAst.definitions)\n              },\n            })\n          },\n        })\n\n        // Remove duplicate queries\n        const uniqueQueries = _.uniqBy(queries, q => documentLocations.get(q))\n\n        resolve(uniqueQueries)\n      })\n      .catch(reject)\n  })\n}\n\nconst cache = {}\n\nexport default class FileParser {\n  async parseFile(file: string): Promise<?DocumentNode> {\n    let text\n    try {\n      text = await fs.readFile(file, `utf8`)\n    } catch (err) {\n      report.error(`There was a problem reading the file: ${file}`, err)\n      boundActionCreators.queryExtractionGraphQLError({\n        componentPath: file,\n      })\n      return null\n    }\n\n    if (text.indexOf(`graphql`) === -1) return null\n    const hash = crypto\n      .createHash(`md5`)\n      .update(file)\n      .update(text)\n      .digest(`hex`)\n\n    try {\n      let astDefinitions =\n        cache[hash] || (cache[hash] = await findGraphQLTags(file, text))\n\n      // If any AST definitions were extracted, report success.\n      // This can mean there is none or there was a babel error when\n      // we tried to extract the graphql AST.\n      if (astDefinitions.length > 0) {\n        boundActionCreators.queryExtractedBabelSuccess({\n          componentPath: file,\n        })\n      }\n\n      return astDefinitions.length\n        ? {\n            kind: `Document`,\n            definitions: astDefinitions,\n          }\n        : null\n    } catch (err) {\n      report.error(\n        `There was a problem parsing the GraphQL query in file: ${file}`,\n        err\n      )\n      boundActionCreators.queryExtractionGraphQLError({\n        componentPath: file,\n      })\n      return null\n    }\n  }\n\n  async parseFiles(files: Array<string>): Promise<Map<string, DocumentNode>> {\n    const documents = new Map()\n\n    return Promise.all(\n      files.map(file =>\n        this.parseFile(file).then(doc => {\n          if (!doc) return\n          documents.set(file, doc)\n        })\n      )\n    ).then(() => documents)\n  }\n}\n"],"file":"file-parser.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/graphql-errors.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/graphql-errors.js.map
deleted file mode 100644
index e566dca..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/graphql-errors.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/graphql-errors.js"],"names":["handlers","name","node","kind","value","loc","formatFilePath","filePath","report","format","bold","blue","formatError","message","codeFrame","stripIndent","extractError","error","docRegex","matches","docName","codeBlock","exec","toString","index","lastIndex","findLocation","extractedMessage","def","location","enter","regex","handler","match","slice","getCodeFrame","query","lineNumber","column","linesAbove","linesBelow","getCodeFrameFromRelayError","start","source","body","line","multipleRootQueriesError","otherDef","otherName","unifiedName","_","camelCase","upperFirst","yellow","green","graphqlValidationError","errors","doc","length","locations","graphqlError","namePathMap","nameDefMap","get","formattedMessage","reportedMessage"],"mappings":"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","sourcesContent":["// @flow\n\nimport { print, visit, GraphQLError, getLocation } from \"graphql\"\nimport babelCodeFrame from \"@babel/code-frame\"\nimport _ from \"lodash\"\nimport report from \"gatsby-cli/lib/reporter\"\n\ntype RelayGraphQLError = Error & { validationErrors?: Object }\n\n// These handle specific errors throw by RelayParser. If an error matches\n// you get a pointer to the location in the query that is broken, otherwise\n// we show the error and the query.\nconst handlers = [\n  [\n    /Unknown field `(.+)` on type `(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Field` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n  [\n    /Unknown argument `(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Argument` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n  [\n    /Unknown directive `@(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Directive` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n]\n\nfunction formatFilePath(filePath: string) {\n  return `${report.format.bold(`file:`)} ${report.format.blue(filePath)}`\n}\n\nfunction formatError(message: string, filePath: string, codeFrame: string) {\n  return (\n    report.stripIndent`\n    ${message}\n\n      ${formatFilePath(filePath)}\n  ` + `\\n\\n${codeFrame}\\n`\n  )\n}\n\nfunction extractError(error: Error): { message: string, docName: string } {\n  const docRegex = /Error:.(RelayParser|GraphQLParser):(.*)Source: document.`(.*)`.file.*(GraphQL.request.*^\\s*$)/gms\n  let matches\n  let message = ``\n  let docName = ``\n  let codeBlock = ``\n  while ((matches = docRegex.exec(error.toString())) !== null) {\n    // This is necessary to avoid infinite loops with zero-width matches\n    if (matches.index === docRegex.lastIndex) docRegex.lastIndex++\n    ;[, , message, docName, codeBlock] = matches\n  }\n\n  if (!message) {\n    message = error.toString()\n  }\n\n  return { message, codeBlock, docName }\n}\n\nfunction findLocation(extractedMessage, def) {\n  let location = null\n  visit(def, {\n    enter(node) {\n      if (location) return\n      for (let [regex, handler] of handlers) {\n        let match = extractedMessage.match(regex)\n        if (!match) continue\n        if ((location = handler(match.slice(1), node))) break\n      }\n    },\n  })\n  return location\n}\n\nfunction getCodeFrame(query: string, lineNumber?: number, column?: number) {\n  return babelCodeFrame(query, lineNumber, column, {\n    linesAbove: 10,\n    linesBelow: 10,\n  })\n}\n\nfunction getCodeFrameFromRelayError(\n  def: any,\n  extractedMessage: string,\n  error: Error\n) {\n  let { start, source } = findLocation(extractedMessage, def) || {}\n  let query = source ? source.body : print(def)\n\n  // we can't reliably get a location without the location source, since\n  // the printed query may differ from the original.\n  let { line, column } = (source && getLocation(source, start)) || {}\n  return getCodeFrame(query, line, column)\n}\n\nexport function multipleRootQueriesError(\n  filePath: string,\n  def: any,\n  otherDef: any\n) {\n  let name = def.name.value\n  let otherName = otherDef.name.value\n  let unifiedName = `${_.camelCase(name)}And${_.upperFirst(\n    _.camelCase(otherName)\n  )}`\n\n  return formatError(\n    `Multiple \"root\" queries found in file: \"${name}\" and \"${otherName}\". ` +\n      `Only the first (\"${otherName}\") will be registered.`,\n    filePath,\n    `  ${report.format.yellow(`Instead of:`)} \\n\\n` +\n      babelCodeFrame(report.stripIndent`\n      query ${otherName} {\n        bar {\n          #...\n        }\n      }\n\n      query ${name} {\n        foo {\n          #...\n        }\n      }\n    `) +\n      `\\n\\n  ${report.format.green(`Do:`)} \\n\\n` +\n      babelCodeFrame(report.stripIndent`\n      query ${unifiedName} {\n        bar {\n          #...\n        }\n        foo {\n          #...\n        }\n      }\n    `)\n  )\n}\n\nexport function graphqlValidationError(\n  errors: Array<GraphQLError>,\n  filePath: string,\n  doc: any\n): string {\n  if (!errors || !errors.length) return ``\n  let error = errors[0]\n  let { source, locations: [{ line, column }] = [{}] } = error\n  let query = source ? source.body : print(doc)\n\n  return formatError(error.message, filePath, getCodeFrame(query, line, column))\n}\n\nexport function graphqlError(\n  namePathMap: Map<string, string>,\n  nameDefMap: Map<string, any>,\n  error: Error | RelayGraphQLError\n) {\n  let codeBlock\n  let { message, docName } = extractError(error)\n  let filePath = namePathMap.get(docName)\n\n  if (filePath && docName) {\n    codeBlock = getCodeFrameFromRelayError(\n      nameDefMap.get(docName),\n      message,\n      error\n    )\n    const formattedMessage = formatError(message, filePath, codeBlock)\n    return { formattedMessage, docName, message, codeBlock }\n  }\n\n  let reportedMessage = `There was an error while compiling your site's GraphQL queries.\n  ${message || error.message}\n    `\n\n  if (error.message.match(/must be an instance of/)) {\n    reportedMessage +=\n      `This usually means that more than one instance of 'graphql' is installed ` +\n      `in your node_modules. Remove all but the top level one or run \\`npm dedupe\\` to fix it.`\n  }\n\n  if (error.message.match(/Duplicate document/)) {\n    reportedMessage += `${error.message.slice(21)}\\n`\n  }\n\n  return { formattedMessage: reportedMessage, docName, message, codeBlock }\n}\n"],"file":"graphql-errors.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/index.js b/node_modules/gatsby/dist/internal-plugins/query-runner/index.js
deleted file mode 100644
index bfc87aa..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/index.js
+++ /dev/null
@@ -1,4 +0,0 @@
-"use strict";
-
-require(`./pages-writer`);
-//# sourceMappingURL=index.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/index.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/index.js.map
deleted file mode 100644
index 42b655e..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/index.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/index.js"],"names":["require"],"mappings":";;AAAAA,OAAO,CAAE,gBAAF,CAAP","sourcesContent":["require(`./pages-writer`)\n"],"file":"index.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/page-query-runner.js b/node_modules/gatsby/dist/internal-plugins/query-runner/page-query-runner.js
deleted file mode 100644
index ca0e2fb..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/page-query-runner.js
+++ /dev/null
@@ -1,211 +0,0 @@
-"use strict";
-
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
-/**
- * Jobs of this module
- * - Ensure on bootstrap that all invalid page queries are run and report
- *   when this is done
- * - Watch for when a page's query is invalidated and re-run it.
- */
-const _ = require(`lodash`);
-
-const queue = require(`./query-queue`);
-
-const _require = require(`../../redux`),
-      store = _require.store,
-      emitter = _require.emitter;
-
-let queuedDirtyActions = [];
-let active = false;
-let running = false;
-const runQueriesForPathnamesQueue = new Set();
-
-exports.queueQueryForPathname = pathname => {
-  runQueriesForPathnamesQueue.add(pathname);
-}; // Do initial run of graphql queries during bootstrap.
-// Afterwards we listen "API_RUNNING_QUEUE_EMPTY" and check
-// for dirty nodes before running queries.
-
-
-exports.runInitialQueries =
-/*#__PURE__*/
-(0, _asyncToGenerator2.default)(function* () {
-  active = true;
-  yield runQueries(true);
-  return;
-});
-
-const runQueries =
-/*#__PURE__*/
-function () {
-  var _ref2 = (0, _asyncToGenerator2.default)(function* (initial = false) {
-    // Don't run queries until bootstrap gets to "run graphql queries"
-    if (!active) {
-      return;
-    } // Find paths dependent on dirty nodes
-
-
-    queuedDirtyActions = _.uniq(queuedDirtyActions, a => a.payload.id);
-    const dirtyIds = findDirtyIds(queuedDirtyActions);
-    queuedDirtyActions = []; // Find ids without data dependencies (i.e. no queries have been run for
-    // them before) and run them.
-
-    const cleanIds = findIdsWithoutDataDependencies(); // Construct paths for all queries to run
-
-    let pathnamesToRun = _.uniq([...dirtyIds, ...cleanIds]); // If this is the initial run, remove pathnames from `runQueriesForPathnamesQueue`
-    // if they're also not in the dirtyIds or cleanIds.
-    //
-    // We do this because the page component reducer/machine always
-    // adds pages to runQueriesForPathnamesQueue but during bootstrap
-    // we may not want to run those page queries if their data hasn't
-    // changed since the last time we ran Gatsby.
-
-
-    let diffedPathnames = [...runQueriesForPathnamesQueue];
-
-    if (initial) {
-      diffedPathnames = _.intersection([...runQueriesForPathnamesQueue], pathnamesToRun);
-    } // Combine.
-
-
-    pathnamesToRun = _.union(diffedPathnames, pathnamesToRun);
-    runQueriesForPathnamesQueue.clear(); // Run these paths
-
-    yield runQueriesForPathnames(pathnamesToRun);
-    return;
-  });
-
-  return function runQueries() {
-    return _ref2.apply(this, arguments);
-  };
-}();
-
-exports.runQueries = runQueries;
-emitter.on(`CREATE_NODE`, action => {
-  queuedDirtyActions.push(action);
-});
-emitter.on(`DELETE_NODE`, action => {
-  queuedDirtyActions.push({
-    payload: action.payload
-  });
-});
-
-const runQueuedActions =
-/*#__PURE__*/
-function () {
-  var _ref3 = (0, _asyncToGenerator2.default)(function* () {
-    if (active && !running) {
-      try {
-        running = true;
-        yield runQueries();
-      } finally {
-        running = false;
-
-        if (queuedDirtyActions.length > 0) {
-          runQueuedActions();
-        }
-      }
-    }
-  });
-
-  return function runQueuedActions() {
-    return _ref3.apply(this, arguments);
-  };
-}();
-
-exports.runQueuedActions = runQueuedActions; // Wait until all plugins have finished running (e.g. various
-// transformer plugins) before running queries so we don't
-// query things in a 1/2 finished state.
-
-emitter.on(`API_RUNNING_QUEUE_EMPTY`, runQueuedActions);
-let seenIdsWithoutDataDependencies = []; // Remove pages from seenIdsWithoutDataDependencies when they're deleted
-// so their query will be run again if they're created again.
-
-emitter.on(`DELETE_PAGE`, action => {
-  seenIdsWithoutDataDependencies = seenIdsWithoutDataDependencies.filter(p => p !== action.payload.path);
-});
-
-const findIdsWithoutDataDependencies = () => {
-  const state = store.getState();
-
-  const allTrackedIds = _.uniq(_.flatten(_.concat(_.values(state.componentDataDependencies.nodes), _.values(state.componentDataDependencies.connections)))); // Get list of paths not already tracked and run the queries for these
-  // paths.
-
-
-  const notTrackedIds = _.difference([...Array.from(state.pages.values(), p => p.path), ...[...state.staticQueryComponents.values()].map(c => c.jsonName)], [...allTrackedIds, ...seenIdsWithoutDataDependencies]); // Add new IDs to our seen array so we don't keep trying to run queries for them.
-  // Pages without queries can't be tracked.
-
-
-  seenIdsWithoutDataDependencies = _.uniq([...notTrackedIds, ...seenIdsWithoutDataDependencies]);
-  return notTrackedIds;
-};
-
-const runQueriesForPathnames = pathnames => {
-  const staticQueries = pathnames.filter(p => p.slice(0, 4) === `sq--`);
-  const pageQueries = pathnames.filter(p => p.slice(0, 4) !== `sq--`);
-  const state = store.getState();
-  staticQueries.forEach(id => {
-    const staticQueryComponent = store.getState().staticQueryComponents.get(id);
-    const queryJob = {
-      id: staticQueryComponent.hash,
-      hash: staticQueryComponent.hash,
-      jsonName: staticQueryComponent.jsonName,
-      query: staticQueryComponent.query,
-      componentPath: staticQueryComponent.componentPath,
-      context: {
-        path: staticQueryComponent.jsonName
-      }
-    };
-    queue.push(queryJob);
-  });
-  const pages = state.pages;
-  let didNotQueueItems = true;
-  pageQueries.forEach(id => {
-    const page = pages.get(id);
-
-    if (page) {
-      didNotQueueItems = false;
-      queue.push({
-        id: page.path,
-        jsonName: page.jsonName,
-        query: store.getState().components.get(page.componentPath).query,
-        isPage: true,
-        componentPath: page.componentPath,
-        context: Object.assign({}, page, page.context)
-      });
-    }
-  });
-
-  if (didNotQueueItems || !pathnames || pathnames.length === 0) {
-    return Promise.resolve();
-  }
-
-  return new Promise(resolve => {
-    const onDrain = () => {
-      queue.removeListener(`drain`, onDrain);
-      resolve();
-    };
-
-    queue.on(`drain`, onDrain);
-  });
-};
-
-const findDirtyIds = actions => {
-  const state = store.getState();
-
-  const uniqDirties = _.uniq(actions.reduce((dirtyIds, action) => {
-    const node = action.payload;
-    if (!node || !node.id || !node.internal.type) return dirtyIds; // Find components that depend on this node so are now dirty.
-
-    dirtyIds = dirtyIds.concat(state.componentDataDependencies.nodes[node.id]); // Find connections that depend on this node so are now invalid.
-
-    dirtyIds = dirtyIds.concat(state.componentDataDependencies.connections[node.internal.type]);
-    return _.compact(dirtyIds);
-  }, []));
-
-  return uniqDirties;
-};
-//# sourceMappingURL=page-query-runner.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/page-query-runner.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/page-query-runner.js.map
deleted file mode 100644
index a94902c..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/page-query-runner.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/page-query-runner.js"],"names":["_","require","queue","store","emitter","queuedDirtyActions","active","running","runQueriesForPathnamesQueue","Set","exports","queueQueryForPathname","pathname","add","runInitialQueries","runQueries","initial","uniq","a","payload","id","dirtyIds","findDirtyIds","cleanIds","findIdsWithoutDataDependencies","pathnamesToRun","diffedPathnames","intersection","union","clear","runQueriesForPathnames","on","action","push","runQueuedActions","length","seenIdsWithoutDataDependencies","filter","p","path","state","getState","allTrackedIds","flatten","concat","values","componentDataDependencies","nodes","connections","notTrackedIds","difference","Array","from","pages","staticQueryComponents","map","c","jsonName","pathnames","staticQueries","slice","pageQueries","forEach","staticQueryComponent","get","queryJob","hash","query","componentPath","context","didNotQueueItems","page","components","isPage","Promise","resolve","onDrain","removeListener","actions","uniqDirties","reduce","node","internal","type","compact"],"mappings":"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","sourcesContent":["// @flow\n\nimport type { QueryJob } from \"../query-runner\"\n\n/**\n * Jobs of this module\n * - Ensure on bootstrap that all invalid page queries are run and report\n *   when this is done\n * - Watch for when a page's query is invalidated and re-run it.\n */\n\nconst _ = require(`lodash`)\n\nconst queue = require(`./query-queue`)\nconst { store, emitter } = require(`../../redux`)\n\nlet queuedDirtyActions = []\n\nlet active = false\nlet running = false\n\nconst runQueriesForPathnamesQueue = new Set()\nexports.queueQueryForPathname = pathname => {\n  runQueriesForPathnamesQueue.add(pathname)\n}\n\n// Do initial run of graphql queries during bootstrap.\n// Afterwards we listen \"API_RUNNING_QUEUE_EMPTY\" and check\n// for dirty nodes before running queries.\nexports.runInitialQueries = async () => {\n  active = true\n  await runQueries(true)\n  return\n}\n\nconst runQueries = async (initial = false) => {\n  // Don't run queries until bootstrap gets to \"run graphql queries\"\n  if (!active) {\n    return\n  }\n\n  // Find paths dependent on dirty nodes\n  queuedDirtyActions = _.uniq(queuedDirtyActions, a => a.payload.id)\n  const dirtyIds = findDirtyIds(queuedDirtyActions)\n  queuedDirtyActions = []\n\n  // Find ids without data dependencies (i.e. no queries have been run for\n  // them before) and run them.\n  const cleanIds = findIdsWithoutDataDependencies()\n\n  // Construct paths for all queries to run\n  let pathnamesToRun = _.uniq([...dirtyIds, ...cleanIds])\n\n  // If this is the initial run, remove pathnames from `runQueriesForPathnamesQueue`\n  // if they're also not in the dirtyIds or cleanIds.\n  //\n  // We do this because the page component reducer/machine always\n  // adds pages to runQueriesForPathnamesQueue but during bootstrap\n  // we may not want to run those page queries if their data hasn't\n  // changed since the last time we ran Gatsby.\n  let diffedPathnames = [...runQueriesForPathnamesQueue]\n  if (initial) {\n    diffedPathnames = _.intersection(\n      [...runQueriesForPathnamesQueue],\n      pathnamesToRun\n    )\n  }\n\n  // Combine.\n  pathnamesToRun = _.union(diffedPathnames, pathnamesToRun)\n\n  runQueriesForPathnamesQueue.clear()\n\n  // Run these paths\n  await runQueriesForPathnames(pathnamesToRun)\n  return\n}\n\nexports.runQueries = runQueries\n\nemitter.on(`CREATE_NODE`, action => {\n  queuedDirtyActions.push(action)\n})\n\nemitter.on(`DELETE_NODE`, action => {\n  queuedDirtyActions.push({ payload: action.payload })\n})\n\nconst runQueuedActions = async () => {\n  if (active && !running) {\n    try {\n      running = true\n      await runQueries()\n    } finally {\n      running = false\n      if (queuedDirtyActions.length > 0) {\n        runQueuedActions()\n      }\n    }\n  }\n}\nexports.runQueuedActions = runQueuedActions\n\n// Wait until all plugins have finished running (e.g. various\n// transformer plugins) before running queries so we don't\n// query things in a 1/2 finished state.\nemitter.on(`API_RUNNING_QUEUE_EMPTY`, runQueuedActions)\n\nlet seenIdsWithoutDataDependencies = []\n\n// Remove pages from seenIdsWithoutDataDependencies when they're deleted\n// so their query will be run again if they're created again.\nemitter.on(`DELETE_PAGE`, action => {\n  seenIdsWithoutDataDependencies = seenIdsWithoutDataDependencies.filter(\n    p => p !== action.payload.path\n  )\n})\n\nconst findIdsWithoutDataDependencies = () => {\n  const state = store.getState()\n  const allTrackedIds = _.uniq(\n    _.flatten(\n      _.concat(\n        _.values(state.componentDataDependencies.nodes),\n        _.values(state.componentDataDependencies.connections)\n      )\n    )\n  )\n\n  // Get list of paths not already tracked and run the queries for these\n  // paths.\n  const notTrackedIds = _.difference(\n    [\n      ...Array.from(state.pages.values(), p => p.path),\n      ...[...state.staticQueryComponents.values()].map(c => c.jsonName),\n    ],\n    [...allTrackedIds, ...seenIdsWithoutDataDependencies]\n  )\n\n  // Add new IDs to our seen array so we don't keep trying to run queries for them.\n  // Pages without queries can't be tracked.\n  seenIdsWithoutDataDependencies = _.uniq([\n    ...notTrackedIds,\n    ...seenIdsWithoutDataDependencies,\n  ])\n\n  return notTrackedIds\n}\n\nconst runQueriesForPathnames = pathnames => {\n  const staticQueries = pathnames.filter(p => p.slice(0, 4) === `sq--`)\n  const pageQueries = pathnames.filter(p => p.slice(0, 4) !== `sq--`)\n  const state = store.getState()\n\n  staticQueries.forEach(id => {\n    const staticQueryComponent = store.getState().staticQueryComponents.get(id)\n    const queryJob: QueryJob = {\n      id: staticQueryComponent.hash,\n      hash: staticQueryComponent.hash,\n      jsonName: staticQueryComponent.jsonName,\n      query: staticQueryComponent.query,\n      componentPath: staticQueryComponent.componentPath,\n      context: { path: staticQueryComponent.jsonName },\n    }\n    queue.push(queryJob)\n  })\n\n  const pages = state.pages\n  let didNotQueueItems = true\n  pageQueries.forEach(id => {\n    const page = pages.get(id)\n    if (page) {\n      didNotQueueItems = false\n      queue.push(\n        ({\n          id: page.path,\n          jsonName: page.jsonName,\n          query: store.getState().components.get(page.componentPath).query,\n          isPage: true,\n          componentPath: page.componentPath,\n          context: {\n            ...page,\n            ...page.context,\n          },\n        }: QueryJob)\n      )\n    }\n  })\n\n  if (didNotQueueItems || !pathnames || pathnames.length === 0) {\n    return Promise.resolve()\n  }\n\n  return new Promise(resolve => {\n    const onDrain = () => {\n      queue.removeListener(`drain`, onDrain)\n      resolve()\n    }\n    queue.on(`drain`, onDrain)\n  })\n}\n\nconst findDirtyIds = actions => {\n  const state = store.getState()\n  const uniqDirties = _.uniq(\n    actions.reduce((dirtyIds, action) => {\n      const node = action.payload\n\n      if (!node || !node.id || !node.internal.type) return dirtyIds\n\n      // Find components that depend on this node so are now dirty.\n      dirtyIds = dirtyIds.concat(state.componentDataDependencies.nodes[node.id])\n\n      // Find connections that depend on this node so are now invalid.\n      dirtyIds = dirtyIds.concat(\n        state.componentDataDependencies.connections[node.internal.type]\n      )\n\n      return _.compact(dirtyIds)\n    }, [])\n  )\n  return uniqDirties\n}\n"],"file":"page-query-runner.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/pages-writer.js b/node_modules/gatsby/dist/internal-plugins/query-runner/pages-writer.js
deleted file mode 100644
index 95d724d..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/pages-writer.js
+++ /dev/null
@@ -1,156 +0,0 @@
-"use strict";
-
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
-var _path = require("../../utils/path");
-
-const _ = require(`lodash`);
-
-const fs = require(`fs-extra`);
-
-const crypto = require(`crypto`);
-
-const _require = require(`../../redux/`),
-      store = _require.store,
-      emitter = _require.emitter;
-
-let lastHash = null; // Write out pages information.
-
-const writePages =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* () {
-    bootstrapFinished = true;
-
-    let _store$getState = store.getState(),
-        program = _store$getState.program,
-        jsonDataPaths = _store$getState.jsonDataPaths,
-        pages = _store$getState.pages;
-
-    pages = [...pages.values()];
-    const pagesComponentDependencies = {}; // Write out pages.json
-
-    let pagesData = [];
-    pages.forEach(({
-      path,
-      matchPath,
-      componentChunkName,
-      jsonName
-    }) => {
-      const pageComponentsChunkNames = {
-        componentChunkName
-      };
-
-      if (program._[0] === `develop`) {
-        pagesComponentDependencies[path] = pageComponentsChunkNames;
-      }
-
-      pagesData.push(Object.assign({}, pageComponentsChunkNames, {
-        jsonName,
-        path,
-        matchPath
-      }));
-    });
-    pagesData = _(pagesData) // Ensure pages keep the same sorting through builds.
-    // Pages without matchPath come first, then pages with matchPath,
-    // where more specific patterns come before less specific patterns.
-    // This ensures explicit routes will match before general.
-    // Specificity is inferred from number of path segments.
-    .sortBy(p => `${p.matchPath ? 9999 - p.matchPath.split(`/`).length : `0000`}${p.path}`).value();
-    const newHash = crypto.createHash(`md5`).update(JSON.stringify(pagesComponentDependencies)).digest(`hex`);
-
-    if (newHash === lastHash) {
-      // components didn't change - no need to rewrite pages.json
-      return Promise.resolve();
-    }
-
-    lastHash = newHash; // Get list of components, and json files.
-
-    let components = [];
-    pages.forEach(p => {
-      components.push({
-        componentChunkName: p.componentChunkName,
-        component: p.component
-      });
-    });
-    components = _.uniqBy(components, c => c.componentChunkName); // Create file with sync requires of components/json files.
-
-    let syncRequires = `const { hot } = require("react-hot-loader/root")
-
-// prefer default export if available
-const preferDefault = m => m && m.default || m
-\n\n`;
-    syncRequires += `exports.components = {\n${components.map(c => `  "${c.componentChunkName}": hot(preferDefault(require("${(0, _path.joinPath)(c.component)}")))`).join(`,\n`)}
-}\n\n`; // Create file with async requires of components/json files.
-
-    let asyncRequires = `// prefer default export if available
-const preferDefault = m => m && m.default || m
-\n`;
-    asyncRequires += `exports.components = {\n${components.map(c => `  "${c.componentChunkName}": () => import("${(0, _path.joinPath)(c.component)}" /* webpackChunkName: "${c.componentChunkName}" */)`).join(`,\n`)}
-}\n\n`;
-    asyncRequires += `exports.data = () => import(/* webpackChunkName: "pages-manifest" */ "${(0, _path.joinPath)(program.directory, `.cache`, `data.json`)}")\n\n`;
-
-    const writeAndMove = (file, data) => {
-      const destination = (0, _path.joinPath)(program.directory, `.cache`, file);
-      const tmp = `${destination}.${Date.now()}`;
-      return fs.writeFile(tmp, data).then(() => fs.move(tmp, destination, {
-        overwrite: true
-      }));
-    };
-
-    const result = yield Promise.all([writeAndMove(`pages.json`, JSON.stringify(pagesData, null, 4)), writeAndMove(`sync-requires.js`, syncRequires), writeAndMove(`async-requires.js`, asyncRequires), writeAndMove(`data.json`, JSON.stringify({
-      pages: pagesData,
-      // Sort dataPaths by keys to ensure keeping the same
-      // sorting through builds
-      dataPaths: _(jsonDataPaths).toPairs().sortBy(0).fromPairs().value()
-    }))]);
-    return result;
-  });
-
-  return function writePages() {
-    return _ref.apply(this, arguments);
-  };
-}();
-
-exports.writePages = writePages;
-
-const resetLastHash = () => {
-  lastHash = null;
-};
-
-exports.resetLastHash = resetLastHash;
-let bootstrapFinished = false;
-
-const debouncedWritePages = _.debounce(() => {
-  // Don't write pages again until bootstrap has finished.
-  if (bootstrapFinished) {
-    writePages();
-  }
-}, 500, {
-  leading: true
-});
-
-emitter.on(`CREATE_PAGE`, () => {
-  // Ignore CREATE_PAGE until bootstrap is finished
-  // as this is called many many times during bootstrap and
-  // we can ignore them until CREATE_PAGE_END is called.
-  //
-  // After bootstrap, we need to listen for this as stateful page
-  // creators e.g. the plugin "gatsby-plugin-page-creator"
-  // calls createPage directly so CREATE_PAGE_END won't get fired.
-  if (bootstrapFinished) {
-    debouncedWritePages();
-  }
-});
-emitter.on(`CREATE_PAGE_END`, () => {
-  debouncedWritePages();
-});
-emitter.on(`DELETE_PAGE`, () => {
-  debouncedWritePages();
-});
-emitter.on(`DELETE_PAGE_BY_PATH`, () => {
-  debouncedWritePages();
-});
-//# sourceMappingURL=pages-writer.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/pages-writer.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/pages-writer.js.map
deleted file mode 100644
index 1bbc2df..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/pages-writer.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/pages-writer.js"],"names":["_","require","fs","crypto","store","emitter","lastHash","writePages","bootstrapFinished","getState","program","jsonDataPaths","pages","values","pagesComponentDependencies","pagesData","forEach","path","matchPath","componentChunkName","jsonName","pageComponentsChunkNames","push","sortBy","p","split","length","value","newHash","createHash","update","JSON","stringify","digest","Promise","resolve","components","component","uniqBy","c","syncRequires","map","join","asyncRequires","directory","writeAndMove","file","data","destination","tmp","Date","now","writeFile","then","move","overwrite","result","all","dataPaths","toPairs","fromPairs","exports","resetLastHash","debouncedWritePages","debounce","leading","on"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst fs = require(`fs-extra`)\nconst crypto = require(`crypto`)\n\nconst { store, emitter } = require(`../../redux/`)\n\nimport { joinPath } from \"../../utils/path\"\n\nlet lastHash = null\n\n// Write out pages information.\nconst writePages = async () => {\n  bootstrapFinished = true\n  let { program, jsonDataPaths, pages } = store.getState()\n  pages = [...pages.values()]\n\n  const pagesComponentDependencies = {}\n\n  // Write out pages.json\n  let pagesData = []\n  pages.forEach(({ path, matchPath, componentChunkName, jsonName }) => {\n    const pageComponentsChunkNames = {\n      componentChunkName,\n    }\n\n    if (program._[0] === `develop`) {\n      pagesComponentDependencies[path] = pageComponentsChunkNames\n    }\n\n    pagesData.push({\n      ...pageComponentsChunkNames,\n      jsonName,\n      path,\n      matchPath,\n    })\n  })\n\n  pagesData = _(pagesData)\n    // Ensure pages keep the same sorting through builds.\n    // Pages without matchPath come first, then pages with matchPath,\n    // where more specific patterns come before less specific patterns.\n    // This ensures explicit routes will match before general.\n    // Specificity is inferred from number of path segments.\n    .sortBy(\n      p =>\n        `${p.matchPath ? 9999 - p.matchPath.split(`/`).length : `0000`}${\n          p.path\n        }`\n    )\n    .value()\n  const newHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(pagesComponentDependencies))\n    .digest(`hex`)\n\n  if (newHash === lastHash) {\n    // components didn't change - no need to rewrite pages.json\n    return Promise.resolve()\n  }\n\n  lastHash = newHash\n\n  // Get list of components, and json files.\n  let components = []\n  pages.forEach(p => {\n    components.push({\n      componentChunkName: p.componentChunkName,\n      component: p.component,\n    })\n  })\n\n  components = _.uniqBy(components, c => c.componentChunkName)\n\n  // Create file with sync requires of components/json files.\n  let syncRequires = `const { hot } = require(\"react-hot-loader/root\")\n\n// prefer default export if available\nconst preferDefault = m => m && m.default || m\n\\n\\n`\n  syncRequires += `exports.components = {\\n${components\n    .map(\n      c =>\n        `  \"${c.componentChunkName}\": hot(preferDefault(require(\"${joinPath(\n          c.component\n        )}\")))`\n    )\n    .join(`,\\n`)}\n}\\n\\n`\n\n  // Create file with async requires of components/json files.\n  let asyncRequires = `// prefer default export if available\nconst preferDefault = m => m && m.default || m\n\\n`\n  asyncRequires += `exports.components = {\\n${components\n    .map(\n      c =>\n        `  \"${c.componentChunkName}\": () => import(\"${joinPath(\n          c.component\n        )}\" /* webpackChunkName: \"${c.componentChunkName}\" */)`\n    )\n    .join(`,\\n`)}\n}\\n\\n`\n\n  asyncRequires += `exports.data = () => import(/* webpackChunkName: \"pages-manifest\" */ \"${joinPath(\n    program.directory,\n    `.cache`,\n    `data.json`\n  )}\")\\n\\n`\n\n  const writeAndMove = (file, data) => {\n    const destination = joinPath(program.directory, `.cache`, file)\n    const tmp = `${destination}.${Date.now()}`\n    return fs\n      .writeFile(tmp, data)\n      .then(() => fs.move(tmp, destination, { overwrite: true }))\n  }\n\n  const result = await Promise.all([\n    writeAndMove(`pages.json`, JSON.stringify(pagesData, null, 4)),\n    writeAndMove(`sync-requires.js`, syncRequires),\n    writeAndMove(`async-requires.js`, asyncRequires),\n    writeAndMove(\n      `data.json`,\n      JSON.stringify({\n        pages: pagesData,\n        // Sort dataPaths by keys to ensure keeping the same\n        // sorting through builds\n        dataPaths: _(jsonDataPaths)\n          .toPairs()\n          .sortBy(0)\n          .fromPairs()\n          .value(),\n      })\n    ),\n  ])\n\n  return result\n}\n\nexports.writePages = writePages\n\nconst resetLastHash = () => {\n  lastHash = null\n}\n\nexports.resetLastHash = resetLastHash\n\nlet bootstrapFinished = false\nconst debouncedWritePages = _.debounce(\n  () => {\n    // Don't write pages again until bootstrap has finished.\n    if (bootstrapFinished) {\n      writePages()\n    }\n  },\n  500,\n  { leading: true }\n)\nemitter.on(`CREATE_PAGE`, () => {\n  // Ignore CREATE_PAGE until bootstrap is finished\n  // as this is called many many times during bootstrap and\n  // we can ignore them until CREATE_PAGE_END is called.\n  //\n  // After bootstrap, we need to listen for this as stateful page\n  // creators e.g. the plugin \"gatsby-plugin-page-creator\"\n  // calls createPage directly so CREATE_PAGE_END won't get fired.\n  if (bootstrapFinished) {\n    debouncedWritePages()\n  }\n})\n\nemitter.on(`CREATE_PAGE_END`, () => {\n  debouncedWritePages()\n})\nemitter.on(`DELETE_PAGE`, () => {\n  debouncedWritePages()\n})\nemitter.on(`DELETE_PAGE_BY_PATH`, () => {\n  debouncedWritePages()\n})\n"],"file":"pages-writer.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/query-compiler.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/query-compiler.js.map
deleted file mode 100644
index db23d3a..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-compiler.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-compiler.js"],"names":["normalize","require","_","boundActionCreators","websocketManager","printTransforms","IRTransforms","ValuesOfCorrectTypeRule","FragmentsOnCompositeTypesRule","KnownTypeNamesRule","LoneAnonymousOperationRule","PossibleFragmentSpreadsRule","ScalarLeafsRule","VariablesAreInputTypesRule","VariablesInAllowedPositionRule","validationRules","lastRunHadErrors","overlayErrorID","resolveThemes","themes","reduce","merged","theme","push","themeDir","Runner","constructor","base","additional","schema","reportError","message","queryErrorMessage","report","format","red","panicOnBuild","process","env","gatsby_executing_command","emitError","compileAll","nodes","parseEverything","write","filesRegex","path","join","files","concat","map","folderPath","glob","sync","nodir","filter","d","match","Array","from","store","getState","components","keys","c","uniq","parser","FileParser","parseFiles","compiledNodes","Map","namePathMap","nameDefMap","nameErrorMap","documents","entries","filePath","doc","errors","length","queryExtractionGraphQLError","componentPath","definitions","forEach","def","name","value","set","compilerContext","GraphQLCompilerContext","addAll","ASTConvert","convertASTDocuments","RelayParser","transform","bind","error","formattedMessage","docName","codeBlock","get","printContext","slice","ctx","node","kind","has","otherNode","text","getRoot","GraphQLIRPrinter","print","query","originalText","isHook","isStaticQuery","hash","jsonName","kebabCase","relative","program","directory","NODE_ENV","useContext","compile","runner","queries"],"mappings":"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","sourcesContent":["// @flow\nimport path from \"path\"\nconst normalize = require(`normalize-path`)\nimport glob from \"glob\"\n\nimport { validate } from \"graphql\"\nimport { IRTransforms } from \"@gatsbyjs/relay-compiler\"\nimport RelayParser from \"@gatsbyjs/relay-compiler/lib/RelayParser\"\nimport ASTConvert from \"@gatsbyjs/relay-compiler/lib/ASTConvert\"\nimport GraphQLCompilerContext from \"@gatsbyjs/relay-compiler/lib/GraphQLCompilerContext\"\nimport filterContextForNode from \"@gatsbyjs/relay-compiler/lib/filterContextForNode\"\nconst _ = require(`lodash`)\n\nimport { store } from \"../../redux\"\nconst { boundActionCreators } = require(`../../redux/actions`)\nimport FileParser from \"./file-parser\"\nimport GraphQLIRPrinter from \"@gatsbyjs/relay-compiler/lib/GraphQLIRPrinter\"\nimport {\n  graphqlError,\n  graphqlValidationError,\n  multipleRootQueriesError,\n} from \"./graphql-errors\"\nimport report from \"gatsby-cli/lib/reporter\"\nconst websocketManager = require(`../../utils/websocket-manager`)\n\nimport type { DocumentNode, GraphQLSchema } from \"graphql\"\n\nconst { printTransforms } = IRTransforms\n\nconst {\n  ValuesOfCorrectTypeRule,\n  FragmentsOnCompositeTypesRule,\n  KnownTypeNamesRule,\n  LoneAnonymousOperationRule,\n  PossibleFragmentSpreadsRule,\n  ScalarLeafsRule,\n  VariablesAreInputTypesRule,\n  VariablesInAllowedPositionRule,\n} = require(`graphql`)\n\ntype RootQuery = {\n  name: string,\n  path: string,\n  text: string,\n  originalText: string,\n  isStaticQuery: boolean,\n  hash: string,\n}\n\ntype Queries = Map<string, RootQuery>\n\nconst validationRules = [\n  ValuesOfCorrectTypeRule,\n  FragmentsOnCompositeTypesRule,\n  KnownTypeNamesRule,\n  LoneAnonymousOperationRule,\n  PossibleFragmentSpreadsRule,\n  ScalarLeafsRule,\n  VariablesAreInputTypesRule,\n  VariablesInAllowedPositionRule,\n]\n\nlet lastRunHadErrors = null\nconst overlayErrorID = `graphql-compiler`\n\nconst resolveThemes = (themes = []) =>\n  themes.reduce((merged, theme) => {\n    merged.push(theme.themeDir)\n    return merged\n  }, [])\n\nclass Runner {\n  base: string\n  additional: string[]\n  schema: GraphQLSchema\n  errors: string[]\n  fragmentsDir: string\n\n  constructor(base: string, additional: string[], schema: GraphQLSchema) {\n    this.base = base\n    this.additional = additional\n    this.schema = schema\n  }\n\n  reportError(message) {\n    const queryErrorMessage = `${report.format.red(`GraphQL Error`)} ${message}`\n    report.panicOnBuild(queryErrorMessage)\n    if (process.env.gatsby_executing_command === `develop`) {\n      websocketManager.emitError(overlayErrorID, queryErrorMessage)\n      lastRunHadErrors = true\n    }\n  }\n\n  async compileAll() {\n    let nodes = await this.parseEverything()\n    return await this.write(nodes)\n  }\n\n  async parseEverything() {\n    const filesRegex = path.join(`/**`, `*.+(t|j)s?(x)`)\n    let files = [\n      path.join(this.base, `src`),\n      path.join(this.base, `.cache`, `fragments`),\n    ]\n      .concat(this.additional.map(additional => path.join(additional, `src`)))\n      .reduce(\n        (merged, folderPath) =>\n          merged.concat(\n            glob.sync(path.join(folderPath, filesRegex), {\n              nodir: true,\n            })\n          ),\n        []\n      )\n    files = files.filter(d => !d.match(/\\.d\\.ts$/))\n    files = files.map(normalize)\n\n    // Ensure all page components added as they're not necessarily in the\n    // pages directory e.g. a plugin could add a page component.  Plugins\n    // *should* copy their components (if they add a query) to .cache so that\n    // our babel plugin to remove the query on building is active (we don't\n    // run babel on code in node_modules). Otherwise the component will throw\n    // an error in the browser of \"graphql is not defined\".\n    files = files.concat(\n      Array.from(store.getState().components.keys(), c => normalize(c))\n    )\n    files = _.uniq(files)\n\n    let parser = new FileParser()\n\n    return await parser.parseFiles(files)\n  }\n\n  async write(nodes: Map<string, DocumentNode>): Promise<Queries> {\n    const compiledNodes: Queries = new Map()\n    const namePathMap = new Map()\n    const nameDefMap = new Map()\n    const nameErrorMap = new Map()\n    const documents = []\n\n    for (let [filePath, doc] of nodes.entries()) {\n      let errors = validate(this.schema, doc, validationRules)\n\n      if (errors && errors.length) {\n        this.reportError(graphqlValidationError(errors, filePath))\n        boundActionCreators.queryExtractionGraphQLError({\n          componentPath: filePath,\n        })\n        return compiledNodes\n      }\n\n      documents.push(doc)\n      doc.definitions.forEach((def: any) => {\n        const name: string = def.name.value\n        namePathMap.set(name, filePath)\n        nameDefMap.set(name, def)\n      })\n    }\n\n    let compilerContext = new GraphQLCompilerContext(this.schema)\n    try {\n      compilerContext = compilerContext.addAll(\n        ASTConvert.convertASTDocuments(\n          this.schema,\n          documents,\n          validationRules,\n          RelayParser.transform.bind(RelayParser)\n        )\n      )\n    } catch (error) {\n      const { formattedMessage, docName, message, codeBlock } = graphqlError(\n        namePathMap,\n        nameDefMap,\n        error\n      )\n      nameErrorMap.set(docName, { formattedMessage, message, codeBlock })\n      boundActionCreators.queryExtractionGraphQLError({\n        componentPath: namePathMap.get(docName),\n        error: formattedMessage,\n      })\n      this.reportError(formattedMessage)\n      return false\n    }\n\n    // relay-compiler v1.5.0 added \"StripUnusedVariablesTransform\" to\n    // printTransforms. Unfortunately it currently doesn't detect variables\n    // in input objects widely used in gatsby, and therefore removing\n    // variable declaration from queries.\n    // As a temporary workaround remove that transform by slicing printTransforms.\n    const printContext = printTransforms\n      .slice(0, -1)\n      .reduce((ctx, transform) => transform(ctx, this.schema), compilerContext)\n\n    compilerContext.documents().forEach((node: { name: string }) => {\n      if (node.kind !== `Root`) return\n\n      const { name } = node\n      let filePath = namePathMap.get(name) || ``\n\n      if (compiledNodes.has(filePath)) {\n        let otherNode = compiledNodes.get(filePath)\n        this.reportError(\n          multipleRootQueriesError(\n            filePath,\n            nameDefMap.get(name),\n            otherNode && nameDefMap.get(otherNode.name)\n          )\n        )\n        boundActionCreators.queryExtractionGraphQLError({\n          componentPath: filePath,\n        })\n        return\n      }\n\n      let text = filterContextForNode(printContext.getRoot(name), printContext)\n        .documents()\n        .map(GraphQLIRPrinter.print)\n        .join(`\\n`)\n\n      const query = {\n        name,\n        text,\n        originalText: nameDefMap.get(name).text,\n        path: filePath,\n        isHook: nameDefMap.get(name).isHook,\n        isStaticQuery: nameDefMap.get(name).isStaticQuery,\n        hash: nameDefMap.get(name).hash,\n      }\n\n      if (query.isStaticQuery) {\n        query.jsonName =\n          `sq--` +\n          _.kebabCase(\n            `${path.relative(store.getState().program.directory, filePath)}`\n          )\n      }\n\n      if (\n        query.isHook &&\n        process.env.NODE_ENV === `production` &&\n        typeof require(`react`).useContext !== `function`\n      ) {\n        report.panicOnBuild(\n          `You're likely using a version of React that doesn't support Hooks\\n` +\n            `Please update React and ReactDOM to 16.8.0 or later to use the useStaticQuery hook.`\n        )\n      }\n\n      compiledNodes.set(filePath, query)\n    })\n\n    if (\n      process.env.gatsby_executing_command === `develop` &&\n      lastRunHadErrors\n    ) {\n      websocketManager.emitError(overlayErrorID, null)\n      lastRunHadErrors = false\n    }\n\n    return compiledNodes\n  }\n}\nexport { Runner, resolveThemes }\n\nexport default async function compile(): Promise<Map<string, RootQuery>> {\n  // TODO: swap plugins to themes\n  const { program, schema, themes } = store.getState()\n\n  const runner = new Runner(\n    program.directory,\n    resolveThemes(themes.themes),\n    schema\n  )\n\n  const queries = await runner.compileAll()\n\n  return queries\n}\n"],"file":"query-compiler.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/query-queue.js b/node_modules/gatsby/dist/internal-plugins/query-runner/query-queue.js
deleted file mode 100644
index fe0c002..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-queue.js
+++ /dev/null
@@ -1,103 +0,0 @@
-"use strict";
-
-const Queue = require(`better-queue`);
-
-const queryRunner = require(`./query-runner`);
-
-const _require = require(`../../redux`),
-      store = _require.store,
-      emitter = _require.emitter;
-
-const _require2 = require(`../../redux/actions`),
-      boundActionCreators = _require2.boundActionCreators;
-
-const websocketManager = require(`../../utils/websocket-manager`);
-
-const FastMemoryStore = require(`./better-queue-custom-store`);
-
-const processing = new Set();
-const waiting = new Map();
-const queueOptions = {
-  concurrent: 4,
-  // Merge duplicate jobs.
-  merge: (oldTask, newTask, cb) => {
-    cb(null, newTask);
-  },
-  priority: (job, cb) => {
-    const activePaths = Array.from(websocketManager.activePaths.values());
-
-    if (job.id && activePaths.includes(job.id)) {
-      cb(null, 10);
-    } else {
-      cb(null, 1);
-    }
-  },
-  // Filter out new query jobs if that query is already running.  When the
-  // query finshes, it checks the waiting map and pushes another job to
-  // make sure all the user changes are captured.
-  filter: (job, cb) => {
-    if (processing.has(job.id)) {
-      waiting.set(job.id, job);
-      cb(`already running`);
-    } else {
-      cb(null, job);
-    }
-  },
-  store: FastMemoryStore() // During builds we don't need all the filtering, etc. so we
-  // remove them to speed up queries
-
-};
-
-if (process.env.gatsby_executing_command === `build`) {
-  delete queueOptions.filter;
-  delete queueOptions.priority;
-  delete queueOptions.merge;
-}
-
-const queue = new Queue((plObj, callback) => {
-  const state = store.getState();
-  processing.add(plObj.id);
-  return queryRunner(plObj, state.components[plObj.component]).catch(e => console.log(`Error running queryRunner`, e)).then(result => {
-    processing.delete(plObj.id);
-
-    if (waiting.has(plObj.id)) {
-      queue.push(waiting.get(plObj.id));
-      waiting.delete(plObj.id);
-    } // Send event that the page query finished.
-
-
-    boundActionCreators.pageQueryRun({
-      path: plObj.id,
-      componentPath: plObj.componentPath,
-      isPage: plObj.isPage
-    });
-    return callback(null, result);
-  }, error => callback(error));
-}, queueOptions); // HACKY!!! TODO: REMOVE IN NEXT REFACTOR
-// We start paused until we call `runInitialQueries` during bootstrap.
-
-let isBootstrapping = true;
-queue.pause();
-emitter.on(`START_QUERY_QUEUE`, () => {
-  isBootstrapping = false;
-  queue.resume();
-}); // END HACKY
-// Pause running queries when new nodes are added (processing starts).
-
-emitter.on(`CREATE_NODE`, () => {
-  queue.pause();
-}); // Resume running queries as soon as the api queue is empty.
-
-emitter.on(`API_RUNNING_QUEUE_EMPTY`, () => {
-  if (!isBootstrapping) {
-    queue.resume();
-  }
-});
-queue.on(`drain`, () => {
-  emitter.emit(`QUERY_QUEUE_DRAINED`);
-});
-queue.on(`task_queued`, () => {
-  emitter.emit(`QUERY_ENQUEUED`);
-});
-module.exports = queue;
-//# sourceMappingURL=query-queue.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/query-queue.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/query-queue.js.map
deleted file mode 100644
index 8bf8dbe..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-queue.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-queue.js"],"names":["Queue","require","queryRunner","store","emitter","boundActionCreators","websocketManager","FastMemoryStore","processing","Set","waiting","Map","queueOptions","concurrent","merge","oldTask","newTask","cb","priority","job","activePaths","Array","from","values","id","includes","filter","has","set","process","env","gatsby_executing_command","queue","plObj","callback","state","getState","add","components","component","catch","e","console","log","then","result","delete","push","get","pageQueryRun","path","componentPath","isPage","error","isBootstrapping","pause","on","resume","emit","module","exports"],"mappings":"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","sourcesContent":["const Queue = require(`better-queue`)\n\nconst queryRunner = require(`./query-runner`)\nconst { store, emitter } = require(`../../redux`)\nconst { boundActionCreators } = require(`../../redux/actions`)\nconst websocketManager = require(`../../utils/websocket-manager`)\nconst FastMemoryStore = require(`./better-queue-custom-store`)\n\nconst processing = new Set()\nconst waiting = new Map()\n\nconst queueOptions = {\n  concurrent: 4,\n  // Merge duplicate jobs.\n  merge: (oldTask, newTask, cb) => {\n    cb(null, newTask)\n  },\n  priority: (job, cb) => {\n    const activePaths = Array.from(websocketManager.activePaths.values())\n    if (job.id && activePaths.includes(job.id)) {\n      cb(null, 10)\n    } else {\n      cb(null, 1)\n    }\n  },\n  // Filter out new query jobs if that query is already running.  When the\n  // query finshes, it checks the waiting map and pushes another job to\n  // make sure all the user changes are captured.\n  filter: (job, cb) => {\n    if (processing.has(job.id)) {\n      waiting.set(job.id, job)\n      cb(`already running`)\n    } else {\n      cb(null, job)\n    }\n  },\n  store: FastMemoryStore(),\n}\n\n// During builds we don't need all the filtering, etc. so we\n// remove them to speed up queries\nif (process.env.gatsby_executing_command === `build`) {\n  delete queueOptions.filter\n  delete queueOptions.priority\n  delete queueOptions.merge\n}\n\nconst queue = new Queue((plObj, callback) => {\n  const state = store.getState()\n  processing.add(plObj.id)\n\n  return queryRunner(plObj, state.components[plObj.component])\n    .catch(e => console.log(`Error running queryRunner`, e))\n    .then(\n      result => {\n        processing.delete(plObj.id)\n        if (waiting.has(plObj.id)) {\n          queue.push(waiting.get(plObj.id))\n          waiting.delete(plObj.id)\n        }\n\n        // Send event that the page query finished.\n        boundActionCreators.pageQueryRun({\n          path: plObj.id,\n          componentPath: plObj.componentPath,\n          isPage: plObj.isPage,\n        })\n\n        return callback(null, result)\n      },\n      error => callback(error)\n    )\n}, queueOptions)\n\n// HACKY!!! TODO: REMOVE IN NEXT REFACTOR\n// We start paused until we call `runInitialQueries` during bootstrap.\nlet isBootstrapping = true\nqueue.pause()\n\nemitter.on(`START_QUERY_QUEUE`, () => {\n  isBootstrapping = false\n  queue.resume()\n})\n// END HACKY\n\n// Pause running queries when new nodes are added (processing starts).\nemitter.on(`CREATE_NODE`, () => {\n  queue.pause()\n})\n\n// Resume running queries as soon as the api queue is empty.\nemitter.on(`API_RUNNING_QUEUE_EMPTY`, () => {\n  if (!isBootstrapping) {\n    queue.resume()\n  }\n})\n\nqueue.on(`drain`, () => {\n  emitter.emit(`QUERY_QUEUE_DRAINED`)\n})\n\nqueue.on(`task_queued`, () => {\n  emitter.emit(`QUERY_ENQUEUED`)\n})\n\nmodule.exports = queue\n"],"file":"query-queue.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/query-runner.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/query-runner.js.map
deleted file mode 100644
index 34ea3ee..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-runner.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-runner.js"],"names":["fs","require","report","websocketManager","path","store","withResolverContext","generatePathChunkName","formatErrorDetails","mod","resultHashes","module","exports","queryJob","component","getState","schema","program","graphql","query","context","result","errors","errorDetails","Map","set","isPage","JSON","stringify","pluginCreatorId","panicOnBuild","componentPath","Object","assign","pageContext","jsonName","internalComponentName","componentChunkName","updatedAt","pluginCreator___NODE","resultJSON","resultHash","createHash","update","digest","replace","dataPath","hash","process","env","gatsby_executing_command","emitPageData","id","emitStaticQueryData","modInt","toString","resultPath","join","directory","outputFile","dispatch","type","payload","key","value"],"mappings":"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","sourcesContent":["// @flow\n\nimport { graphql as graphqlFunction } from \"graphql\"\nconst fs = require(`fs-extra`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst websocketManager = require(`../../utils/websocket-manager`)\n\nconst path = require(`path`)\nconst { store } = require(`../../redux`)\nconst withResolverContext = require(`../../schema/context`)\nconst { generatePathChunkName } = require(`../../utils/js-chunk-names`)\nconst { formatErrorDetails } = require(`./utils`)\nconst mod = require(`hash-mod`)(999)\n\nconst resultHashes = {}\n\ntype QueryJob = {\n  id: string,\n  hash?: string,\n  jsonName: string,\n  query: string,\n  componentPath: string,\n  context: Object,\n  isPage: Boolean,\n}\n\n// Run query\nmodule.exports = async (queryJob: QueryJob, component: Any) => {\n  const { schema, program } = store.getState()\n\n  const graphql = (query, context) =>\n    graphqlFunction(\n      schema,\n      query,\n      context,\n      withResolverContext(context, schema),\n      context\n    )\n\n  // Run query\n  let result\n  // Nothing to do if the query doesn't exist.\n  if (!queryJob.query || queryJob.query === ``) {\n    result = {}\n  } else {\n    result = await graphql(queryJob.query, queryJob.context)\n  }\n\n  // If there's a graphql error then log the error. If we're building, also\n  // quit.\n  if (result && result.errors) {\n    const errorDetails = new Map()\n    errorDetails.set(`Errors`, result.errors || [])\n    if (queryJob.isPage) {\n      errorDetails.set(`URL path`, queryJob.context.path)\n      errorDetails.set(\n        `Context`,\n        JSON.stringify(queryJob.context.context, null, 2)\n      )\n    }\n    errorDetails.set(`Plugin`, queryJob.pluginCreatorId || `none`)\n    errorDetails.set(`Query`, queryJob.query)\n\n    report.panicOnBuild(`\nThe GraphQL query from ${queryJob.componentPath} failed.\n\n${formatErrorDetails(errorDetails)}`)\n  }\n\n  // Add the page context onto the results.\n  if (queryJob && queryJob.isPage) {\n    result[`pageContext`] = Object.assign({}, queryJob.context)\n  }\n\n  // Delete internal data from pageContext\n  if (result.pageContext) {\n    delete result.pageContext.jsonName\n    delete result.pageContext.path\n    delete result.pageContext.internalComponentName\n    delete result.pageContext.component\n    delete result.pageContext.componentChunkName\n    delete result.pageContext.updatedAt\n    delete result.pageContext.pluginCreator___NODE\n    delete result.pageContext.pluginCreatorId\n    delete result.pageContext.componentPath\n    delete result.pageContext.context\n  }\n\n  const resultJSON = JSON.stringify(result)\n  const resultHash = require(`crypto`)\n    .createHash(`sha1`)\n    .update(resultJSON)\n    .digest(`base64`)\n    // Remove potentially unsafe characters. This increases chances of collisions\n    // slightly but it should still be very safe + we get a shorter\n    // url vs hex.\n    .replace(/[^a-zA-Z0-9-_]/g, ``)\n\n  let dataPath\n  if (queryJob.isPage) {\n    dataPath = `${generatePathChunkName(queryJob.jsonName)}-${resultHash}`\n  } else {\n    dataPath = queryJob.hash\n  }\n\n  if (process.env.gatsby_executing_command === `develop`) {\n    if (queryJob.isPage) {\n      websocketManager.emitPageData({\n        result,\n        id: queryJob.id,\n      })\n    } else {\n      websocketManager.emitStaticQueryData({\n        result,\n        id: queryJob.id,\n      })\n    }\n  }\n\n  if (resultHashes[queryJob.id] !== resultHash) {\n    resultHashes[queryJob.id] = resultHash\n    let modInt = ``\n    // We leave StaticQuery results at public/static/d\n    // as the babel plugin has that path hard-coded\n    // for importing static query results.\n    if (queryJob.isPage) {\n      modInt = mod(dataPath).toString()\n    }\n\n    // Always write file to public/static/d/ folder.\n    const resultPath = path.join(\n      program.directory,\n      `public`,\n      `static`,\n      `d`,\n      modInt,\n      `${dataPath}.json`\n    )\n\n    if (queryJob.isPage) {\n      dataPath = `${modInt}/${dataPath}`\n    }\n\n    await fs.outputFile(resultPath, resultJSON)\n\n    store.dispatch({\n      type: `SET_JSON_DATA_PATH`,\n      payload: {\n        key: queryJob.jsonName,\n        value: dataPath,\n      },\n    })\n\n    return result\n  }\n\n  return result\n}\n"],"file":"query-runner.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/query-watcher.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/query-watcher.js.map
deleted file mode 100644
index 50e7cb5..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-watcher.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-watcher.js"],"names":["_","require","chokidar","path","slash","store","emitter","boundActionCreators","queryCompiler","default","report","queueQueryForPathname","runQueuedQueries","runQueuedActions","runQueries","debug","getQueriesSnapshot","state","getState","snapshot","components","Map","staticQueryComponents","handleComponentsWithRemovedQueries","queries","forEach","c","query","has","componentPath","dispatch","type","payload","jsonName","deleteComponentsDependencies","handleQuery","component","isStaticQuery","oldQuery","get","isNewQuery","hash","text","replaceStaticQuery","name","id","updateStateAndRunQueries","isFirstRun","then","size","queryExtracted","queriesWillNotRun","queryWillRun","watchComponent","warn","log","stripIndent","clearInactiveComponents","pages","activeTemplates","Set","page","add","exports","extractQueries","process","env","NODE_ENV","watch","program","directory","queueQueriesForPageComponent","getPagesForComponent","map","p","runQueryForPage","values","filter","filesToWatch","watcher","debounceCompile","debounce","rootDir","join","on","filePath","gatsby_executing_command","bootstrapFinished","action","otherPageWithTemplateExists"],"mappings":"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","sourcesContent":["/** *\n * Jobs of this module\n * - Maintain the list of components in the Redux store. So monitor new components\n *   and add/remove components.\n * - Watch components for query changes and extract these and update the store.\n * - Ensure all page queries are run as part of bootstrap and report back when\n *   this is done\n * - Whenever a query changes, re-run all pages that rely on this query.\n ***/\n\nconst _ = require(`lodash`)\nconst chokidar = require(`chokidar`)\nconst path = require(`path`)\nconst slash = require(`slash`)\n\nconst { store, emitter } = require(`../../redux/`)\nconst { boundActionCreators } = require(`../../redux/actions`)\nconst queryCompiler = require(`./query-compiler`).default\nconst report = require(`gatsby-cli/lib/reporter`)\nconst {\n  queueQueryForPathname,\n  runQueuedActions: runQueuedQueries,\n  runQueries,\n} = require(`./page-query-runner`)\nconst debug = require(`debug`)(`gatsby:query-watcher`)\n\nconst getQueriesSnapshot = () => {\n  const state = store.getState()\n\n  const snapshot = {\n    components: new Map(state.components),\n    staticQueryComponents: new Map(state.staticQueryComponents),\n  }\n\n  return snapshot\n}\n\nconst handleComponentsWithRemovedQueries = (\n  { components, staticQueryComponents },\n  queries\n) => {\n  // If a component had static query and it doesn't have it\n  // anymore - update the store\n  staticQueryComponents.forEach(c => {\n    if (c.query !== `` && !queries.has(c.componentPath)) {\n      debug(`Static query was removed from ${c.componentPath}`)\n      store.dispatch({\n        type: `REMOVE_STATIC_QUERY`,\n        payload: c.jsonName,\n      })\n      boundActionCreators.deleteComponentsDependencies([c.jsonName])\n    }\n  })\n}\n\nconst handleQuery = (\n  { components, staticQueryComponents },\n  query,\n  component\n) => {\n  // If this is a static query\n  // Add action / reducer + watch staticquery files\n  if (query.isStaticQuery) {\n    const oldQuery = staticQueryComponents.get(query.jsonName)\n    const isNewQuery = !oldQuery\n\n    // Compare query text because text is compiled query with any attached\n    // fragments and we want to rerun queries if fragments are edited.\n    // Compare hash because hash is used for identyfing query and\n    // passing data to component in development. Hash can change if user will\n    // format query text, but it doesn't mean that compiled text will change.\n    if (\n      isNewQuery ||\n      oldQuery.hash !== query.hash ||\n      oldQuery.text !== query.text\n    ) {\n      boundActionCreators.replaceStaticQuery({\n        name: query.name,\n        componentPath: query.path,\n        id: query.jsonName,\n        jsonName: query.jsonName,\n        query: query.text,\n        hash: query.hash,\n      })\n\n      debug(\n        `Static query in ${component} ${\n          isNewQuery ? `was added` : `has changed`\n        }.`\n      )\n\n      boundActionCreators.deleteComponentsDependencies([query.jsonName])\n      queueQueryForPathname(query.jsonName)\n    }\n    return true\n  }\n\n  return false\n}\n\nconst updateStateAndRunQueries = isFirstRun => {\n  const snapshot = getQueriesSnapshot()\n  return queryCompiler().then(queries => {\n    // If there's an error while extracting queries, the queryCompiler returns false\n    // or zero results.\n    // Yeah, should probably be an error but don't feel like threading the error\n    // all the way here.\n    if (!queries || queries.size === 0) {\n      return null\n    }\n    handleComponentsWithRemovedQueries(snapshot, queries)\n\n    // Run action for each component\n    const { components } = snapshot\n    components.forEach(c =>\n      boundActionCreators.queryExtracted({\n        componentPath: c.componentPath,\n        query: queries.get(c.componentPath)?.text || ``,\n      })\n    )\n\n    let queriesWillNotRun = false\n    queries.forEach((query, component) => {\n      const queryWillRun = handleQuery(snapshot, query, component)\n\n      if (queryWillRun) {\n        watchComponent(component)\n        // Check if this is a page component.\n        // If it is and this is our first run during bootstrap,\n        // show a warning about having a query in a non-page component.\n      } else if (isFirstRun && !snapshot.components.has(component)) {\n        report.warn(\n          `The GraphQL query in the non-page component \"${component}\" will not be run.`\n        )\n        queriesWillNotRun = true\n      }\n    })\n\n    if (queriesWillNotRun) {\n      report.log(report.stripIndent`\n\n        Exported queries are only executed for Page components. It's possible you're\n        trying to create pages in your gatsby-node.js and that's failing for some\n        reason.\n\n        If the failing component(s) is a regular component and not intended to be a page\n        component, you generally want to use a <StaticQuery> (https://gatsbyjs.org/docs/static-query)\n        instead of exporting a page query.\n\n        If you're more experienced with GraphQL, you can also export GraphQL\n        fragments from components and compose the fragments in the Page component\n        query and pass data down into the child component — http://graphql.org/learn/queries/#fragments\n\n      `)\n    }\n\n    runQueuedQueries()\n\n    return null\n  })\n}\n\n/**\n * Removes components templates that aren't used by any page from redux store.\n */\nconst clearInactiveComponents = () => {\n  const { components, pages } = store.getState()\n\n  const activeTemplates = new Set()\n  pages.forEach(page => {\n    // Set will guarantee uniqeness of entires\n    activeTemplates.add(slash(page.component))\n  })\n\n  components.forEach(component => {\n    if (!activeTemplates.has(component.componentPath)) {\n      debug(\n        `${\n          component.componentPath\n        } component was removed because it isn't used by any page`\n      )\n      store.dispatch({\n        type: `REMOVE_TEMPLATE_COMPONENT`,\n        payload: component,\n      })\n    }\n  })\n}\n\nexports.extractQueries = () => {\n  // Remove template components that point to not existing page templates.\n  // We need to do this, because components data is cached and there might\n  // be changes applied when development server isn't running. This is needed\n  // only in initial run, because during development state will be adjusted.\n  clearInactiveComponents()\n\n  return updateStateAndRunQueries(true).then(() => {\n    // During development start watching files to recompile & run\n    // queries on the fly.\n    if (process.env.NODE_ENV !== `production`) {\n      watch(store.getState().program.directory)\n    }\n  })\n}\n\nconst queueQueriesForPageComponent = componentPath => {\n  const pages = getPagesForComponent(componentPath)\n  // Remove page data dependencies before re-running queries because\n  // the changing of the query could have changed the data dependencies.\n  // Re-running the queries will add back data dependencies.\n  boundActionCreators.deleteComponentsDependencies(\n    pages.map(p => p.path || p.id)\n  )\n  pages.forEach(page => queueQueryForPathname(page.path))\n  runQueries()\n}\n\nconst runQueryForPage = path => {\n  queueQueryForPathname(path)\n  runQueries()\n}\n\nexports.queueQueriesForPageComponent = queueQueriesForPageComponent\nexports.runQueryForPage = runQueryForPage\n\nconst getPagesForComponent = componentPath => {\n  const state = store.getState()\n  return [...state.pages.values()].filter(\n    p => p.componentPath === componentPath\n  )\n}\n\nconst filesToWatch = new Set()\nlet watcher\nconst watchComponent = componentPath => {\n  // We don't start watching until mid-way through the bootstrap so ignore\n  // new components being added until then. This doesn't affect anything as\n  // when extractQueries is called from bootstrap, we make sure that all\n  // components are being watched.\n  if (\n    process.env.NODE_ENV !== `production` &&\n    !filesToWatch.has(componentPath)\n  ) {\n    filesToWatch.add(componentPath)\n    if (watcher) {\n      watcher.add(componentPath)\n    }\n  }\n}\n\nconst debounceCompile = _.debounce(() => {\n  updateStateAndRunQueries()\n}, 100)\n\nexports.watchComponent = watchComponent\nexports.debounceCompile = debounceCompile\n\nconst watch = rootDir => {\n  if (watcher) return\n\n  watcher = chokidar\n    .watch(slash(path.join(rootDir, `/src/**/*.{js,jsx,ts,tsx}`)))\n    .on(`change`, path => {\n      debounceCompile()\n    })\n\n  filesToWatch.forEach(filePath => watcher.add(filePath))\n}\n\nif (process.env.gatsby_executing_command === `develop`) {\n  let bootstrapFinished = false\n\n  emitter.on(`BOOTSTRAP_FINISHED`, () => {\n    bootstrapFinished = true\n  })\n\n  emitter.on(`DELETE_PAGE`, action => {\n    if (bootstrapFinished) {\n      const componentPath = slash(action.payload.component)\n      const { pages } = store.getState()\n      let otherPageWithTemplateExists = false\n      for (let page of pages.values()) {\n        if (slash(page.component) === componentPath) {\n          otherPageWithTemplateExists = true\n          break\n        }\n      }\n      if (!otherPageWithTemplateExists) {\n        store.dispatch({\n          type: `REMOVE_TEMPLATE_COMPONENT`,\n          payload: {\n            componentPath,\n          },\n        })\n      }\n    }\n  })\n}\n"],"file":"query-watcher.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/redirects-writer.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/redirects-writer.js.map
deleted file mode 100644
index afcecff..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/redirects-writer.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/redirects-writer.js"],"names":["lastHash","writeRedirects","bootstrapFinished","store","getState","program","redirects","browserRedirects","filter","r","redirectInBrowser","newHash","crypto","createHash","update","JSON","stringify","digest","Promise","resolve","fs","writeFile","directory","exports","oldRedirects","debouncedWriteRedirects","_","debounce","isEqual","Redirects","emitter","on"],"mappings":";;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA,IAAIA,QAAQ,GAAG,IAAf;;AAEA,MAAMC,cAAc;AAAA;AAAA;AAAA,6CAAG,aAAY;AACjCC,IAAAA,iBAAiB,GAAG,IAApB;;AADiC,0BAGJC,aAAMC,QAAN,EAHI;AAAA,QAG3BC,OAH2B,mBAG3BA,OAH2B;AAAA,QAGlBC,SAHkB,mBAGlBA,SAHkB,EAKjC;;;AACA,UAAMC,gBAAgB,GAAGD,SAAS,CAACE,MAAV,CAAiBC,CAAC,IAAIA,CAAC,CAACC,iBAAxB,CAAzB;;AAEA,UAAMC,OAAO,GAAGC,gBACbC,UADa,CACD,KADC,EAEbC,MAFa,CAENC,IAAI,CAACC,SAAL,CAAeT,gBAAf,CAFM,EAGbU,MAHa,CAGL,KAHK,CAAhB;;AAKA,QAAIN,OAAO,KAAKX,QAAhB,EAA0B;AACxB,aAAOkB,OAAO,CAACC,OAAR,EAAP;AACD;;AAEDnB,IAAAA,QAAQ,GAAGW,OAAX;AAEA,iBAAaS,iBAAGC,SAAH,CACX,oBAAShB,OAAO,CAACiB,SAAjB,EAA6B,uBAA7B,CADW,EAEXP,IAAI,CAACC,SAAL,CAAeT,gBAAf,EAAiC,IAAjC,EAAuC,CAAvC,CAFW,CAAb;AAID,GAvBmB;;AAAA,kBAAdN,cAAc;AAAA;AAAA;AAAA,GAApB;;AAyBAsB,OAAO,CAACtB,cAAR,GAAyBA,cAAzB;AAEA,IAAIC,iBAAiB,GAAG,KAAxB;AACA,IAAIsB,YAAJ;;AACA,MAAMC,uBAAuB,GAAGC,gBAAEC,QAAF,CAAW,MAAM;AAC/C;AACA,MACEzB,iBAAiB,IACjB,CAACwB,gBAAEE,OAAF,CAAUJ,YAAV,EAAwBrB,aAAMC,QAAN,GAAiBE,SAAzC,CAFH,EAGE;AACAL,IAAAA,cAAc;AACduB,IAAAA,YAAY,GAAGrB,aAAMC,QAAN,GAAiByB,SAAhC;AACD;AACF,CAT+B,EAS7B,GAT6B,CAAhC;;AAWAC,eAAQC,EAAR,CAAY,iBAAZ,EAA8B,MAAM;AAClCN,EAAAA,uBAAuB;AACxB,CAFD","sourcesContent":["import _ from \"lodash\"\nimport crypto from \"crypto\"\nimport fs from \"fs-extra\"\nimport { store, emitter } from \"../../redux/\"\nimport { joinPath } from \"../../utils/path\"\n\nlet lastHash = null\n\nconst writeRedirects = async () => {\n  bootstrapFinished = true\n\n  let { program, redirects } = store.getState()\n\n  // Filter for redirects that are meant for the browser.\n  const browserRedirects = redirects.filter(r => r.redirectInBrowser)\n\n  const newHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(browserRedirects))\n    .digest(`hex`)\n\n  if (newHash === lastHash) {\n    return Promise.resolve()\n  }\n\n  lastHash = newHash\n\n  return await fs.writeFile(\n    joinPath(program.directory, `.cache/redirects.json`),\n    JSON.stringify(browserRedirects, null, 2)\n  )\n}\n\nexports.writeRedirects = writeRedirects\n\nlet bootstrapFinished = false\nlet oldRedirects\nconst debouncedWriteRedirects = _.debounce(() => {\n  // Don't write redirects again until bootstrap has finished.\n  if (\n    bootstrapFinished &&\n    !_.isEqual(oldRedirects, store.getState().redirects)\n  ) {\n    writeRedirects()\n    oldRedirects = store.getState().Redirects\n  }\n}, 250)\n\nemitter.on(`CREATE_REDIRECT`, () => {\n  debouncedWriteRedirects()\n})\n"],"file":"redirects-writer.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/utils.js.map b/node_modules/gatsby/dist/internal-plugins/query-runner/utils.js.map
deleted file mode 100644
index 411b0a2..0000000
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/utils.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/utils.js"],"names":["indentString","string","replace","formatErrorDetails","errorDetails","Array","from","entries","map","name","details","toString","join"],"mappings":";;;;;AAEA,MAAMA,YAAY,GAAIC,MAAD,IAA4BA,MAAM,CAACC,OAAP,CAAe,KAAf,EAAuB,MAAvB,CAAjD;;;;AAEA,MAAMC,kBAAkB,GAAIC,YAAD,IACzBC,KAAK,CAACC,IAAN,CAAWF,YAAY,CAACG,OAAb,EAAX,EACGC,GADH,CAEI,CAAC,CAACC,IAAD,EAAOC,OAAP,CAAD,KAAsB,GAAED,IAAK;IAC/BT,YAAY,CAACU,OAAO,CAACC,QAAR,EAAD,CAAqB,EAHnC,EAKGC,IALH,CAKS,IALT,CADF","sourcesContent":["// @flow\n\nconst indentString = (string: string): string => string.replace(/\\n/g, `\\n  `)\n\nconst formatErrorDetails = (errorDetails: Map<string, any>): string =>\n  Array.from(errorDetails.entries())\n    .map(\n      ([name, details]) => `${name}:\n  ${indentString(details.toString())}`\n    )\n    .join(`\\n`)\n\nexport { indentString, formatErrorDetails }\n"],"file":"utils.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/better-queue-custom-store.js b/node_modules/gatsby/dist/query/better-queue-custom-store.js
similarity index 100%
rename from node_modules/gatsby/dist/internal-plugins/query-runner/better-queue-custom-store.js
rename to node_modules/gatsby/dist/query/better-queue-custom-store.js
diff --git a/node_modules/gatsby/dist/query/better-queue-custom-store.js.map b/node_modules/gatsby/dist/query/better-queue-custom-store.js.map
new file mode 100644
index 0000000..979edcd
--- /dev/null
+++ b/node_modules/gatsby/dist/query/better-queue-custom-store.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/query/better-queue-custom-store.js"],"names":["MemoryStoreWithPriorityBuckets","uuid","queueMap","Map","tasks","taskIdToPriority","running","priorityKeys","updatePriorityKeys","Array","from","keys","sort","a","b","addTaskWithPriority","taskId","priority","needToUpdatePriorityKeys","priorityTasks","get","set","push","connect","cb","size","getTask","deleteTask","delete","splice","indexOf","putTask","task","oldTask","oldPriority","oldPriorityTasks","length","takeFirstN","n","lockId","remainingTasks","haveSomeTasks","tasksToRun","taskWithSamePriority","grabbedTaskIds","forEach","takeLastN","reverse","deleteCount","Math","min","getRunningTasks","getLock","releaseLock","module","exports"],"mappings":"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","sourcesContent":["function MemoryStoreWithPriorityBuckets() {\n  let uuid = 0\n\n  /**\n   * Task ids grouped by priority\n   */\n  const queueMap = new Map()\n\n  /**\n   * Task id to task lookup\n   */\n  const tasks = new Map()\n\n  /**\n   * Task id to priority lookup\n   */\n  const taskIdToPriority = new Map()\n\n  /**\n   * Lock to running tasks object\n   */\n  const running = {}\n\n  let priorityKeys = []\n  const updatePriorityKeys = () => {\n    priorityKeys = Array.from(queueMap.keys()).sort((a, b) => b - a)\n  }\n\n  const addTaskWithPriority = (taskId, priority) => {\n    let needToUpdatePriorityKeys = false\n    let priorityTasks = queueMap.get(priority)\n    if (!priorityTasks) {\n      priorityTasks = []\n      queueMap.set(priority, priorityTasks)\n      needToUpdatePriorityKeys = true\n    }\n\n    taskIdToPriority.set(taskId, priority)\n    priorityTasks.push(taskId)\n    return needToUpdatePriorityKeys\n  }\n\n  return {\n    connect: function(cb) {\n      cb(null, tasks.size)\n    },\n    getTask: function(taskId, cb) {\n      cb(null, tasks.get(taskId))\n    },\n    deleteTask: function(taskId, cb) {\n      if (tasks.get(taskId)) {\n        tasks.delete(taskId)\n        const priority = taskIdToPriority.get(taskId)\n        const priorityTasks = queueMap.get(priority)\n        priorityTasks.splice(priorityTasks.indexOf(taskId), 1)\n        taskIdToPriority.delete(taskId)\n      }\n      cb()\n    },\n    putTask: function(taskId, task, priority = 0, cb) {\n      const oldTask = tasks.get(taskId)\n      tasks.set(taskId, task)\n      let needToUpdatePriorityKeys = false\n      if (oldTask) {\n        const oldPriority = taskIdToPriority.get(taskId)\n\n        if (oldPriority !== priority) {\n          const oldPriorityTasks = queueMap.get(oldPriority)\n          oldPriorityTasks.splice(oldPriorityTasks.indexOf(taskId), 1)\n\n          if (\n            addTaskWithPriority(taskId, priority) ||\n            oldPriority.length === 0\n          ) {\n            needToUpdatePriorityKeys = true\n          }\n        }\n      } else {\n        needToUpdatePriorityKeys = addTaskWithPriority(taskId, priority)\n      }\n\n      if (needToUpdatePriorityKeys) {\n        updatePriorityKeys()\n      }\n      cb()\n    },\n    takeFirstN: function(n, cb) {\n      const lockId = uuid++\n      let remainingTasks = n\n      let needToUpdatePriorityKeys = false\n      let haveSomeTasks = false\n      const tasksToRun = {}\n\n      for (let priority of priorityKeys) {\n        const taskWithSamePriority = queueMap.get(priority)\n        const grabbedTaskIds = taskWithSamePriority.splice(0, remainingTasks)\n        grabbedTaskIds.forEach(taskId => {\n          // add task to task that will run\n          // and remove it from waiting list\n          tasksToRun[taskId] = tasks.get(taskId)\n          tasks.delete(taskId)\n          taskIdToPriority.delete(taskId)\n          haveSomeTasks = true\n        })\n\n        remainingTasks -= grabbedTaskIds.length\n        if (taskWithSamePriority.length === 0) {\n          queueMap.delete(priority)\n          needToUpdatePriorityKeys = true\n        }\n        if (remainingTasks <= 0) {\n          break\n        }\n      }\n\n      if (needToUpdatePriorityKeys) {\n        updatePriorityKeys()\n      }\n\n      if (haveSomeTasks) {\n        running[lockId] = tasksToRun\n      }\n\n      cb(null, lockId)\n    },\n    takeLastN: function(n, cb) {\n      // This is not really used by Gatsby, but will be implemented for\n      // completion in easiest possible way (so not very performant).\n      // Mostly done so generic test suite used by other stores passes.\n      // This is mostly C&P from takeFirstN, with array reversal and different\n      // splice args\n      const lockId = uuid++\n      let remainingTasks = n\n      let needToUpdatePriorityKeys = false\n      let haveSomeTasks = false\n      const tasksToRun = {}\n\n      for (let priority of priorityKeys.reverse()) {\n        const taskWithSamePriority = queueMap.get(priority)\n        const deleteCount = Math.min(\n          remainingTasks,\n          taskWithSamePriority.length\n        )\n        const grabbedTaskIds = taskWithSamePriority.splice(\n          taskWithSamePriority.length - deleteCount,\n          deleteCount\n        )\n        grabbedTaskIds.forEach(taskId => {\n          // add task to task that will run\n          // and remove it from waiting list\n          tasksToRun[taskId] = tasks.get(taskId)\n          tasks.delete(taskId)\n          taskIdToPriority.delete(taskId)\n          haveSomeTasks = true\n        })\n\n        remainingTasks -= grabbedTaskIds.length\n        if (taskWithSamePriority.length === 0) {\n          queueMap.delete(priority)\n          needToUpdatePriorityKeys = true\n        }\n        if (remainingTasks <= 0) {\n          break\n        }\n      }\n\n      if (needToUpdatePriorityKeys) {\n        updatePriorityKeys()\n      }\n\n      if (haveSomeTasks) {\n        running[lockId] = tasksToRun\n      }\n\n      cb(null, lockId)\n    },\n    getRunningTasks: function(cb) {\n      cb(null, running)\n    },\n    getLock: function(lockId, cb) {\n      cb(null, running[lockId])\n    },\n    releaseLock: function(lockId, cb) {\n      delete running[lockId]\n      cb()\n    },\n  }\n}\n\nmodule.exports = MemoryStoreWithPriorityBuckets\n"],"file":"better-queue-custom-store.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/file-parser.js b/node_modules/gatsby/dist/query/file-parser.js
similarity index 98%
rename from node_modules/gatsby/dist/internal-plugins/query-runner/file-parser.js
rename to node_modules/gatsby/dist/query/file-parser.js
index 236f342..0d0d679 100644
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/file-parser.js
+++ b/node_modules/gatsby/dist/query/file-parser.js
@@ -9,7 +9,7 @@ var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/
 
 var _traverse = _interopRequireDefault(require("@babel/traverse"));
 
-var _babelParseToAst = require("../../utils/babel-parse-to-ast");
+var _babelParseToAst = require("../utils/babel-parse-to-ast");
 
 const fs = require(`fs-extra`);
 
@@ -22,9 +22,9 @@ const getGraphQLTag = require(`babel-plugin-remove-graphql-queries`).getGraphQLT
 
 const report = require(`gatsby-cli/lib/reporter`);
 
-const apiRunnerNode = require(`../../utils/api-runner-node`);
+const apiRunnerNode = require(`../utils/api-runner-node`);
 
-const _require = require(`../../redux/actions`),
+const _require = require(`../redux/actions`),
       boundActionCreators = _require.boundActionCreators;
 /**
  * Add autogenerated query name if it wasn't defined by user.
diff --git a/node_modules/gatsby/dist/query/file-parser.js.map b/node_modules/gatsby/dist/query/file-parser.js.map
new file mode 100644
index 0000000..ff01f5c
--- /dev/null
+++ b/node_modules/gatsby/dist/query/file-parser.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/query/file-parser.js"],"names":["fs","require","crypto","_","getGraphQLTag","report","apiRunnerNode","boundActionCreators","generateQueryName","def","hash","file","name","value","camelCase","kind","warnForUnknownQueryVariable","varName","usageFunction","warn","parseToAst","filePath","fileStr","ast","transpiled","filename","contents","length","item","tmp","error","queryExtractionGraphQLError","componentPath","undefined","queryExtractionBabelError","warnForGlobalTag","findGraphQLTags","text","Promise","resolve","reject","then","queries","documentLocations","WeakMap","extractStaticQuery","taggedTemplateExpressPath","isHook","gqlAst","isGlobal","definitions","forEach","set","node","start","loc","map","d","isStaticQuery","push","JSXElement","path","openingElement","traverse","JSXAttribute","jsxPath","TaggedTemplateExpression","templatePath","Identifier","identifierPath","found","VariableDeclarator","varPath","id","init","type","CallExpression","hookPath","callee","get","referencesImport","ExportNamedDeclaration","state","innerPath","uniqueQueries","uniqBy","q","catch","cache","FileParser","parseFile","readFile","err","indexOf","createHash","update","digest","astDefinitions","queryExtractedBabelSuccess","parseFiles","files","documents","Map","all","doc"],"mappings":"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","sourcesContent":["// @flow\nconst fs = require(`fs-extra`)\nconst crypto = require(`crypto`)\nconst _ = require(`lodash`)\n\n// Traverse is a es6 module...\nimport traverse from \"@babel/traverse\"\nconst getGraphQLTag = require(`babel-plugin-remove-graphql-queries`)\n  .getGraphQLTag\nconst report = require(`gatsby-cli/lib/reporter`)\n\nimport type { DocumentNode, DefinitionNode } from \"graphql\"\nimport { babelParseToAst } from \"../utils/babel-parse-to-ast\"\n\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst { boundActionCreators } = require(`../redux/actions`)\n\n/**\n * Add autogenerated query name if it wasn't defined by user.\n */\nconst generateQueryName = ({ def, hash, file }) => {\n  if (!def.name || !def.name.value) {\n    def.name = {\n      value: `${_.camelCase(file)}${hash}`,\n      kind: `Name`,\n    }\n  }\n  return def\n}\n\nconst warnForUnknownQueryVariable = (varName, file, usageFunction) =>\n  report.warn(\n    `\\nWe were unable to find the declaration of variable \"${varName}\", which you passed as the \"query\" prop into the ${usageFunction} declaration in \"${file}\".\n\nPerhaps the variable name has a typo?\n\nAlso note that we are currently unable to use queries defined in files other than the file where the ${usageFunction} is defined. If you're attempting to import the query, please move it into \"${file}\". If being able to import queries from another file is an important capability for you, we invite your help fixing it.\\n`\n  )\n\nasync function parseToAst(filePath, fileStr) {\n  let ast\n\n  // Preprocess and attempt to parse source; return an AST if we can, log an\n  // error if we can't.\n  const transpiled = await apiRunnerNode(`preprocessSource`, {\n    filename: filePath,\n    contents: fileStr,\n  })\n  if (transpiled && transpiled.length) {\n    for (const item of transpiled) {\n      try {\n        const tmp = babelParseToAst(item, filePath)\n        ast = tmp\n        break\n      } catch (error) {\n        report.error(error)\n        boundActionCreators.queryExtractionGraphQLError({\n          componentPath: filePath,\n        })\n        continue\n      }\n    }\n    if (ast === undefined) {\n      report.error(`Failed to parse preprocessed file ${filePath}`)\n      boundActionCreators.queryExtractionGraphQLError({\n        componentPath: filePath,\n      })\n\n      return null\n    }\n  } else {\n    try {\n      ast = babelParseToAst(fileStr, filePath)\n    } catch (error) {\n      boundActionCreators.queryExtractionBabelError({\n        componentPath: filePath,\n        error,\n      })\n      report.error(\n        `There was a problem parsing \"${filePath}\"; any GraphQL ` +\n          `fragments or queries in this file were not processed. \\n` +\n          `This may indicate a syntax error in the code, or it may be a file type ` +\n          `that Gatsby does not know how to parse.`\n      )\n\n      return null\n    }\n  }\n\n  return ast\n}\n\nconst warnForGlobalTag = file =>\n  report.warn(\n    `Using the global \\`graphql\\` tag is deprecated, and will not be supported in v3.\\n` +\n      `Import it instead like:  import { graphql } from 'gatsby' in file:\\n` +\n      file\n  )\n\nasync function findGraphQLTags(file, text): Promise<Array<DefinitionNode>> {\n  return new Promise((resolve, reject) => {\n    parseToAst(file, text)\n      .then(ast => {\n        let queries = []\n        if (!ast) {\n          resolve(queries)\n          return\n        }\n\n        /**\n         * A map of graphql documents to unique locations.\n         *\n         * A graphql document's unique location is made of:\n         *\n         *  - the location of the graphql template literal that contains the document, and\n         *  - the document's location within the graphql template literal\n         *\n         * This is used to prevent returning duplicated documents.\n         */\n        const documentLocations = new WeakMap()\n\n        const extractStaticQuery = (\n          taggedTemplateExpressPath,\n          isHook = false\n        ) => {\n          const { ast: gqlAst, text, hash, isGlobal } = getGraphQLTag(\n            taggedTemplateExpressPath\n          )\n          if (!gqlAst) return\n\n          if (isGlobal) warnForGlobalTag(file)\n\n          gqlAst.definitions.forEach(def => {\n            documentLocations.set(\n              def,\n              `${taggedTemplateExpressPath.node.start}-${def.loc.start}`\n            )\n            generateQueryName({\n              def,\n              hash,\n              file,\n            })\n          })\n\n          const definitions = [...gqlAst.definitions].map(d => {\n            d.isStaticQuery = true\n            d.isHook = isHook\n            d.text = text\n            d.hash = hash\n            return d\n          })\n\n          queries.push(...definitions)\n        }\n\n        // Look for queries in <StaticQuery /> elements.\n        traverse(ast, {\n          JSXElement(path) {\n            if (path.node.openingElement.name.name !== `StaticQuery`) {\n              return\n            }\n\n            // astexplorer.com link I (@kyleamathews) used when prototyping this algorithm\n            // https://astexplorer.net/#/gist/ab5d71c0f08f287fbb840bf1dd8b85ff/2f188345d8e5a4152fe7c96f0d52dbcc6e9da466\n            path.traverse({\n              JSXAttribute(jsxPath) {\n                if (jsxPath.node.name.name !== `query`) {\n                  return\n                }\n                jsxPath.traverse({\n                  // Assume the query is inline in the component and extract that.\n                  TaggedTemplateExpression(templatePath) {\n                    extractStaticQuery(templatePath)\n                  },\n                  // Also see if it's a variable that's passed in as a prop\n                  // and if it is, go find it.\n                  Identifier(identifierPath) {\n                    if (identifierPath.node.name !== `graphql`) {\n                      const varName = identifierPath.node.name\n                      let found = false\n                      traverse(ast, {\n                        VariableDeclarator(varPath) {\n                          if (\n                            varPath.node.id.name === varName &&\n                            varPath.node.init.type ===\n                              `TaggedTemplateExpression`\n                          ) {\n                            varPath.traverse({\n                              TaggedTemplateExpression(templatePath) {\n                                found = true\n                                extractStaticQuery(templatePath)\n                              },\n                            })\n                          }\n                        },\n                      })\n                      if (!found) {\n                        warnForUnknownQueryVariable(\n                          varName,\n                          file,\n                          `<StaticQuery>`\n                        )\n                      }\n                    }\n                  },\n                })\n              },\n            })\n            return\n          },\n        })\n\n        // Look for queries in useStaticQuery hooks.\n        traverse(ast, {\n          CallExpression(hookPath) {\n            if (\n              hookPath.node.callee.name !== `useStaticQuery` ||\n              !hookPath.get(`callee`).referencesImport(`gatsby`)\n            ) {\n              return\n            }\n\n            hookPath.traverse({\n              // Assume the query is inline in the component and extract that.\n              TaggedTemplateExpression(templatePath) {\n                extractStaticQuery(templatePath, true)\n              },\n              // // Also see if it's a variable that's passed in as a prop\n              // // and if it is, go find it.\n              Identifier(identifierPath) {\n                if (\n                  identifierPath.node.name !== `graphql` &&\n                  identifierPath.node.name !== `useStaticQuery`\n                ) {\n                  const varName = identifierPath.node.name\n                  let found = false\n                  traverse(ast, {\n                    VariableDeclarator(varPath) {\n                      if (\n                        varPath.node.id.name === varName &&\n                        varPath.node.init.type === `TaggedTemplateExpression`\n                      ) {\n                        varPath.traverse({\n                          TaggedTemplateExpression(templatePath) {\n                            found = true\n                            extractStaticQuery(templatePath, true)\n                          },\n                        })\n                      }\n                    },\n                  })\n                  if (!found) {\n                    warnForUnknownQueryVariable(varName, file, `useStaticQuery`)\n                  }\n                }\n              },\n            })\n          },\n        })\n\n        // Look for exported page queries\n        traverse(ast, {\n          ExportNamedDeclaration(path, state) {\n            path.traverse({\n              TaggedTemplateExpression(innerPath) {\n                const { ast: gqlAst, isGlobal, hash } = getGraphQLTag(innerPath)\n                if (!gqlAst) return\n\n                if (isGlobal) warnForGlobalTag(file)\n\n                gqlAst.definitions.forEach(def => {\n                  documentLocations.set(\n                    def,\n                    `${innerPath.node.start}-${def.loc.start}`\n                  )\n                  generateQueryName({\n                    def,\n                    hash,\n                    file,\n                  })\n                })\n\n                queries.push(...gqlAst.definitions)\n              },\n            })\n          },\n        })\n\n        // Remove duplicate queries\n        const uniqueQueries = _.uniqBy(queries, q => documentLocations.get(q))\n\n        resolve(uniqueQueries)\n      })\n      .catch(reject)\n  })\n}\n\nconst cache = {}\n\nexport default class FileParser {\n  async parseFile(file: string): Promise<?DocumentNode> {\n    let text\n    try {\n      text = await fs.readFile(file, `utf8`)\n    } catch (err) {\n      report.error(`There was a problem reading the file: ${file}`, err)\n      boundActionCreators.queryExtractionGraphQLError({\n        componentPath: file,\n      })\n      return null\n    }\n\n    if (text.indexOf(`graphql`) === -1) return null\n    const hash = crypto\n      .createHash(`md5`)\n      .update(file)\n      .update(text)\n      .digest(`hex`)\n\n    try {\n      let astDefinitions =\n        cache[hash] || (cache[hash] = await findGraphQLTags(file, text))\n\n      // If any AST definitions were extracted, report success.\n      // This can mean there is none or there was a babel error when\n      // we tried to extract the graphql AST.\n      if (astDefinitions.length > 0) {\n        boundActionCreators.queryExtractedBabelSuccess({\n          componentPath: file,\n        })\n      }\n\n      return astDefinitions.length\n        ? {\n            kind: `Document`,\n            definitions: astDefinitions,\n          }\n        : null\n    } catch (err) {\n      report.error(\n        `There was a problem parsing the GraphQL query in file: ${file}`,\n        err\n      )\n      boundActionCreators.queryExtractionGraphQLError({\n        componentPath: file,\n      })\n      return null\n    }\n  }\n\n  async parseFiles(files: Array<string>): Promise<Map<string, DocumentNode>> {\n    const documents = new Map()\n\n    return Promise.all(\n      files.map(file =>\n        this.parseFile(file).then(doc => {\n          if (!doc) return\n          documents.set(file, doc)\n        })\n      )\n    ).then(() => documents)\n  }\n}\n"],"file":"file-parser.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/graphql-errors.js b/node_modules/gatsby/dist/query/graphql-errors.js
similarity index 100%
rename from node_modules/gatsby/dist/internal-plugins/query-runner/graphql-errors.js
rename to node_modules/gatsby/dist/query/graphql-errors.js
diff --git a/node_modules/gatsby/dist/query/graphql-errors.js.map b/node_modules/gatsby/dist/query/graphql-errors.js.map
new file mode 100644
index 0000000..9add5e2
--- /dev/null
+++ b/node_modules/gatsby/dist/query/graphql-errors.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/query/graphql-errors.js"],"names":["handlers","name","node","kind","value","loc","formatFilePath","filePath","report","format","bold","blue","formatError","message","codeFrame","stripIndent","extractError","error","docRegex","matches","docName","codeBlock","exec","toString","index","lastIndex","findLocation","extractedMessage","def","location","enter","regex","handler","match","slice","getCodeFrame","query","lineNumber","column","linesAbove","linesBelow","getCodeFrameFromRelayError","start","source","body","line","multipleRootQueriesError","otherDef","otherName","unifiedName","_","camelCase","upperFirst","yellow","green","graphqlValidationError","errors","doc","length","locations","graphqlError","namePathMap","nameDefMap","get","formattedMessage","reportedMessage"],"mappings":"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","sourcesContent":["// @flow\n\nimport { print, visit, GraphQLError, getLocation } from \"graphql\"\nimport babelCodeFrame from \"@babel/code-frame\"\nimport _ from \"lodash\"\nimport report from \"gatsby-cli/lib/reporter\"\n\ntype RelayGraphQLError = Error & { validationErrors?: Object }\n\n// These handle specific errors throw by RelayParser. If an error matches\n// you get a pointer to the location in the query that is broken, otherwise\n// we show the error and the query.\nconst handlers = [\n  [\n    /Unknown field `(.+)` on type `(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Field` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n  [\n    /Unknown argument `(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Argument` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n  [\n    /Unknown directive `@(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Directive` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n]\n\nfunction formatFilePath(filePath: string) {\n  return `${report.format.bold(`file:`)} ${report.format.blue(filePath)}`\n}\n\nfunction formatError(message: string, filePath: string, codeFrame: string) {\n  return (\n    report.stripIndent`\n    ${message}\n\n      ${formatFilePath(filePath)}\n  ` + `\\n\\n${codeFrame}\\n`\n  )\n}\n\nfunction extractError(error: Error): { message: string, docName: string } {\n  const docRegex = /Error:.(RelayParser|GraphQLParser):(.*)Source: document.`(.*)`.file.*(GraphQL.request.*^\\s*$)/gms\n  let matches\n  let message = ``\n  let docName = ``\n  let codeBlock = ``\n  while ((matches = docRegex.exec(error.toString())) !== null) {\n    // This is necessary to avoid infinite loops with zero-width matches\n    if (matches.index === docRegex.lastIndex) docRegex.lastIndex++\n    ;[, , message, docName, codeBlock] = matches\n  }\n\n  if (!message) {\n    message = error.toString()\n  }\n\n  return { message, codeBlock, docName }\n}\n\nfunction findLocation(extractedMessage, def) {\n  let location = null\n  visit(def, {\n    enter(node) {\n      if (location) return\n      for (let [regex, handler] of handlers) {\n        let match = extractedMessage.match(regex)\n        if (!match) continue\n        if ((location = handler(match.slice(1), node))) break\n      }\n    },\n  })\n  return location\n}\n\nfunction getCodeFrame(query: string, lineNumber?: number, column?: number) {\n  return babelCodeFrame(query, lineNumber, column, {\n    linesAbove: 10,\n    linesBelow: 10,\n  })\n}\n\nfunction getCodeFrameFromRelayError(\n  def: any,\n  extractedMessage: string,\n  error: Error\n) {\n  let { start, source } = findLocation(extractedMessage, def) || {}\n  let query = source ? source.body : print(def)\n\n  // we can't reliably get a location without the location source, since\n  // the printed query may differ from the original.\n  let { line, column } = (source && getLocation(source, start)) || {}\n  return getCodeFrame(query, line, column)\n}\n\nexport function multipleRootQueriesError(\n  filePath: string,\n  def: any,\n  otherDef: any\n) {\n  let name = def.name.value\n  let otherName = otherDef.name.value\n  let unifiedName = `${_.camelCase(name)}And${_.upperFirst(\n    _.camelCase(otherName)\n  )}`\n\n  return formatError(\n    `Multiple \"root\" queries found in file: \"${name}\" and \"${otherName}\". ` +\n      `Only the first (\"${otherName}\") will be registered.`,\n    filePath,\n    `  ${report.format.yellow(`Instead of:`)} \\n\\n` +\n      babelCodeFrame(report.stripIndent`\n      query ${otherName} {\n        bar {\n          #...\n        }\n      }\n\n      query ${name} {\n        foo {\n          #...\n        }\n      }\n    `) +\n      `\\n\\n  ${report.format.green(`Do:`)} \\n\\n` +\n      babelCodeFrame(report.stripIndent`\n      query ${unifiedName} {\n        bar {\n          #...\n        }\n        foo {\n          #...\n        }\n      }\n    `)\n  )\n}\n\nexport function graphqlValidationError(\n  errors: Array<GraphQLError>,\n  filePath: string,\n  doc: any\n): string {\n  if (!errors || !errors.length) return ``\n  let error = errors[0]\n  let { source, locations: [{ line, column }] = [{}] } = error\n  let query = source ? source.body : print(doc)\n\n  return formatError(error.message, filePath, getCodeFrame(query, line, column))\n}\n\nexport function graphqlError(\n  namePathMap: Map<string, string>,\n  nameDefMap: Map<string, any>,\n  error: Error | RelayGraphQLError\n) {\n  let codeBlock\n  let { message, docName } = extractError(error)\n  let filePath = namePathMap.get(docName)\n\n  if (filePath && docName) {\n    codeBlock = getCodeFrameFromRelayError(\n      nameDefMap.get(docName),\n      message,\n      error\n    )\n    const formattedMessage = formatError(message, filePath, codeBlock)\n    return { formattedMessage, docName, message, codeBlock }\n  }\n\n  let reportedMessage = `There was an error while compiling your site's GraphQL queries.\n  ${message || error.message}\n    `\n\n  if (error.message.match(/must be an instance of/)) {\n    reportedMessage +=\n      `This usually means that more than one instance of 'graphql' is installed ` +\n      `in your node_modules. Remove all but the top level one or run \\`npm dedupe\\` to fix it.`\n  }\n\n  if (error.message.match(/Duplicate document/)) {\n    reportedMessage += `${error.message.slice(21)}\\n`\n  }\n\n  return { formattedMessage: reportedMessage, docName, message, codeBlock }\n}\n"],"file":"graphql-errors.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/query/index.js b/node_modules/gatsby/dist/query/index.js
new file mode 100644
index 0000000..7b242b3
--- /dev/null
+++ b/node_modules/gatsby/dist/query/index.js
@@ -0,0 +1,297 @@
+"use strict";
+
+var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
+
+var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
+
+const _ = require(`lodash`);
+
+const convertHrtime = require(`convert-hrtime`);
+
+const _require = require(`../redux`),
+      store = _require.store,
+      emitter = _require.emitter;
+
+const queryQueue = require(`./query-queue`);
+
+const jobHandler = require(`./job-handler`);
+
+let seenIdsWithoutDataDependencies = [];
+let queuedDirtyActions = [];
+const extractedQueryIds = new Set(); // Remove pages from seenIdsWithoutDataDependencies when they're deleted
+// so their query will be run again if they're created again.
+
+emitter.on(`DELETE_PAGE`, action => {
+  seenIdsWithoutDataDependencies = seenIdsWithoutDataDependencies.filter(p => p !== action.payload.path);
+});
+emitter.on(`CREATE_NODE`, action => {
+  queuedDirtyActions.push(action);
+});
+emitter.on(`DELETE_NODE`, action => {
+  queuedDirtyActions.push({
+    payload: action.payload
+  });
+});
+
+const enqueueExtractedQueryId = queryId => {
+  extractedQueryIds.add(queryId);
+}; /////////////////////////////////////////////////////////////////////
+// Calculate dirty static/page queries
+
+
+const findIdsWithoutDataDependencies = state => {
+  const allTrackedIds = _.uniq(_.flatten(_.concat(_.values(state.componentDataDependencies.nodes), _.values(state.componentDataDependencies.connections)))); // Get list of paths not already tracked and run the queries for these
+  // paths.
+
+
+  const notTrackedIds = _.difference([...Array.from(state.pages.values(), p => p.path), ...[...state.staticQueryComponents.values()].map(c => c.id)], [...allTrackedIds, ...seenIdsWithoutDataDependencies]); // Add new IDs to our seen array so we don't keep trying to run queries for them.
+  // Pages without queries can't be tracked.
+
+
+  seenIdsWithoutDataDependencies = _.uniq([...notTrackedIds, ...seenIdsWithoutDataDependencies]);
+  return notTrackedIds;
+};
+
+const popNodeQueries = ({
+  state
+}) => {
+  const actions = _.uniq(queuedDirtyActions, a => a.payload.id);
+
+  const uniqDirties = _.uniq(actions.reduce((dirtyIds, action) => {
+    const node = action.payload;
+    if (!node || !node.id || !node.internal.type) return dirtyIds; // Find components that depend on this node so are now dirty.
+
+    dirtyIds = dirtyIds.concat(state.componentDataDependencies.nodes[node.id]); // Find connections that depend on this node so are now invalid.
+
+    dirtyIds = dirtyIds.concat(state.componentDataDependencies.connections[node.internal.type]);
+    return _.compact(dirtyIds);
+  }, []));
+
+  queuedDirtyActions = [];
+  return uniqDirties;
+};
+
+const popNodeAndDepQueries = state => {
+  const nodeQueries = popNodeQueries({
+    state
+  });
+  const noDepQueries = findIdsWithoutDataDependencies(state);
+  return _.uniq([...nodeQueries, ...noDepQueries]);
+};
+
+const popExtractedQueries = () => {
+  const queries = [...extractedQueryIds];
+  extractedQueryIds.clear();
+  return queries;
+};
+/**
+ * Calculates the set of dirty query IDs (page.paths, or
+ * staticQuery.hash's). These are queries that:
+ *
+ * - depend on nodes or node collections (via
+ *   `actions.createPageDependency`) that have changed.
+ * - do NOT have node dependencies. Since all queries should return
+ *   data, then this implies that node dependencies have not been
+ *   tracked, and therefore these queries haven't been run before
+ * - have been recently extracted (see `./query-watcher.js`)
+ *
+ * Note, this function pops queries off internal queues, so it's up
+ * to the caller to reference the results
+ */
+
+
+const calcDirtyQueryIds = state => _.union(popNodeAndDepQueries(state), popExtractedQueries());
+/**
+ * Same as `calcDirtyQueryIds`, except that we only include extracted
+ * queries that depend on nodes or haven't been run yet. We do this
+ * because the page component reducer/machine always enqueues
+ * extractedQueryIds but during bootstrap we may not want to run those
+ * page queries if their data hasn't changed since the last time we
+ * ran Gatsby.
+ */
+
+
+const calcBootstrapDirtyQueryIds = state => {
+  const nodeAndNoDepQueries = popNodeAndDepQueries(state);
+
+  const extractedQueriesThatNeedRunning = _.intersection(popExtractedQueries(), nodeAndNoDepQueries);
+
+  return _.union(extractedQueriesThatNeedRunning, nodeAndNoDepQueries);
+};
+/**
+ * groups queryIds by whether they are static or page queries.
+ */
+
+
+const groupQueryIds = queryIds => {
+  const grouped = _.groupBy(queryIds, p => p.slice(0, 4) === `sq--`);
+
+  return {
+    staticQueryIds: grouped[true] || [],
+    pageQueryIds: grouped[false] || []
+  };
+}; /////////////////////////////////////////////////////////////////////
+// Create Query Jobs
+
+
+const processQueries =
+/*#__PURE__*/
+function () {
+  var _ref = (0, _asyncToGenerator2.default)(function* (queryJobs, {
+    activity
+  }) {
+    if (queryJobs.length == 0) {
+      return;
+    }
+
+    const startQueries = process.hrtime();
+    const queue = queryQueue.create();
+    queue.on(`task_finish`, () => {
+      const stats = queue.getStats();
+
+      if (activity) {
+        activity.setStatus(`${stats.total}/${stats.peak} ${(stats.total / convertHrtime(process.hrtime(startQueries)).seconds).toFixed(2)} queries/second`);
+      }
+    });
+    const drainedPromise = new Promise(resolve => {
+      queue.once(`drain`, resolve);
+    });
+    queryJobs.forEach(queryJob => {
+      queue.push(queryJob);
+    });
+    yield drainedPromise;
+  });
+
+  return function processQueries(_x, _x2) {
+    return _ref.apply(this, arguments);
+  };
+}();
+
+const makePageQueryJob = (state, queryId) => {
+  const page = state.pages.get(queryId);
+  const component = state.components.get(page.componentPath);
+  const path = page.path,
+        componentPath = page.componentPath,
+        context = page.context;
+  const query = component.query;
+  return {
+    id: path,
+    query,
+    isPage: true,
+    componentPath,
+    context: Object.assign({}, page, context)
+  };
+};
+
+const processPageQueries =
+/*#__PURE__*/
+function () {
+  var _ref2 = (0, _asyncToGenerator2.default)(function* (queryIds, {
+    state,
+    activity
+  }) {
+    state = state || store.getState();
+    yield processQueries(queryIds.map(id => makePageQueryJob(state, id)), {
+      activity
+    });
+  });
+
+  return function processPageQueries(_x3, _x4) {
+    return _ref2.apply(this, arguments);
+  };
+}();
+
+const makeStaticQueryJob = (state, queryId) => {
+  const component = state.staticQueryComponents.get(queryId);
+  const hash = component.hash,
+        id = component.id,
+        query = component.query,
+        componentPath = component.componentPath;
+  return {
+    id,
+    hash,
+    query,
+    componentPath,
+    context: {
+      path: id
+    }
+  };
+};
+
+const processStaticQueries =
+/*#__PURE__*/
+function () {
+  var _ref3 = (0, _asyncToGenerator2.default)(function* (queryIds, {
+    state,
+    activity
+  }) {
+    state = state || store.getState();
+    yield processQueries(queryIds.map(id => makeStaticQueryJob(state, id)), {
+      activity
+    });
+  });
+
+  return function processStaticQueries(_x5, _x6) {
+    return _ref3.apply(this, arguments);
+  };
+}(); /////////////////////////////////////////////////////////////////////
+// Background query daemon (for gatsby develop)
+
+/**
+ * Starts a background process that processes any dirty queries
+ * whenever one of the following occurs.
+ *
+ * 1. A node has changed (but only after the api call has finished
+ * running)
+ * 2. A component query (e.g by editing a React Component) has
+ * changed
+ *
+ * For what constitutes a dirty query, see `calcDirtyQueryIds`
+ */
+
+
+const startListener = queue => {
+  const runQueuedActions = () => {
+    const state = store.getState();
+    const dirtyQueryIds = calcDirtyQueryIds(state);
+
+    const _groupQueryIds = groupQueryIds(dirtyQueryIds),
+          staticQueryIds = _groupQueryIds.staticQueryIds,
+          pageQueryIds = _groupQueryIds.pageQueryIds;
+
+    staticQueryIds.map(id => makeStaticQueryJob(state, id)).forEach(queryJob => {
+      queue.push(queryJob);
+    });
+    pageQueryIds.map(id => makePageQueryJob(state, id)).forEach(queryJob => {
+      queue.push(queryJob);
+    });
+  };
+
+  runQueuedActions();
+  emitter.on(`API_RUNNING_QUEUE_EMPTY`, runQueuedActions);
+  emitter.on(`QUERY_RUNNER_QUERIES_ENQUEUED`, runQueuedActions);
+};
+/**
+ * Force query processing to run. Noop until `startDaemon` has been
+ * called.
+ */
+
+
+const runQueries = () => {
+  // A bit hacky bit it works well.
+  emitter.emit(`QUERY_RUNNER_QUERIES_ENQUEUED`);
+};
+
+module.exports = {
+  enqueueExtractedQueryId,
+  calcBootstrapDirtyQueryIds,
+  groupQueryIds,
+  processQueries,
+  processPageQueries,
+  processStaticQueries,
+  runQueries,
+  startListener,
+  createQueue: queryQueue.create,
+  jobHandler
+};
+//# sourceMappingURL=index.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/query/index.js.map b/node_modules/gatsby/dist/query/index.js.map
new file mode 100644
index 0000000..5d75ffc
--- /dev/null
+++ b/node_modules/gatsby/dist/query/index.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/query/index.js"],"names":["_","require","convertHrtime","store","emitter","queryQueue","jobHandler","seenIdsWithoutDataDependencies","queuedDirtyActions","extractedQueryIds","Set","on","action","filter","p","payload","path","push","enqueueExtractedQueryId","queryId","add","findIdsWithoutDataDependencies","state","allTrackedIds","uniq","flatten","concat","values","componentDataDependencies","nodes","connections","notTrackedIds","difference","Array","from","pages","staticQueryComponents","map","c","id","popNodeQueries","actions","a","uniqDirties","reduce","dirtyIds","node","internal","type","compact","popNodeAndDepQueries","nodeQueries","noDepQueries","popExtractedQueries","queries","clear","calcDirtyQueryIds","union","calcBootstrapDirtyQueryIds","nodeAndNoDepQueries","extractedQueriesThatNeedRunning","intersection","groupQueryIds","queryIds","grouped","groupBy","slice","staticQueryIds","pageQueryIds","processQueries","queryJobs","activity","length","startQueries","process","hrtime","queue","create","stats","getStats","setStatus","total","peak","seconds","toFixed","drainedPromise","Promise","resolve","once","forEach","queryJob","makePageQueryJob","page","get","component","components","componentPath","context","query","isPage","processPageQueries","getState","makeStaticQueryJob","hash","processStaticQueries","startListener","runQueuedActions","dirtyQueryIds","runQueries","emit","module","exports","createQueue"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst convertHrtime = require(`convert-hrtime`)\nconst { store, emitter } = require(`../redux`)\nconst queryQueue = require(`./query-queue`)\nconst jobHandler = require(`./job-handler`)\n\nlet seenIdsWithoutDataDependencies = []\nlet queuedDirtyActions = []\nconst extractedQueryIds = new Set()\n\n// Remove pages from seenIdsWithoutDataDependencies when they're deleted\n// so their query will be run again if they're created again.\nemitter.on(`DELETE_PAGE`, action => {\n  seenIdsWithoutDataDependencies = seenIdsWithoutDataDependencies.filter(\n    p => p !== action.payload.path\n  )\n})\n\nemitter.on(`CREATE_NODE`, action => {\n  queuedDirtyActions.push(action)\n})\n\nemitter.on(`DELETE_NODE`, action => {\n  queuedDirtyActions.push({ payload: action.payload })\n})\n\nconst enqueueExtractedQueryId = queryId => {\n  extractedQueryIds.add(queryId)\n}\n\n/////////////////////////////////////////////////////////////////////\n// Calculate dirty static/page queries\n\nconst findIdsWithoutDataDependencies = state => {\n  const allTrackedIds = _.uniq(\n    _.flatten(\n      _.concat(\n        _.values(state.componentDataDependencies.nodes),\n        _.values(state.componentDataDependencies.connections)\n      )\n    )\n  )\n\n  // Get list of paths not already tracked and run the queries for these\n  // paths.\n  const notTrackedIds = _.difference(\n    [\n      ...Array.from(state.pages.values(), p => p.path),\n      ...[...state.staticQueryComponents.values()].map(c => c.id),\n    ],\n    [...allTrackedIds, ...seenIdsWithoutDataDependencies]\n  )\n\n  // Add new IDs to our seen array so we don't keep trying to run queries for them.\n  // Pages without queries can't be tracked.\n  seenIdsWithoutDataDependencies = _.uniq([\n    ...notTrackedIds,\n    ...seenIdsWithoutDataDependencies,\n  ])\n\n  return notTrackedIds\n}\n\nconst popNodeQueries = ({ state }) => {\n  const actions = _.uniq(queuedDirtyActions, a => a.payload.id)\n\n  const uniqDirties = _.uniq(\n    actions.reduce((dirtyIds, action) => {\n      const node = action.payload\n\n      if (!node || !node.id || !node.internal.type) return dirtyIds\n\n      // Find components that depend on this node so are now dirty.\n      dirtyIds = dirtyIds.concat(state.componentDataDependencies.nodes[node.id])\n\n      // Find connections that depend on this node so are now invalid.\n      dirtyIds = dirtyIds.concat(\n        state.componentDataDependencies.connections[node.internal.type]\n      )\n\n      return _.compact(dirtyIds)\n    }, [])\n  )\n  queuedDirtyActions = []\n  return uniqDirties\n}\n\nconst popNodeAndDepQueries = state => {\n  const nodeQueries = popNodeQueries({ state })\n\n  const noDepQueries = findIdsWithoutDataDependencies(state)\n\n  return _.uniq([...nodeQueries, ...noDepQueries])\n}\n\nconst popExtractedQueries = () => {\n  const queries = [...extractedQueryIds]\n  extractedQueryIds.clear()\n  return queries\n}\n\n/**\n * Calculates the set of dirty query IDs (page.paths, or\n * staticQuery.hash's). These are queries that:\n *\n * - depend on nodes or node collections (via\n *   `actions.createPageDependency`) that have changed.\n * - do NOT have node dependencies. Since all queries should return\n *   data, then this implies that node dependencies have not been\n *   tracked, and therefore these queries haven't been run before\n * - have been recently extracted (see `./query-watcher.js`)\n *\n * Note, this function pops queries off internal queues, so it's up\n * to the caller to reference the results\n */\n\nconst calcDirtyQueryIds = state =>\n  _.union(popNodeAndDepQueries(state), popExtractedQueries())\n\n/**\n * Same as `calcDirtyQueryIds`, except that we only include extracted\n * queries that depend on nodes or haven't been run yet. We do this\n * because the page component reducer/machine always enqueues\n * extractedQueryIds but during bootstrap we may not want to run those\n * page queries if their data hasn't changed since the last time we\n * ran Gatsby.\n */\nconst calcBootstrapDirtyQueryIds = state => {\n  const nodeAndNoDepQueries = popNodeAndDepQueries(state)\n\n  const extractedQueriesThatNeedRunning = _.intersection(\n    popExtractedQueries(),\n    nodeAndNoDepQueries\n  )\n  return _.union(extractedQueriesThatNeedRunning, nodeAndNoDepQueries)\n}\n\n/**\n * groups queryIds by whether they are static or page queries.\n */\nconst groupQueryIds = queryIds => {\n  const grouped = _.groupBy(queryIds, p => p.slice(0, 4) === `sq--`)\n  return {\n    staticQueryIds: grouped[true] || [],\n    pageQueryIds: grouped[false] || [],\n  }\n}\n\n/////////////////////////////////////////////////////////////////////\n// Create Query Jobs\n\nconst processQueries = async (queryJobs, { activity }) => {\n  if (queryJobs.length == 0) {\n    return\n  }\n  const startQueries = process.hrtime()\n\n  const queue = queryQueue.create()\n  queue.on(`task_finish`, () => {\n    const stats = queue.getStats()\n    if (activity) {\n      activity.setStatus(\n        `${stats.total}/${stats.peak} ${(\n          stats.total / convertHrtime(process.hrtime(startQueries)).seconds\n        ).toFixed(2)} queries/second`\n      )\n    }\n  })\n  const drainedPromise = new Promise(resolve => {\n    queue.once(`drain`, resolve)\n  })\n\n  queryJobs.forEach(queryJob => {\n    queue.push(queryJob)\n  })\n  await drainedPromise\n}\n\nconst makePageQueryJob = (state, queryId) => {\n  const page = state.pages.get(queryId)\n  const component = state.components.get(page.componentPath)\n  const { path, componentPath, context } = page\n  const { query } = component\n  return {\n    id: path,\n    query,\n    isPage: true,\n    componentPath,\n    context: {\n      ...page,\n      ...context,\n    },\n  }\n}\n\nconst processPageQueries = async (queryIds, { state, activity }) => {\n  state = state || store.getState()\n  await processQueries(queryIds.map(id => makePageQueryJob(state, id)), {\n    activity,\n  })\n}\n\nconst makeStaticQueryJob = (state, queryId) => {\n  const component = state.staticQueryComponents.get(queryId)\n  const { hash, id, query, componentPath } = component\n  return {\n    id,\n    hash,\n    query,\n    componentPath,\n    context: { path: id },\n  }\n}\n\nconst processStaticQueries = async (queryIds, { state, activity }) => {\n  state = state || store.getState()\n  await processQueries(queryIds.map(id => makeStaticQueryJob(state, id)), {\n    activity,\n  })\n}\n\n/////////////////////////////////////////////////////////////////////\n// Background query daemon (for gatsby develop)\n\n/**\n * Starts a background process that processes any dirty queries\n * whenever one of the following occurs.\n *\n * 1. A node has changed (but only after the api call has finished\n * running)\n * 2. A component query (e.g by editing a React Component) has\n * changed\n *\n * For what constitutes a dirty query, see `calcDirtyQueryIds`\n */\nconst startListener = queue => {\n  const runQueuedActions = () => {\n    const state = store.getState()\n\n    const dirtyQueryIds = calcDirtyQueryIds(state)\n    const { staticQueryIds, pageQueryIds } = groupQueryIds(dirtyQueryIds)\n\n    staticQueryIds\n      .map(id => makeStaticQueryJob(state, id))\n      .forEach(queryJob => {\n        queue.push(queryJob)\n      })\n\n    pageQueryIds\n      .map(id => makePageQueryJob(state, id))\n      .forEach(queryJob => {\n        queue.push(queryJob)\n      })\n  }\n  runQueuedActions()\n  emitter.on(`API_RUNNING_QUEUE_EMPTY`, runQueuedActions)\n  emitter.on(`QUERY_RUNNER_QUERIES_ENQUEUED`, runQueuedActions)\n}\n\n/**\n * Force query processing to run. Noop until `startDaemon` has been\n * called.\n */\nconst runQueries = () => {\n  // A bit hacky bit it works well.\n  emitter.emit(`QUERY_RUNNER_QUERIES_ENQUEUED`)\n}\n\nmodule.exports = {\n  enqueueExtractedQueryId,\n  calcBootstrapDirtyQueryIds,\n  groupQueryIds,\n  processQueries,\n  processPageQueries,\n  processStaticQueries,\n  runQueries,\n  startListener,\n  createQueue: queryQueue.create,\n  jobHandler,\n}\n"],"file":"index.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/query-runner.js b/node_modules/gatsby/dist/query/job-handler.js
similarity index 56%
rename from node_modules/gatsby/dist/internal-plugins/query-runner/query-runner.js
rename to node_modules/gatsby/dist/query/job-handler.js
index ab451c6..1645bed 100644
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-runner.js
+++ b/node_modules/gatsby/dist/query/job-handler.js
@@ -8,35 +8,36 @@ var _graphql = require("graphql");
 
 const fs = require(`fs-extra`);
 
-const report = require(`gatsby-cli/lib/reporter`);
-
-const websocketManager = require(`../../utils/websocket-manager`);
-
 const path = require(`path`);
 
-const _require = require(`../../redux`),
-      store = _require.store;
+const report = require(`gatsby-cli/lib/reporter`);
+
+const _require = require(`../redux/actions`),
+      boundActionCreators = _require.boundActionCreators;
 
-const withResolverContext = require(`../../schema/context`);
+const _require2 = require(`../redux`),
+      store = _require2.store;
 
-const _require2 = require(`../../utils/js-chunk-names`),
-      generatePathChunkName = _require2.generatePathChunkName;
+const withResolverContext = require(`../schema/context`);
 
 const _require3 = require(`./utils`),
       formatErrorDetails = _require3.formatErrorDetails;
 
-const mod = require(`hash-mod`)(999);
+const pageDataUtil = require(`../utils/page-data`);
 
 const resultHashes = {};
 
-// Run query
-module.exports =
+const jobHandler =
 /*#__PURE__*/
 function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (queryJob, component) {
+  var _ref = (0, _asyncToGenerator2.default)(function* ({
+    queryJob
+  }) {
     const _store$getState = store.getState(),
           schema = _store$getState.schema,
-          program = _store$getState.program;
+          program = _store$getState.program,
+          pages = _store$getState.pages,
+          webpackCompilationHash = _store$getState.webpackCompilationHash;
 
     const graphql = (query, context) => (0, _graphql.graphql)(schema, query, context, withResolverContext(context, schema), context); // Run query
 
@@ -75,7 +76,6 @@ ${formatErrorDetails(errorDetails)}`);
 
 
     if (result.pageContext) {
-      delete result.pageContext.jsonName;
       delete result.pageContext.path;
       delete result.pageContext.internalComponentName;
       delete result.pageContext.component;
@@ -89,66 +89,37 @@ ${formatErrorDetails(errorDetails)}`);
 
     const resultJSON = JSON.stringify(result);
 
-    const resultHash = require(`crypto`).createHash(`sha1`).update(resultJSON).digest(`base64`) // Remove potentially unsafe characters. This increases chances of collisions
-    // slightly but it should still be very safe + we get a shorter
-    // url vs hex.
-    .replace(/[^a-zA-Z0-9-_]/g, ``);
-
-    let dataPath;
-
-    if (queryJob.isPage) {
-      dataPath = `${generatePathChunkName(queryJob.jsonName)}-${resultHash}`;
-    } else {
-      dataPath = queryJob.hash;
-    }
-
-    if (process.env.gatsby_executing_command === `develop`) {
-      if (queryJob.isPage) {
-        websocketManager.emitPageData({
-          result,
-          id: queryJob.id
-        });
-      } else {
-        websocketManager.emitStaticQueryData({
-          result,
-          id: queryJob.id
-        });
-      }
-    }
+    const resultHash = require(`crypto`).createHash(`sha1`).update(resultJSON).digest(`base64`);
 
     if (resultHashes[queryJob.id] !== resultHash) {
       resultHashes[queryJob.id] = resultHash;
-      let modInt = ``; // We leave StaticQuery results at public/static/d
-      // as the babel plugin has that path hard-coded
-      // for importing static query results.
-
-      if (queryJob.isPage) {
-        modInt = mod(dataPath).toString();
-      } // Always write file to public/static/d/ folder.
-
-
-      const resultPath = path.join(program.directory, `public`, `static`, `d`, modInt, `${dataPath}.json`);
+      const publicDir = path.join(program.directory, `public`);
 
       if (queryJob.isPage) {
-        dataPath = `${modInt}/${dataPath}`;
+        const page = pages.get(queryJob.id);
+        yield pageDataUtil.write({
+          publicDir
+        }, page, result, webpackCompilationHash);
+      } else {
+        const staticDir = path.join(publicDir, `static`);
+        const resultPath = path.join(staticDir, `d`, `${queryJob.hash}.json`);
+        yield fs.outputFile(resultPath, resultJSON);
       }
+    } // Send event that the page query finished.
 
-      yield fs.outputFile(resultPath, resultJSON);
-      store.dispatch({
-        type: `SET_JSON_DATA_PATH`,
-        payload: {
-          key: queryJob.jsonName,
-          value: dataPath
-        }
-      });
-      return result;
-    }
 
+    boundActionCreators.pageQueryRun({
+      path: queryJob.id,
+      componentPath: queryJob.componentPath,
+      isPage: queryJob.isPage
+    });
     return result;
   });
 
-  return function (_x, _x2) {
+  return function jobHandler(_x) {
     return _ref.apply(this, arguments);
   };
 }();
-//# sourceMappingURL=query-runner.js.map
\ No newline at end of file
+
+module.exports = jobHandler;
+//# sourceMappingURL=job-handler.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/query/job-handler.js.map b/node_modules/gatsby/dist/query/job-handler.js.map
new file mode 100644
index 0000000..4b0e2f3
--- /dev/null
+++ b/node_modules/gatsby/dist/query/job-handler.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/query/job-handler.js"],"names":["fs","require","path","report","boundActionCreators","store","withResolverContext","formatErrorDetails","pageDataUtil","resultHashes","jobHandler","queryJob","getState","schema","program","pages","webpackCompilationHash","graphql","query","context","result","errors","errorDetails","Map","set","isPage","JSON","stringify","pluginCreatorId","panicOnBuild","componentPath","Object","assign","pageContext","internalComponentName","component","componentChunkName","updatedAt","pluginCreator___NODE","resultJSON","resultHash","createHash","update","digest","id","publicDir","join","directory","page","get","write","staticDir","resultPath","hash","outputFile","pageQueryRun","module","exports"],"mappings":"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","sourcesContent":["// @flow\n\nimport { graphql as graphqlFunction } from \"graphql\"\nconst fs = require(`fs-extra`)\nconst path = require(`path`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst { boundActionCreators } = require(`../redux/actions`)\nconst { store } = require(`../redux`)\nconst withResolverContext = require(`../schema/context`)\nconst { formatErrorDetails } = require(`./utils`)\nconst pageDataUtil = require(`../utils/page-data`)\n\nconst resultHashes = {}\n\nconst jobHandler = async ({ queryJob }) => {\n  const { schema, program, pages, webpackCompilationHash } = store.getState()\n\n  const graphql = (query, context) =>\n    graphqlFunction(\n      schema,\n      query,\n      context,\n      withResolverContext(context, schema),\n      context\n    )\n\n  // Run query\n  let result\n  // Nothing to do if the query doesn't exist.\n  if (!queryJob.query || queryJob.query === ``) {\n    result = {}\n  } else {\n    result = await graphql(queryJob.query, queryJob.context)\n  }\n\n  // If there's a graphql error then log the error. If we're building, also\n  // quit.\n  if (result && result.errors) {\n    const errorDetails = new Map()\n    errorDetails.set(`Errors`, result.errors || [])\n    if (queryJob.isPage) {\n      errorDetails.set(`URL path`, queryJob.context.path)\n      errorDetails.set(\n        `Context`,\n        JSON.stringify(queryJob.context.context, null, 2)\n      )\n    }\n    errorDetails.set(`Plugin`, queryJob.pluginCreatorId || `none`)\n    errorDetails.set(`Query`, queryJob.query)\n\n    report.panicOnBuild(`\nThe GraphQL query from ${queryJob.componentPath} failed.\n\n${formatErrorDetails(errorDetails)}`)\n  }\n\n  // Add the page context onto the results.\n  if (queryJob && queryJob.isPage) {\n    result[`pageContext`] = Object.assign({}, queryJob.context)\n  }\n\n  // Delete internal data from pageContext\n  if (result.pageContext) {\n    delete result.pageContext.path\n    delete result.pageContext.internalComponentName\n    delete result.pageContext.component\n    delete result.pageContext.componentChunkName\n    delete result.pageContext.updatedAt\n    delete result.pageContext.pluginCreator___NODE\n    delete result.pageContext.pluginCreatorId\n    delete result.pageContext.componentPath\n    delete result.pageContext.context\n  }\n\n  const resultJSON = JSON.stringify(result)\n  const resultHash = require(`crypto`)\n    .createHash(`sha1`)\n    .update(resultJSON)\n    .digest(`base64`)\n\n  if (resultHashes[queryJob.id] !== resultHash) {\n    resultHashes[queryJob.id] = resultHash\n\n    const publicDir = path.join(program.directory, `public`)\n    if (queryJob.isPage) {\n      const page = pages.get(queryJob.id)\n      await pageDataUtil.write(\n        { publicDir },\n        page,\n        result,\n        webpackCompilationHash\n      )\n    } else {\n      const staticDir = path.join(publicDir, `static`)\n      const resultPath = path.join(staticDir, `d`, `${queryJob.hash}.json`)\n      await fs.outputFile(resultPath, resultJSON)\n    }\n  }\n\n  // Send event that the page query finished.\n  boundActionCreators.pageQueryRun({\n    path: queryJob.id,\n    componentPath: queryJob.componentPath,\n    isPage: queryJob.isPage,\n  })\n\n  return result\n}\n\nmodule.exports = jobHandler\n"],"file":"job-handler.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/query-compiler.js b/node_modules/gatsby/dist/query/query-compiler.js
similarity index 96%
rename from node_modules/gatsby/dist/internal-plugins/query-runner/query-compiler.js
rename to node_modules/gatsby/dist/query/query-compiler.js
index dae2884..0492683 100644
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-compiler.js
+++ b/node_modules/gatsby/dist/query/query-compiler.js
@@ -26,7 +26,7 @@ var _GraphQLCompilerContext = _interopRequireDefault(require("@gatsbyjs/relay-co
 
 var _filterContextForNode = _interopRequireDefault(require("@gatsbyjs/relay-compiler/lib/filterContextForNode"));
 
-var _redux = require("../../redux");
+var _redux = require("../redux");
 
 var _fileParser = _interopRequireDefault(require("./file-parser"));
 
@@ -40,10 +40,10 @@ const normalize = require(`normalize-path`);
 
 const _ = require(`lodash`);
 
-const _require = require(`../../redux/actions`),
+const _require = require(`../redux/actions`),
       boundActionCreators = _require.boundActionCreators;
 
-const websocketManager = require(`../../utils/websocket-manager`);
+const websocketManager = require(`../utils/websocket-manager`);
 
 const printTransforms = _relayCompiler.IRTransforms.printTransforms;
 
@@ -228,7 +228,7 @@ class Runner {
         };
 
         if (query.isStaticQuery) {
-          query.jsonName = `sq--` + _.kebabCase(`${_path.default.relative(_redux.store.getState().program.directory, filePath)}`);
+          query.id = `sq--` + _.kebabCase(`${_path.default.relative(_redux.store.getState().program.directory, filePath)}`);
         }
 
         if (query.isHook && process.env.NODE_ENV === `production` && typeof require(`react`).useContext !== `function`) {
diff --git a/node_modules/gatsby/dist/query/query-compiler.js.map b/node_modules/gatsby/dist/query/query-compiler.js.map
new file mode 100644
index 0000000..921511c
--- /dev/null
+++ b/node_modules/gatsby/dist/query/query-compiler.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/query/query-compiler.js"],"names":["normalize","require","_","boundActionCreators","websocketManager","printTransforms","IRTransforms","ValuesOfCorrectTypeRule","FragmentsOnCompositeTypesRule","KnownTypeNamesRule","LoneAnonymousOperationRule","PossibleFragmentSpreadsRule","ScalarLeafsRule","VariablesAreInputTypesRule","VariablesInAllowedPositionRule","validationRules","lastRunHadErrors","overlayErrorID","resolveThemes","themes","reduce","merged","theme","push","themeDir","Runner","constructor","base","additional","schema","reportError","message","queryErrorMessage","report","format","red","panicOnBuild","process","env","gatsby_executing_command","emitError","compileAll","nodes","parseEverything","write","filesRegex","path","join","files","concat","map","folderPath","glob","sync","nodir","filter","d","match","Array","from","store","getState","components","keys","c","uniq","parser","FileParser","parseFiles","compiledNodes","Map","namePathMap","nameDefMap","nameErrorMap","documents","entries","filePath","doc","errors","length","queryExtractionGraphQLError","componentPath","definitions","forEach","def","name","value","set","compilerContext","GraphQLCompilerContext","addAll","ASTConvert","convertASTDocuments","RelayParser","transform","bind","error","formattedMessage","docName","codeBlock","get","printContext","slice","ctx","node","kind","has","otherNode","text","getRoot","GraphQLIRPrinter","print","query","originalText","isHook","isStaticQuery","hash","id","kebabCase","relative","program","directory","NODE_ENV","useContext","compile","runner","queries"],"mappings":"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","sourcesContent":["// @flow\nimport path from \"path\"\nconst normalize = require(`normalize-path`)\nimport glob from \"glob\"\n\nimport { validate } from \"graphql\"\nimport { IRTransforms } from \"@gatsbyjs/relay-compiler\"\nimport RelayParser from \"@gatsbyjs/relay-compiler/lib/RelayParser\"\nimport ASTConvert from \"@gatsbyjs/relay-compiler/lib/ASTConvert\"\nimport GraphQLCompilerContext from \"@gatsbyjs/relay-compiler/lib/GraphQLCompilerContext\"\nimport filterContextForNode from \"@gatsbyjs/relay-compiler/lib/filterContextForNode\"\nconst _ = require(`lodash`)\n\nimport { store } from \"../redux\"\nconst { boundActionCreators } = require(`../redux/actions`)\nimport FileParser from \"./file-parser\"\nimport GraphQLIRPrinter from \"@gatsbyjs/relay-compiler/lib/GraphQLIRPrinter\"\nimport {\n  graphqlError,\n  graphqlValidationError,\n  multipleRootQueriesError,\n} from \"./graphql-errors\"\nimport report from \"gatsby-cli/lib/reporter\"\nconst websocketManager = require(`../utils/websocket-manager`)\n\nimport type { DocumentNode, GraphQLSchema } from \"graphql\"\n\nconst { printTransforms } = IRTransforms\n\nconst {\n  ValuesOfCorrectTypeRule,\n  FragmentsOnCompositeTypesRule,\n  KnownTypeNamesRule,\n  LoneAnonymousOperationRule,\n  PossibleFragmentSpreadsRule,\n  ScalarLeafsRule,\n  VariablesAreInputTypesRule,\n  VariablesInAllowedPositionRule,\n} = require(`graphql`)\n\ntype RootQuery = {\n  name: string,\n  path: string,\n  text: string,\n  originalText: string,\n  isStaticQuery: boolean,\n  hash: string,\n}\n\ntype Queries = Map<string, RootQuery>\n\nconst validationRules = [\n  ValuesOfCorrectTypeRule,\n  FragmentsOnCompositeTypesRule,\n  KnownTypeNamesRule,\n  LoneAnonymousOperationRule,\n  PossibleFragmentSpreadsRule,\n  ScalarLeafsRule,\n  VariablesAreInputTypesRule,\n  VariablesInAllowedPositionRule,\n]\n\nlet lastRunHadErrors = null\nconst overlayErrorID = `graphql-compiler`\n\nconst resolveThemes = (themes = []) =>\n  themes.reduce((merged, theme) => {\n    merged.push(theme.themeDir)\n    return merged\n  }, [])\n\nclass Runner {\n  base: string\n  additional: string[]\n  schema: GraphQLSchema\n  errors: string[]\n  fragmentsDir: string\n\n  constructor(base: string, additional: string[], schema: GraphQLSchema) {\n    this.base = base\n    this.additional = additional\n    this.schema = schema\n  }\n\n  reportError(message) {\n    const queryErrorMessage = `${report.format.red(`GraphQL Error`)} ${message}`\n    report.panicOnBuild(queryErrorMessage)\n    if (process.env.gatsby_executing_command === `develop`) {\n      websocketManager.emitError(overlayErrorID, queryErrorMessage)\n      lastRunHadErrors = true\n    }\n  }\n\n  async compileAll() {\n    let nodes = await this.parseEverything()\n    return await this.write(nodes)\n  }\n\n  async parseEverything() {\n    const filesRegex = path.join(`/**`, `*.+(t|j)s?(x)`)\n    let files = [\n      path.join(this.base, `src`),\n      path.join(this.base, `.cache`, `fragments`),\n    ]\n      .concat(this.additional.map(additional => path.join(additional, `src`)))\n      .reduce(\n        (merged, folderPath) =>\n          merged.concat(\n            glob.sync(path.join(folderPath, filesRegex), {\n              nodir: true,\n            })\n          ),\n        []\n      )\n    files = files.filter(d => !d.match(/\\.d\\.ts$/))\n    files = files.map(normalize)\n\n    // Ensure all page components added as they're not necessarily in the\n    // pages directory e.g. a plugin could add a page component.  Plugins\n    // *should* copy their components (if they add a query) to .cache so that\n    // our babel plugin to remove the query on building is active (we don't\n    // run babel on code in node_modules). Otherwise the component will throw\n    // an error in the browser of \"graphql is not defined\".\n    files = files.concat(\n      Array.from(store.getState().components.keys(), c => normalize(c))\n    )\n    files = _.uniq(files)\n\n    let parser = new FileParser()\n\n    return await parser.parseFiles(files)\n  }\n\n  async write(nodes: Map<string, DocumentNode>): Promise<Queries> {\n    const compiledNodes: Queries = new Map()\n    const namePathMap = new Map()\n    const nameDefMap = new Map()\n    const nameErrorMap = new Map()\n    const documents = []\n\n    for (let [filePath, doc] of nodes.entries()) {\n      let errors = validate(this.schema, doc, validationRules)\n\n      if (errors && errors.length) {\n        this.reportError(graphqlValidationError(errors, filePath))\n        boundActionCreators.queryExtractionGraphQLError({\n          componentPath: filePath,\n        })\n        return compiledNodes\n      }\n\n      documents.push(doc)\n      doc.definitions.forEach((def: any) => {\n        const name: string = def.name.value\n        namePathMap.set(name, filePath)\n        nameDefMap.set(name, def)\n      })\n    }\n\n    let compilerContext = new GraphQLCompilerContext(this.schema)\n    try {\n      compilerContext = compilerContext.addAll(\n        ASTConvert.convertASTDocuments(\n          this.schema,\n          documents,\n          validationRules,\n          RelayParser.transform.bind(RelayParser)\n        )\n      )\n    } catch (error) {\n      const { formattedMessage, docName, message, codeBlock } = graphqlError(\n        namePathMap,\n        nameDefMap,\n        error\n      )\n      nameErrorMap.set(docName, { formattedMessage, message, codeBlock })\n      boundActionCreators.queryExtractionGraphQLError({\n        componentPath: namePathMap.get(docName),\n        error: formattedMessage,\n      })\n      this.reportError(formattedMessage)\n      return false\n    }\n\n    // relay-compiler v1.5.0 added \"StripUnusedVariablesTransform\" to\n    // printTransforms. Unfortunately it currently doesn't detect variables\n    // in input objects widely used in gatsby, and therefore removing\n    // variable declaration from queries.\n    // As a temporary workaround remove that transform by slicing printTransforms.\n    const printContext = printTransforms\n      .slice(0, -1)\n      .reduce((ctx, transform) => transform(ctx, this.schema), compilerContext)\n\n    compilerContext.documents().forEach((node: { name: string }) => {\n      if (node.kind !== `Root`) return\n\n      const { name } = node\n      let filePath = namePathMap.get(name) || ``\n\n      if (compiledNodes.has(filePath)) {\n        let otherNode = compiledNodes.get(filePath)\n        this.reportError(\n          multipleRootQueriesError(\n            filePath,\n            nameDefMap.get(name),\n            otherNode && nameDefMap.get(otherNode.name)\n          )\n        )\n        boundActionCreators.queryExtractionGraphQLError({\n          componentPath: filePath,\n        })\n        return\n      }\n\n      let text = filterContextForNode(printContext.getRoot(name), printContext)\n        .documents()\n        .map(GraphQLIRPrinter.print)\n        .join(`\\n`)\n\n      const query = {\n        name,\n        text,\n        originalText: nameDefMap.get(name).text,\n        path: filePath,\n        isHook: nameDefMap.get(name).isHook,\n        isStaticQuery: nameDefMap.get(name).isStaticQuery,\n        hash: nameDefMap.get(name).hash,\n      }\n\n      if (query.isStaticQuery) {\n        query.id =\n          `sq--` +\n          _.kebabCase(\n            `${path.relative(store.getState().program.directory, filePath)}`\n          )\n      }\n\n      if (\n        query.isHook &&\n        process.env.NODE_ENV === `production` &&\n        typeof require(`react`).useContext !== `function`\n      ) {\n        report.panicOnBuild(\n          `You're likely using a version of React that doesn't support Hooks\\n` +\n            `Please update React and ReactDOM to 16.8.0 or later to use the useStaticQuery hook.`\n        )\n      }\n\n      compiledNodes.set(filePath, query)\n    })\n\n    if (\n      process.env.gatsby_executing_command === `develop` &&\n      lastRunHadErrors\n    ) {\n      websocketManager.emitError(overlayErrorID, null)\n      lastRunHadErrors = false\n    }\n\n    return compiledNodes\n  }\n}\nexport { Runner, resolveThemes }\n\nexport default async function compile(): Promise<Map<string, RootQuery>> {\n  // TODO: swap plugins to themes\n  const { program, schema, themes } = store.getState()\n\n  const runner = new Runner(\n    program.directory,\n    resolveThemes(themes.themes),\n    schema\n  )\n\n  const queries = await runner.compileAll()\n\n  return queries\n}\n"],"file":"query-compiler.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/query/query-queue.js b/node_modules/gatsby/dist/query/query-queue.js
new file mode 100644
index 0000000..68eff91
--- /dev/null
+++ b/node_modules/gatsby/dist/query/query-queue.js
@@ -0,0 +1,59 @@
+"use strict";
+
+var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
+
+var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
+
+const Queue = require(`better-queue`);
+
+const FastMemoryStore = require(`./better-queue-custom-store`);
+
+const jobHandler = require(`./job-handler`);
+
+const makeBaseOptions = () => {
+  return {
+    concurrent: 4,
+    store: FastMemoryStore()
+  };
+};
+
+const defaultPostHandler = ({
+  queryJob,
+  result
+}) => result;
+
+const create = ({
+  postHandler = defaultPostHandler,
+  betterQueueOptions = {}
+} = {}) => {
+  const queueOptions = Object.assign({}, makeBaseOptions, betterQueueOptions);
+  const queue = new Queue(
+  /*#__PURE__*/
+  function () {
+    var _ref = (0, _asyncToGenerator2.default)(function* (queryJob, callback) {
+      try {
+        const result = yield jobHandler({
+          queryJob
+        });
+        postHandler({
+          queryJob,
+          result
+        });
+        callback(null, result);
+      } catch (err) {
+        console.log(`Error running queryRunner`, err);
+        callback(err);
+      }
+    });
+
+    return function (_x, _x2) {
+      return _ref.apply(this, arguments);
+    };
+  }(), queueOptions);
+  return queue;
+};
+
+module.exports = {
+  create
+};
+//# sourceMappingURL=query-queue.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/query/query-queue.js.map b/node_modules/gatsby/dist/query/query-queue.js.map
new file mode 100644
index 0000000..2583274
--- /dev/null
+++ b/node_modules/gatsby/dist/query/query-queue.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/query/query-queue.js"],"names":["Queue","require","FastMemoryStore","jobHandler","makeBaseOptions","concurrent","store","defaultPostHandler","queryJob","result","create","postHandler","betterQueueOptions","queueOptions","queue","callback","err","console","log","module","exports"],"mappings":";;;;;;AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAE,cAAF,CAArB;;AAEA,MAAMC,eAAe,GAAGD,OAAO,CAAE,6BAAF,CAA/B;;AACA,MAAME,UAAU,GAAGF,OAAO,CAAE,eAAF,CAA1B;;AAEA,MAAMG,eAAe,GAAG,MAAM;AAC5B,SAAO;AACLC,IAAAA,UAAU,EAAE,CADP;AAELC,IAAAA,KAAK,EAAEJ,eAAe;AAFjB,GAAP;AAID,CALD;;AAOA,MAAMK,kBAAkB,GAAG,CAAC;AAAEC,EAAAA,QAAF;AAAYC,EAAAA;AAAZ,CAAD,KAA0BA,MAArD;;AAEA,MAAMC,MAAM,GAAG,CAAC;AACdC,EAAAA,WAAW,GAAGJ,kBADA;AAEdK,EAAAA,kBAAkB,GAAG;AAFP,IAGZ,EAHW,KAGJ;AACT,QAAMC,YAAY,qBAAQT,eAAR,EAA4BQ,kBAA5B,CAAlB;AACA,QAAME,KAAK,GAAG,IAAId,KAAJ;AAAA;AAAA;AAAA,+CAAU,WAAOQ,QAAP,EAAiBO,QAAjB,EAA8B;AACpD,UAAI;AACF,cAAMN,MAAM,SAASN,UAAU,CAAC;AAAEK,UAAAA;AAAF,SAAD,CAA/B;AACAG,QAAAA,WAAW,CAAC;AAAEH,UAAAA,QAAF;AAAYC,UAAAA;AAAZ,SAAD,CAAX;AACAM,QAAAA,QAAQ,CAAC,IAAD,EAAON,MAAP,CAAR;AACD,OAJD,CAIE,OAAOO,GAAP,EAAY;AACZC,QAAAA,OAAO,CAACC,GAAR,CAAa,2BAAb,EAAyCF,GAAzC;AACAD,QAAAA,QAAQ,CAACC,GAAD,CAAR;AACD;AACF,KATa;;AAAA;AAAA;AAAA;AAAA,OASXH,YATW,CAAd;AAUA,SAAOC,KAAP;AACD,CAhBD;;AAkBAK,MAAM,CAACC,OAAP,GAAiB;AACfV,EAAAA;AADe,CAAjB","sourcesContent":["const Queue = require(`better-queue`)\n\nconst FastMemoryStore = require(`./better-queue-custom-store`)\nconst jobHandler = require(`./job-handler`)\n\nconst makeBaseOptions = () => {\n  return {\n    concurrent: 4,\n    store: FastMemoryStore(),\n  }\n}\n\nconst defaultPostHandler = ({ queryJob, result }) => result\n\nconst create = ({\n  postHandler = defaultPostHandler,\n  betterQueueOptions = {},\n} = {}) => {\n  const queueOptions = { ...makeBaseOptions, ...betterQueueOptions }\n  const queue = new Queue(async (queryJob, callback) => {\n    try {\n      const result = await jobHandler({ queryJob })\n      postHandler({ queryJob, result })\n      callback(null, result)\n    } catch (err) {\n      console.log(`Error running queryRunner`, err)\n      callback(err)\n    }\n  }, queueOptions)\n  return queue\n}\n\nmodule.exports = {\n  create,\n}\n"],"file":"query-queue.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/query-watcher.js b/node_modules/gatsby/dist/query/query-watcher.js
similarity index 80%
rename from node_modules/gatsby/dist/internal-plugins/query-runner/query-watcher.js
rename to node_modules/gatsby/dist/query/query-watcher.js
index f3b3618..748b24c 100644
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-watcher.js
+++ b/node_modules/gatsby/dist/query/query-watcher.js
@@ -17,21 +17,18 @@ const path = require(`path`);
 
 const slash = require(`slash`);
 
-const _require = require(`../../redux/`),
+const _require = require(`../redux/`),
       store = _require.store,
       emitter = _require.emitter;
 
-const _require2 = require(`../../redux/actions`),
+const _require2 = require(`../redux/actions`),
       boundActionCreators = _require2.boundActionCreators;
 
 const queryCompiler = require(`./query-compiler`).default;
 
 const report = require(`gatsby-cli/lib/reporter`);
 
-const _require3 = require(`./page-query-runner`),
-      queueQueryForPathname = _require3.queueQueryForPathname,
-      runQueuedQueries = _require3.runQueuedActions,
-      runQueries = _require3.runQueries;
+const queryRunner = require(`./index`);
 
 const debug = require(`debug`)(`gatsby:query-watcher`);
 
@@ -55,9 +52,9 @@ const handleComponentsWithRemovedQueries = ({
       debug(`Static query was removed from ${c.componentPath}`);
       store.dispatch({
         type: `REMOVE_STATIC_QUERY`,
-        payload: c.jsonName
+        payload: c.id
       });
-      boundActionCreators.deleteComponentsDependencies([c.jsonName]);
+      boundActionCreators.deleteComponentsDependencies([c.id]);
     }
   });
 };
@@ -69,7 +66,7 @@ const handleQuery = ({
   // If this is a static query
   // Add action / reducer + watch staticquery files
   if (query.isStaticQuery) {
-    const oldQuery = staticQueryComponents.get(query.jsonName);
+    const oldQuery = staticQueryComponents.get(query.id);
     const isNewQuery = !oldQuery; // Compare query text because text is compiled query with any attached
     // fragments and we want to rerun queries if fragments are edited.
     // Compare hash because hash is used for identyfing query and
@@ -78,16 +75,15 @@ const handleQuery = ({
 
     if (isNewQuery || oldQuery.hash !== query.hash || oldQuery.text !== query.text) {
       boundActionCreators.replaceStaticQuery({
+        id: query.id,
         name: query.name,
         componentPath: query.path,
-        id: query.jsonName,
-        jsonName: query.jsonName,
         query: query.text,
         hash: query.hash
       });
       debug(`Static query in ${component} ${isNewQuery ? `was added` : `has changed`}.`);
-      boundActionCreators.deleteComponentsDependencies([query.jsonName]);
-      queueQueryForPathname(query.jsonName);
+      boundActionCreators.deleteComponentsDependencies([query.id]);
+      queryRunner.enqueueExtractedQueryId(query.id);
     }
 
     return true;
@@ -150,7 +146,7 @@ const updateStateAndRunQueries = isFirstRun => {
       `);
     }
 
-    runQueuedQueries();
+    queryRunner.runQueries();
     return null;
   });
 };
@@ -201,13 +197,13 @@ const queueQueriesForPageComponent = componentPath => {
   // Re-running the queries will add back data dependencies.
 
   boundActionCreators.deleteComponentsDependencies(pages.map(p => p.path || p.id));
-  pages.forEach(page => queueQueryForPathname(page.path));
-  runQueries();
+  pages.forEach(page => queryRunner.enqueueExtractedQueryId(page.path));
+  queryRunner.runQueries();
 };
 
 const runQueryForPage = path => {
-  queueQueryForPathname(path);
-  runQueries();
+  queryRunner.enqueueExtractedQueryId(path);
+  queryRunner.runQueries();
 };
 
 exports.queueQueriesForPageComponent = queueQueriesForPageComponent;
@@ -250,49 +246,43 @@ const watch = rootDir => {
   filesToWatch.forEach(filePath => watcher.add(filePath));
 };
 
-if (process.env.gatsby_executing_command === `develop`) {
-  let bootstrapFinished = false;
-  emitter.on(`BOOTSTRAP_FINISHED`, () => {
-    bootstrapFinished = true;
-  });
+exports.startWatchDeletePage = () => {
   emitter.on(`DELETE_PAGE`, action => {
-    if (bootstrapFinished) {
-      const componentPath = slash(action.payload.component);
+    const componentPath = slash(action.payload.component);
 
-      const _store$getState2 = store.getState(),
-            pages = _store$getState2.pages;
+    const _store$getState2 = store.getState(),
+          pages = _store$getState2.pages;
 
-      let otherPageWithTemplateExists = false;
+    let otherPageWithTemplateExists = false;
 
-      for (var _iterator = pages.values(), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
-        var _ref;
+    for (var _iterator = pages.values(), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
+      var _ref;
 
-        if (_isArray) {
-          if (_i >= _iterator.length) break;
-          _ref = _iterator[_i++];
-        } else {
-          _i = _iterator.next();
-          if (_i.done) break;
-          _ref = _i.value;
-        }
+      if (_isArray) {
+        if (_i >= _iterator.length) break;
+        _ref = _iterator[_i++];
+      } else {
+        _i = _iterator.next();
+        if (_i.done) break;
+        _ref = _i.value;
+      }
 
-        let page = _ref;
+      let page = _ref;
 
-        if (slash(page.component) === componentPath) {
-          otherPageWithTemplateExists = true;
-          break;
-        }
+      if (slash(page.component) === componentPath) {
+        otherPageWithTemplateExists = true;
+        break;
       }
+    }
 
-      if (!otherPageWithTemplateExists) {
-        store.dispatch({
-          type: `REMOVE_TEMPLATE_COMPONENT`,
-          payload: {
-            componentPath
-          }
-        });
-      }
+    if (!otherPageWithTemplateExists) {
+      store.dispatch({
+        type: `REMOVE_TEMPLATE_COMPONENT`,
+        payload: {
+          componentPath
+        }
+      });
     }
   });
-}
+};
 //# sourceMappingURL=query-watcher.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/query/query-watcher.js.map b/node_modules/gatsby/dist/query/query-watcher.js.map
new file mode 100644
index 0000000..0a5d192
--- /dev/null
+++ b/node_modules/gatsby/dist/query/query-watcher.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/query/query-watcher.js"],"names":["_","require","chokidar","path","slash","store","emitter","boundActionCreators","queryCompiler","default","report","queryRunner","debug","getQueriesSnapshot","state","getState","snapshot","components","Map","staticQueryComponents","handleComponentsWithRemovedQueries","queries","forEach","c","query","has","componentPath","dispatch","type","payload","id","deleteComponentsDependencies","handleQuery","component","isStaticQuery","oldQuery","get","isNewQuery","hash","text","replaceStaticQuery","name","enqueueExtractedQueryId","updateStateAndRunQueries","isFirstRun","then","size","queryExtracted","queriesWillNotRun","queryWillRun","watchComponent","warn","log","stripIndent","runQueries","clearInactiveComponents","pages","activeTemplates","Set","page","add","exports","extractQueries","process","env","NODE_ENV","watch","program","directory","queueQueriesForPageComponent","getPagesForComponent","map","p","runQueryForPage","values","filter","filesToWatch","watcher","debounceCompile","debounce","rootDir","join","on","filePath","startWatchDeletePage","action","otherPageWithTemplateExists"],"mappings":"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","sourcesContent":["/** *\n * Jobs of this module\n * - Maintain the list of components in the Redux store. So monitor new components\n *   and add/remove components.\n * - Watch components for query changes and extract these and update the store.\n * - Ensure all page queries are run as part of bootstrap and report back when\n *   this is done\n * - Whenever a query changes, re-run all pages that rely on this query.\n ***/\n\nconst _ = require(`lodash`)\nconst chokidar = require(`chokidar`)\nconst path = require(`path`)\nconst slash = require(`slash`)\n\nconst { store, emitter } = require(`../redux/`)\nconst { boundActionCreators } = require(`../redux/actions`)\nconst queryCompiler = require(`./query-compiler`).default\nconst report = require(`gatsby-cli/lib/reporter`)\nconst queryRunner = require(`./index`)\nconst debug = require(`debug`)(`gatsby:query-watcher`)\n\nconst getQueriesSnapshot = () => {\n  const state = store.getState()\n\n  const snapshot = {\n    components: new Map(state.components),\n    staticQueryComponents: new Map(state.staticQueryComponents),\n  }\n\n  return snapshot\n}\n\nconst handleComponentsWithRemovedQueries = (\n  { components, staticQueryComponents },\n  queries\n) => {\n  // If a component had static query and it doesn't have it\n  // anymore - update the store\n  staticQueryComponents.forEach(c => {\n    if (c.query !== `` && !queries.has(c.componentPath)) {\n      debug(`Static query was removed from ${c.componentPath}`)\n      store.dispatch({\n        type: `REMOVE_STATIC_QUERY`,\n        payload: c.id,\n      })\n      boundActionCreators.deleteComponentsDependencies([c.id])\n    }\n  })\n}\n\nconst handleQuery = (\n  { components, staticQueryComponents },\n  query,\n  component\n) => {\n  // If this is a static query\n  // Add action / reducer + watch staticquery files\n  if (query.isStaticQuery) {\n    const oldQuery = staticQueryComponents.get(query.id)\n    const isNewQuery = !oldQuery\n\n    // Compare query text because text is compiled query with any attached\n    // fragments and we want to rerun queries if fragments are edited.\n    // Compare hash because hash is used for identyfing query and\n    // passing data to component in development. Hash can change if user will\n    // format query text, but it doesn't mean that compiled text will change.\n    if (\n      isNewQuery ||\n      oldQuery.hash !== query.hash ||\n      oldQuery.text !== query.text\n    ) {\n      boundActionCreators.replaceStaticQuery({\n        id: query.id,\n        name: query.name,\n        componentPath: query.path,\n        query: query.text,\n        hash: query.hash,\n      })\n\n      debug(\n        `Static query in ${component} ${\n          isNewQuery ? `was added` : `has changed`\n        }.`\n      )\n\n      boundActionCreators.deleteComponentsDependencies([query.id])\n      queryRunner.enqueueExtractedQueryId(query.id)\n    }\n    return true\n  }\n\n  return false\n}\n\nconst updateStateAndRunQueries = isFirstRun => {\n  const snapshot = getQueriesSnapshot()\n  return queryCompiler().then(queries => {\n    // If there's an error while extracting queries, the queryCompiler returns false\n    // or zero results.\n    // Yeah, should probably be an error but don't feel like threading the error\n    // all the way here.\n    if (!queries || queries.size === 0) {\n      return null\n    }\n    handleComponentsWithRemovedQueries(snapshot, queries)\n\n    // Run action for each component\n    const { components } = snapshot\n    components.forEach(c =>\n      boundActionCreators.queryExtracted({\n        componentPath: c.componentPath,\n        query: queries.get(c.componentPath)?.text || ``,\n      })\n    )\n\n    let queriesWillNotRun = false\n    queries.forEach((query, component) => {\n      const queryWillRun = handleQuery(snapshot, query, component)\n\n      if (queryWillRun) {\n        watchComponent(component)\n        // Check if this is a page component.\n        // If it is and this is our first run during bootstrap,\n        // show a warning about having a query in a non-page component.\n      } else if (isFirstRun && !snapshot.components.has(component)) {\n        report.warn(\n          `The GraphQL query in the non-page component \"${component}\" will not be run.`\n        )\n        queriesWillNotRun = true\n      }\n    })\n\n    if (queriesWillNotRun) {\n      report.log(report.stripIndent`\n\n        Exported queries are only executed for Page components. It's possible you're\n        trying to create pages in your gatsby-node.js and that's failing for some\n        reason.\n\n        If the failing component(s) is a regular component and not intended to be a page\n        component, you generally want to use a <StaticQuery> (https://gatsbyjs.org/docs/static-query)\n        instead of exporting a page query.\n\n        If you're more experienced with GraphQL, you can also export GraphQL\n        fragments from components and compose the fragments in the Page component\n        query and pass data down into the child component — http://graphql.org/learn/queries/#fragments\n\n      `)\n    }\n\n    queryRunner.runQueries()\n\n    return null\n  })\n}\n\n/**\n * Removes components templates that aren't used by any page from redux store.\n */\nconst clearInactiveComponents = () => {\n  const { components, pages } = store.getState()\n\n  const activeTemplates = new Set()\n  pages.forEach(page => {\n    // Set will guarantee uniqeness of entires\n    activeTemplates.add(slash(page.component))\n  })\n\n  components.forEach(component => {\n    if (!activeTemplates.has(component.componentPath)) {\n      debug(\n        `${\n          component.componentPath\n        } component was removed because it isn't used by any page`\n      )\n      store.dispatch({\n        type: `REMOVE_TEMPLATE_COMPONENT`,\n        payload: component,\n      })\n    }\n  })\n}\n\nexports.extractQueries = () => {\n  // Remove template components that point to not existing page templates.\n  // We need to do this, because components data is cached and there might\n  // be changes applied when development server isn't running. This is needed\n  // only in initial run, because during development state will be adjusted.\n  clearInactiveComponents()\n\n  return updateStateAndRunQueries(true).then(() => {\n    // During development start watching files to recompile & run\n    // queries on the fly.\n    if (process.env.NODE_ENV !== `production`) {\n      watch(store.getState().program.directory)\n    }\n  })\n}\n\nconst queueQueriesForPageComponent = componentPath => {\n  const pages = getPagesForComponent(componentPath)\n  // Remove page data dependencies before re-running queries because\n  // the changing of the query could have changed the data dependencies.\n  // Re-running the queries will add back data dependencies.\n  boundActionCreators.deleteComponentsDependencies(\n    pages.map(p => p.path || p.id)\n  )\n  pages.forEach(page => queryRunner.enqueueExtractedQueryId(page.path))\n  queryRunner.runQueries()\n}\n\nconst runQueryForPage = path => {\n  queryRunner.enqueueExtractedQueryId(path)\n  queryRunner.runQueries()\n}\n\nexports.queueQueriesForPageComponent = queueQueriesForPageComponent\nexports.runQueryForPage = runQueryForPage\n\nconst getPagesForComponent = componentPath => {\n  const state = store.getState()\n  return [...state.pages.values()].filter(\n    p => p.componentPath === componentPath\n  )\n}\n\nconst filesToWatch = new Set()\nlet watcher\nconst watchComponent = componentPath => {\n  // We don't start watching until mid-way through the bootstrap so ignore\n  // new components being added until then. This doesn't affect anything as\n  // when extractQueries is called from bootstrap, we make sure that all\n  // components are being watched.\n  if (\n    process.env.NODE_ENV !== `production` &&\n    !filesToWatch.has(componentPath)\n  ) {\n    filesToWatch.add(componentPath)\n    if (watcher) {\n      watcher.add(componentPath)\n    }\n  }\n}\n\nconst debounceCompile = _.debounce(() => {\n  updateStateAndRunQueries()\n}, 100)\n\nexports.watchComponent = watchComponent\nexports.debounceCompile = debounceCompile\n\nconst watch = rootDir => {\n  if (watcher) return\n\n  watcher = chokidar\n    .watch(slash(path.join(rootDir, `/src/**/*.{js,jsx,ts,tsx}`)))\n    .on(`change`, path => {\n      debounceCompile()\n    })\n\n  filesToWatch.forEach(filePath => watcher.add(filePath))\n}\n\nexports.startWatchDeletePage = () => {\n  emitter.on(`DELETE_PAGE`, action => {\n    const componentPath = slash(action.payload.component)\n    const { pages } = store.getState()\n    let otherPageWithTemplateExists = false\n    for (let page of pages.values()) {\n      if (slash(page.component) === componentPath) {\n        otherPageWithTemplateExists = true\n        break\n      }\n    }\n    if (!otherPageWithTemplateExists) {\n      store.dispatch({\n        type: `REMOVE_TEMPLATE_COMPONENT`,\n        payload: {\n          componentPath,\n        },\n      })\n    }\n  })\n}\n"],"file":"query-watcher.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/internal-plugins/query-runner/utils.js b/node_modules/gatsby/dist/query/utils.js
similarity index 100%
rename from node_modules/gatsby/dist/internal-plugins/query-runner/utils.js
rename to node_modules/gatsby/dist/query/utils.js
diff --git a/node_modules/gatsby/dist/query/utils.js.map b/node_modules/gatsby/dist/query/utils.js.map
new file mode 100644
index 0000000..efc43a2
--- /dev/null
+++ b/node_modules/gatsby/dist/query/utils.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/query/utils.js"],"names":["indentString","string","replace","formatErrorDetails","errorDetails","Array","from","entries","map","name","details","toString","join"],"mappings":";;;;;AAEA,MAAMA,YAAY,GAAIC,MAAD,IAA4BA,MAAM,CAACC,OAAP,CAAe,KAAf,EAAuB,MAAvB,CAAjD;;;;AAEA,MAAMC,kBAAkB,GAAIC,YAAD,IACzBC,KAAK,CAACC,IAAN,CAAWF,YAAY,CAACG,OAAb,EAAX,EACGC,GADH,CAEI,CAAC,CAACC,IAAD,EAAOC,OAAP,CAAD,KAAsB,GAAED,IAAK;IAC/BT,YAAY,CAACU,OAAO,CAACC,QAAR,EAAD,CAAqB,EAHnC,EAKGC,IALH,CAKS,IALT,CADF","sourcesContent":["// @flow\n\nconst indentString = (string: string): string => string.replace(/\\n/g, `\\n  `)\n\nconst formatErrorDetails = (errorDetails: Map<string, any>): string =>\n  Array.from(errorDetails.entries())\n    .map(\n      ([name, details]) => `${name}:\n  ${indentString(details.toString())}`\n    )\n    .join(`\\n`)\n\nexport { indentString, formatErrorDetails }\n"],"file":"utils.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/redux/actions.js b/node_modules/gatsby/dist/redux/actions.js
index bbb28ad..1a24e02 100644
--- a/node_modules/gatsby/dist/redux/actions.js
+++ b/node_modules/gatsby/dist/redux/actions.js
@@ -246,19 +246,15 @@ ${reservedFields.map(f => `  * "${f}"`).join(`\n`)}
     report.panic(`See the documentation for createPage https://www.gatsbyjs.org/docs/actions/#createPage`);
   }
 
-  let jsonName;
   let internalComponentName;
 
   if (page.path === `/`) {
-    jsonName = `index`;
     internalComponentName = `ComponentIndex`;
   } else {
-    jsonName = `${kebabHash(page.path)}`;
     internalComponentName = `Component${pascalCase(page.path)}`;
   }
 
   let internalPage = {
-    jsonName,
     internalComponentName,
     path: page.path,
     matchPath: page.matchPath,
diff --git a/node_modules/gatsby/dist/redux/actions.js.map b/node_modules/gatsby/dist/redux/actions.js.map
index fcd12fb..ee27e6e 100644
--- a/node_modules/gatsby/dist/redux/actions.js.map
+++ b/node_modules/gatsby/dist/redux/actions.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/redux/actions.js"],"names":["Joi","require","chalk","_","bindActionCreators","stripIndent","report","path","fs","truePath","url","kebabHash","slash","hasNodeChanged","getNode","trackInlineObjectsInRootNode","store","fileExistsSync","sync","joiSchemas","generateComponentChunkName","actions","findChildrenRecursively","children","concat","map","child","newChildren","isArray","length","deletePage","page","type","payload","pascalCase","flow","camelCase","upperFirst","hasWarnedForPageComponentInvalidContext","Set","hasWarnedForPageComponentInvalidCasing","pageComponentCache","fileOkCache","createPage","plugin","actionOptions","noPageOrComponent","name","message","process","env","NODE_ENV","console","log","bold","red","isObject","context","reservedFields","invalidFields","Object","keys","pick","singularMessage","pluralMessage","error","f","join","JSON","stringify","some","panic","has","component","warn","add","originalPageComponent","trueComponentPath","markers","split","letter","index","isAbsolute","jsonName","internalComponentName","internalPage","matchPath","componentChunkName","isCreatedByStatefulCreatePages","traceId","updatedAt","Date","now","includes","fileName","fileContent","readFileSync","notEmpty","includesDefaultExport","test","extname","relativePath","relative","getState","program","directory","panicOnBuild","oldPage","pages","get","contextModified","isEqual","deleteNode","options","args","id","msg","node","createDeleteAction","deleteAction","deleteDescendantsActions","deleteNodes","nodes","descendantNodes","flatten","n","deleteNodesAction","typeOwners","createNode","internal","array","parent","owner","result","validate","nodeSchema","fields","Error","oldNode","pluginName","parentSpan","setTag","deleteActions","updateNodeAction","contentDigest","touchNode","nodeId","createNodeField","value","fieldName","fieldValue","fieldOwners","schemaFieldName","fieldOwner","createParentChildLink","push","uniq","createPageDependency","connection","deleteComponentsDependencies","paths","replaceComponentQuery","query","componentPath","replaceStaticQuery","setWebpackConfig","config","replaceWebpackConfig","setBabelOptions","exit","setBabelPlugin","setBabelPreset","createJob","job","setJob","endJob","setPluginStatus","status","maybeAddPathPrefix","pathPrefix","parsed","parse","isRelativeProtocol","startsWith","protocol","createRedirect","fromPath","isPermanent","redirectInBrowser","toPath","rest","prefixPaths","addThirdPartySchema","schema","createTypes","types","queryExtracted","queryExtractionGraphQLError","queryExtractedBabelSuccess","queryExtractionBabelError","setProgramStatus","pageQueryRun","isPage","exports","boundActionCreators","dispatch"],"mappings":";;;;;;AACA,MAAMA,GAAG,GAAGC,OAAO,CAAE,KAAF,CAAnB;;AACA,MAAMC,KAAK,GAAGD,OAAO,CAAE,OAAF,CAArB;;AACA,MAAME,CAAC,GAAGF,OAAO,CAAE,QAAF,CAAjB;;iBAC+BA,OAAO,CAAE,OAAF,C;MAA9BG,kB,YAAAA,kB;;kBACgBH,OAAO,CAAE,aAAF,C;MAAvBI,W,aAAAA,W;;AACR,MAAMC,MAAM,GAAGL,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMM,IAAI,GAAGN,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMO,EAAE,GAAGP,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAMQ,QAAQ,GAAGR,OAAO,CAAE,gBAAF,CAAxB;;AACA,MAAMS,GAAG,GAAGT,OAAO,CAAE,KAAF,CAAnB;;AACA,MAAMU,SAAS,GAAGV,OAAO,CAAE,YAAF,CAAzB;;AACA,MAAMW,KAAK,GAAGX,OAAO,CAAE,OAAF,CAArB;;kBACoCA,OAAO,CAAE,aAAF,C;MAAnCY,c,aAAAA,c;MAAgBC,O,aAAAA,O;;kBACiBb,OAAO,CAAE,qBAAF,C;MAAxCc,4B,aAAAA,4B;;kBACUd,OAAO,CAAE,SAAF,C;MAAjBe,K,aAAAA,K;;AACR,MAAMC,cAAc,GAAGhB,OAAO,CAAE,kBAAF,CAAP,CAA4BiB,IAAnD;;AACA,MAAMC,UAAU,GAAGlB,OAAO,CAAE,oBAAF,CAA1B;;kBACuCA,OAAO,CAAE,yBAAF,C;MAAtCmB,0B,aAAAA,0B;;AAER,MAAMC,OAAO,GAAG,EAAhB;;AAEA,MAAMC,uBAAuB,GAAG,CAACC,QAAQ,GAAG,EAAZ,KAAmB;AACjDA,EAAAA,QAAQ,GAAGA,QAAQ,CAACC,MAAT,CACT,GAAGD,QAAQ,CAACE,GAAT,CAAaC,KAAK,IAAI;AACvB,UAAMC,WAAW,GAAGb,OAAO,CAACY,KAAD,CAAP,CAAeH,QAAnC;;AACA,QAAIpB,CAAC,CAACyB,OAAF,CAAUD,WAAV,KAA0BA,WAAW,CAACE,MAAZ,GAAqB,CAAnD,EAAsD;AACpD,aAAOP,uBAAuB,CAACK,WAAD,CAA9B;AACD,KAFD,MAEO;AACL,aAAO,EAAP;AACD;AACF,GAPE,CADM,CAAX;AAWA,SAAOJ,QAAP;AACD,CAbD;;AA6CA;;;;;;;;AAQAF,OAAO,CAACS,UAAR,GAAsBC,IAAD,IAAqB;AACxC,SAAO;AACLC,IAAAA,IAAI,EAAG,aADF;AAELC,IAAAA,OAAO,EAAEF;AAFJ,GAAP;AAID,CALD;;AAOA,MAAMG,UAAU,GAAG/B,CAAC,CAACgC,IAAF,CACjBhC,CAAC,CAACiC,SADe,EAEjBjC,CAAC,CAACkC,UAFe,CAAnB;;AAIA,MAAMC,uCAAuC,GAAG,IAAIC,GAAJ,EAAhD;AACA,MAAMC,sCAAsC,GAAG,IAAID,GAAJ,EAA/C;AACA,MAAME,kBAAkB,GAAG,EAA3B;AACA,MAAMC,WAAW,GAAG,EAApB;AAEA;;;;;;;;;;;;;;;;;;;;;AAoBArB,OAAO,CAACsB,UAAR,GAAqB,CACnBZ,IADmB,EAEnBa,MAFmB,EAGnBC,aAHmB,KAIhB;AACH,MAAIC,iBAAiB,GAAG,KAAxB;AACA,MAAIC,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAAChB,IAAI,CAACxB,IAAV,EAAgB;AACd,UAAMyC,OAAO,GAAI,GAAED,IAAK,8CAAxB,CADc,CAEd;;AACA,QAAIE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCC,MAAAA,OAAO,CAACC,GAAR,CAAYnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CAAeP,OAAf,CAAZ;AACAI,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYtB,IAAZ;AACD,KAJD,MAIO;AACL,aAAOiB,OAAP;AACD;;AACDF,IAAAA,iBAAiB,GAAG,IAApB;AACD,GAjBE,CAmBH;AACA;;;AACA,MAAI3C,CAAC,CAACqD,QAAF,CAAWzB,IAAI,CAAC0B,OAAhB,CAAJ,EAA8B;AAC5B,UAAMC,cAAc,GAAG,CACpB,MADoB,EAEpB,WAFoB,EAGpB,WAHoB,EAIpB,oBAJoB,EAKpB,sBALoB,EAMpB,iBANoB,CAAvB;AAQA,UAAMC,aAAa,GAAGC,MAAM,CAACC,IAAP,CAAY1D,CAAC,CAAC2D,IAAF,CAAO/B,IAAI,CAAC0B,OAAZ,EAAqBC,cAArB,CAAZ,CAAtB;AAEA,UAAMK,eAAe,GAAI,GAAEhB,IAAK,yEAAhC;AACA,UAAMiB,aAAa,GAAI,GAAEjB,IAAK,wEAA9B;;AACA,QAAIY,aAAa,CAAC9B,MAAd,GAAuB,CAA3B,EAA8B;AAC5B,YAAMoC,KAAK,GAAI,GACbN,aAAa,CAAC9B,MAAd,KAAyB,CAAzB,GAA6BkC,eAA7B,GAA+CC,aAChD;;EAELL,aAAa,CAAClC,GAAd,CAAkByC,CAAC,IAAK,QAAOA,CAAE,GAAjC,EAAqCC,IAArC,CAA2C,IAA3C,CAAgD;;EAEhDC,IAAI,CAACC,SAAL,CAAetC,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAA8B;;;;;;;;;;;;;;;;EAgB9B2B,cAAc,CAACjC,GAAf,CAAmByC,CAAC,IAAK,QAAOA,CAAE,GAAlC,EAAsCC,IAAtC,CAA4C,IAA5C,CAAiD;;aAtB7C;;AAyBA,UAAIlB,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnC,eAAOc,KAAP,CADmC,CAEnC;AACA;AACA;AACD,OALD,MAKO,IAAIN,aAAa,CAACW,IAAd,CAAmBJ,CAAC,IAAInC,IAAI,CAAC0B,OAAL,CAAaS,CAAb,MAAoBnC,IAAI,CAACmC,CAAD,CAAhD,CAAJ,EAA0D;AAC/D5D,QAAAA,MAAM,CAACiE,KAAP,CAAaN,KAAb;AACD,OAFM,MAEA;AACL,YAAI,CAAC3B,uCAAuC,CAACkC,GAAxC,CAA4CzC,IAAI,CAAC0C,SAAjD,CAAL,EAAkE;AAChEnE,UAAAA,MAAM,CAACoE,IAAP,CAAYT,KAAZ;AACA3B,UAAAA,uCAAuC,CAACqC,GAAxC,CAA4C5C,IAAI,CAAC0C,SAAjD;AACD;AACF;AACF;AACF,GA1EE,CA4EH;AACA;;;AACA,MAAIxB,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnC,QAAI,CAAClC,cAAc,CAACc,IAAI,CAAC0C,SAAN,CAAnB,EAAqC;AACnC,YAAMzB,OAAO,GAAI,GAAED,IAAK,6EACtBhB,IAAI,CAAC0C,SACN,EAFD;AAGArB,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CAAeP,OAAf,CAAZ;AACAI,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYtB,IAAZ;AACAe,MAAAA,iBAAiB,GAAG,IAApB;AACD,KATD,MASO,IAAIf,IAAI,CAAC0C,SAAT,EAAoB;AACzB;AACA;AACA;AACA,UAAIhC,kBAAkB,CAACV,IAAI,CAAC0C,SAAN,CAAtB,EAAwC;AACtC1C,QAAAA,IAAI,CAAC0C,SAAL,GAAiBhC,kBAAkB,CAACV,IAAI,CAAC0C,SAAN,CAAnC;AACD,OAFD,MAEO;AACL,cAAMG,qBAAqB,GAAG7C,IAAI,CAAC0C,SAAnC,CADK,CAGL;;AACA1C,QAAAA,IAAI,CAAC0C,SAAL,GAAiB7D,KAAK,CAACmB,IAAI,CAAC0C,SAAN,CAAtB,CAJK,CAKL;AACA;AACA;AACA;;AACA,cAAMI,iBAAiB,GAAGjE,KAAK,CAACH,QAAQ,CAACsB,IAAI,CAAC0C,SAAN,CAAT,CAA/B;;AACA,YAAII,iBAAiB,KAAK9C,IAAI,CAAC0C,SAA/B,EAA0C;AACxC,cAAI,CAACjC,sCAAsC,CAACgC,GAAvC,CAA2CzC,IAAI,CAAC0C,SAAhD,CAAL,EAAiE;AAC/D,kBAAMK,OAAO,GAAG/C,IAAI,CAAC0C,SAAL,CACbM,KADa,CACN,EADM,EAEbtD,GAFa,CAET,CAACuD,MAAD,EAASC,KAAT,KAAmB;AACtB,kBAAID,MAAM,KAAKH,iBAAiB,CAACI,KAAD,CAAhC,EAAyC;AACvC,uBAAQ,GAAR;AACD;;AACD,qBAAQ,GAAR;AACD,aAPa,EAQbd,IARa,CAQP,EARO,CAAhB;AAUA7D,YAAAA,MAAM,CAACoE,IAAP,CACErE,WAAY;cACZ0C,IAAK;;mCAEgBhB,IAAI,CAAC0C,SAAU;mCACfI,iBAAkB;mCAClBC,OAAQ;WAN/B;AASAtC,YAAAA,sCAAsC,CAACmC,GAAvC,CAA2C5C,IAAI,CAAC0C,SAAhD;AACD;;AAED1C,UAAAA,IAAI,CAAC0C,SAAL,GAAiBI,iBAAjB;AACD;;AACDpC,QAAAA,kBAAkB,CAACmC,qBAAD,CAAlB,GAA4C7C,IAAI,CAAC0C,SAAjD;AACD;AACF;AACF;;AAED,MAAI,CAAC1C,IAAI,CAAC0C,SAAN,IAAmB,CAAClE,IAAI,CAAC2E,UAAL,CAAgBnD,IAAI,CAAC0C,SAArB,CAAxB,EAAyD;AACvD,UAAMzB,OAAO,GAAI,GAAED,IAAK,+EAAxB,CADuD,CAEvD;;AACA,QAAIE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCC,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CAAeP,OAAf,CAAZ;AACAI,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYtB,IAAZ;AACD,KALD,MAKO;AACL,aAAOiB,OAAP;AACD;;AACDF,IAAAA,iBAAiB,GAAG,IAApB;AACD;;AAED,MAAIA,iBAAJ,EAAuB;AACrBxC,IAAAA,MAAM,CAACiE,KAAP,CACG,wFADH;AAGD;;AAED,MAAIY,QAAJ;AACA,MAAIC,qBAAJ;;AACA,MAAIrD,IAAI,CAACxB,IAAL,KAAe,GAAnB,EAAuB;AACrB4E,IAAAA,QAAQ,GAAI,OAAZ;AACAC,IAAAA,qBAAqB,GAAI,gBAAzB;AACD,GAHD,MAGO;AACLD,IAAAA,QAAQ,GAAI,GAAExE,SAAS,CAACoB,IAAI,CAACxB,IAAN,CAAY,EAAnC;AACA6E,IAAAA,qBAAqB,GAAI,YAAWlD,UAAU,CAACH,IAAI,CAACxB,IAAN,CAAY,EAA1D;AACD;;AAED,MAAI8E,YAAkB,GAAG;AACvBF,IAAAA,QADuB;AAEvBC,IAAAA,qBAFuB;AAGvB7E,IAAAA,IAAI,EAAEwB,IAAI,CAACxB,IAHY;AAIvB+E,IAAAA,SAAS,EAAEvD,IAAI,CAACuD,SAJO;AAKvBb,IAAAA,SAAS,EAAE1C,IAAI,CAAC0C,SALO;AAMvBc,IAAAA,kBAAkB,EAAEnE,0BAA0B,CAACW,IAAI,CAAC0C,SAAN,CANvB;AAOvBe,IAAAA,8BAA8B,EAC5B3C,aAAa,IACbA,aAAa,CAAC4C,OAAd,KAA2B,+BATN;AAUvB;AACAhC,IAAAA,OAAO,EAAE1B,IAAI,CAAC0B,OAAL,IAAgB,EAXF;AAYvBiC,IAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL,EAZY,CAezB;;AAfyB,GAAzB;;AAgBA,MAAIP,YAAY,CAAC9E,IAAb,CAAkB,CAAlB,MAA0B,GAA9B,EAAkC;AAChC8E,IAAAA,YAAY,CAAC9E,IAAb,GAAqB,IAAG8E,YAAY,CAAC9E,IAAK,EAA1C;AACD,GAvLE,CAyLH;AACA;AACA;AACA;;;AACA,MACE,CAAC8E,YAAY,CAACZ,SAAb,CAAuBoB,QAAvB,CAAiC,UAAjC,CAAD,IACC5C,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,YAA1B,IACC,CAACT,WAAW,CAAC2C,YAAY,CAACZ,SAAd,CAHhB,EAIE;AACA,UAAMqB,QAAQ,GAAGT,YAAY,CAACZ,SAA9B;AACA,UAAMsB,WAAW,GAAGvF,EAAE,CAACwF,YAAH,CAAgBF,QAAhB,EAA2B,OAA3B,CAApB;AACA,QAAIG,QAAQ,GAAG,IAAf;AACA,QAAIC,qBAAqB,GAAG,IAA5B;;AAEA,QAAIH,WAAW,KAAM,EAArB,EAAwB;AACtBE,MAAAA,QAAQ,GAAG,KAAX;AACD;;AAED,QACE,CAACF,WAAW,CAACF,QAAZ,CAAsB,gBAAtB,CAAD,IACA,CAACE,WAAW,CAACF,QAAZ,CAAsB,gBAAtB,CADD,IAEA,CAACE,WAAW,CAACF,QAAZ,CAAsB,iBAAtB,CAFD,IAGA;AACA,oBAAgBM,IAAhB,CAAqB5F,IAAI,CAAC6F,OAAL,CAAaN,QAAb,CAArB,CALF,EAME;AACAI,MAAAA,qBAAqB,GAAG,KAAxB;AACD;;AACD,QAAI,CAACD,QAAD,IAAa,CAACC,qBAAlB,EAAyC;AACvC,YAAMG,YAAY,GAAG9F,IAAI,CAAC+F,QAAL,CACnBtF,KAAK,CAACuF,QAAN,GAAiBC,OAAjB,CAAyBC,SADN,EAEnBX,QAFmB,CAArB;;AAKA,UAAI,CAACG,QAAL,EAAe;AACb3F,QAAAA,MAAM,CAACoG,YAAP,CACG,2DAA0DL,YAAa,kDAD1E;AAGD;;AAED,UAAI,CAACH,qBAAL,EAA4B;AAC1B5F,QAAAA,MAAM,CAACoG,YAAP,CACG,IAAGZ,QAAS,uEADf;AAGD;AACF;;AAEDpD,IAAAA,WAAW,CAAC2C,YAAY,CAACZ,SAAd,CAAX,GAAsC,IAAtC;AACD;;AAED,QAAMkC,OAAa,GAAG3F,KAAK,CAACuF,QAAN,GAAiBK,KAAjB,CAAuBC,GAAvB,CAA2BxB,YAAY,CAAC9E,IAAxC,CAAtB;AACA,QAAMuG,eAAe,GACnB,CAAC,CAACH,OAAF,IAAa,CAACxG,CAAC,CAAC4G,OAAF,CAAUJ,OAAO,CAAClD,OAAlB,EAA2B4B,YAAY,CAAC5B,OAAxC,CADhB;AAGA,2BACKZ,aADL;AAEEb,IAAAA,IAAI,EAAG,aAFT;AAGE8E,IAAAA,eAHF;AAIElE,IAAAA,MAJF;AAKEX,IAAAA,OAAO,EAAEoD;AALX;AAOD,CAzPD;AA2PA;;;;;;;;;AAOAhE,OAAO,CAAC2F,UAAR,GAAqB,CAACC,OAAD,EAAerE,MAAf,EAA+BsE,IAA/B,KAA6C;AAChE,MAAIC,EAAJ,CADgE,CAGhE;AACA;;AACA,MAAI,OAAOF,OAAP,KAAoB,QAAxB,EAAiC;AAC/B,QAAIG,GAAG,GACJ,mEAAD,GACC,8DAFH;;AAGA,QAAIF,IAAI,IAAIA,IAAI,CAACnE,IAAjB,EAAuB;AACrB;AACAH,MAAAA,MAAM,GAAGsE,IAAT;AACAE,MAAAA,GAAG,GAAGA,GAAG,GAAI,+BAA8BxE,MAAM,CAACG,IAAK,EAAvD;AACD;;AACDzC,IAAAA,MAAM,CAACoE,IAAP,CAAY0C,GAAZ;AAEAD,IAAAA,EAAE,GAAGF,OAAL;AACD,GAZD,MAYO;AACLE,IAAAA,EAAE,GAAGF,OAAO,IAAIA,OAAO,CAACI,IAAnB,IAA2BJ,OAAO,CAACI,IAAR,CAAaF,EAA7C;AACD,GAnB+D,CAqBhE;AACA;;;AACA,QAAME,IAAI,GAAGvG,OAAO,CAACqG,EAAD,CAApB;;AAEA,QAAMG,kBAAkB,GAAGD,IAAI,IAAI;AACjC,WAAO;AACLrF,MAAAA,IAAI,EAAG,aADF;AAELY,MAAAA,MAFK;AAGLX,MAAAA,OAAO,EAAEoF;AAHJ,KAAP;AAKD,GAND;;AAQA,QAAME,YAAY,GAAGD,kBAAkB,CAACD,IAAD,CAAvC,CAjCgE,CAmChE;AACA;;AACA,QAAMG,wBAAwB,GAC5BH,IAAI,IACJ/F,uBAAuB,CAAC+F,IAAI,CAAC9F,QAAN,CAAvB,CACGE,GADH,CACOX,OADP,EAEGW,GAFH,CAEO6F,kBAFP,CAFF;;AAMA,MAAIE,wBAAwB,IAAIA,wBAAwB,CAAC3F,MAAzD,EAAiE;AAC/D,WAAO,CAAC,GAAG2F,wBAAJ,EAA8BD,YAA9B,CAAP;AACD,GAFD,MAEO;AACL,WAAOA,YAAP;AACD;AACF,CAhDD;AAkDA;;;;;;;;AAMAlG,OAAO,CAACoG,WAAR,GAAsB,CAACC,KAAD,EAAe9E,MAAf,KAAkC;AACtD,MAAIwE,GAAG,GACJ,oEAAD,GACC,6CAFH;;AAGA,MAAIxE,MAAM,IAAIA,MAAM,CAACG,IAArB,EAA2B;AACzBqE,IAAAA,GAAG,GAAGA,GAAG,GAAI,gCAA+BxE,MAAM,CAACG,IAAK,EAAxD;AACD;;AACDzC,EAAAA,MAAM,CAACoE,IAAP,CAAY0C,GAAZ,EAPsD,CAStD;;AACA,QAAMO,eAAe,GAAGxH,CAAC,CAACyH,OAAF,CACtBF,KAAK,CAACjG,GAAN,CAAUoG,CAAC,IAAIvG,uBAAuB,CAACR,OAAO,CAAC+G,CAAD,CAAP,CAAWtG,QAAZ,CAAtC,CADsB,CAAxB;;AAIA,QAAMuG,iBAAiB,GAAG;AACxB9F,IAAAA,IAAI,EAAG,cADiB;AAExBY,IAAAA,MAFwB;AAGxBX,IAAAA,OAAO,EAAE,CAAC,GAAGyF,KAAJ,EAAW,GAAGC,eAAd;AAHe,GAA1B;AAKA,SAAOG,iBAAP;AACD,CApBD;;AAsBA,MAAMC,UAAU,GAAG,EAAnB;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEA1G,OAAO,CAAC2G,UAAR,GAAqB,CACnBX,IADmB,EAEnBzE,MAFmB,EAGnBC,aAA6B,GAAG,EAHb,KAIhB;AACH,MAAI,CAAC1C,CAAC,CAACqD,QAAF,CAAW6D,IAAX,CAAL,EAAuB;AACrB,WAAOjE,OAAO,CAACC,GAAR,CACLnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CACG,sEADH,CADK,CAAP;AAKD,GAPE,CASH;;;AACA,MAAI,CAAC8D,IAAI,CAACY,QAAV,EAAoB;AAClBZ,IAAAA,IAAI,CAACY,QAAL,GAAgB,EAAhB;AACD,GAZE,CAcH;;;AACA,MAAI,CAACZ,IAAI,CAACa,KAAN,IAAe,CAAC/H,CAAC,CAACyB,OAAF,CAAUyF,IAAI,CAAC9F,QAAf,CAApB,EAA8C;AAC5C8F,IAAAA,IAAI,CAAC9F,QAAL,GAAgB,EAAhB;AACD,GAjBE,CAmBH;;;AACA,MAAI,CAAC8F,IAAI,CAACc,MAAV,EAAkB;AAChBd,IAAAA,IAAI,CAACc,MAAL,GAAc,IAAd;AACD,GAtBE,CAwBH;;;AACA,MAAId,IAAI,CAACY,QAAL,CAAcG,KAAlB,EAAyB;AACvB9H,IAAAA,MAAM,CAAC2D,KAAP,CAAaG,IAAI,CAACC,SAAL,CAAegD,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAAb;AACA/G,IAAAA,MAAM,CAACiE,KAAP,CACErE,KAAK,CAACoD,IAAN,CAAWC,GAAX,CACG,iFADH,CADF;AAKD,GAhCE,CAkCH;;;AACA,MAAIX,MAAJ,EAAY;AACVyE,IAAAA,IAAI,CAACY,QAAL,CAAcG,KAAd,GAAsBxF,MAAM,CAACG,IAA7B;AACD;;AAED,QAAMsF,MAAM,GAAGrI,GAAG,CAACsI,QAAJ,CAAajB,IAAb,EAAmBlG,UAAU,CAACoH,UAA9B,CAAf;;AACA,MAAIF,MAAM,CAACpE,KAAX,EAAkB;AAChBb,IAAAA,OAAO,CAACC,GAAR,CAAYnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CAAgB,qCAAhB,CAAZ;AACAH,IAAAA,OAAO,CAACC,GAAR,CAAYnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CAAe8E,MAAM,CAACpE,KAAtB,CAAZ;AACAb,IAAAA,OAAO,CAACC,GAAR,CAAYgE,IAAZ;AACA,WAAO;AAAErF,MAAAA,IAAI,EAAG,kBAAT;AAA4BiC,MAAAA,KAAK,EAAE;AAAnC,KAAP;AACD,GA7CE,CA+CH;;;AACA,MAAIoD,IAAI,CAACmB,MAAT,EAAiB;AACf,UAAM,IAAIC,KAAJ,CACJpI,WAAY;;;;;;;;;QASV+D,IAAI,CAACC,SAAL,CAAegD,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAA8B;;;;QAI9BjD,IAAI,CAACC,SAAL,CAAezB,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAgC;KAd9B,CAAN;AAiBD;;AAED7B,EAAAA,4BAA4B,CAACsG,IAAD,CAA5B;AAEA,QAAMqB,OAAO,GAAG5H,OAAO,CAACuG,IAAI,CAACF,EAAN,CAAvB,CAtEG,CAwEH;AACA;;AACA,MAAIvE,MAAJ,EAAY;AACV,QAAI+F,UAAU,GAAG/F,MAAM,CAACG,IAAxB;AAEA,QAAI,CAACgF,UAAU,CAACV,IAAI,CAACY,QAAL,CAAcjG,IAAf,CAAf,EACE+F,UAAU,CAACV,IAAI,CAACY,QAAL,CAAcjG,IAAf,CAAV,GAAiC2G,UAAjC,CADF,KAEK,IAAIZ,UAAU,CAACV,IAAI,CAACY,QAAL,CAAcjG,IAAf,CAAV,KAAmC2G,UAAvC,EACH,MAAM,IAAIF,KAAJ,CAAUpI,WAAY;sBACZsI,UAAW;;yBAERtB,IAAI,CAACY,QAAL,CAAcjG,IAAK,kBACpC+F,UAAU,CAACV,IAAI,CAACY,QAAL,CAAcjG,IAAf,CACX;;;;;;;UAOGoC,IAAI,CAACC,SAAL,CAAegD,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAA8B;;;;UAI9BjD,IAAI,CAACC,SAAL,CAAezB,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAgC;OAhB9B,CAAN,CANQ,CAyBV;AACA;;AACA,QAAI8F,OAAO,IAAIA,OAAO,CAACT,QAAR,CAAiBG,KAAjB,KAA2BO,UAA1C,EAAsD;AACpD,YAAM,IAAIF,KAAJ,CACJpI,WAAY;0DACsCgH,IAAI,CAACF,EAAG;oBAC9CuB,OAAO,CAACT,QAAR,CAAiBG,KAAM,yBAAwBO,UAAW;;;SAHlE,CAAN;AAQD;AACF;;AAED,MAAI9F,aAAa,CAAC+F,UAAlB,EAA8B;AAC5B/F,IAAAA,aAAa,CAAC+F,UAAd,CAAyBC,MAAzB,CAAiC,QAAjC,EAA0CxB,IAAI,CAACF,EAA/C;AACAtE,IAAAA,aAAa,CAAC+F,UAAd,CAAyBC,MAAzB,CAAiC,UAAjC,EAA4CxB,IAAI,CAACF,EAAjD;AACD;;AAED,MAAI2B,aAAJ;AACA,MAAIC,gBAAJ,CAvHG,CAwHH;;AACA,MAAIL,OAAO,IAAI,CAAC7H,cAAc,CAACwG,IAAI,CAACF,EAAN,EAAUE,IAAI,CAACY,QAAL,CAAce,aAAxB,CAA9B,EAAsE;AACpED,IAAAA,gBAAgB;AACd/G,MAAAA,IAAI,EAAG,YADO;AAEdY,MAAAA;AAFc,OAGXC,aAHW;AAIdZ,MAAAA,OAAO,EAAEoF,IAAI,CAACF;AAJA,MAAhB;AAMD,GAPD,MAOO;AACL;AACA;AACA,QAAIuB,OAAJ,EAAa;AACX,YAAMpB,kBAAkB,GAAGD,IAAI,IAAI;AACjC;AACErF,UAAAA,IAAI,EAAG,aADT;AAEEY,UAAAA;AAFF,WAGKC,aAHL;AAIEZ,UAAAA,OAAO,EAAEoF;AAJX;AAMD,OAPD;;AAQAyB,MAAAA,aAAa,GAAGxH,uBAAuB,CAACoH,OAAO,CAACnH,QAAT,CAAvB,CACbE,GADa,CACTX,OADS,EAEbW,GAFa,CAET6F,kBAFS,CAAhB;AAGD;;AAEDyB,IAAAA,gBAAgB;AACd/G,MAAAA,IAAI,EAAG,aADO;AAEdY,MAAAA,MAFc;AAGd8F,MAAAA;AAHc,OAIX7F,aAJW;AAKdZ,MAAAA,OAAO,EAAEoF;AALK,MAAhB;AAOD;;AAED,MAAIyB,aAAa,IAAIA,aAAa,CAACjH,MAAnC,EAA2C;AACzC,WAAO,CAAC,GAAGiH,aAAJ,EAAmBC,gBAAnB,CAAP;AACD,GAFD,MAEO;AACL,WAAOA,gBAAP;AACD;AACF,CAnKD;AAqKA;;;;;;;;;;;;;AAWA1H,OAAO,CAAC4H,SAAR,GAAoB,CAAChC,OAAD,EAAerE,MAAf,KAAmC;AACrD,MAAIsG,MAAM,GAAG/I,CAAC,CAAC0G,GAAF,CAAMI,OAAN,EAAgB,QAAhB,CAAb,CADqD,CAGrD;;;AACA,MAAI,OAAOA,OAAP,KAAoB,QAAxB,EAAiC;AAC/B7D,IAAAA,OAAO,CAACsB,IAAR,CACG,wIADH;;AAIA,QAAI9B,MAAM,IAAIA,MAAM,CAACG,IAArB,EAA2B;AACzBK,MAAAA,OAAO,CAACC,GAAR,CAAa,6BAA4BT,MAAM,CAACG,IAAK,EAArD;AACD;;AAEDmG,IAAAA,MAAM,GAAGjC,OAAT;AACD;;AAED,SAAO;AACLjF,IAAAA,IAAI,EAAG,YADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEiH;AAHJ,GAAP;AAKD,CArBD;;AA8BA;;;;;;;;;;;;;;;;;;;;;;AAsBA7H,OAAO,CAAC8H,eAAR,GAA0B,CACxB;AAAE9B,EAAAA,IAAF;AAAQtE,EAAAA,IAAR;AAAcqG,EAAAA,KAAd;AAAqBC,EAAAA,SAArB;AAAgCC,EAAAA;AAAhC,CADwB,EAExB1G,MAFwB,EAGxBC,aAHwB,KAIrB;AACH,MAAIwG,SAAJ,EAAe;AACbjG,IAAAA,OAAO,CAACsB,IAAR,CACG,8EADH;;AAGA,QAAI,CAAC3B,IAAL,EAAW;AACTA,MAAAA,IAAI,GAAGsG,SAAP;AACD;AACF;;AACD,MAAIC,UAAJ,EAAgB;AACdlG,IAAAA,OAAO,CAACsB,IAAR,CACG,gFADH;;AAGA,QAAI,CAAC0E,KAAL,EAAY;AACVA,MAAAA,KAAK,GAAGE,UAAR;AACD;AACF,GAhBE,CAiBH;;;AACA,MAAI,CAACjC,IAAI,CAACY,QAAL,CAAcsB,WAAnB,EAAgC;AAC9BlC,IAAAA,IAAI,CAACY,QAAL,CAAcsB,WAAd,GAA4B,EAA5B;AACD;;AACD,MAAI,CAAClC,IAAI,CAACmB,MAAV,EAAkB;AAChBnB,IAAAA,IAAI,CAACmB,MAAL,GAAc,EAAd;AACD;AAED;;;;;AAGA,QAAMgB,eAAe,GAAGrJ,CAAC,CAAC0F,QAAF,CAAW9C,IAAX,EAAkB,SAAlB,IACpBA,IAAI,CAACgC,KAAL,CAAY,KAAZ,EAAkB,CAAlB,CADoB,GAEpBhC,IAFJ,CA5BG,CAgCH;;AACA,QAAM0G,UAAU,GAAGpC,IAAI,CAACY,QAAL,CAAcsB,WAAd,CAA0BC,eAA1B,CAAnB;;AACA,MAAIC,UAAU,IAAIA,UAAU,KAAK7G,MAAM,CAACG,IAAxC,EAA8C;AAC5C,UAAM,IAAI0F,KAAJ,CACJpI,WAAY;;;iBAGDgH,IAAI,CAACF,EAAG;gBACTvE,MAAM,CAACG,IAAK;cACdA,IAAK;eACJqG,KAAM;OAPX,CAAN;AAUD,GA7CE,CA+CH;;;AACA/B,EAAAA,IAAI,CAACmB,MAAL,CAAYzF,IAAZ,IAAoBqG,KAApB;AACA/B,EAAAA,IAAI,CAACY,QAAL,CAAcsB,WAAd,CAA0BC,eAA1B,IAA6C5G,MAAM,CAACG,IAApD;AAEA;AACEf,IAAAA,IAAI,EAAG,mBADT;AAEEY,IAAAA;AAFF,KAGKC,aAHL;AAIEZ,IAAAA,OAAO,EAAEoF;AAJX;AAMD,CA7DD;AA+DA;;;;;;;;;;;;;;AAYAhG,OAAO,CAACqI,qBAAR,GAAgC,CAC9B;AAAEvB,EAAAA,MAAF;AAAUzG,EAAAA;AAAV,CAD8B,EAE9BkB,MAF8B,KAG3B;AACH;AACAuF,EAAAA,MAAM,CAAC5G,QAAP,CAAgBoI,IAAhB,CAAqBjI,KAAK,CAACyF,EAA3B;AACAgB,EAAAA,MAAM,CAAC5G,QAAP,GAAkBpB,CAAC,CAACyJ,IAAF,CAAOzB,MAAM,CAAC5G,QAAd,CAAlB;AAEA,SAAO;AACLS,IAAAA,IAAI,EAAG,+BADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEkG;AAHJ,GAAP;AAKD,CAbD;AAeA;;;;;;;;;;;AASA9G,OAAO,CAACwI,oBAAR,GAA+B,CAC7B;AACEtJ,EAAAA,IADF;AAEE2I,EAAAA,MAFF;AAGEY,EAAAA;AAHF,CAD6B,EAM7BlH,MAAc,GAAI,EANW,KAO1B;AACH,SAAO;AACLZ,IAAAA,IAAI,EAAG,6BADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAE;AACP1B,MAAAA,IADO;AAEP2I,MAAAA,MAFO;AAGPY,MAAAA;AAHO;AAHJ,GAAP;AASD,CAjBD;AAmBA;;;;;;;;AAMAzI,OAAO,CAAC0I,4BAAR,GAAwCC,KAAD,IAAqB;AAC1D,SAAO;AACLhI,IAAAA,IAAI,EAAG,gCADF;AAELC,IAAAA,OAAO,EAAE;AACP+H,MAAAA;AADO;AAFJ,GAAP;AAMD,CAPD;AASA;;;;;;;AAKA3I,OAAO,CAAC4I,qBAAR,GAAgC,CAAC;AAC/BC,EAAAA,KAD+B;AAE/BC,EAAAA;AAF+B,CAAD,KAM1B;AACJ,SAAO;AACLnI,IAAAA,IAAI,EAAG,yBADF;AAELC,IAAAA,OAAO,EAAE;AACPiI,MAAAA,KADO;AAEPC,MAAAA;AAFO;AAFJ,GAAP;AAOD,CAdD;AAgBA;;;;;;;AAKA9I,OAAO,CAAC+I,kBAAR,GAA6B,CAAClD,IAAD,EAAYtE,MAAgB,GAAG,IAA/B,KAAwC;AACnE,SAAO;AACLZ,IAAAA,IAAI,EAAG,sBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEiF;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASA7F,OAAO,CAACgJ,gBAAR,GAA2B,CAACC,MAAD,EAAiB1H,MAAgB,GAAG,IAApC,KAA6C;AACtE,SAAO;AACLZ,IAAAA,IAAI,EAAG,oBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEqI;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASAjJ,OAAO,CAACkJ,oBAAR,GAA+B,CAACD,MAAD,EAAiB1H,MAAgB,GAAG,IAApC,KAA6C;AAC1E,SAAO;AACLZ,IAAAA,IAAI,EAAG,wBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEqI;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;;;AAWAjJ,OAAO,CAACmJ,eAAR,GAA0B,CAACvD,OAAD,EAAkBrE,MAAgB,GAAG,IAArC,KAA8C;AACtE;AACA,MAAIG,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAAC5C,CAAC,CAACqD,QAAF,CAAWyD,OAAX,CAAL,EAA0B;AACxB7D,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,2CAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAe4C,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAAZ;;AACA,QAAIhE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAACwH,IAAR,CAAa,CAAb;AACD;AACF;;AAED,MAAI,CAACtK,CAAC,CAACqD,QAAF,CAAWyD,OAAO,CAACA,OAAnB,CAAL,EAAkC;AAChC7D,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,yCAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAe4C,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAAZ;;AACA,QAAIhE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAACwH,IAAR,CAAa,CAAb;AACD;AACF;;AAED,SAAO;AACLzI,IAAAA,IAAI,EAAG,mBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEgF;AAHJ,GAAP;AAKD,CA3BD;AA6BA;;;;;;;;;;;;;;;AAaA5F,OAAO,CAACqJ,cAAR,GAAyB,CAACJ,MAAD,EAAiB1H,MAAgB,GAAG,IAApC,KAA6C;AACpE;AACA,MAAIG,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAACuH,MAAM,CAACvH,IAAZ,EAAkB;AAChBK,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,wCAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAeiG,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAZ;;AACA,QAAIrH,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAACwH,IAAR,CAAa,CAAb;AACD;AACF;;AACD,MAAI,CAACH,MAAM,CAACrD,OAAZ,EAAqB;AACnBqD,IAAAA,MAAM,CAACrD,OAAP,GAAiB,EAAjB;AACD;;AACD,SAAO;AACLjF,IAAAA,IAAI,EAAG,kBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEqI;AAHJ,GAAP;AAKD,CArBD;AAuBA;;;;;;;;;;;;;;;AAaAjJ,OAAO,CAACsJ,cAAR,GAAyB,CAACL,MAAD,EAAiB1H,MAAgB,GAAG,IAApC,KAA6C;AACpE;AACA,MAAIG,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAACuH,MAAM,CAACvH,IAAZ,EAAkB;AAChBK,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,wCAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAeiG,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAZ;;AACA,QAAIrH,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAACwH,IAAR,CAAa,CAAb;AACD;AACF;;AACD,MAAI,CAACH,MAAM,CAACrD,OAAZ,EAAqB;AACnBqD,IAAAA,MAAM,CAACrD,OAAP,GAAiB,EAAjB;AACD;;AACD,SAAO;AACLjF,IAAAA,IAAI,EAAG,kBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEqI;AAHJ,GAAP;AAKD,CArBD;AAuBA;;;;;;;;;;;;;;AAYAjJ,OAAO,CAACuJ,SAAR,GAAoB,CAACC,GAAD,EAAWjI,MAAgB,GAAG,IAA9B,KAAuC;AACzD,SAAO;AACLZ,IAAAA,IAAI,EAAG,YADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAE4I;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASAxJ,OAAO,CAACyJ,MAAR,GAAiB,CAACD,GAAD,EAAWjI,MAAgB,GAAG,IAA9B,KAAuC;AACtD,SAAO;AACLZ,IAAAA,IAAI,EAAG,SADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAE4I;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASAxJ,OAAO,CAAC0J,MAAR,GAAiB,CAACF,GAAD,EAAWjI,MAAgB,GAAG,IAA9B,KAAuC;AACtD,SAAO;AACLZ,IAAAA,IAAI,EAAG,SADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAE4I;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;AAQAxJ,OAAO,CAAC2J,eAAR,GAA0B,CACxBC,MADwB,EAExBrI,MAFwB,KAGrB;AACH,SAAO;AACLZ,IAAAA,IAAI,EAAG,mBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEgJ;AAHJ,GAAP;AAKD,CATD;AAWA;;;;;AAGA,MAAMC,kBAAkB,GAAG,CAAC3K,IAAD,EAAO4K,UAAP,KAAsB;AAC/C,QAAMC,MAAM,GAAG1K,GAAG,CAAC2K,KAAJ,CAAU9K,IAAV,CAAf;AACA,QAAM+K,kBAAkB,GAAG/K,IAAI,CAACgL,UAAL,CAAiB,IAAjB,CAA3B;AACA,SAAQ,GACNH,MAAM,CAACI,QAAP,IAAmB,IAAnB,IAA2BF,kBAA3B,GAAiD,EAAjD,GAAqDH,UACtD,GAAE5K,IAAK,EAFR;AAGD,CAND;AAQA;;;;;;;;;;;;;;;;;;;;;AAmBAc,OAAO,CAACoK,cAAR,GAAyB,UAMnB;AAAA,MALJC,QAKI,QALJA,QAKI;AAAA,8BAJJC,WAII;AAAA,MAJJA,WAII,iCAJU,KAIV;AAAA,mCAHJC,iBAGI;AAAA,MAHJA,iBAGI,sCAHgB,KAGhB;AAAA,MAFJC,MAEI,QAFJA,MAEI;AAAA,MADDC,IACC;AACJ,MAAIX,UAAU,GAAI,EAAlB;;AACA,MAAInK,KAAK,CAACuF,QAAN,GAAiBC,OAAjB,CAAyBuF,WAA7B,EAA0C;AACxCZ,IAAAA,UAAU,GAAGnK,KAAK,CAACuF,QAAN,GAAiB+D,MAAjB,CAAwBa,UAArC;AACD;;AAED,SAAO;AACLnJ,IAAAA,IAAI,EAAG,iBADF;AAELC,IAAAA,OAAO;AACLyJ,MAAAA,QAAQ,EAAER,kBAAkB,CAACQ,QAAD,EAAWP,UAAX,CADvB;AAELQ,MAAAA,WAFK;AAGLC,MAAAA,iBAHK;AAILC,MAAAA,MAAM,EAAEX,kBAAkB,CAACW,MAAD,EAASV,UAAT;AAJrB,OAKFW,IALE;AAFF,GAAP;AAUD,CAtBD;AAwBA;;;;;;;;;;;;;AAWAzK,OAAO,CAAC2K,mBAAR,GAA8B,CAC5B;AAAEC,EAAAA;AAAF,CAD4B,EAE5BrJ,MAF4B,EAG5B6C,OAH4B,KAIzB;AACH,SAAO;AACLzD,IAAAA,IAAI,EAAG,wBADF;AAELY,IAAAA,MAFK;AAGL6C,IAAAA,OAHK;AAILxD,IAAAA,OAAO,EAAEgK;AAJJ,GAAP;AAMD,CAXD;;AAcA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFA5K,OAAO,CAAC6K,WAAR,GAAsB,CACpBC,KADoB,EAMpBvJ,MANoB,EAOpB6C,OAPoB,KAQjB;AACH,SAAO;AACLzD,IAAAA,IAAI,EAAG,cADF;AAELY,IAAAA,MAFK;AAGL6C,IAAAA,OAHK;AAILxD,IAAAA,OAAO,EAAEkK;AAJJ,GAAP;AAMD,CAfD;AAiBA;;;;;;;;;;;;;AAWA9K,OAAO,CAAC+K,cAAR,GAAyB,CACvB;AAAEjC,EAAAA,aAAF;AAAiBD,EAAAA;AAAjB,CADuB,EAEvBtH,MAFuB,EAGvB6C,OAHuB,KAIpB;AACH,SAAO;AACLzD,IAAAA,IAAI,EAAG,iBADF;AAELY,IAAAA,MAFK;AAGL6C,IAAAA,OAHK;AAILxD,IAAAA,OAAO,EAAE;AAAEkI,MAAAA,aAAF;AAAiBD,MAAAA;AAAjB;AAJJ,GAAP;AAMD,CAXD;AAaA;;;;;;;;;;;;AAUA7I,OAAO,CAACgL,2BAAR,GAAsC,CACpC;AAAElC,EAAAA,aAAF;AAAiBlG,EAAAA;AAAjB,CADoC,EAEpCrB,MAFoC,EAGpC6C,OAHoC,KAIjC;AACH,SAAO;AACLzD,IAAAA,IAAI,EAAG,gCADF;AAELY,IAAAA,MAFK;AAGL6C,IAAAA,OAHK;AAILxD,IAAAA,OAAO,EAAE;AAAEkI,MAAAA,aAAF;AAAiBlG,MAAAA;AAAjB;AAJJ,GAAP;AAMD,CAXD;AAaA;;;;;;;;;;;;AAUA5C,OAAO,CAACiL,0BAAR,GAAqC,CACnC;AAAEnC,EAAAA;AAAF,CADmC,EAEnCvH,MAFmC,EAGnC6C,OAHmC,KAIhC;AACH,SAAO;AACLzD,IAAAA,IAAI,EAAG,gCADF;AAELY,IAAAA,MAFK;AAGL6C,IAAAA,OAHK;AAILxD,IAAAA,OAAO,EAAE;AAAEkI,MAAAA;AAAF;AAJJ,GAAP;AAMD,CAXD;AAaA;;;;;;;;;;;;AAUA9I,OAAO,CAACkL,yBAAR,GAAoC,CAClC;AAAEpC,EAAAA,aAAF;AAAiBlG,EAAAA;AAAjB,CADkC,EAElCrB,MAFkC,EAGlC6C,OAHkC,KAI/B;AACH,SAAO;AACLzD,IAAAA,IAAI,EAAG,8BADF;AAELY,IAAAA,MAFK;AAGL6C,IAAAA,OAHK;AAILxD,IAAAA,OAAO,EAAE;AAAEkI,MAAAA,aAAF;AAAiBlG,MAAAA;AAAjB;AAJJ,GAAP;AAMD,CAXD;AAaA;;;;;;;;AAMA5C,OAAO,CAACmL,gBAAR,GAA2B,CAACvB,MAAD,EAASrI,MAAT,EAAyB6C,OAAzB,KAA8C;AACvE,SAAO;AACLzD,IAAAA,IAAI,EAAG,oBADF;AAELY,IAAAA,MAFK;AAGL6C,IAAAA,OAHK;AAILxD,IAAAA,OAAO,EAAEgJ;AAJJ,GAAP;AAMD,CAPD;AASA;;;;;;;;AAMA5J,OAAO,CAACoL,YAAR,GAAuB,CACrB;AAAElM,EAAAA,IAAF;AAAQ4J,EAAAA,aAAR;AAAuBuC,EAAAA;AAAvB,CADqB,EAErB9J,MAFqB,EAGrB6C,OAHqB,KAIlB;AACH,SAAO;AACLzD,IAAAA,IAAI,EAAG,gBADF;AAELY,IAAAA,MAFK;AAGL6C,IAAAA,OAHK;AAILxD,IAAAA,OAAO,EAAE;AAAE1B,MAAAA,IAAF;AAAQ4J,MAAAA,aAAR;AAAuBuC,MAAAA;AAAvB;AAJJ,GAAP;AAMD,CAXD;AAaA;;;;;AAGAC,OAAO,CAACtL,OAAR,GAAkBA,OAAlB;AAEA;;;;AAGAsL,OAAO,CAACC,mBAAR,GAA8BxM,kBAAkB,CAACiB,OAAD,EAAUL,KAAK,CAAC6L,QAAhB,CAAhD","sourcesContent":["// @flow\nconst Joi = require(`joi`)\nconst chalk = require(`chalk`)\nconst _ = require(`lodash`)\nconst { bindActionCreators } = require(`redux`)\nconst { stripIndent } = require(`common-tags`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst path = require(`path`)\nconst fs = require(`fs`)\nconst truePath = require(`true-case-path`)\nconst url = require(`url`)\nconst kebabHash = require(`kebab-hash`)\nconst slash = require(`slash`)\nconst { hasNodeChanged, getNode } = require(`../db/nodes`)\nconst { trackInlineObjectsInRootNode } = require(`../db/node-tracking`)\nconst { store } = require(`./index`)\nconst fileExistsSync = require(`fs-exists-cached`).sync\nconst joiSchemas = require(`../joi-schemas/joi`)\nconst { generateComponentChunkName } = require(`../utils/js-chunk-names`)\n\nconst actions = {}\n\nconst findChildrenRecursively = (children = []) => {\n  children = children.concat(\n    ...children.map(child => {\n      const newChildren = getNode(child).children\n      if (_.isArray(newChildren) && newChildren.length > 0) {\n        return findChildrenRecursively(newChildren)\n      } else {\n        return []\n      }\n    })\n  )\n\n  return children\n}\n\ntype Job = {\n  id: string,\n}\ntype PageInput = {\n  path: string,\n  component: string,\n  context?: Object,\n}\n\ntype Page = {\n  path: string,\n  matchPath: ?string,\n  component: string,\n  context: Object,\n  internalComponentName: string,\n  jsonName: string,\n  componentChunkName: string,\n  updatedAt: number,\n}\n\ntype Plugin = {\n  name: string,\n}\n\ntype ActionOptions = {\n  traceId: ?string,\n  parentSpan: ?Object,\n  followsSpan: ?Object,\n}\n\n/**\n * Delete a page\n * @param {Object} page a page object\n * @param {string} page.path The path of the page\n * @param {string} page.component The absolute path to the page component\n * @example\n * deletePage(page)\n */\nactions.deletePage = (page: PageInput) => {\n  return {\n    type: `DELETE_PAGE`,\n    payload: page,\n  }\n}\n\nconst pascalCase = _.flow(\n  _.camelCase,\n  _.upperFirst\n)\nconst hasWarnedForPageComponentInvalidContext = new Set()\nconst hasWarnedForPageComponentInvalidCasing = new Set()\nconst pageComponentCache = {}\nconst fileOkCache = {}\n\n/**\n * Create a page. See [the guide on creating and modifying pages](/docs/creating-and-modifying-pages/)\n * for detailed documentation about creating pages.\n * @param {Object} page a page object\n * @param {string} page.path Any valid URL. Must start with a forward slash\n * @param {string} page.component The absolute path to the component for this page\n * @param {Object} page.context Context data for this page. Passed as props\n * to the component `this.props.pageContext` as well as to the graphql query\n * as graphql arguments.\n * @example\n * createPage({\n *   path: `/my-sweet-new-page/`,\n *   component: path.resolve(`./src/templates/my-sweet-new-page.js`),\n *   // The context is passed as props to the component as well\n *   // as into the component's GraphQL query.\n *   context: {\n *     id: `123456`,\n *   },\n * })\n */\nactions.createPage = (\n  page: PageInput,\n  plugin?: Plugin,\n  actionOptions?: ActionOptions\n) => {\n  let noPageOrComponent = false\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!page.path) {\n    const message = `${name} must set the page path when creating a page`\n    // Don't log out when testing\n    if (process.env.NODE_ENV !== `test`) {\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n    } else {\n      return message\n    }\n    noPageOrComponent = true\n  }\n\n  // Validate that the context object doesn't overlap with any core page fields\n  // as this will cause trouble when running graphql queries.\n  if (_.isObject(page.context)) {\n    const reservedFields = [\n      `path`,\n      `matchPath`,\n      `component`,\n      `componentChunkName`,\n      `pluginCreator___NODE`,\n      `pluginCreatorId`,\n    ]\n    const invalidFields = Object.keys(_.pick(page.context, reservedFields))\n\n    const singularMessage = `${name} used a reserved field name in the context object when creating a page:`\n    const pluralMessage = `${name} used reserved field names in the context object when creating a page:`\n    if (invalidFields.length > 0) {\n      const error = `${\n        invalidFields.length === 1 ? singularMessage : pluralMessage\n      }\n\n${invalidFields.map(f => `  * \"${f}\"`).join(`\\n`)}\n\n${JSON.stringify(page, null, 4)}\n\nData in \"context\" is passed to GraphQL as potential arguments when running the\npage query.\n\nWhen arguments for GraphQL are constructed, the context object is combined with\nthe page object so *both* page object and context data are available as\narguments. So you don't need to add the page \"path\" to the context as it's\nalready available in GraphQL. If a context field duplicates a field already\nused by the page object, this can break functionality within Gatsby so must be\navoided.\n\nPlease choose another name for the conflicting fields.\n\nThe following fields are used by the page object and should be avoided.\n\n${reservedFields.map(f => `  * \"${f}\"`).join(`\\n`)}\n\n            `\n      if (process.env.NODE_ENV === `test`) {\n        return error\n        // Only error if the context version is different than the page\n        // version.  People in v1 often thought that they needed to also pass\n        // the path to context for it to be available in GraphQL\n      } else if (invalidFields.some(f => page.context[f] !== page[f])) {\n        report.panic(error)\n      } else {\n        if (!hasWarnedForPageComponentInvalidContext.has(page.component)) {\n          report.warn(error)\n          hasWarnedForPageComponentInvalidContext.add(page.component)\n        }\n      }\n    }\n  }\n\n  // Don't check if the component exists during tests as we use a lot of fake\n  // component paths.\n  if (process.env.NODE_ENV !== `test`) {\n    if (!fileExistsSync(page.component)) {\n      const message = `${name} created a page with a component that doesn't exist. Missing component is ${\n        page.component\n      }`\n      console.log(``)\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n      noPageOrComponent = true\n    } else if (page.component) {\n      // check if we've processed this component path\n      // before, before running the expensive \"truePath\"\n      // operation\n      if (pageComponentCache[page.component]) {\n        page.component = pageComponentCache[page.component]\n      } else {\n        const originalPageComponent = page.component\n\n        // normalize component path\n        page.component = slash(page.component)\n        // check if path uses correct casing - incorrect casing will\n        // cause issues in query compiler and inconsistencies when\n        // developing on Mac or Windows and trying to deploy from\n        // linux CI/CD pipeline\n        const trueComponentPath = slash(truePath(page.component))\n        if (trueComponentPath !== page.component) {\n          if (!hasWarnedForPageComponentInvalidCasing.has(page.component)) {\n            const markers = page.component\n              .split(``)\n              .map((letter, index) => {\n                if (letter !== trueComponentPath[index]) {\n                  return `^`\n                }\n                return ` `\n              })\n              .join(``)\n\n            report.warn(\n              stripIndent`\n            ${name} created a page with a component path that doesn't match the casing of the actual file. This may work locally, but will break on systems which are case-sensitive, e.g. most CI/CD pipelines.\n\n            page.component:     \"${page.component}\"\n            path in filesystem: \"${trueComponentPath}\"\n                                 ${markers}\n          `\n            )\n            hasWarnedForPageComponentInvalidCasing.add(page.component)\n          }\n\n          page.component = trueComponentPath\n        }\n        pageComponentCache[originalPageComponent] = page.component\n      }\n    }\n  }\n\n  if (!page.component || !path.isAbsolute(page.component)) {\n    const message = `${name} must set the absolute path to the page component when create creating a page`\n    // Don't log out when testing\n    if (process.env.NODE_ENV !== `test`) {\n      console.log(``)\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n    } else {\n      return message\n    }\n    noPageOrComponent = true\n  }\n\n  if (noPageOrComponent) {\n    report.panic(\n      `See the documentation for createPage https://www.gatsbyjs.org/docs/actions/#createPage`\n    )\n  }\n\n  let jsonName\n  let internalComponentName\n  if (page.path === `/`) {\n    jsonName = `index`\n    internalComponentName = `ComponentIndex`\n  } else {\n    jsonName = `${kebabHash(page.path)}`\n    internalComponentName = `Component${pascalCase(page.path)}`\n  }\n\n  let internalPage: Page = {\n    jsonName,\n    internalComponentName,\n    path: page.path,\n    matchPath: page.matchPath,\n    component: page.component,\n    componentChunkName: generateComponentChunkName(page.component),\n    isCreatedByStatefulCreatePages:\n      actionOptions &&\n      actionOptions.traceId === `initial-createPagesStatefully`,\n    // Ensure the page has a context object\n    context: page.context || {},\n    updatedAt: Date.now(),\n  }\n\n  // If the path doesn't have an initial forward slash, add it.\n  if (internalPage.path[0] !== `/`) {\n    internalPage.path = `/${internalPage.path}`\n  }\n\n  // Validate that the page component imports React and exports something\n  // (hopefully a component).\n  //\n  // Only run validation once during builds.\n  if (\n    !internalPage.component.includes(`/.cache/`) &&\n    (process.env.NODE_ENV === `production` &&\n      !fileOkCache[internalPage.component])\n  ) {\n    const fileName = internalPage.component\n    const fileContent = fs.readFileSync(fileName, `utf-8`)\n    let notEmpty = true\n    let includesDefaultExport = true\n\n    if (fileContent === ``) {\n      notEmpty = false\n    }\n\n    if (\n      !fileContent.includes(`export default`) &&\n      !fileContent.includes(`module.exports`) &&\n      !fileContent.includes(`exports.default`) &&\n      // this check only applies to js and ts, not mdx\n      /\\.(jsx?|tsx?)/.test(path.extname(fileName))\n    ) {\n      includesDefaultExport = false\n    }\n    if (!notEmpty || !includesDefaultExport) {\n      const relativePath = path.relative(\n        store.getState().program.directory,\n        fileName\n      )\n\n      if (!notEmpty) {\n        report.panicOnBuild(\n          `You have an empty file in the \"src/pages\" directory at \"${relativePath}\". Please remove it or make it a valid component`\n        )\n      }\n\n      if (!includesDefaultExport) {\n        report.panicOnBuild(\n          `[${fileName}] The page component must export a React component for it to be valid`\n        )\n      }\n    }\n\n    fileOkCache[internalPage.component] = true\n  }\n\n  const oldPage: Page = store.getState().pages.get(internalPage.path)\n  const contextModified =\n    !!oldPage && !_.isEqual(oldPage.context, internalPage.context)\n\n  return {\n    ...actionOptions,\n    type: `CREATE_PAGE`,\n    contextModified,\n    plugin,\n    payload: internalPage,\n  }\n}\n\n/**\n * Delete a node\n * @param {object} $0\n * @param {object} $0.node the node object\n * @example\n * deleteNode({node: node})\n */\nactions.deleteNode = (options: any, plugin: Plugin, args: any) => {\n  let id\n\n  // Check if using old method signature. Warn about incorrect usage but get\n  // node from nodeID anyway.\n  if (typeof options === `string`) {\n    let msg =\n      `Calling \"deleteNode\" with a nodeId is deprecated. Please pass an ` +\n      `object containing a full node instead: deleteNode({ node }).`\n    if (args && args.name) {\n      // `plugin` used to be the third argument\n      plugin = args\n      msg = msg + ` \"deleteNode\" was called by ${plugin.name}`\n    }\n    report.warn(msg)\n\n    id = options\n  } else {\n    id = options && options.node && options.node.id\n  }\n\n  // Always get node from the store, as the node we get as an arg\n  // might already have been deleted.\n  const node = getNode(id)\n\n  const createDeleteAction = node => {\n    return {\n      type: `DELETE_NODE`,\n      plugin,\n      payload: node,\n    }\n  }\n\n  const deleteAction = createDeleteAction(node)\n\n  // It's possible the file node was never created as sometimes tools will\n  // write and then immediately delete temporary files to the file system.\n  const deleteDescendantsActions =\n    node &&\n    findChildrenRecursively(node.children)\n      .map(getNode)\n      .map(createDeleteAction)\n\n  if (deleteDescendantsActions && deleteDescendantsActions.length) {\n    return [...deleteDescendantsActions, deleteAction]\n  } else {\n    return deleteAction\n  }\n}\n\n/**\n * Batch delete nodes\n * @param {Array} nodes an array of node ids\n * @example\n * deleteNodes([`node1`, `node2`])\n */\nactions.deleteNodes = (nodes: any[], plugin: Plugin) => {\n  let msg =\n    `The \"deleteNodes\" action is now deprecated and will be removed in ` +\n    `Gatsby v3. Please use \"deleteNode\" instead.`\n  if (plugin && plugin.name) {\n    msg = msg + ` \"deleteNodes\" was called by ${plugin.name}`\n  }\n  report.warn(msg)\n\n  // Also delete any nodes transformed from these.\n  const descendantNodes = _.flatten(\n    nodes.map(n => findChildrenRecursively(getNode(n).children))\n  )\n\n  const deleteNodesAction = {\n    type: `DELETE_NODES`,\n    plugin,\n    payload: [...nodes, ...descendantNodes],\n  }\n  return deleteNodesAction\n}\n\nconst typeOwners = {}\n/**\n * Create a new node.\n * @param {Object} node a node object\n * @param {string} node.id The node's ID. Must be globally unique.\n * @param {string} node.parent The ID of the parent's node. If the node is\n * derived from another node, set that node as the parent. Otherwise it can\n * just be `null`.\n * @param {Array} node.children An array of children node IDs. If you're\n * creating the children nodes while creating the parent node, add the\n * children node IDs here directly. If you're adding a child node to a\n * parent node created by a plugin, you can't mutate this value directly\n * to add your node id, instead use the action creator `createParentChildLink`.\n * @param {Object} node.internal node fields that aren't generally\n * interesting to consumers of node data but are very useful for plugin writers\n * and Gatsby core.\n * @param {string} node.internal.mediaType An optional field to indicate to\n * transformer plugins that your node has raw content they can transform.\n * Use either an official media type (we use mime-db as our source\n * (https://www.npmjs.com/package/mime-db) or a made-up one if your data\n * doesn't fit in any existing bucket. Transformer plugins use node media types\n * for deciding if they should transform a node into a new one. E.g.\n * markdown transformers look for media types of\n * `text/markdown`.\n * @param {string} node.internal.type An arbitrary globally unique type\n * choosen by the plugin creating the node. Should be descriptive of the\n * node as the type is used in forming GraphQL types so users will query\n * for nodes based on the type choosen here. Nodes of a given type can\n * only be created by one plugin.\n * @param {string} node.internal.content An optional field. This is rarely\n * used. It is used when a source plugin sources data it doesn't know how\n * to transform e.g. a markdown string pulled from an API. The source plugin\n * can defer the transformation to a specialized transformer plugin like\n * gatsby-transformer-remark. This `content` field holds the raw content\n * (so for the markdown case, the markdown string).\n *\n * Data that's already structured should be added to the top-level of the node\n * object and _not_ added here. You should not `JSON.stringify` your node's\n * data here.\n *\n * If the content is very large and can be lazy-loaded, e.g. a file on disk,\n * you can define a `loadNodeContent` function for this node and the node\n * content will be lazy loaded when it's needed.\n * @param {string} node.internal.contentDigest the digest for the content\n * of this node. Helps Gatsby avoid doing extra work on data that hasn't\n * changed.\n * @param {string} node.internal.description An optional field. Human\n * readable description of what this node represent / its source. It will\n * be displayed when type conflicts are found, making it easier to find\n * and correct type conflicts.\n * @example\n * createNode({\n *   // Data for the node.\n *   field1: `a string`,\n *   field2: 10,\n *   field3: true,\n *   ...arbitraryOtherData,\n *\n *   // Required fields.\n *   id: `a-node-id`,\n *   parent: `the-id-of-the-parent-node`, // or null if it's a source node without a parent\n *   children: [],\n *   internal: {\n *     type: `CoolServiceMarkdownField`,\n *     contentDigest: crypto\n *       .createHash(`md5`)\n *       .update(JSON.stringify(fieldData))\n *       .digest(`hex`),\n *     mediaType: `text/markdown`, // optional\n *     content: JSON.stringify(fieldData), // optional\n *     description: `Cool Service: \"Title of entry\"`, // optional\n *   }\n * })\n */\nactions.createNode = (\n  node: any,\n  plugin?: Plugin,\n  actionOptions?: ActionOptions = {}\n) => {\n  if (!_.isObject(node)) {\n    return console.log(\n      chalk.bold.red(\n        `The node passed to the \"createNode\" action creator must be an object`\n      )\n    )\n  }\n\n  // Ensure the new node has an internals object.\n  if (!node.internal) {\n    node.internal = {}\n  }\n\n  // Ensure the new node has a children array.\n  if (!node.array && !_.isArray(node.children)) {\n    node.children = []\n  }\n\n  // Ensure the new node has a parent field\n  if (!node.parent) {\n    node.parent = null\n  }\n\n  // Tell user not to set the owner name themself.\n  if (node.internal.owner) {\n    report.error(JSON.stringify(node, null, 4))\n    report.panic(\n      chalk.bold.red(\n        `The node internal.owner field is set automatically by Gatsby and not by plugins`\n      )\n    )\n  }\n\n  // Add the plugin name to the internal object.\n  if (plugin) {\n    node.internal.owner = plugin.name\n  }\n\n  const result = Joi.validate(node, joiSchemas.nodeSchema)\n  if (result.error) {\n    console.log(chalk.bold.red(`The new node didn't pass validation`))\n    console.log(chalk.bold.red(result.error))\n    console.log(node)\n    return { type: `VALIDATION_ERROR`, error: true }\n  }\n\n  // Ensure node isn't directly setting fields.\n  if (node.fields) {\n    throw new Error(\n      stripIndent`\n      Plugins creating nodes can not set data on the reserved field \"fields\"\n      as this is reserved for plugins which wish to extend your nodes.\n\n      If your plugin didn't add \"fields\" you're probably seeing this\n      error because you're reusing an old node object.\n\n      Node:\n\n      ${JSON.stringify(node, null, 4)}\n\n      Plugin that created the node:\n\n      ${JSON.stringify(plugin, null, 4)}\n    `\n    )\n  }\n\n  trackInlineObjectsInRootNode(node)\n\n  const oldNode = getNode(node.id)\n\n  // Ensure the plugin isn't creating a node type owned by another\n  // plugin. Type \"ownership\" is first come first served.\n  if (plugin) {\n    let pluginName = plugin.name\n\n    if (!typeOwners[node.internal.type])\n      typeOwners[node.internal.type] = pluginName\n    else if (typeOwners[node.internal.type] !== pluginName)\n      throw new Error(stripIndent`\n        The plugin \"${pluginName}\" created a node of a type owned by another plugin.\n\n        The node type \"${node.internal.type}\" is owned by \"${\n        typeOwners[node.internal.type]\n      }\".\n\n        If you copy and pasted code from elsewhere, you'll need to pick a new type name\n        for your new node(s).\n\n        The node object passed to \"createNode\":\n\n        ${JSON.stringify(node, null, 4)}\n\n        The plugin creating the node:\n\n        ${JSON.stringify(plugin, null, 4)}\n      `)\n\n    // If the node has been created in the past, check that\n    // the current plugin is the same as the previous.\n    if (oldNode && oldNode.internal.owner !== pluginName) {\n      throw new Error(\n        stripIndent`\n        Nodes can only be updated by their owner. Node \"${node.id}\" is\n        owned by \"${oldNode.internal.owner}\" and another plugin \"${pluginName}\"\n        tried to update it.\n\n        `\n      )\n    }\n  }\n\n  if (actionOptions.parentSpan) {\n    actionOptions.parentSpan.setTag(`nodeId`, node.id)\n    actionOptions.parentSpan.setTag(`nodeType`, node.id)\n  }\n\n  let deleteActions\n  let updateNodeAction\n  // Check if the node has already been processed.\n  if (oldNode && !hasNodeChanged(node.id, node.internal.contentDigest)) {\n    updateNodeAction = {\n      type: `TOUCH_NODE`,\n      plugin,\n      ...actionOptions,\n      payload: node.id,\n    }\n  } else {\n    // Remove any previously created descendant nodes as they're all due\n    // to be recreated.\n    if (oldNode) {\n      const createDeleteAction = node => {\n        return {\n          type: `DELETE_NODE`,\n          plugin,\n          ...actionOptions,\n          payload: node,\n        }\n      }\n      deleteActions = findChildrenRecursively(oldNode.children)\n        .map(getNode)\n        .map(createDeleteAction)\n    }\n\n    updateNodeAction = {\n      type: `CREATE_NODE`,\n      plugin,\n      oldNode,\n      ...actionOptions,\n      payload: node,\n    }\n  }\n\n  if (deleteActions && deleteActions.length) {\n    return [...deleteActions, updateNodeAction]\n  } else {\n    return updateNodeAction\n  }\n}\n\n/**\n * \"Touch\" a node. Tells Gatsby a node still exists and shouldn't\n * be garbage collected. Primarily useful for source plugins fetching\n * nodes from a remote system that can return only nodes that have\n * updated. The source plugin then touches all the nodes that haven't\n * updated but still exist so Gatsby knows to keep them.\n * @param {Object} $0\n * @param {string} $0.nodeId The id of a node\n * @example\n * touchNode({ nodeId: `a-node-id` })\n */\nactions.touchNode = (options: any, plugin?: Plugin) => {\n  let nodeId = _.get(options, `nodeId`)\n\n  // Check if using old method signature. Warn about incorrect usage\n  if (typeof options === `string`) {\n    console.warn(\n      `Calling \"touchNode\" with a nodeId is deprecated. Please pass an object containing a nodeId instead: touchNode({ nodeId: 'a-node-id' })`\n    )\n\n    if (plugin && plugin.name) {\n      console.log(`\"touchNode\" was called by ${plugin.name}`)\n    }\n\n    nodeId = options\n  }\n\n  return {\n    type: `TOUCH_NODE`,\n    plugin,\n    payload: nodeId,\n  }\n}\n\ntype CreateNodeInput = {\n  node: Object,\n  fieldName?: string,\n  fieldValue?: string,\n  name?: string,\n  value: any,\n}\n/**\n * Extend another node. The new node field is placed under the `fields`\n * key on the extended node object.\n *\n * Once a plugin has claimed a field name the field name can't be used by\n * other plugins.  Also since nodes are immutable, you can't mutate the node\n * directly. So to extend another node, use this.\n * @param {Object} $0\n * @param {Object} $0.node the target node object\n * @param {string} $0.fieldName [deprecated] the name for the field\n * @param {string} $0.fieldValue [deprecated] the value for the field\n * @param {string} $0.name the name for the field\n * @param {string} $0.value the value for the field\n * @example\n * createNodeField({\n *   node,\n *   name: `happiness`,\n *   value: `is sweet graphql queries`\n * })\n *\n * // The field value is now accessible at node.fields.happiness\n */\nactions.createNodeField = (\n  { node, name, value, fieldName, fieldValue }: CreateNodeInput,\n  plugin: Plugin,\n  actionOptions?: ActionOptions\n) => {\n  if (fieldName) {\n    console.warn(\n      `Calling \"createNodeField\" with \"fieldName\" is deprecated. Use \"name\" instead`\n    )\n    if (!name) {\n      name = fieldName\n    }\n  }\n  if (fieldValue) {\n    console.warn(\n      `Calling \"createNodeField\" with \"fieldValue\" is deprecated. Use \"value\" instead`\n    )\n    if (!value) {\n      value = fieldValue\n    }\n  }\n  // Ensure required fields are set.\n  if (!node.internal.fieldOwners) {\n    node.internal.fieldOwners = {}\n  }\n  if (!node.fields) {\n    node.fields = {}\n  }\n\n  /**\n   * Normalized name of the field that will be used in schema\n   */\n  const schemaFieldName = _.includes(name, `___NODE`)\n    ? name.split(`___`)[0]\n    : name\n\n  // Check that this field isn't owned by another plugin.\n  const fieldOwner = node.internal.fieldOwners[schemaFieldName]\n  if (fieldOwner && fieldOwner !== plugin.name) {\n    throw new Error(\n      stripIndent`\n      A plugin tried to update a node field that it doesn't own:\n\n      Node id: ${node.id}\n      Plugin: ${plugin.name}\n      name: ${name}\n      value: ${value}\n      `\n    )\n  }\n\n  // Update node\n  node.fields[name] = value\n  node.internal.fieldOwners[schemaFieldName] = plugin.name\n\n  return {\n    type: `ADD_FIELD_TO_NODE`,\n    plugin,\n    ...actionOptions,\n    payload: node,\n  }\n}\n\n/**\n * Creates a link between a parent and child node. This is used when you\n * transform content from a node creating a new child node. You need to add\n * this new child node to the `children` array of the parent but since you\n * don't have direct access to the immutable parent node, use this action\n * instead.\n * @param {Object} $0\n * @param {Object} $0.parent the parent node object\n * @param {Object} $0.child the child node object\n * @example\n * createParentChildLink({ parent: parentNode, child: childNode })\n */\nactions.createParentChildLink = (\n  { parent, child }: { parent: any, child: any },\n  plugin?: Plugin\n) => {\n  // Update parent\n  parent.children.push(child.id)\n  parent.children = _.uniq(parent.children)\n\n  return {\n    type: `ADD_CHILD_NODE_TO_PARENT_NODE`,\n    plugin,\n    payload: parent,\n  }\n}\n\n/**\n * Create a dependency between a page and data. Probably for\n * internal use only.\n * @param {Object} $0\n * @param {string} $0.path the path to the page\n * @param {string} $0.nodeId A node ID\n * @param {string} $0.connection A connection type\n * @private\n */\nactions.createPageDependency = (\n  {\n    path,\n    nodeId,\n    connection,\n  }: { path: string, nodeId: string, connection: string },\n  plugin: string = ``\n) => {\n  return {\n    type: `CREATE_COMPONENT_DEPENDENCY`,\n    plugin,\n    payload: {\n      path,\n      nodeId,\n      connection,\n    },\n  }\n}\n\n/**\n * Delete dependencies between an array of pages and data. Probably for\n * internal use only. Used when deleting pages.\n * @param {Array} paths the paths to delete.\n * @private\n */\nactions.deleteComponentsDependencies = (paths: string[]) => {\n  return {\n    type: `DELETE_COMPONENTS_DEPENDENCIES`,\n    payload: {\n      paths,\n    },\n  }\n}\n\n/**\n * When the query watcher extracts a GraphQL query, it calls\n * this to store the query with its component.\n * @private\n */\nactions.replaceComponentQuery = ({\n  query,\n  componentPath,\n}: {\n  query: string,\n  componentPath: string,\n}) => {\n  return {\n    type: `REPLACE_COMPONENT_QUERY`,\n    payload: {\n      query,\n      componentPath,\n    },\n  }\n}\n\n/**\n * When the query watcher extracts a \"static\" GraphQL query from <StaticQuery>\n * components, it calls this to store the query with its component.\n * @private\n */\nactions.replaceStaticQuery = (args: any, plugin?: ?Plugin = null) => {\n  return {\n    type: `REPLACE_STATIC_QUERY`,\n    plugin,\n    payload: args,\n  }\n}\n\n/**\n * Merge additional configuration into the current webpack config. A few\n * configurations options will be ignored if set, in order to try prevent accidental breakage.\n * Specifically, any change to `entry`, `output`, `target`, or `resolveLoaders` will be ignored.\n *\n * For full control over the webpack config, use `replaceWebpackConfig()`.\n *\n * @param {Object} config partial webpack config, to be merged into the current one\n */\nactions.setWebpackConfig = (config: Object, plugin?: ?Plugin = null) => {\n  return {\n    type: `SET_WEBPACK_CONFIG`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Completely replace the webpack config for the current stage. This can be\n * dangerous and break Gatsby if certain configuration options are changed.\n *\n * Generally only useful for cases where you need to handle config merging logic\n * yourself, in which case consider using `webpack-merge`.\n *\n * @param {Object} config complete webpack config\n */\nactions.replaceWebpackConfig = (config: Object, plugin?: ?Plugin = null) => {\n  return {\n    type: `REPLACE_WEBPACK_CONFIG`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Set top-level Babel options. Plugins and presets will be ignored. Use\n * setBabelPlugin and setBabelPreset for this.\n * @param {Object} config An options object in the shape of a normal babelrc JavaScript object\n * @example\n * setBabelOptions({\n *   options: {\n *     sourceMaps: `inline`,\n *   }\n * })\n */\nactions.setBabelOptions = (options: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!_.isObject(options)) {\n    console.log(`${name} must pass an object to \"setBabelOptions\"`)\n    console.log(JSON.stringify(options, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n\n  if (!_.isObject(options.options)) {\n    console.log(`${name} must pass options to \"setBabelOptions\"`)\n    console.log(JSON.stringify(options, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n\n  return {\n    type: `SET_BABEL_OPTIONS`,\n    plugin,\n    payload: options,\n  }\n}\n\n/**\n * Add new plugins or merge options into existing Babel plugins.\n * @param {Object} config A config object describing the Babel plugin to be added.\n * @param {string} config.name The name of the Babel plugin\n * @param {Object} config.options Options to pass to the Babel plugin.\n * @example\n * setBabelPlugin({\n *   name:  `babel-plugin-emotion`,\n *   options: {\n *     sourceMap: true,\n *   },\n * })\n */\nactions.setBabelPlugin = (config: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!config.name) {\n    console.log(`${name} must set the name of the Babel plugin`)\n    console.log(JSON.stringify(config, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n  if (!config.options) {\n    config.options = {}\n  }\n  return {\n    type: `SET_BABEL_PLUGIN`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Add new presets or merge options into existing Babel presets.\n * @param {Object} config A config object describing the Babel plugin to be added.\n * @param {string} config.name The name of the Babel preset.\n * @param {Object} config.options Options to pass to the Babel preset.\n * @example\n * setBabelPreset({\n *   name: `@babel/preset-react`,\n *   options: {\n *     pragma: `Glamor.createElement`,\n *   },\n * })\n */\nactions.setBabelPreset = (config: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!config.name) {\n    console.log(`${name} must set the name of the Babel preset`)\n    console.log(JSON.stringify(config, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n  if (!config.options) {\n    config.options = {}\n  }\n  return {\n    type: `SET_BABEL_PRESET`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Create a \"job\". This is a long-running process that are generally\n * started as side-effects to GraphQL queries.\n * [`gatsby-plugin-sharp`](/packages/gatsby-plugin-sharp/) uses this for\n * example.\n *\n * Gatsby doesn't finish its bootstrap until all jobs are ended.\n * @param {Object} job A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * createJob({ id: `write file id: 123`, fileName: `something.jpeg` })\n */\nactions.createJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `CREATE_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * Set (update) a \"job\". Sometimes on really long running jobs you want\n * to update the job as it continues.\n *\n * @param {Object} job A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * setJob({ id: `write file id: 123`, progress: 50 })\n */\nactions.setJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `SET_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * End a \"job\".\n *\n * Gatsby doesn't finish its bootstrap until all jobs are ended.\n * @param {Object} job  A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * endJob({ id: `write file id: 123` })\n */\nactions.endJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `END_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * Set plugin status. A plugin can use this to save status keys e.g. the last\n * it fetched something. These values are persisted between runs of Gatsby.\n *\n * @param {Object} status  An object with arbitrary values set\n * @example\n * setPluginStatus({ lastFetched: Date.now() })\n */\nactions.setPluginStatus = (\n  status: { [key: string]: mixed },\n  plugin: Plugin\n) => {\n  return {\n    type: `SET_PLUGIN_STATUS`,\n    plugin,\n    payload: status,\n  }\n}\n\n/**\n * Check if path is absolute and add pathPrefix in front if it's not\n */\nconst maybeAddPathPrefix = (path, pathPrefix) => {\n  const parsed = url.parse(path)\n  const isRelativeProtocol = path.startsWith(`//`)\n  return `${\n    parsed.protocol != null || isRelativeProtocol ? `` : pathPrefix\n  }${path}`\n}\n\n/**\n * Create a redirect from one page to another. Server redirects don't work out\n * of the box. You must have a plugin setup to integrate the redirect data with\n * your hosting technology e.g. the [Netlify\n * plugin](/packages/gatsby-plugin-netlify/), or the [Amazon S3\n * plugin](/packages/gatsby-plugin-s3/).\n *\n * @param {Object} redirect Redirect data\n * @param {string} redirect.fromPath Any valid URL. Must start with a forward slash\n * @param {boolean} redirect.isPermanent This is a permanent redirect; defaults to temporary\n * @param {string} redirect.toPath URL of a created page (see `createPage`)\n * @param {boolean} redirect.redirectInBrowser Redirects are generally for redirecting legacy URLs to their new configuration. If you can't update your UI for some reason, set `redirectInBrowser` to true and Gatsby will handle redirecting in the client as well.\n * @param {boolean} redirect.force (Plugin-specific) Will trigger the redirect even if the `fromPath` matches a piece of content. This is not part of the Gatsby API, but implemented by (some) plugins that configure hosting provider redirects\n * @param {number} redirect.statusCode (Plugin-specific) Manually set the HTTP status code. This allows you to create a rewrite (status code 200) or custom error page (status code 404). Note that this will override the `isPermanent` option which also sets the status code. This is not part of the Gatsby API, but implemented by (some) plugins that configure hosting provider redirects\n * @example\n * createRedirect({ fromPath: '/old-url', toPath: '/new-url', isPermanent: true })\n * createRedirect({ fromPath: '/url', toPath: '/zn-CH/url', Language: 'zn' })\n * createRedirect({ fromPath: '/not_so-pretty_url', toPath: '/pretty/url', statusCode: 200 })\n */\nactions.createRedirect = ({\n  fromPath,\n  isPermanent = false,\n  redirectInBrowser = false,\n  toPath,\n  ...rest\n}) => {\n  let pathPrefix = ``\n  if (store.getState().program.prefixPaths) {\n    pathPrefix = store.getState().config.pathPrefix\n  }\n\n  return {\n    type: `CREATE_REDIRECT`,\n    payload: {\n      fromPath: maybeAddPathPrefix(fromPath, pathPrefix),\n      isPermanent,\n      redirectInBrowser,\n      toPath: maybeAddPathPrefix(toPath, pathPrefix),\n      ...rest,\n    },\n  }\n}\n\n/**\n * Add a third-party schema to be merged into main schema. Schema has to be a\n * graphql-js GraphQLSchema object.\n *\n * This schema is going to be merged as-is. This can easily break the main\n * Gatsby schema, so it's user's responsibility to make sure it doesn't happen\n * (by eg namespacing the schema).\n *\n * @param {Object} $0\n * @param {GraphQLSchema} $0.schema GraphQL schema to add\n */\nactions.addThirdPartySchema = (\n  { schema }: { schema: GraphQLSchema },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `ADD_THIRD_PARTY_SCHEMA`,\n    plugin,\n    traceId,\n    payload: schema,\n  }\n}\n\nimport type GatsbyGraphQLType from \"../schema/types/type-builders\"\n/**\n * Add type definitions to the GraphQL schema.\n *\n * @param {string | GraphQLOutputType | GatsbyGraphQLType | string[] | GraphQLOutputType[] | GatsbyGraphQLType[]} types Type definitions\n *\n * Type definitions can be provided either as\n * [`graphql-js` types](https://graphql.org/graphql-js/), in\n * [GraphQL schema definition language (SDL)](https://graphql.org/learn/)\n * or using Gatsby Type Builders available on the `schema` API argument.\n *\n * Things to note:\n * * needs to be called *before* schema generation. It is recommended to use\n *   `createTypes` in the `sourceNodes` API.\n * * type definitions targeting node types, i.e. `MarkdownRemark` and others\n *   added in `sourceNodes` or `onCreateNode` APIs, need to implement the\n *   `Node` interface. Interface fields will be added automatically, but it\n *   is mandatory to label those types with `implements Node`.\n * * by default, explicit type definitions from `createTypes` will be merged\n *   with inferred field types, and default field resolvers for `Date` (which\n *   adds formatting options) and `File` (which resolves the field value as\n *   a `relativePath` foreign-key field) are added. This behavior can be\n *   customised with `@infer` and `@dontInfer` directives, and their\n *   `noDefaultResolvers` argument.\n *\n * @example\n * exports.sourceNodes = ({ actions }) => {\n *   const { createTypes } = actions\n *   const typeDefs = `\n *     \"\"\"\n *     Markdown Node\n *     \"\"\"\n *     type MarkdownRemark implements Node {\n *       frontmatter: Frontmatter!\n *     }\n *\n *     \"\"\"\n *     Markdown Frontmatter\n *     \"\"\"\n *     type Frontmatter {\n *       title: String!\n *       author: AuthorJson!\n *       date: Date!\n *       published: Boolean!\n *       tags: [String!]!\n *     }\n *\n *     \"\"\"\n *     Author information\n *     \"\"\"\n *     # Does not include automatically inferred fields\n *     type AuthorJson implements Node @dontInfer(noFieldResolvers: true) {\n *       name: String!\n *       birthday: Date! # no default resolvers for Date formatting added\n *     }\n *   `\n *   createTypes(typeDefs)\n * }\n *\n * // using Gatsby Type Builder API\n * exports.sourceNodes = ({ actions, schema }) => {\n *   const { createTypes } = actions\n *   const typeDefs = [\n *     schema.buildObjectType({\n *       name: 'MarkdownRemark',\n *       fields: {\n *         frontmatter: 'Frontmatter!'\n *       },\n *       interfaces: ['Node'],\n *     }),\n *     schema.buildObjectType({\n *       name: 'Frontmatter',\n *       fields: {\n *         title: {\n *           type: 'String!',\n *           resolve(parent) {\n *             return parent.title || '(Untitled)'\n *           }\n *         },\n *         author: 'AuthorJson!',\n *         date: 'Date!',\n *         published: 'Boolean!',\n *         tags: '[String!]!',\n *       }\n *     })\n *   ]\n *   createTypes(typeDefs)\n * }\n */\nactions.createTypes = (\n  types:\n    | string\n    | GraphQLOutputType\n    | GatsbyGraphQLType\n    | Array<string | GraphQLOutputType | GatsbyGraphQLType>,\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `CREATE_TYPES`,\n    plugin,\n    traceId,\n    payload: types,\n  }\n}\n\n/**\n *\n * Report that a query has been extracted from a component. Used by\n * query-compilier.js.\n *\n * @param {Object} $0\n * @param {componentPath} $0.componentPath The path to the component that just had\n * its query read.\n * @param {query} $0.query The GraphQL query that was extracted from the component.\n * @private\n */\nactions.queryExtracted = (\n  { componentPath, query },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `QUERY_EXTRACTED`,\n    plugin,\n    traceId,\n    payload: { componentPath, query },\n  }\n}\n\n/**\n *\n * Report that the Relay Compilier found a graphql error when attempting to extract a query\n *\n * @param {Object} $0\n * @param {componentPath} $0.componentPath The path to the component that just had\n * its query read.\n * @param {error} $0.error The GraphQL query that was extracted from the component.\n * @private\n */\nactions.queryExtractionGraphQLError = (\n  { componentPath, error },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `QUERY_EXTRACTION_GRAPHQL_ERROR`,\n    plugin,\n    traceId,\n    payload: { componentPath, error },\n  }\n}\n\n/**\n *\n * Report that babel was able to extract the graphql query.\n * Indicates that the file is free of JS errors.\n *\n * @param {Object} $0\n * @param {componentPath} $0.componentPath The path to the component that just had\n * its query read.\n * @private\n */\nactions.queryExtractedBabelSuccess = (\n  { componentPath },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `QUERY_EXTRACTION_BABEL_SUCCESS`,\n    plugin,\n    traceId,\n    payload: { componentPath },\n  }\n}\n\n/**\n *\n * Report that the Relay Compilier found a babel error when attempting to extract a query\n *\n * @param {Object} $0\n * @param {componentPath} $0.componentPath The path to the component that just had\n * its query read.\n * @param {error} $0.error The Babel error object\n * @private\n */\nactions.queryExtractionBabelError = (\n  { componentPath, error },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `QUERY_EXTRACTION_BABEL_ERROR`,\n    plugin,\n    traceId,\n    payload: { componentPath, error },\n  }\n}\n\n/**\n * Set overall program status e.g. `BOOTSTRAPING` or `BOOTSTRAP_FINISHED`.\n *\n * @param {string} Program status\n * @private\n */\nactions.setProgramStatus = (status, plugin: Plugin, traceId?: string) => {\n  return {\n    type: `SET_PROGRAM_STATUS`,\n    plugin,\n    traceId,\n    payload: status,\n  }\n}\n\n/**\n * Broadcast that a page's query was run.\n *\n * @param {string} Path to the page component that changed.\n * @private\n */\nactions.pageQueryRun = (\n  { path, componentPath, isPage },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `PAGE_QUERY_RUN`,\n    plugin,\n    traceId,\n    payload: { path, componentPath, isPage },\n  }\n}\n\n/**\n * All action creators wrapped with a dispatch.\n */\nexports.actions = actions\n\n/**\n * All action creators wrapped with a dispatch. - *DEPRECATED*\n */\nexports.boundActionCreators = bindActionCreators(actions, store.dispatch)\n"],"file":"actions.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/redux/actions.js"],"names":["Joi","require","chalk","_","bindActionCreators","stripIndent","report","path","fs","truePath","url","kebabHash","slash","hasNodeChanged","getNode","trackInlineObjectsInRootNode","store","fileExistsSync","sync","joiSchemas","generateComponentChunkName","actions","findChildrenRecursively","children","concat","map","child","newChildren","isArray","length","deletePage","page","type","payload","pascalCase","flow","camelCase","upperFirst","hasWarnedForPageComponentInvalidContext","Set","hasWarnedForPageComponentInvalidCasing","pageComponentCache","fileOkCache","createPage","plugin","actionOptions","noPageOrComponent","name","message","process","env","NODE_ENV","console","log","bold","red","isObject","context","reservedFields","invalidFields","Object","keys","pick","singularMessage","pluralMessage","error","f","join","JSON","stringify","some","panic","has","component","warn","add","originalPageComponent","trueComponentPath","markers","split","letter","index","isAbsolute","internalComponentName","internalPage","matchPath","componentChunkName","isCreatedByStatefulCreatePages","traceId","updatedAt","Date","now","includes","fileName","fileContent","readFileSync","notEmpty","includesDefaultExport","test","extname","relativePath","relative","getState","program","directory","panicOnBuild","oldPage","pages","get","contextModified","isEqual","deleteNode","options","args","id","msg","node","createDeleteAction","deleteAction","deleteDescendantsActions","deleteNodes","nodes","descendantNodes","flatten","n","deleteNodesAction","typeOwners","createNode","internal","array","parent","owner","result","validate","nodeSchema","fields","Error","oldNode","pluginName","parentSpan","setTag","deleteActions","updateNodeAction","contentDigest","touchNode","nodeId","createNodeField","value","fieldName","fieldValue","fieldOwners","schemaFieldName","fieldOwner","createParentChildLink","push","uniq","createPageDependency","connection","deleteComponentsDependencies","paths","replaceComponentQuery","query","componentPath","replaceStaticQuery","setWebpackConfig","config","replaceWebpackConfig","setBabelOptions","exit","setBabelPlugin","setBabelPreset","createJob","job","setJob","endJob","setPluginStatus","status","maybeAddPathPrefix","pathPrefix","parsed","parse","isRelativeProtocol","startsWith","protocol","createRedirect","fromPath","isPermanent","redirectInBrowser","toPath","rest","prefixPaths","addThirdPartySchema","schema","createTypes","types","queryExtracted","queryExtractionGraphQLError","queryExtractedBabelSuccess","queryExtractionBabelError","setProgramStatus","pageQueryRun","isPage","exports","boundActionCreators","dispatch"],"mappings":";;;;;;AACA,MAAMA,GAAG,GAAGC,OAAO,CAAE,KAAF,CAAnB;;AACA,MAAMC,KAAK,GAAGD,OAAO,CAAE,OAAF,CAArB;;AACA,MAAME,CAAC,GAAGF,OAAO,CAAE,QAAF,CAAjB;;iBAC+BA,OAAO,CAAE,OAAF,C;MAA9BG,kB,YAAAA,kB;;kBACgBH,OAAO,CAAE,aAAF,C;MAAvBI,W,aAAAA,W;;AACR,MAAMC,MAAM,GAAGL,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMM,IAAI,GAAGN,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMO,EAAE,GAAGP,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAMQ,QAAQ,GAAGR,OAAO,CAAE,gBAAF,CAAxB;;AACA,MAAMS,GAAG,GAAGT,OAAO,CAAE,KAAF,CAAnB;;AACA,MAAMU,SAAS,GAAGV,OAAO,CAAE,YAAF,CAAzB;;AACA,MAAMW,KAAK,GAAGX,OAAO,CAAE,OAAF,CAArB;;kBACoCA,OAAO,CAAE,aAAF,C;MAAnCY,c,aAAAA,c;MAAgBC,O,aAAAA,O;;kBACiBb,OAAO,CAAE,qBAAF,C;MAAxCc,4B,aAAAA,4B;;kBACUd,OAAO,CAAE,SAAF,C;MAAjBe,K,aAAAA,K;;AACR,MAAMC,cAAc,GAAGhB,OAAO,CAAE,kBAAF,CAAP,CAA4BiB,IAAnD;;AACA,MAAMC,UAAU,GAAGlB,OAAO,CAAE,oBAAF,CAA1B;;kBACuCA,OAAO,CAAE,yBAAF,C;MAAtCmB,0B,aAAAA,0B;;AAER,MAAMC,OAAO,GAAG,EAAhB;;AAEA,MAAMC,uBAAuB,GAAG,CAACC,QAAQ,GAAG,EAAZ,KAAmB;AACjDA,EAAAA,QAAQ,GAAGA,QAAQ,CAACC,MAAT,CACT,GAAGD,QAAQ,CAACE,GAAT,CAAaC,KAAK,IAAI;AACvB,UAAMC,WAAW,GAAGb,OAAO,CAACY,KAAD,CAAP,CAAeH,QAAnC;;AACA,QAAIpB,CAAC,CAACyB,OAAF,CAAUD,WAAV,KAA0BA,WAAW,CAACE,MAAZ,GAAqB,CAAnD,EAAsD;AACpD,aAAOP,uBAAuB,CAACK,WAAD,CAA9B;AACD,KAFD,MAEO;AACL,aAAO,EAAP;AACD;AACF,GAPE,CADM,CAAX;AAWA,SAAOJ,QAAP;AACD,CAbD;;AA4CA;;;;;;;;AAQAF,OAAO,CAACS,UAAR,GAAsBC,IAAD,IAAqB;AACxC,SAAO;AACLC,IAAAA,IAAI,EAAG,aADF;AAELC,IAAAA,OAAO,EAAEF;AAFJ,GAAP;AAID,CALD;;AAOA,MAAMG,UAAU,GAAG/B,CAAC,CAACgC,IAAF,CACjBhC,CAAC,CAACiC,SADe,EAEjBjC,CAAC,CAACkC,UAFe,CAAnB;;AAIA,MAAMC,uCAAuC,GAAG,IAAIC,GAAJ,EAAhD;AACA,MAAMC,sCAAsC,GAAG,IAAID,GAAJ,EAA/C;AACA,MAAME,kBAAkB,GAAG,EAA3B;AACA,MAAMC,WAAW,GAAG,EAApB;AAEA;;;;;;;;;;;;;;;;;;;;;AAoBArB,OAAO,CAACsB,UAAR,GAAqB,CACnBZ,IADmB,EAEnBa,MAFmB,EAGnBC,aAHmB,KAIhB;AACH,MAAIC,iBAAiB,GAAG,KAAxB;AACA,MAAIC,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAAChB,IAAI,CAACxB,IAAV,EAAgB;AACd,UAAMyC,OAAO,GAAI,GAAED,IAAK,8CAAxB,CADc,CAEd;;AACA,QAAIE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCC,MAAAA,OAAO,CAACC,GAAR,CAAYnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CAAeP,OAAf,CAAZ;AACAI,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYtB,IAAZ;AACD,KAJD,MAIO;AACL,aAAOiB,OAAP;AACD;;AACDF,IAAAA,iBAAiB,GAAG,IAApB;AACD,GAjBE,CAmBH;AACA;;;AACA,MAAI3C,CAAC,CAACqD,QAAF,CAAWzB,IAAI,CAAC0B,OAAhB,CAAJ,EAA8B;AAC5B,UAAMC,cAAc,GAAG,CACpB,MADoB,EAEpB,WAFoB,EAGpB,WAHoB,EAIpB,oBAJoB,EAKpB,sBALoB,EAMpB,iBANoB,CAAvB;AAQA,UAAMC,aAAa,GAAGC,MAAM,CAACC,IAAP,CAAY1D,CAAC,CAAC2D,IAAF,CAAO/B,IAAI,CAAC0B,OAAZ,EAAqBC,cAArB,CAAZ,CAAtB;AAEA,UAAMK,eAAe,GAAI,GAAEhB,IAAK,yEAAhC;AACA,UAAMiB,aAAa,GAAI,GAAEjB,IAAK,wEAA9B;;AACA,QAAIY,aAAa,CAAC9B,MAAd,GAAuB,CAA3B,EAA8B;AAC5B,YAAMoC,KAAK,GAAI,GACbN,aAAa,CAAC9B,MAAd,KAAyB,CAAzB,GAA6BkC,eAA7B,GAA+CC,aAChD;;EAELL,aAAa,CAAClC,GAAd,CAAkByC,CAAC,IAAK,QAAOA,CAAE,GAAjC,EAAqCC,IAArC,CAA2C,IAA3C,CAAgD;;EAEhDC,IAAI,CAACC,SAAL,CAAetC,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAA8B;;;;;;;;;;;;;;;;EAgB9B2B,cAAc,CAACjC,GAAf,CAAmByC,CAAC,IAAK,QAAOA,CAAE,GAAlC,EAAsCC,IAAtC,CAA4C,IAA5C,CAAiD;;aAtB7C;;AAyBA,UAAIlB,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnC,eAAOc,KAAP,CADmC,CAEnC;AACA;AACA;AACD,OALD,MAKO,IAAIN,aAAa,CAACW,IAAd,CAAmBJ,CAAC,IAAInC,IAAI,CAAC0B,OAAL,CAAaS,CAAb,MAAoBnC,IAAI,CAACmC,CAAD,CAAhD,CAAJ,EAA0D;AAC/D5D,QAAAA,MAAM,CAACiE,KAAP,CAAaN,KAAb;AACD,OAFM,MAEA;AACL,YAAI,CAAC3B,uCAAuC,CAACkC,GAAxC,CAA4CzC,IAAI,CAAC0C,SAAjD,CAAL,EAAkE;AAChEnE,UAAAA,MAAM,CAACoE,IAAP,CAAYT,KAAZ;AACA3B,UAAAA,uCAAuC,CAACqC,GAAxC,CAA4C5C,IAAI,CAAC0C,SAAjD;AACD;AACF;AACF;AACF,GA1EE,CA4EH;AACA;;;AACA,MAAIxB,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnC,QAAI,CAAClC,cAAc,CAACc,IAAI,CAAC0C,SAAN,CAAnB,EAAqC;AACnC,YAAMzB,OAAO,GAAI,GAAED,IAAK,6EACtBhB,IAAI,CAAC0C,SACN,EAFD;AAGArB,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CAAeP,OAAf,CAAZ;AACAI,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYtB,IAAZ;AACAe,MAAAA,iBAAiB,GAAG,IAApB;AACD,KATD,MASO,IAAIf,IAAI,CAAC0C,SAAT,EAAoB;AACzB;AACA;AACA;AACA,UAAIhC,kBAAkB,CAACV,IAAI,CAAC0C,SAAN,CAAtB,EAAwC;AACtC1C,QAAAA,IAAI,CAAC0C,SAAL,GAAiBhC,kBAAkB,CAACV,IAAI,CAAC0C,SAAN,CAAnC;AACD,OAFD,MAEO;AACL,cAAMG,qBAAqB,GAAG7C,IAAI,CAAC0C,SAAnC,CADK,CAGL;;AACA1C,QAAAA,IAAI,CAAC0C,SAAL,GAAiB7D,KAAK,CAACmB,IAAI,CAAC0C,SAAN,CAAtB,CAJK,CAKL;AACA;AACA;AACA;;AACA,cAAMI,iBAAiB,GAAGjE,KAAK,CAACH,QAAQ,CAACsB,IAAI,CAAC0C,SAAN,CAAT,CAA/B;;AACA,YAAII,iBAAiB,KAAK9C,IAAI,CAAC0C,SAA/B,EAA0C;AACxC,cAAI,CAACjC,sCAAsC,CAACgC,GAAvC,CAA2CzC,IAAI,CAAC0C,SAAhD,CAAL,EAAiE;AAC/D,kBAAMK,OAAO,GAAG/C,IAAI,CAAC0C,SAAL,CACbM,KADa,CACN,EADM,EAEbtD,GAFa,CAET,CAACuD,MAAD,EAASC,KAAT,KAAmB;AACtB,kBAAID,MAAM,KAAKH,iBAAiB,CAACI,KAAD,CAAhC,EAAyC;AACvC,uBAAQ,GAAR;AACD;;AACD,qBAAQ,GAAR;AACD,aAPa,EAQbd,IARa,CAQP,EARO,CAAhB;AAUA7D,YAAAA,MAAM,CAACoE,IAAP,CACErE,WAAY;cACZ0C,IAAK;;mCAEgBhB,IAAI,CAAC0C,SAAU;mCACfI,iBAAkB;mCAClBC,OAAQ;WAN/B;AASAtC,YAAAA,sCAAsC,CAACmC,GAAvC,CAA2C5C,IAAI,CAAC0C,SAAhD;AACD;;AAED1C,UAAAA,IAAI,CAAC0C,SAAL,GAAiBI,iBAAjB;AACD;;AACDpC,QAAAA,kBAAkB,CAACmC,qBAAD,CAAlB,GAA4C7C,IAAI,CAAC0C,SAAjD;AACD;AACF;AACF;;AAED,MAAI,CAAC1C,IAAI,CAAC0C,SAAN,IAAmB,CAAClE,IAAI,CAAC2E,UAAL,CAAgBnD,IAAI,CAAC0C,SAArB,CAAxB,EAAyD;AACvD,UAAMzB,OAAO,GAAI,GAAED,IAAK,+EAAxB,CADuD,CAEvD;;AACA,QAAIE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCC,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CAAeP,OAAf,CAAZ;AACAI,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYtB,IAAZ;AACD,KALD,MAKO;AACL,aAAOiB,OAAP;AACD;;AACDF,IAAAA,iBAAiB,GAAG,IAApB;AACD;;AAED,MAAIA,iBAAJ,EAAuB;AACrBxC,IAAAA,MAAM,CAACiE,KAAP,CACG,wFADH;AAGD;;AAED,MAAIY,qBAAJ;;AACA,MAAIpD,IAAI,CAACxB,IAAL,KAAe,GAAnB,EAAuB;AACrB4E,IAAAA,qBAAqB,GAAI,gBAAzB;AACD,GAFD,MAEO;AACLA,IAAAA,qBAAqB,GAAI,YAAWjD,UAAU,CAACH,IAAI,CAACxB,IAAN,CAAY,EAA1D;AACD;;AAED,MAAI6E,YAAkB,GAAG;AACvBD,IAAAA,qBADuB;AAEvB5E,IAAAA,IAAI,EAAEwB,IAAI,CAACxB,IAFY;AAGvB8E,IAAAA,SAAS,EAAEtD,IAAI,CAACsD,SAHO;AAIvBZ,IAAAA,SAAS,EAAE1C,IAAI,CAAC0C,SAJO;AAKvBa,IAAAA,kBAAkB,EAAElE,0BAA0B,CAACW,IAAI,CAAC0C,SAAN,CALvB;AAMvBc,IAAAA,8BAA8B,EAC5B1C,aAAa,IACbA,aAAa,CAAC2C,OAAd,KAA2B,+BARN;AASvB;AACA/B,IAAAA,OAAO,EAAE1B,IAAI,CAAC0B,OAAL,IAAgB,EAVF;AAWvBgC,IAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL,EAXY,CAczB;;AAdyB,GAAzB;;AAeA,MAAIP,YAAY,CAAC7E,IAAb,CAAkB,CAAlB,MAA0B,GAA9B,EAAkC;AAChC6E,IAAAA,YAAY,CAAC7E,IAAb,GAAqB,IAAG6E,YAAY,CAAC7E,IAAK,EAA1C;AACD,GAnLE,CAqLH;AACA;AACA;AACA;;;AACA,MACE,CAAC6E,YAAY,CAACX,SAAb,CAAuBmB,QAAvB,CAAiC,UAAjC,CAAD,IACC3C,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,YAA1B,IACC,CAACT,WAAW,CAAC0C,YAAY,CAACX,SAAd,CAHhB,EAIE;AACA,UAAMoB,QAAQ,GAAGT,YAAY,CAACX,SAA9B;AACA,UAAMqB,WAAW,GAAGtF,EAAE,CAACuF,YAAH,CAAgBF,QAAhB,EAA2B,OAA3B,CAApB;AACA,QAAIG,QAAQ,GAAG,IAAf;AACA,QAAIC,qBAAqB,GAAG,IAA5B;;AAEA,QAAIH,WAAW,KAAM,EAArB,EAAwB;AACtBE,MAAAA,QAAQ,GAAG,KAAX;AACD;;AAED,QACE,CAACF,WAAW,CAACF,QAAZ,CAAsB,gBAAtB,CAAD,IACA,CAACE,WAAW,CAACF,QAAZ,CAAsB,gBAAtB,CADD,IAEA,CAACE,WAAW,CAACF,QAAZ,CAAsB,iBAAtB,CAFD,IAGA;AACA,oBAAgBM,IAAhB,CAAqB3F,IAAI,CAAC4F,OAAL,CAAaN,QAAb,CAArB,CALF,EAME;AACAI,MAAAA,qBAAqB,GAAG,KAAxB;AACD;;AACD,QAAI,CAACD,QAAD,IAAa,CAACC,qBAAlB,EAAyC;AACvC,YAAMG,YAAY,GAAG7F,IAAI,CAAC8F,QAAL,CACnBrF,KAAK,CAACsF,QAAN,GAAiBC,OAAjB,CAAyBC,SADN,EAEnBX,QAFmB,CAArB;;AAKA,UAAI,CAACG,QAAL,EAAe;AACb1F,QAAAA,MAAM,CAACmG,YAAP,CACG,2DAA0DL,YAAa,kDAD1E;AAGD;;AAED,UAAI,CAACH,qBAAL,EAA4B;AAC1B3F,QAAAA,MAAM,CAACmG,YAAP,CACG,IAAGZ,QAAS,uEADf;AAGD;AACF;;AAEDnD,IAAAA,WAAW,CAAC0C,YAAY,CAACX,SAAd,CAAX,GAAsC,IAAtC;AACD;;AAED,QAAMiC,OAAa,GAAG1F,KAAK,CAACsF,QAAN,GAAiBK,KAAjB,CAAuBC,GAAvB,CAA2BxB,YAAY,CAAC7E,IAAxC,CAAtB;AACA,QAAMsG,eAAe,GACnB,CAAC,CAACH,OAAF,IAAa,CAACvG,CAAC,CAAC2G,OAAF,CAAUJ,OAAO,CAACjD,OAAlB,EAA2B2B,YAAY,CAAC3B,OAAxC,CADhB;AAGA,2BACKZ,aADL;AAEEb,IAAAA,IAAI,EAAG,aAFT;AAGE6E,IAAAA,eAHF;AAIEjE,IAAAA,MAJF;AAKEX,IAAAA,OAAO,EAAEmD;AALX;AAOD,CArPD;AAuPA;;;;;;;;;AAOA/D,OAAO,CAAC0F,UAAR,GAAqB,CAACC,OAAD,EAAepE,MAAf,EAA+BqE,IAA/B,KAA6C;AAChE,MAAIC,EAAJ,CADgE,CAGhE;AACA;;AACA,MAAI,OAAOF,OAAP,KAAoB,QAAxB,EAAiC;AAC/B,QAAIG,GAAG,GACJ,mEAAD,GACC,8DAFH;;AAGA,QAAIF,IAAI,IAAIA,IAAI,CAAClE,IAAjB,EAAuB;AACrB;AACAH,MAAAA,MAAM,GAAGqE,IAAT;AACAE,MAAAA,GAAG,GAAGA,GAAG,GAAI,+BAA8BvE,MAAM,CAACG,IAAK,EAAvD;AACD;;AACDzC,IAAAA,MAAM,CAACoE,IAAP,CAAYyC,GAAZ;AAEAD,IAAAA,EAAE,GAAGF,OAAL;AACD,GAZD,MAYO;AACLE,IAAAA,EAAE,GAAGF,OAAO,IAAIA,OAAO,CAACI,IAAnB,IAA2BJ,OAAO,CAACI,IAAR,CAAaF,EAA7C;AACD,GAnB+D,CAqBhE;AACA;;;AACA,QAAME,IAAI,GAAGtG,OAAO,CAACoG,EAAD,CAApB;;AAEA,QAAMG,kBAAkB,GAAGD,IAAI,IAAI;AACjC,WAAO;AACLpF,MAAAA,IAAI,EAAG,aADF;AAELY,MAAAA,MAFK;AAGLX,MAAAA,OAAO,EAAEmF;AAHJ,KAAP;AAKD,GAND;;AAQA,QAAME,YAAY,GAAGD,kBAAkB,CAACD,IAAD,CAAvC,CAjCgE,CAmChE;AACA;;AACA,QAAMG,wBAAwB,GAC5BH,IAAI,IACJ9F,uBAAuB,CAAC8F,IAAI,CAAC7F,QAAN,CAAvB,CACGE,GADH,CACOX,OADP,EAEGW,GAFH,CAEO4F,kBAFP,CAFF;;AAMA,MAAIE,wBAAwB,IAAIA,wBAAwB,CAAC1F,MAAzD,EAAiE;AAC/D,WAAO,CAAC,GAAG0F,wBAAJ,EAA8BD,YAA9B,CAAP;AACD,GAFD,MAEO;AACL,WAAOA,YAAP;AACD;AACF,CAhDD;AAkDA;;;;;;;;AAMAjG,OAAO,CAACmG,WAAR,GAAsB,CAACC,KAAD,EAAe7E,MAAf,KAAkC;AACtD,MAAIuE,GAAG,GACJ,oEAAD,GACC,6CAFH;;AAGA,MAAIvE,MAAM,IAAIA,MAAM,CAACG,IAArB,EAA2B;AACzBoE,IAAAA,GAAG,GAAGA,GAAG,GAAI,gCAA+BvE,MAAM,CAACG,IAAK,EAAxD;AACD;;AACDzC,EAAAA,MAAM,CAACoE,IAAP,CAAYyC,GAAZ,EAPsD,CAStD;;AACA,QAAMO,eAAe,GAAGvH,CAAC,CAACwH,OAAF,CACtBF,KAAK,CAAChG,GAAN,CAAUmG,CAAC,IAAItG,uBAAuB,CAACR,OAAO,CAAC8G,CAAD,CAAP,CAAWrG,QAAZ,CAAtC,CADsB,CAAxB;;AAIA,QAAMsG,iBAAiB,GAAG;AACxB7F,IAAAA,IAAI,EAAG,cADiB;AAExBY,IAAAA,MAFwB;AAGxBX,IAAAA,OAAO,EAAE,CAAC,GAAGwF,KAAJ,EAAW,GAAGC,eAAd;AAHe,GAA1B;AAKA,SAAOG,iBAAP;AACD,CApBD;;AAsBA,MAAMC,UAAU,GAAG,EAAnB;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEAzG,OAAO,CAAC0G,UAAR,GAAqB,CACnBX,IADmB,EAEnBxE,MAFmB,EAGnBC,aAA6B,GAAG,EAHb,KAIhB;AACH,MAAI,CAAC1C,CAAC,CAACqD,QAAF,CAAW4D,IAAX,CAAL,EAAuB;AACrB,WAAOhE,OAAO,CAACC,GAAR,CACLnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CACG,sEADH,CADK,CAAP;AAKD,GAPE,CASH;;;AACA,MAAI,CAAC6D,IAAI,CAACY,QAAV,EAAoB;AAClBZ,IAAAA,IAAI,CAACY,QAAL,GAAgB,EAAhB;AACD,GAZE,CAcH;;;AACA,MAAI,CAACZ,IAAI,CAACa,KAAN,IAAe,CAAC9H,CAAC,CAACyB,OAAF,CAAUwF,IAAI,CAAC7F,QAAf,CAApB,EAA8C;AAC5C6F,IAAAA,IAAI,CAAC7F,QAAL,GAAgB,EAAhB;AACD,GAjBE,CAmBH;;;AACA,MAAI,CAAC6F,IAAI,CAACc,MAAV,EAAkB;AAChBd,IAAAA,IAAI,CAACc,MAAL,GAAc,IAAd;AACD,GAtBE,CAwBH;;;AACA,MAAId,IAAI,CAACY,QAAL,CAAcG,KAAlB,EAAyB;AACvB7H,IAAAA,MAAM,CAAC2D,KAAP,CAAaG,IAAI,CAACC,SAAL,CAAe+C,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAAb;AACA9G,IAAAA,MAAM,CAACiE,KAAP,CACErE,KAAK,CAACoD,IAAN,CAAWC,GAAX,CACG,iFADH,CADF;AAKD,GAhCE,CAkCH;;;AACA,MAAIX,MAAJ,EAAY;AACVwE,IAAAA,IAAI,CAACY,QAAL,CAAcG,KAAd,GAAsBvF,MAAM,CAACG,IAA7B;AACD;;AAED,QAAMqF,MAAM,GAAGpI,GAAG,CAACqI,QAAJ,CAAajB,IAAb,EAAmBjG,UAAU,CAACmH,UAA9B,CAAf;;AACA,MAAIF,MAAM,CAACnE,KAAX,EAAkB;AAChBb,IAAAA,OAAO,CAACC,GAAR,CAAYnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CAAgB,qCAAhB,CAAZ;AACAH,IAAAA,OAAO,CAACC,GAAR,CAAYnD,KAAK,CAACoD,IAAN,CAAWC,GAAX,CAAe6E,MAAM,CAACnE,KAAtB,CAAZ;AACAb,IAAAA,OAAO,CAACC,GAAR,CAAY+D,IAAZ;AACA,WAAO;AAAEpF,MAAAA,IAAI,EAAG,kBAAT;AAA4BiC,MAAAA,KAAK,EAAE;AAAnC,KAAP;AACD,GA7CE,CA+CH;;;AACA,MAAImD,IAAI,CAACmB,MAAT,EAAiB;AACf,UAAM,IAAIC,KAAJ,CACJnI,WAAY;;;;;;;;;QASV+D,IAAI,CAACC,SAAL,CAAe+C,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAA8B;;;;QAI9BhD,IAAI,CAACC,SAAL,CAAezB,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAgC;KAd9B,CAAN;AAiBD;;AAED7B,EAAAA,4BAA4B,CAACqG,IAAD,CAA5B;AAEA,QAAMqB,OAAO,GAAG3H,OAAO,CAACsG,IAAI,CAACF,EAAN,CAAvB,CAtEG,CAwEH;AACA;;AACA,MAAItE,MAAJ,EAAY;AACV,QAAI8F,UAAU,GAAG9F,MAAM,CAACG,IAAxB;AAEA,QAAI,CAAC+E,UAAU,CAACV,IAAI,CAACY,QAAL,CAAchG,IAAf,CAAf,EACE8F,UAAU,CAACV,IAAI,CAACY,QAAL,CAAchG,IAAf,CAAV,GAAiC0G,UAAjC,CADF,KAEK,IAAIZ,UAAU,CAACV,IAAI,CAACY,QAAL,CAAchG,IAAf,CAAV,KAAmC0G,UAAvC,EACH,MAAM,IAAIF,KAAJ,CAAUnI,WAAY;sBACZqI,UAAW;;yBAERtB,IAAI,CAACY,QAAL,CAAchG,IAAK,kBACpC8F,UAAU,CAACV,IAAI,CAACY,QAAL,CAAchG,IAAf,CACX;;;;;;;UAOGoC,IAAI,CAACC,SAAL,CAAe+C,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAA8B;;;;UAI9BhD,IAAI,CAACC,SAAL,CAAezB,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAgC;OAhB9B,CAAN,CANQ,CAyBV;AACA;;AACA,QAAI6F,OAAO,IAAIA,OAAO,CAACT,QAAR,CAAiBG,KAAjB,KAA2BO,UAA1C,EAAsD;AACpD,YAAM,IAAIF,KAAJ,CACJnI,WAAY;0DACsC+G,IAAI,CAACF,EAAG;oBAC9CuB,OAAO,CAACT,QAAR,CAAiBG,KAAM,yBAAwBO,UAAW;;;SAHlE,CAAN;AAQD;AACF;;AAED,MAAI7F,aAAa,CAAC8F,UAAlB,EAA8B;AAC5B9F,IAAAA,aAAa,CAAC8F,UAAd,CAAyBC,MAAzB,CAAiC,QAAjC,EAA0CxB,IAAI,CAACF,EAA/C;AACArE,IAAAA,aAAa,CAAC8F,UAAd,CAAyBC,MAAzB,CAAiC,UAAjC,EAA4CxB,IAAI,CAACF,EAAjD;AACD;;AAED,MAAI2B,aAAJ;AACA,MAAIC,gBAAJ,CAvHG,CAwHH;;AACA,MAAIL,OAAO,IAAI,CAAC5H,cAAc,CAACuG,IAAI,CAACF,EAAN,EAAUE,IAAI,CAACY,QAAL,CAAce,aAAxB,CAA9B,EAAsE;AACpED,IAAAA,gBAAgB;AACd9G,MAAAA,IAAI,EAAG,YADO;AAEdY,MAAAA;AAFc,OAGXC,aAHW;AAIdZ,MAAAA,OAAO,EAAEmF,IAAI,CAACF;AAJA,MAAhB;AAMD,GAPD,MAOO;AACL;AACA;AACA,QAAIuB,OAAJ,EAAa;AACX,YAAMpB,kBAAkB,GAAGD,IAAI,IAAI;AACjC;AACEpF,UAAAA,IAAI,EAAG,aADT;AAEEY,UAAAA;AAFF,WAGKC,aAHL;AAIEZ,UAAAA,OAAO,EAAEmF;AAJX;AAMD,OAPD;;AAQAyB,MAAAA,aAAa,GAAGvH,uBAAuB,CAACmH,OAAO,CAAClH,QAAT,CAAvB,CACbE,GADa,CACTX,OADS,EAEbW,GAFa,CAET4F,kBAFS,CAAhB;AAGD;;AAEDyB,IAAAA,gBAAgB;AACd9G,MAAAA,IAAI,EAAG,aADO;AAEdY,MAAAA,MAFc;AAGd6F,MAAAA;AAHc,OAIX5F,aAJW;AAKdZ,MAAAA,OAAO,EAAEmF;AALK,MAAhB;AAOD;;AAED,MAAIyB,aAAa,IAAIA,aAAa,CAAChH,MAAnC,EAA2C;AACzC,WAAO,CAAC,GAAGgH,aAAJ,EAAmBC,gBAAnB,CAAP;AACD,GAFD,MAEO;AACL,WAAOA,gBAAP;AACD;AACF,CAnKD;AAqKA;;;;;;;;;;;;;AAWAzH,OAAO,CAAC2H,SAAR,GAAoB,CAAChC,OAAD,EAAepE,MAAf,KAAmC;AACrD,MAAIqG,MAAM,GAAG9I,CAAC,CAACyG,GAAF,CAAMI,OAAN,EAAgB,QAAhB,CAAb,CADqD,CAGrD;;;AACA,MAAI,OAAOA,OAAP,KAAoB,QAAxB,EAAiC;AAC/B5D,IAAAA,OAAO,CAACsB,IAAR,CACG,wIADH;;AAIA,QAAI9B,MAAM,IAAIA,MAAM,CAACG,IAArB,EAA2B;AACzBK,MAAAA,OAAO,CAACC,GAAR,CAAa,6BAA4BT,MAAM,CAACG,IAAK,EAArD;AACD;;AAEDkG,IAAAA,MAAM,GAAGjC,OAAT;AACD;;AAED,SAAO;AACLhF,IAAAA,IAAI,EAAG,YADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEgH;AAHJ,GAAP;AAKD,CArBD;;AA8BA;;;;;;;;;;;;;;;;;;;;;;AAsBA5H,OAAO,CAAC6H,eAAR,GAA0B,CACxB;AAAE9B,EAAAA,IAAF;AAAQrE,EAAAA,IAAR;AAAcoG,EAAAA,KAAd;AAAqBC,EAAAA,SAArB;AAAgCC,EAAAA;AAAhC,CADwB,EAExBzG,MAFwB,EAGxBC,aAHwB,KAIrB;AACH,MAAIuG,SAAJ,EAAe;AACbhG,IAAAA,OAAO,CAACsB,IAAR,CACG,8EADH;;AAGA,QAAI,CAAC3B,IAAL,EAAW;AACTA,MAAAA,IAAI,GAAGqG,SAAP;AACD;AACF;;AACD,MAAIC,UAAJ,EAAgB;AACdjG,IAAAA,OAAO,CAACsB,IAAR,CACG,gFADH;;AAGA,QAAI,CAACyE,KAAL,EAAY;AACVA,MAAAA,KAAK,GAAGE,UAAR;AACD;AACF,GAhBE,CAiBH;;;AACA,MAAI,CAACjC,IAAI,CAACY,QAAL,CAAcsB,WAAnB,EAAgC;AAC9BlC,IAAAA,IAAI,CAACY,QAAL,CAAcsB,WAAd,GAA4B,EAA5B;AACD;;AACD,MAAI,CAAClC,IAAI,CAACmB,MAAV,EAAkB;AAChBnB,IAAAA,IAAI,CAACmB,MAAL,GAAc,EAAd;AACD;AAED;;;;;AAGA,QAAMgB,eAAe,GAAGpJ,CAAC,CAACyF,QAAF,CAAW7C,IAAX,EAAkB,SAAlB,IACpBA,IAAI,CAACgC,KAAL,CAAY,KAAZ,EAAkB,CAAlB,CADoB,GAEpBhC,IAFJ,CA5BG,CAgCH;;AACA,QAAMyG,UAAU,GAAGpC,IAAI,CAACY,QAAL,CAAcsB,WAAd,CAA0BC,eAA1B,CAAnB;;AACA,MAAIC,UAAU,IAAIA,UAAU,KAAK5G,MAAM,CAACG,IAAxC,EAA8C;AAC5C,UAAM,IAAIyF,KAAJ,CACJnI,WAAY;;;iBAGD+G,IAAI,CAACF,EAAG;gBACTtE,MAAM,CAACG,IAAK;cACdA,IAAK;eACJoG,KAAM;OAPX,CAAN;AAUD,GA7CE,CA+CH;;;AACA/B,EAAAA,IAAI,CAACmB,MAAL,CAAYxF,IAAZ,IAAoBoG,KAApB;AACA/B,EAAAA,IAAI,CAACY,QAAL,CAAcsB,WAAd,CAA0BC,eAA1B,IAA6C3G,MAAM,CAACG,IAApD;AAEA;AACEf,IAAAA,IAAI,EAAG,mBADT;AAEEY,IAAAA;AAFF,KAGKC,aAHL;AAIEZ,IAAAA,OAAO,EAAEmF;AAJX;AAMD,CA7DD;AA+DA;;;;;;;;;;;;;;AAYA/F,OAAO,CAACoI,qBAAR,GAAgC,CAC9B;AAAEvB,EAAAA,MAAF;AAAUxG,EAAAA;AAAV,CAD8B,EAE9BkB,MAF8B,KAG3B;AACH;AACAsF,EAAAA,MAAM,CAAC3G,QAAP,CAAgBmI,IAAhB,CAAqBhI,KAAK,CAACwF,EAA3B;AACAgB,EAAAA,MAAM,CAAC3G,QAAP,GAAkBpB,CAAC,CAACwJ,IAAF,CAAOzB,MAAM,CAAC3G,QAAd,CAAlB;AAEA,SAAO;AACLS,IAAAA,IAAI,EAAG,+BADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEiG;AAHJ,GAAP;AAKD,CAbD;AAeA;;;;;;;;;;;AASA7G,OAAO,CAACuI,oBAAR,GAA+B,CAC7B;AACErJ,EAAAA,IADF;AAEE0I,EAAAA,MAFF;AAGEY,EAAAA;AAHF,CAD6B,EAM7BjH,MAAc,GAAI,EANW,KAO1B;AACH,SAAO;AACLZ,IAAAA,IAAI,EAAG,6BADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAE;AACP1B,MAAAA,IADO;AAEP0I,MAAAA,MAFO;AAGPY,MAAAA;AAHO;AAHJ,GAAP;AASD,CAjBD;AAmBA;;;;;;;;AAMAxI,OAAO,CAACyI,4BAAR,GAAwCC,KAAD,IAAqB;AAC1D,SAAO;AACL/H,IAAAA,IAAI,EAAG,gCADF;AAELC,IAAAA,OAAO,EAAE;AACP8H,MAAAA;AADO;AAFJ,GAAP;AAMD,CAPD;AASA;;;;;;;AAKA1I,OAAO,CAAC2I,qBAAR,GAAgC,CAAC;AAC/BC,EAAAA,KAD+B;AAE/BC,EAAAA;AAF+B,CAAD,KAM1B;AACJ,SAAO;AACLlI,IAAAA,IAAI,EAAG,yBADF;AAELC,IAAAA,OAAO,EAAE;AACPgI,MAAAA,KADO;AAEPC,MAAAA;AAFO;AAFJ,GAAP;AAOD,CAdD;AAgBA;;;;;;;AAKA7I,OAAO,CAAC8I,kBAAR,GAA6B,CAAClD,IAAD,EAAYrE,MAAgB,GAAG,IAA/B,KAAwC;AACnE,SAAO;AACLZ,IAAAA,IAAI,EAAG,sBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEgF;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASA5F,OAAO,CAAC+I,gBAAR,GAA2B,CAACC,MAAD,EAAiBzH,MAAgB,GAAG,IAApC,KAA6C;AACtE,SAAO;AACLZ,IAAAA,IAAI,EAAG,oBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEoI;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASAhJ,OAAO,CAACiJ,oBAAR,GAA+B,CAACD,MAAD,EAAiBzH,MAAgB,GAAG,IAApC,KAA6C;AAC1E,SAAO;AACLZ,IAAAA,IAAI,EAAG,wBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEoI;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;;;AAWAhJ,OAAO,CAACkJ,eAAR,GAA0B,CAACvD,OAAD,EAAkBpE,MAAgB,GAAG,IAArC,KAA8C;AACtE;AACA,MAAIG,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAAC5C,CAAC,CAACqD,QAAF,CAAWwD,OAAX,CAAL,EAA0B;AACxB5D,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,2CAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAe2C,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAAZ;;AACA,QAAI/D,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAACuH,IAAR,CAAa,CAAb;AACD;AACF;;AAED,MAAI,CAACrK,CAAC,CAACqD,QAAF,CAAWwD,OAAO,CAACA,OAAnB,CAAL,EAAkC;AAChC5D,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,yCAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAe2C,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAAZ;;AACA,QAAI/D,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAACuH,IAAR,CAAa,CAAb;AACD;AACF;;AAED,SAAO;AACLxI,IAAAA,IAAI,EAAG,mBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAE+E;AAHJ,GAAP;AAKD,CA3BD;AA6BA;;;;;;;;;;;;;;;AAaA3F,OAAO,CAACoJ,cAAR,GAAyB,CAACJ,MAAD,EAAiBzH,MAAgB,GAAG,IAApC,KAA6C;AACpE;AACA,MAAIG,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAACsH,MAAM,CAACtH,IAAZ,EAAkB;AAChBK,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,wCAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAegG,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAZ;;AACA,QAAIpH,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAACuH,IAAR,CAAa,CAAb;AACD;AACF;;AACD,MAAI,CAACH,MAAM,CAACrD,OAAZ,EAAqB;AACnBqD,IAAAA,MAAM,CAACrD,OAAP,GAAiB,EAAjB;AACD;;AACD,SAAO;AACLhF,IAAAA,IAAI,EAAG,kBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEoI;AAHJ,GAAP;AAKD,CArBD;AAuBA;;;;;;;;;;;;;;;AAaAhJ,OAAO,CAACqJ,cAAR,GAAyB,CAACL,MAAD,EAAiBzH,MAAgB,GAAG,IAApC,KAA6C;AACpE;AACA,MAAIG,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAACsH,MAAM,CAACtH,IAAZ,EAAkB;AAChBK,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,wCAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAegG,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAZ;;AACA,QAAIpH,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAACuH,IAAR,CAAa,CAAb;AACD;AACF;;AACD,MAAI,CAACH,MAAM,CAACrD,OAAZ,EAAqB;AACnBqD,IAAAA,MAAM,CAACrD,OAAP,GAAiB,EAAjB;AACD;;AACD,SAAO;AACLhF,IAAAA,IAAI,EAAG,kBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAEoI;AAHJ,GAAP;AAKD,CArBD;AAuBA;;;;;;;;;;;;;;AAYAhJ,OAAO,CAACsJ,SAAR,GAAoB,CAACC,GAAD,EAAWhI,MAAgB,GAAG,IAA9B,KAAuC;AACzD,SAAO;AACLZ,IAAAA,IAAI,EAAG,YADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAE2I;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASAvJ,OAAO,CAACwJ,MAAR,GAAiB,CAACD,GAAD,EAAWhI,MAAgB,GAAG,IAA9B,KAAuC;AACtD,SAAO;AACLZ,IAAAA,IAAI,EAAG,SADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAE2I;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASAvJ,OAAO,CAACyJ,MAAR,GAAiB,CAACF,GAAD,EAAWhI,MAAgB,GAAG,IAA9B,KAAuC;AACtD,SAAO;AACLZ,IAAAA,IAAI,EAAG,SADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAE2I;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;AAQAvJ,OAAO,CAAC0J,eAAR,GAA0B,CACxBC,MADwB,EAExBpI,MAFwB,KAGrB;AACH,SAAO;AACLZ,IAAAA,IAAI,EAAG,mBADF;AAELY,IAAAA,MAFK;AAGLX,IAAAA,OAAO,EAAE+I;AAHJ,GAAP;AAKD,CATD;AAWA;;;;;AAGA,MAAMC,kBAAkB,GAAG,CAAC1K,IAAD,EAAO2K,UAAP,KAAsB;AAC/C,QAAMC,MAAM,GAAGzK,GAAG,CAAC0K,KAAJ,CAAU7K,IAAV,CAAf;AACA,QAAM8K,kBAAkB,GAAG9K,IAAI,CAAC+K,UAAL,CAAiB,IAAjB,CAA3B;AACA,SAAQ,GACNH,MAAM,CAACI,QAAP,IAAmB,IAAnB,IAA2BF,kBAA3B,GAAiD,EAAjD,GAAqDH,UACtD,GAAE3K,IAAK,EAFR;AAGD,CAND;AAQA;;;;;;;;;;;;;;;;;;;;;AAmBAc,OAAO,CAACmK,cAAR,GAAyB,UAMnB;AAAA,MALJC,QAKI,QALJA,QAKI;AAAA,8BAJJC,WAII;AAAA,MAJJA,WAII,iCAJU,KAIV;AAAA,mCAHJC,iBAGI;AAAA,MAHJA,iBAGI,sCAHgB,KAGhB;AAAA,MAFJC,MAEI,QAFJA,MAEI;AAAA,MADDC,IACC;AACJ,MAAIX,UAAU,GAAI,EAAlB;;AACA,MAAIlK,KAAK,CAACsF,QAAN,GAAiBC,OAAjB,CAAyBuF,WAA7B,EAA0C;AACxCZ,IAAAA,UAAU,GAAGlK,KAAK,CAACsF,QAAN,GAAiB+D,MAAjB,CAAwBa,UAArC;AACD;;AAED,SAAO;AACLlJ,IAAAA,IAAI,EAAG,iBADF;AAELC,IAAAA,OAAO;AACLwJ,MAAAA,QAAQ,EAAER,kBAAkB,CAACQ,QAAD,EAAWP,UAAX,CADvB;AAELQ,MAAAA,WAFK;AAGLC,MAAAA,iBAHK;AAILC,MAAAA,MAAM,EAAEX,kBAAkB,CAACW,MAAD,EAASV,UAAT;AAJrB,OAKFW,IALE;AAFF,GAAP;AAUD,CAtBD;AAwBA;;;;;;;;;;;;;AAWAxK,OAAO,CAAC0K,mBAAR,GAA8B,CAC5B;AAAEC,EAAAA;AAAF,CAD4B,EAE5BpJ,MAF4B,EAG5B4C,OAH4B,KAIzB;AACH,SAAO;AACLxD,IAAAA,IAAI,EAAG,wBADF;AAELY,IAAAA,MAFK;AAGL4C,IAAAA,OAHK;AAILvD,IAAAA,OAAO,EAAE+J;AAJJ,GAAP;AAMD,CAXD;;AAcA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFA3K,OAAO,CAAC4K,WAAR,GAAsB,CACpBC,KADoB,EAMpBtJ,MANoB,EAOpB4C,OAPoB,KAQjB;AACH,SAAO;AACLxD,IAAAA,IAAI,EAAG,cADF;AAELY,IAAAA,MAFK;AAGL4C,IAAAA,OAHK;AAILvD,IAAAA,OAAO,EAAEiK;AAJJ,GAAP;AAMD,CAfD;AAiBA;;;;;;;;;;;;;AAWA7K,OAAO,CAAC8K,cAAR,GAAyB,CACvB;AAAEjC,EAAAA,aAAF;AAAiBD,EAAAA;AAAjB,CADuB,EAEvBrH,MAFuB,EAGvB4C,OAHuB,KAIpB;AACH,SAAO;AACLxD,IAAAA,IAAI,EAAG,iBADF;AAELY,IAAAA,MAFK;AAGL4C,IAAAA,OAHK;AAILvD,IAAAA,OAAO,EAAE;AAAEiI,MAAAA,aAAF;AAAiBD,MAAAA;AAAjB;AAJJ,GAAP;AAMD,CAXD;AAaA;;;;;;;;;;;;AAUA5I,OAAO,CAAC+K,2BAAR,GAAsC,CACpC;AAAElC,EAAAA,aAAF;AAAiBjG,EAAAA;AAAjB,CADoC,EAEpCrB,MAFoC,EAGpC4C,OAHoC,KAIjC;AACH,SAAO;AACLxD,IAAAA,IAAI,EAAG,gCADF;AAELY,IAAAA,MAFK;AAGL4C,IAAAA,OAHK;AAILvD,IAAAA,OAAO,EAAE;AAAEiI,MAAAA,aAAF;AAAiBjG,MAAAA;AAAjB;AAJJ,GAAP;AAMD,CAXD;AAaA;;;;;;;;;;;;AAUA5C,OAAO,CAACgL,0BAAR,GAAqC,CACnC;AAAEnC,EAAAA;AAAF,CADmC,EAEnCtH,MAFmC,EAGnC4C,OAHmC,KAIhC;AACH,SAAO;AACLxD,IAAAA,IAAI,EAAG,gCADF;AAELY,IAAAA,MAFK;AAGL4C,IAAAA,OAHK;AAILvD,IAAAA,OAAO,EAAE;AAAEiI,MAAAA;AAAF;AAJJ,GAAP;AAMD,CAXD;AAaA;;;;;;;;;;;;AAUA7I,OAAO,CAACiL,yBAAR,GAAoC,CAClC;AAAEpC,EAAAA,aAAF;AAAiBjG,EAAAA;AAAjB,CADkC,EAElCrB,MAFkC,EAGlC4C,OAHkC,KAI/B;AACH,SAAO;AACLxD,IAAAA,IAAI,EAAG,8BADF;AAELY,IAAAA,MAFK;AAGL4C,IAAAA,OAHK;AAILvD,IAAAA,OAAO,EAAE;AAAEiI,MAAAA,aAAF;AAAiBjG,MAAAA;AAAjB;AAJJ,GAAP;AAMD,CAXD;AAaA;;;;;;;;AAMA5C,OAAO,CAACkL,gBAAR,GAA2B,CAACvB,MAAD,EAASpI,MAAT,EAAyB4C,OAAzB,KAA8C;AACvE,SAAO;AACLxD,IAAAA,IAAI,EAAG,oBADF;AAELY,IAAAA,MAFK;AAGL4C,IAAAA,OAHK;AAILvD,IAAAA,OAAO,EAAE+I;AAJJ,GAAP;AAMD,CAPD;AASA;;;;;;;;AAMA3J,OAAO,CAACmL,YAAR,GAAuB,CACrB;AAAEjM,EAAAA,IAAF;AAAQ2J,EAAAA,aAAR;AAAuBuC,EAAAA;AAAvB,CADqB,EAErB7J,MAFqB,EAGrB4C,OAHqB,KAIlB;AACH,SAAO;AACLxD,IAAAA,IAAI,EAAG,gBADF;AAELY,IAAAA,MAFK;AAGL4C,IAAAA,OAHK;AAILvD,IAAAA,OAAO,EAAE;AAAE1B,MAAAA,IAAF;AAAQ2J,MAAAA,aAAR;AAAuBuC,MAAAA;AAAvB;AAJJ,GAAP;AAMD,CAXD;AAaA;;;;;AAGAC,OAAO,CAACrL,OAAR,GAAkBA,OAAlB;AAEA;;;;AAGAqL,OAAO,CAACC,mBAAR,GAA8BvM,kBAAkB,CAACiB,OAAD,EAAUL,KAAK,CAAC4L,QAAhB,CAAhD","sourcesContent":["// @flow\nconst Joi = require(`joi`)\nconst chalk = require(`chalk`)\nconst _ = require(`lodash`)\nconst { bindActionCreators } = require(`redux`)\nconst { stripIndent } = require(`common-tags`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst path = require(`path`)\nconst fs = require(`fs`)\nconst truePath = require(`true-case-path`)\nconst url = require(`url`)\nconst kebabHash = require(`kebab-hash`)\nconst slash = require(`slash`)\nconst { hasNodeChanged, getNode } = require(`../db/nodes`)\nconst { trackInlineObjectsInRootNode } = require(`../db/node-tracking`)\nconst { store } = require(`./index`)\nconst fileExistsSync = require(`fs-exists-cached`).sync\nconst joiSchemas = require(`../joi-schemas/joi`)\nconst { generateComponentChunkName } = require(`../utils/js-chunk-names`)\n\nconst actions = {}\n\nconst findChildrenRecursively = (children = []) => {\n  children = children.concat(\n    ...children.map(child => {\n      const newChildren = getNode(child).children\n      if (_.isArray(newChildren) && newChildren.length > 0) {\n        return findChildrenRecursively(newChildren)\n      } else {\n        return []\n      }\n    })\n  )\n\n  return children\n}\n\ntype Job = {\n  id: string,\n}\ntype PageInput = {\n  path: string,\n  component: string,\n  context?: Object,\n}\n\ntype Page = {\n  path: string,\n  matchPath: ?string,\n  component: string,\n  context: Object,\n  internalComponentName: string,\n  componentChunkName: string,\n  updatedAt: number,\n}\n\ntype Plugin = {\n  name: string,\n}\n\ntype ActionOptions = {\n  traceId: ?string,\n  parentSpan: ?Object,\n  followsSpan: ?Object,\n}\n\n/**\n * Delete a page\n * @param {Object} page a page object\n * @param {string} page.path The path of the page\n * @param {string} page.component The absolute path to the page component\n * @example\n * deletePage(page)\n */\nactions.deletePage = (page: PageInput) => {\n  return {\n    type: `DELETE_PAGE`,\n    payload: page,\n  }\n}\n\nconst pascalCase = _.flow(\n  _.camelCase,\n  _.upperFirst\n)\nconst hasWarnedForPageComponentInvalidContext = new Set()\nconst hasWarnedForPageComponentInvalidCasing = new Set()\nconst pageComponentCache = {}\nconst fileOkCache = {}\n\n/**\n * Create a page. See [the guide on creating and modifying pages](/docs/creating-and-modifying-pages/)\n * for detailed documentation about creating pages.\n * @param {Object} page a page object\n * @param {string} page.path Any valid URL. Must start with a forward slash\n * @param {string} page.component The absolute path to the component for this page\n * @param {Object} page.context Context data for this page. Passed as props\n * to the component `this.props.pageContext` as well as to the graphql query\n * as graphql arguments.\n * @example\n * createPage({\n *   path: `/my-sweet-new-page/`,\n *   component: path.resolve(`./src/templates/my-sweet-new-page.js`),\n *   // The context is passed as props to the component as well\n *   // as into the component's GraphQL query.\n *   context: {\n *     id: `123456`,\n *   },\n * })\n */\nactions.createPage = (\n  page: PageInput,\n  plugin?: Plugin,\n  actionOptions?: ActionOptions\n) => {\n  let noPageOrComponent = false\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!page.path) {\n    const message = `${name} must set the page path when creating a page`\n    // Don't log out when testing\n    if (process.env.NODE_ENV !== `test`) {\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n    } else {\n      return message\n    }\n    noPageOrComponent = true\n  }\n\n  // Validate that the context object doesn't overlap with any core page fields\n  // as this will cause trouble when running graphql queries.\n  if (_.isObject(page.context)) {\n    const reservedFields = [\n      `path`,\n      `matchPath`,\n      `component`,\n      `componentChunkName`,\n      `pluginCreator___NODE`,\n      `pluginCreatorId`,\n    ]\n    const invalidFields = Object.keys(_.pick(page.context, reservedFields))\n\n    const singularMessage = `${name} used a reserved field name in the context object when creating a page:`\n    const pluralMessage = `${name} used reserved field names in the context object when creating a page:`\n    if (invalidFields.length > 0) {\n      const error = `${\n        invalidFields.length === 1 ? singularMessage : pluralMessage\n      }\n\n${invalidFields.map(f => `  * \"${f}\"`).join(`\\n`)}\n\n${JSON.stringify(page, null, 4)}\n\nData in \"context\" is passed to GraphQL as potential arguments when running the\npage query.\n\nWhen arguments for GraphQL are constructed, the context object is combined with\nthe page object so *both* page object and context data are available as\narguments. So you don't need to add the page \"path\" to the context as it's\nalready available in GraphQL. If a context field duplicates a field already\nused by the page object, this can break functionality within Gatsby so must be\navoided.\n\nPlease choose another name for the conflicting fields.\n\nThe following fields are used by the page object and should be avoided.\n\n${reservedFields.map(f => `  * \"${f}\"`).join(`\\n`)}\n\n            `\n      if (process.env.NODE_ENV === `test`) {\n        return error\n        // Only error if the context version is different than the page\n        // version.  People in v1 often thought that they needed to also pass\n        // the path to context for it to be available in GraphQL\n      } else if (invalidFields.some(f => page.context[f] !== page[f])) {\n        report.panic(error)\n      } else {\n        if (!hasWarnedForPageComponentInvalidContext.has(page.component)) {\n          report.warn(error)\n          hasWarnedForPageComponentInvalidContext.add(page.component)\n        }\n      }\n    }\n  }\n\n  // Don't check if the component exists during tests as we use a lot of fake\n  // component paths.\n  if (process.env.NODE_ENV !== `test`) {\n    if (!fileExistsSync(page.component)) {\n      const message = `${name} created a page with a component that doesn't exist. Missing component is ${\n        page.component\n      }`\n      console.log(``)\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n      noPageOrComponent = true\n    } else if (page.component) {\n      // check if we've processed this component path\n      // before, before running the expensive \"truePath\"\n      // operation\n      if (pageComponentCache[page.component]) {\n        page.component = pageComponentCache[page.component]\n      } else {\n        const originalPageComponent = page.component\n\n        // normalize component path\n        page.component = slash(page.component)\n        // check if path uses correct casing - incorrect casing will\n        // cause issues in query compiler and inconsistencies when\n        // developing on Mac or Windows and trying to deploy from\n        // linux CI/CD pipeline\n        const trueComponentPath = slash(truePath(page.component))\n        if (trueComponentPath !== page.component) {\n          if (!hasWarnedForPageComponentInvalidCasing.has(page.component)) {\n            const markers = page.component\n              .split(``)\n              .map((letter, index) => {\n                if (letter !== trueComponentPath[index]) {\n                  return `^`\n                }\n                return ` `\n              })\n              .join(``)\n\n            report.warn(\n              stripIndent`\n            ${name} created a page with a component path that doesn't match the casing of the actual file. This may work locally, but will break on systems which are case-sensitive, e.g. most CI/CD pipelines.\n\n            page.component:     \"${page.component}\"\n            path in filesystem: \"${trueComponentPath}\"\n                                 ${markers}\n          `\n            )\n            hasWarnedForPageComponentInvalidCasing.add(page.component)\n          }\n\n          page.component = trueComponentPath\n        }\n        pageComponentCache[originalPageComponent] = page.component\n      }\n    }\n  }\n\n  if (!page.component || !path.isAbsolute(page.component)) {\n    const message = `${name} must set the absolute path to the page component when create creating a page`\n    // Don't log out when testing\n    if (process.env.NODE_ENV !== `test`) {\n      console.log(``)\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n    } else {\n      return message\n    }\n    noPageOrComponent = true\n  }\n\n  if (noPageOrComponent) {\n    report.panic(\n      `See the documentation for createPage https://www.gatsbyjs.org/docs/actions/#createPage`\n    )\n  }\n\n  let internalComponentName\n  if (page.path === `/`) {\n    internalComponentName = `ComponentIndex`\n  } else {\n    internalComponentName = `Component${pascalCase(page.path)}`\n  }\n\n  let internalPage: Page = {\n    internalComponentName,\n    path: page.path,\n    matchPath: page.matchPath,\n    component: page.component,\n    componentChunkName: generateComponentChunkName(page.component),\n    isCreatedByStatefulCreatePages:\n      actionOptions &&\n      actionOptions.traceId === `initial-createPagesStatefully`,\n    // Ensure the page has a context object\n    context: page.context || {},\n    updatedAt: Date.now(),\n  }\n\n  // If the path doesn't have an initial forward slash, add it.\n  if (internalPage.path[0] !== `/`) {\n    internalPage.path = `/${internalPage.path}`\n  }\n\n  // Validate that the page component imports React and exports something\n  // (hopefully a component).\n  //\n  // Only run validation once during builds.\n  if (\n    !internalPage.component.includes(`/.cache/`) &&\n    (process.env.NODE_ENV === `production` &&\n      !fileOkCache[internalPage.component])\n  ) {\n    const fileName = internalPage.component\n    const fileContent = fs.readFileSync(fileName, `utf-8`)\n    let notEmpty = true\n    let includesDefaultExport = true\n\n    if (fileContent === ``) {\n      notEmpty = false\n    }\n\n    if (\n      !fileContent.includes(`export default`) &&\n      !fileContent.includes(`module.exports`) &&\n      !fileContent.includes(`exports.default`) &&\n      // this check only applies to js and ts, not mdx\n      /\\.(jsx?|tsx?)/.test(path.extname(fileName))\n    ) {\n      includesDefaultExport = false\n    }\n    if (!notEmpty || !includesDefaultExport) {\n      const relativePath = path.relative(\n        store.getState().program.directory,\n        fileName\n      )\n\n      if (!notEmpty) {\n        report.panicOnBuild(\n          `You have an empty file in the \"src/pages\" directory at \"${relativePath}\". Please remove it or make it a valid component`\n        )\n      }\n\n      if (!includesDefaultExport) {\n        report.panicOnBuild(\n          `[${fileName}] The page component must export a React component for it to be valid`\n        )\n      }\n    }\n\n    fileOkCache[internalPage.component] = true\n  }\n\n  const oldPage: Page = store.getState().pages.get(internalPage.path)\n  const contextModified =\n    !!oldPage && !_.isEqual(oldPage.context, internalPage.context)\n\n  return {\n    ...actionOptions,\n    type: `CREATE_PAGE`,\n    contextModified,\n    plugin,\n    payload: internalPage,\n  }\n}\n\n/**\n * Delete a node\n * @param {object} $0\n * @param {object} $0.node the node object\n * @example\n * deleteNode({node: node})\n */\nactions.deleteNode = (options: any, plugin: Plugin, args: any) => {\n  let id\n\n  // Check if using old method signature. Warn about incorrect usage but get\n  // node from nodeID anyway.\n  if (typeof options === `string`) {\n    let msg =\n      `Calling \"deleteNode\" with a nodeId is deprecated. Please pass an ` +\n      `object containing a full node instead: deleteNode({ node }).`\n    if (args && args.name) {\n      // `plugin` used to be the third argument\n      plugin = args\n      msg = msg + ` \"deleteNode\" was called by ${plugin.name}`\n    }\n    report.warn(msg)\n\n    id = options\n  } else {\n    id = options && options.node && options.node.id\n  }\n\n  // Always get node from the store, as the node we get as an arg\n  // might already have been deleted.\n  const node = getNode(id)\n\n  const createDeleteAction = node => {\n    return {\n      type: `DELETE_NODE`,\n      plugin,\n      payload: node,\n    }\n  }\n\n  const deleteAction = createDeleteAction(node)\n\n  // It's possible the file node was never created as sometimes tools will\n  // write and then immediately delete temporary files to the file system.\n  const deleteDescendantsActions =\n    node &&\n    findChildrenRecursively(node.children)\n      .map(getNode)\n      .map(createDeleteAction)\n\n  if (deleteDescendantsActions && deleteDescendantsActions.length) {\n    return [...deleteDescendantsActions, deleteAction]\n  } else {\n    return deleteAction\n  }\n}\n\n/**\n * Batch delete nodes\n * @param {Array} nodes an array of node ids\n * @example\n * deleteNodes([`node1`, `node2`])\n */\nactions.deleteNodes = (nodes: any[], plugin: Plugin) => {\n  let msg =\n    `The \"deleteNodes\" action is now deprecated and will be removed in ` +\n    `Gatsby v3. Please use \"deleteNode\" instead.`\n  if (plugin && plugin.name) {\n    msg = msg + ` \"deleteNodes\" was called by ${plugin.name}`\n  }\n  report.warn(msg)\n\n  // Also delete any nodes transformed from these.\n  const descendantNodes = _.flatten(\n    nodes.map(n => findChildrenRecursively(getNode(n).children))\n  )\n\n  const deleteNodesAction = {\n    type: `DELETE_NODES`,\n    plugin,\n    payload: [...nodes, ...descendantNodes],\n  }\n  return deleteNodesAction\n}\n\nconst typeOwners = {}\n/**\n * Create a new node.\n * @param {Object} node a node object\n * @param {string} node.id The node's ID. Must be globally unique.\n * @param {string} node.parent The ID of the parent's node. If the node is\n * derived from another node, set that node as the parent. Otherwise it can\n * just be `null`.\n * @param {Array} node.children An array of children node IDs. If you're\n * creating the children nodes while creating the parent node, add the\n * children node IDs here directly. If you're adding a child node to a\n * parent node created by a plugin, you can't mutate this value directly\n * to add your node id, instead use the action creator `createParentChildLink`.\n * @param {Object} node.internal node fields that aren't generally\n * interesting to consumers of node data but are very useful for plugin writers\n * and Gatsby core.\n * @param {string} node.internal.mediaType An optional field to indicate to\n * transformer plugins that your node has raw content they can transform.\n * Use either an official media type (we use mime-db as our source\n * (https://www.npmjs.com/package/mime-db) or a made-up one if your data\n * doesn't fit in any existing bucket. Transformer plugins use node media types\n * for deciding if they should transform a node into a new one. E.g.\n * markdown transformers look for media types of\n * `text/markdown`.\n * @param {string} node.internal.type An arbitrary globally unique type\n * choosen by the plugin creating the node. Should be descriptive of the\n * node as the type is used in forming GraphQL types so users will query\n * for nodes based on the type choosen here. Nodes of a given type can\n * only be created by one plugin.\n * @param {string} node.internal.content An optional field. This is rarely\n * used. It is used when a source plugin sources data it doesn't know how\n * to transform e.g. a markdown string pulled from an API. The source plugin\n * can defer the transformation to a specialized transformer plugin like\n * gatsby-transformer-remark. This `content` field holds the raw content\n * (so for the markdown case, the markdown string).\n *\n * Data that's already structured should be added to the top-level of the node\n * object and _not_ added here. You should not `JSON.stringify` your node's\n * data here.\n *\n * If the content is very large and can be lazy-loaded, e.g. a file on disk,\n * you can define a `loadNodeContent` function for this node and the node\n * content will be lazy loaded when it's needed.\n * @param {string} node.internal.contentDigest the digest for the content\n * of this node. Helps Gatsby avoid doing extra work on data that hasn't\n * changed.\n * @param {string} node.internal.description An optional field. Human\n * readable description of what this node represent / its source. It will\n * be displayed when type conflicts are found, making it easier to find\n * and correct type conflicts.\n * @example\n * createNode({\n *   // Data for the node.\n *   field1: `a string`,\n *   field2: 10,\n *   field3: true,\n *   ...arbitraryOtherData,\n *\n *   // Required fields.\n *   id: `a-node-id`,\n *   parent: `the-id-of-the-parent-node`, // or null if it's a source node without a parent\n *   children: [],\n *   internal: {\n *     type: `CoolServiceMarkdownField`,\n *     contentDigest: crypto\n *       .createHash(`md5`)\n *       .update(JSON.stringify(fieldData))\n *       .digest(`hex`),\n *     mediaType: `text/markdown`, // optional\n *     content: JSON.stringify(fieldData), // optional\n *     description: `Cool Service: \"Title of entry\"`, // optional\n *   }\n * })\n */\nactions.createNode = (\n  node: any,\n  plugin?: Plugin,\n  actionOptions?: ActionOptions = {}\n) => {\n  if (!_.isObject(node)) {\n    return console.log(\n      chalk.bold.red(\n        `The node passed to the \"createNode\" action creator must be an object`\n      )\n    )\n  }\n\n  // Ensure the new node has an internals object.\n  if (!node.internal) {\n    node.internal = {}\n  }\n\n  // Ensure the new node has a children array.\n  if (!node.array && !_.isArray(node.children)) {\n    node.children = []\n  }\n\n  // Ensure the new node has a parent field\n  if (!node.parent) {\n    node.parent = null\n  }\n\n  // Tell user not to set the owner name themself.\n  if (node.internal.owner) {\n    report.error(JSON.stringify(node, null, 4))\n    report.panic(\n      chalk.bold.red(\n        `The node internal.owner field is set automatically by Gatsby and not by plugins`\n      )\n    )\n  }\n\n  // Add the plugin name to the internal object.\n  if (plugin) {\n    node.internal.owner = plugin.name\n  }\n\n  const result = Joi.validate(node, joiSchemas.nodeSchema)\n  if (result.error) {\n    console.log(chalk.bold.red(`The new node didn't pass validation`))\n    console.log(chalk.bold.red(result.error))\n    console.log(node)\n    return { type: `VALIDATION_ERROR`, error: true }\n  }\n\n  // Ensure node isn't directly setting fields.\n  if (node.fields) {\n    throw new Error(\n      stripIndent`\n      Plugins creating nodes can not set data on the reserved field \"fields\"\n      as this is reserved for plugins which wish to extend your nodes.\n\n      If your plugin didn't add \"fields\" you're probably seeing this\n      error because you're reusing an old node object.\n\n      Node:\n\n      ${JSON.stringify(node, null, 4)}\n\n      Plugin that created the node:\n\n      ${JSON.stringify(plugin, null, 4)}\n    `\n    )\n  }\n\n  trackInlineObjectsInRootNode(node)\n\n  const oldNode = getNode(node.id)\n\n  // Ensure the plugin isn't creating a node type owned by another\n  // plugin. Type \"ownership\" is first come first served.\n  if (plugin) {\n    let pluginName = plugin.name\n\n    if (!typeOwners[node.internal.type])\n      typeOwners[node.internal.type] = pluginName\n    else if (typeOwners[node.internal.type] !== pluginName)\n      throw new Error(stripIndent`\n        The plugin \"${pluginName}\" created a node of a type owned by another plugin.\n\n        The node type \"${node.internal.type}\" is owned by \"${\n        typeOwners[node.internal.type]\n      }\".\n\n        If you copy and pasted code from elsewhere, you'll need to pick a new type name\n        for your new node(s).\n\n        The node object passed to \"createNode\":\n\n        ${JSON.stringify(node, null, 4)}\n\n        The plugin creating the node:\n\n        ${JSON.stringify(plugin, null, 4)}\n      `)\n\n    // If the node has been created in the past, check that\n    // the current plugin is the same as the previous.\n    if (oldNode && oldNode.internal.owner !== pluginName) {\n      throw new Error(\n        stripIndent`\n        Nodes can only be updated by their owner. Node \"${node.id}\" is\n        owned by \"${oldNode.internal.owner}\" and another plugin \"${pluginName}\"\n        tried to update it.\n\n        `\n      )\n    }\n  }\n\n  if (actionOptions.parentSpan) {\n    actionOptions.parentSpan.setTag(`nodeId`, node.id)\n    actionOptions.parentSpan.setTag(`nodeType`, node.id)\n  }\n\n  let deleteActions\n  let updateNodeAction\n  // Check if the node has already been processed.\n  if (oldNode && !hasNodeChanged(node.id, node.internal.contentDigest)) {\n    updateNodeAction = {\n      type: `TOUCH_NODE`,\n      plugin,\n      ...actionOptions,\n      payload: node.id,\n    }\n  } else {\n    // Remove any previously created descendant nodes as they're all due\n    // to be recreated.\n    if (oldNode) {\n      const createDeleteAction = node => {\n        return {\n          type: `DELETE_NODE`,\n          plugin,\n          ...actionOptions,\n          payload: node,\n        }\n      }\n      deleteActions = findChildrenRecursively(oldNode.children)\n        .map(getNode)\n        .map(createDeleteAction)\n    }\n\n    updateNodeAction = {\n      type: `CREATE_NODE`,\n      plugin,\n      oldNode,\n      ...actionOptions,\n      payload: node,\n    }\n  }\n\n  if (deleteActions && deleteActions.length) {\n    return [...deleteActions, updateNodeAction]\n  } else {\n    return updateNodeAction\n  }\n}\n\n/**\n * \"Touch\" a node. Tells Gatsby a node still exists and shouldn't\n * be garbage collected. Primarily useful for source plugins fetching\n * nodes from a remote system that can return only nodes that have\n * updated. The source plugin then touches all the nodes that haven't\n * updated but still exist so Gatsby knows to keep them.\n * @param {Object} $0\n * @param {string} $0.nodeId The id of a node\n * @example\n * touchNode({ nodeId: `a-node-id` })\n */\nactions.touchNode = (options: any, plugin?: Plugin) => {\n  let nodeId = _.get(options, `nodeId`)\n\n  // Check if using old method signature. Warn about incorrect usage\n  if (typeof options === `string`) {\n    console.warn(\n      `Calling \"touchNode\" with a nodeId is deprecated. Please pass an object containing a nodeId instead: touchNode({ nodeId: 'a-node-id' })`\n    )\n\n    if (plugin && plugin.name) {\n      console.log(`\"touchNode\" was called by ${plugin.name}`)\n    }\n\n    nodeId = options\n  }\n\n  return {\n    type: `TOUCH_NODE`,\n    plugin,\n    payload: nodeId,\n  }\n}\n\ntype CreateNodeInput = {\n  node: Object,\n  fieldName?: string,\n  fieldValue?: string,\n  name?: string,\n  value: any,\n}\n/**\n * Extend another node. The new node field is placed under the `fields`\n * key on the extended node object.\n *\n * Once a plugin has claimed a field name the field name can't be used by\n * other plugins.  Also since nodes are immutable, you can't mutate the node\n * directly. So to extend another node, use this.\n * @param {Object} $0\n * @param {Object} $0.node the target node object\n * @param {string} $0.fieldName [deprecated] the name for the field\n * @param {string} $0.fieldValue [deprecated] the value for the field\n * @param {string} $0.name the name for the field\n * @param {string} $0.value the value for the field\n * @example\n * createNodeField({\n *   node,\n *   name: `happiness`,\n *   value: `is sweet graphql queries`\n * })\n *\n * // The field value is now accessible at node.fields.happiness\n */\nactions.createNodeField = (\n  { node, name, value, fieldName, fieldValue }: CreateNodeInput,\n  plugin: Plugin,\n  actionOptions?: ActionOptions\n) => {\n  if (fieldName) {\n    console.warn(\n      `Calling \"createNodeField\" with \"fieldName\" is deprecated. Use \"name\" instead`\n    )\n    if (!name) {\n      name = fieldName\n    }\n  }\n  if (fieldValue) {\n    console.warn(\n      `Calling \"createNodeField\" with \"fieldValue\" is deprecated. Use \"value\" instead`\n    )\n    if (!value) {\n      value = fieldValue\n    }\n  }\n  // Ensure required fields are set.\n  if (!node.internal.fieldOwners) {\n    node.internal.fieldOwners = {}\n  }\n  if (!node.fields) {\n    node.fields = {}\n  }\n\n  /**\n   * Normalized name of the field that will be used in schema\n   */\n  const schemaFieldName = _.includes(name, `___NODE`)\n    ? name.split(`___`)[0]\n    : name\n\n  // Check that this field isn't owned by another plugin.\n  const fieldOwner = node.internal.fieldOwners[schemaFieldName]\n  if (fieldOwner && fieldOwner !== plugin.name) {\n    throw new Error(\n      stripIndent`\n      A plugin tried to update a node field that it doesn't own:\n\n      Node id: ${node.id}\n      Plugin: ${plugin.name}\n      name: ${name}\n      value: ${value}\n      `\n    )\n  }\n\n  // Update node\n  node.fields[name] = value\n  node.internal.fieldOwners[schemaFieldName] = plugin.name\n\n  return {\n    type: `ADD_FIELD_TO_NODE`,\n    plugin,\n    ...actionOptions,\n    payload: node,\n  }\n}\n\n/**\n * Creates a link between a parent and child node. This is used when you\n * transform content from a node creating a new child node. You need to add\n * this new child node to the `children` array of the parent but since you\n * don't have direct access to the immutable parent node, use this action\n * instead.\n * @param {Object} $0\n * @param {Object} $0.parent the parent node object\n * @param {Object} $0.child the child node object\n * @example\n * createParentChildLink({ parent: parentNode, child: childNode })\n */\nactions.createParentChildLink = (\n  { parent, child }: { parent: any, child: any },\n  plugin?: Plugin\n) => {\n  // Update parent\n  parent.children.push(child.id)\n  parent.children = _.uniq(parent.children)\n\n  return {\n    type: `ADD_CHILD_NODE_TO_PARENT_NODE`,\n    plugin,\n    payload: parent,\n  }\n}\n\n/**\n * Create a dependency between a page and data. Probably for\n * internal use only.\n * @param {Object} $0\n * @param {string} $0.path the path to the page\n * @param {string} $0.nodeId A node ID\n * @param {string} $0.connection A connection type\n * @private\n */\nactions.createPageDependency = (\n  {\n    path,\n    nodeId,\n    connection,\n  }: { path: string, nodeId: string, connection: string },\n  plugin: string = ``\n) => {\n  return {\n    type: `CREATE_COMPONENT_DEPENDENCY`,\n    plugin,\n    payload: {\n      path,\n      nodeId,\n      connection,\n    },\n  }\n}\n\n/**\n * Delete dependencies between an array of pages and data. Probably for\n * internal use only. Used when deleting pages.\n * @param {Array} paths the paths to delete.\n * @private\n */\nactions.deleteComponentsDependencies = (paths: string[]) => {\n  return {\n    type: `DELETE_COMPONENTS_DEPENDENCIES`,\n    payload: {\n      paths,\n    },\n  }\n}\n\n/**\n * When the query watcher extracts a GraphQL query, it calls\n * this to store the query with its component.\n * @private\n */\nactions.replaceComponentQuery = ({\n  query,\n  componentPath,\n}: {\n  query: string,\n  componentPath: string,\n}) => {\n  return {\n    type: `REPLACE_COMPONENT_QUERY`,\n    payload: {\n      query,\n      componentPath,\n    },\n  }\n}\n\n/**\n * When the query watcher extracts a \"static\" GraphQL query from <StaticQuery>\n * components, it calls this to store the query with its component.\n * @private\n */\nactions.replaceStaticQuery = (args: any, plugin?: ?Plugin = null) => {\n  return {\n    type: `REPLACE_STATIC_QUERY`,\n    plugin,\n    payload: args,\n  }\n}\n\n/**\n * Merge additional configuration into the current webpack config. A few\n * configurations options will be ignored if set, in order to try prevent accidental breakage.\n * Specifically, any change to `entry`, `output`, `target`, or `resolveLoaders` will be ignored.\n *\n * For full control over the webpack config, use `replaceWebpackConfig()`.\n *\n * @param {Object} config partial webpack config, to be merged into the current one\n */\nactions.setWebpackConfig = (config: Object, plugin?: ?Plugin = null) => {\n  return {\n    type: `SET_WEBPACK_CONFIG`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Completely replace the webpack config for the current stage. This can be\n * dangerous and break Gatsby if certain configuration options are changed.\n *\n * Generally only useful for cases where you need to handle config merging logic\n * yourself, in which case consider using `webpack-merge`.\n *\n * @param {Object} config complete webpack config\n */\nactions.replaceWebpackConfig = (config: Object, plugin?: ?Plugin = null) => {\n  return {\n    type: `REPLACE_WEBPACK_CONFIG`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Set top-level Babel options. Plugins and presets will be ignored. Use\n * setBabelPlugin and setBabelPreset for this.\n * @param {Object} config An options object in the shape of a normal babelrc JavaScript object\n * @example\n * setBabelOptions({\n *   options: {\n *     sourceMaps: `inline`,\n *   }\n * })\n */\nactions.setBabelOptions = (options: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!_.isObject(options)) {\n    console.log(`${name} must pass an object to \"setBabelOptions\"`)\n    console.log(JSON.stringify(options, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n\n  if (!_.isObject(options.options)) {\n    console.log(`${name} must pass options to \"setBabelOptions\"`)\n    console.log(JSON.stringify(options, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n\n  return {\n    type: `SET_BABEL_OPTIONS`,\n    plugin,\n    payload: options,\n  }\n}\n\n/**\n * Add new plugins or merge options into existing Babel plugins.\n * @param {Object} config A config object describing the Babel plugin to be added.\n * @param {string} config.name The name of the Babel plugin\n * @param {Object} config.options Options to pass to the Babel plugin.\n * @example\n * setBabelPlugin({\n *   name:  `babel-plugin-emotion`,\n *   options: {\n *     sourceMap: true,\n *   },\n * })\n */\nactions.setBabelPlugin = (config: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!config.name) {\n    console.log(`${name} must set the name of the Babel plugin`)\n    console.log(JSON.stringify(config, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n  if (!config.options) {\n    config.options = {}\n  }\n  return {\n    type: `SET_BABEL_PLUGIN`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Add new presets or merge options into existing Babel presets.\n * @param {Object} config A config object describing the Babel plugin to be added.\n * @param {string} config.name The name of the Babel preset.\n * @param {Object} config.options Options to pass to the Babel preset.\n * @example\n * setBabelPreset({\n *   name: `@babel/preset-react`,\n *   options: {\n *     pragma: `Glamor.createElement`,\n *   },\n * })\n */\nactions.setBabelPreset = (config: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!config.name) {\n    console.log(`${name} must set the name of the Babel preset`)\n    console.log(JSON.stringify(config, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n  if (!config.options) {\n    config.options = {}\n  }\n  return {\n    type: `SET_BABEL_PRESET`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Create a \"job\". This is a long-running process that are generally\n * started as side-effects to GraphQL queries.\n * [`gatsby-plugin-sharp`](/packages/gatsby-plugin-sharp/) uses this for\n * example.\n *\n * Gatsby doesn't finish its bootstrap until all jobs are ended.\n * @param {Object} job A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * createJob({ id: `write file id: 123`, fileName: `something.jpeg` })\n */\nactions.createJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `CREATE_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * Set (update) a \"job\". Sometimes on really long running jobs you want\n * to update the job as it continues.\n *\n * @param {Object} job A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * setJob({ id: `write file id: 123`, progress: 50 })\n */\nactions.setJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `SET_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * End a \"job\".\n *\n * Gatsby doesn't finish its bootstrap until all jobs are ended.\n * @param {Object} job  A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * endJob({ id: `write file id: 123` })\n */\nactions.endJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `END_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * Set plugin status. A plugin can use this to save status keys e.g. the last\n * it fetched something. These values are persisted between runs of Gatsby.\n *\n * @param {Object} status  An object with arbitrary values set\n * @example\n * setPluginStatus({ lastFetched: Date.now() })\n */\nactions.setPluginStatus = (\n  status: { [key: string]: mixed },\n  plugin: Plugin\n) => {\n  return {\n    type: `SET_PLUGIN_STATUS`,\n    plugin,\n    payload: status,\n  }\n}\n\n/**\n * Check if path is absolute and add pathPrefix in front if it's not\n */\nconst maybeAddPathPrefix = (path, pathPrefix) => {\n  const parsed = url.parse(path)\n  const isRelativeProtocol = path.startsWith(`//`)\n  return `${\n    parsed.protocol != null || isRelativeProtocol ? `` : pathPrefix\n  }${path}`\n}\n\n/**\n * Create a redirect from one page to another. Server redirects don't work out\n * of the box. You must have a plugin setup to integrate the redirect data with\n * your hosting technology e.g. the [Netlify\n * plugin](/packages/gatsby-plugin-netlify/), or the [Amazon S3\n * plugin](/packages/gatsby-plugin-s3/).\n *\n * @param {Object} redirect Redirect data\n * @param {string} redirect.fromPath Any valid URL. Must start with a forward slash\n * @param {boolean} redirect.isPermanent This is a permanent redirect; defaults to temporary\n * @param {string} redirect.toPath URL of a created page (see `createPage`)\n * @param {boolean} redirect.redirectInBrowser Redirects are generally for redirecting legacy URLs to their new configuration. If you can't update your UI for some reason, set `redirectInBrowser` to true and Gatsby will handle redirecting in the client as well.\n * @param {boolean} redirect.force (Plugin-specific) Will trigger the redirect even if the `fromPath` matches a piece of content. This is not part of the Gatsby API, but implemented by (some) plugins that configure hosting provider redirects\n * @param {number} redirect.statusCode (Plugin-specific) Manually set the HTTP status code. This allows you to create a rewrite (status code 200) or custom error page (status code 404). Note that this will override the `isPermanent` option which also sets the status code. This is not part of the Gatsby API, but implemented by (some) plugins that configure hosting provider redirects\n * @example\n * createRedirect({ fromPath: '/old-url', toPath: '/new-url', isPermanent: true })\n * createRedirect({ fromPath: '/url', toPath: '/zn-CH/url', Language: 'zn' })\n * createRedirect({ fromPath: '/not_so-pretty_url', toPath: '/pretty/url', statusCode: 200 })\n */\nactions.createRedirect = ({\n  fromPath,\n  isPermanent = false,\n  redirectInBrowser = false,\n  toPath,\n  ...rest\n}) => {\n  let pathPrefix = ``\n  if (store.getState().program.prefixPaths) {\n    pathPrefix = store.getState().config.pathPrefix\n  }\n\n  return {\n    type: `CREATE_REDIRECT`,\n    payload: {\n      fromPath: maybeAddPathPrefix(fromPath, pathPrefix),\n      isPermanent,\n      redirectInBrowser,\n      toPath: maybeAddPathPrefix(toPath, pathPrefix),\n      ...rest,\n    },\n  }\n}\n\n/**\n * Add a third-party schema to be merged into main schema. Schema has to be a\n * graphql-js GraphQLSchema object.\n *\n * This schema is going to be merged as-is. This can easily break the main\n * Gatsby schema, so it's user's responsibility to make sure it doesn't happen\n * (by eg namespacing the schema).\n *\n * @param {Object} $0\n * @param {GraphQLSchema} $0.schema GraphQL schema to add\n */\nactions.addThirdPartySchema = (\n  { schema }: { schema: GraphQLSchema },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `ADD_THIRD_PARTY_SCHEMA`,\n    plugin,\n    traceId,\n    payload: schema,\n  }\n}\n\nimport type GatsbyGraphQLType from \"../schema/types/type-builders\"\n/**\n * Add type definitions to the GraphQL schema.\n *\n * @param {string | GraphQLOutputType | GatsbyGraphQLType | string[] | GraphQLOutputType[] | GatsbyGraphQLType[]} types Type definitions\n *\n * Type definitions can be provided either as\n * [`graphql-js` types](https://graphql.org/graphql-js/), in\n * [GraphQL schema definition language (SDL)](https://graphql.org/learn/)\n * or using Gatsby Type Builders available on the `schema` API argument.\n *\n * Things to note:\n * * needs to be called *before* schema generation. It is recommended to use\n *   `createTypes` in the `sourceNodes` API.\n * * type definitions targeting node types, i.e. `MarkdownRemark` and others\n *   added in `sourceNodes` or `onCreateNode` APIs, need to implement the\n *   `Node` interface. Interface fields will be added automatically, but it\n *   is mandatory to label those types with `implements Node`.\n * * by default, explicit type definitions from `createTypes` will be merged\n *   with inferred field types, and default field resolvers for `Date` (which\n *   adds formatting options) and `File` (which resolves the field value as\n *   a `relativePath` foreign-key field) are added. This behavior can be\n *   customised with `@infer` and `@dontInfer` directives, and their\n *   `noDefaultResolvers` argument.\n *\n * @example\n * exports.sourceNodes = ({ actions }) => {\n *   const { createTypes } = actions\n *   const typeDefs = `\n *     \"\"\"\n *     Markdown Node\n *     \"\"\"\n *     type MarkdownRemark implements Node {\n *       frontmatter: Frontmatter!\n *     }\n *\n *     \"\"\"\n *     Markdown Frontmatter\n *     \"\"\"\n *     type Frontmatter {\n *       title: String!\n *       author: AuthorJson!\n *       date: Date!\n *       published: Boolean!\n *       tags: [String!]!\n *     }\n *\n *     \"\"\"\n *     Author information\n *     \"\"\"\n *     # Does not include automatically inferred fields\n *     type AuthorJson implements Node @dontInfer(noFieldResolvers: true) {\n *       name: String!\n *       birthday: Date! # no default resolvers for Date formatting added\n *     }\n *   `\n *   createTypes(typeDefs)\n * }\n *\n * // using Gatsby Type Builder API\n * exports.sourceNodes = ({ actions, schema }) => {\n *   const { createTypes } = actions\n *   const typeDefs = [\n *     schema.buildObjectType({\n *       name: 'MarkdownRemark',\n *       fields: {\n *         frontmatter: 'Frontmatter!'\n *       },\n *       interfaces: ['Node'],\n *     }),\n *     schema.buildObjectType({\n *       name: 'Frontmatter',\n *       fields: {\n *         title: {\n *           type: 'String!',\n *           resolve(parent) {\n *             return parent.title || '(Untitled)'\n *           }\n *         },\n *         author: 'AuthorJson!',\n *         date: 'Date!',\n *         published: 'Boolean!',\n *         tags: '[String!]!',\n *       }\n *     })\n *   ]\n *   createTypes(typeDefs)\n * }\n */\nactions.createTypes = (\n  types:\n    | string\n    | GraphQLOutputType\n    | GatsbyGraphQLType\n    | Array<string | GraphQLOutputType | GatsbyGraphQLType>,\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `CREATE_TYPES`,\n    plugin,\n    traceId,\n    payload: types,\n  }\n}\n\n/**\n *\n * Report that a query has been extracted from a component. Used by\n * query-compilier.js.\n *\n * @param {Object} $0\n * @param {componentPath} $0.componentPath The path to the component that just had\n * its query read.\n * @param {query} $0.query The GraphQL query that was extracted from the component.\n * @private\n */\nactions.queryExtracted = (\n  { componentPath, query },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `QUERY_EXTRACTED`,\n    plugin,\n    traceId,\n    payload: { componentPath, query },\n  }\n}\n\n/**\n *\n * Report that the Relay Compilier found a graphql error when attempting to extract a query\n *\n * @param {Object} $0\n * @param {componentPath} $0.componentPath The path to the component that just had\n * its query read.\n * @param {error} $0.error The GraphQL query that was extracted from the component.\n * @private\n */\nactions.queryExtractionGraphQLError = (\n  { componentPath, error },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `QUERY_EXTRACTION_GRAPHQL_ERROR`,\n    plugin,\n    traceId,\n    payload: { componentPath, error },\n  }\n}\n\n/**\n *\n * Report that babel was able to extract the graphql query.\n * Indicates that the file is free of JS errors.\n *\n * @param {Object} $0\n * @param {componentPath} $0.componentPath The path to the component that just had\n * its query read.\n * @private\n */\nactions.queryExtractedBabelSuccess = (\n  { componentPath },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `QUERY_EXTRACTION_BABEL_SUCCESS`,\n    plugin,\n    traceId,\n    payload: { componentPath },\n  }\n}\n\n/**\n *\n * Report that the Relay Compilier found a babel error when attempting to extract a query\n *\n * @param {Object} $0\n * @param {componentPath} $0.componentPath The path to the component that just had\n * its query read.\n * @param {error} $0.error The Babel error object\n * @private\n */\nactions.queryExtractionBabelError = (\n  { componentPath, error },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `QUERY_EXTRACTION_BABEL_ERROR`,\n    plugin,\n    traceId,\n    payload: { componentPath, error },\n  }\n}\n\n/**\n * Set overall program status e.g. `BOOTSTRAPING` or `BOOTSTRAP_FINISHED`.\n *\n * @param {string} Program status\n * @private\n */\nactions.setProgramStatus = (status, plugin: Plugin, traceId?: string) => {\n  return {\n    type: `SET_PROGRAM_STATUS`,\n    plugin,\n    traceId,\n    payload: status,\n  }\n}\n\n/**\n * Broadcast that a page's query was run.\n *\n * @param {string} Path to the page component that changed.\n * @private\n */\nactions.pageQueryRun = (\n  { path, componentPath, isPage },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `PAGE_QUERY_RUN`,\n    plugin,\n    traceId,\n    payload: { path, componentPath, isPage },\n  }\n}\n\n/**\n * All action creators wrapped with a dispatch.\n */\nexports.actions = actions\n\n/**\n * All action creators wrapped with a dispatch. - *DEPRECATED*\n */\nexports.boundActionCreators = bindActionCreators(actions, store.dispatch)\n"],"file":"actions.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/redux/index.js b/node_modules/gatsby/dist/redux/index.js
index f48a9fe..095edd1 100644
--- a/node_modules/gatsby/dist/redux/index.js
+++ b/node_modules/gatsby/dist/redux/index.js
@@ -92,7 +92,7 @@ const store = Redux.createStore(Redux.combineReducers(Object.assign({}, reducers
 function saveState() {
   const state = store.getState();
 
-  const pickedState = _.pick(state, [`nodes`, `status`, `componentDataDependencies`, `jsonDataPaths`, `components`, `staticQueryComponents`]);
+  const pickedState = _.pick(state, [`nodes`, `status`, `componentDataDependencies`, `components`, `staticQueryComponents`, `webpackCompilationHash`]);
 
   pickedState.staticQueryComponents = mapToObject(pickedState.staticQueryComponents);
   pickedState.components = mapToObject(pickedState.components);
diff --git a/node_modules/gatsby/dist/redux/index.js.map b/node_modules/gatsby/dist/redux/index.js.map
index bce8138..a229517 100644
--- a/node_modules/gatsby/dist/redux/index.js.map
+++ b/node_modules/gatsby/dist/redux/index.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/redux/index.js"],"names":["Redux","require","_","fs","mitt","stringify","emitter","reducers","objectToMap","obj","map","Map","Object","keys","forEach","key","set","mapToObject","value","initialState","file","readFileSync","process","cwd","Buffer","isBuffer","JSON","parse","staticQueryComponents","components","nodes","nodesByType","node","type","internal","has","get","id","e","store","createStore","combineReducers","applyMiddleware","multi","dispatch","next","action","Array","isArray","filter","Boolean","saveState","state","getState","pickedState","pick","stringified","writeFile","exports","subscribe","lastAction","emit"],"mappings":"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","sourcesContent":["const Redux = require(`redux`)\nconst _ = require(`lodash`)\nconst fs = require(`fs-extra`)\nconst mitt = require(`mitt`)\nconst stringify = require(`json-stringify-safe`)\n\n// Create event emitter for actions\nconst emitter = mitt()\n\n// Reducers\nconst reducers = require(`./reducers`)\n\nconst objectToMap = obj => {\n  let map = new Map()\n  Object.keys(obj).forEach(key => {\n    map.set(key, obj[key])\n  })\n  return map\n}\n\nconst mapToObject = map => {\n  const obj = {}\n  for (let [key, value] of map) {\n    obj[key] = value\n  }\n  return obj\n}\n\n// Read from cache the old node data.\nlet initialState = {}\ntry {\n  const file = fs.readFileSync(`${process.cwd()}/.cache/redux-state.json`)\n  // Apparently the file mocking in node-tracking-test.js\n  // can override the file reading replacing the mocked string with\n  // an already parsed object.\n  if (Buffer.isBuffer(file) || typeof file === `string`) {\n    initialState = JSON.parse(file)\n  }\n  if (initialState.staticQueryComponents) {\n    initialState.staticQueryComponents = objectToMap(\n      initialState.staticQueryComponents\n    )\n  }\n  if (initialState.components) {\n    initialState.components = objectToMap(initialState.components)\n  }\n  if (initialState.nodes) {\n    initialState.nodes = objectToMap(initialState.nodes)\n\n    initialState.nodesByType = new Map()\n    initialState.nodes.forEach(node => {\n      const { type } = node.internal\n      if (!initialState.nodesByType.has(type)) {\n        initialState.nodesByType.set(type, new Map())\n      }\n      initialState.nodesByType.get(type).set(node.id, node)\n    })\n  }\n} catch (e) {\n  // ignore errors.\n}\n\nconst store = Redux.createStore(\n  Redux.combineReducers({ ...reducers }),\n  initialState,\n  Redux.applyMiddleware(function multi({ dispatch }) {\n    return next => action =>\n      Array.isArray(action)\n        ? action.filter(Boolean).map(dispatch)\n        : next(action)\n  })\n)\n\n// Persist state.\nfunction saveState() {\n  const state = store.getState()\n  const pickedState = _.pick(state, [\n    `nodes`,\n    `status`,\n    `componentDataDependencies`,\n    `jsonDataPaths`,\n    `components`,\n    `staticQueryComponents`,\n  ])\n\n  pickedState.staticQueryComponents = mapToObject(\n    pickedState.staticQueryComponents\n  )\n  pickedState.components = mapToObject(pickedState.components)\n  pickedState.nodes = pickedState.nodes ? mapToObject(pickedState.nodes) : []\n  const stringified = stringify(pickedState, null, 2)\n  return fs.writeFile(`${process.cwd()}/.cache/redux-state.json`, stringified)\n}\n\nexports.saveState = saveState\n\nstore.subscribe(() => {\n  const lastAction = store.getState().lastAction\n  emitter.emit(lastAction.type, lastAction)\n})\n\n/** Event emitter */\nexports.emitter = emitter\n\n/** Redux store */\nexports.store = store\n"],"file":"index.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/redux/index.js"],"names":["Redux","require","_","fs","mitt","stringify","emitter","reducers","objectToMap","obj","map","Map","Object","keys","forEach","key","set","mapToObject","value","initialState","file","readFileSync","process","cwd","Buffer","isBuffer","JSON","parse","staticQueryComponents","components","nodes","nodesByType","node","type","internal","has","get","id","e","store","createStore","combineReducers","applyMiddleware","multi","dispatch","next","action","Array","isArray","filter","Boolean","saveState","state","getState","pickedState","pick","stringified","writeFile","exports","subscribe","lastAction","emit"],"mappings":"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","sourcesContent":["const Redux = require(`redux`)\nconst _ = require(`lodash`)\nconst fs = require(`fs-extra`)\nconst mitt = require(`mitt`)\nconst stringify = require(`json-stringify-safe`)\n\n// Create event emitter for actions\nconst emitter = mitt()\n\n// Reducers\nconst reducers = require(`./reducers`)\n\nconst objectToMap = obj => {\n  let map = new Map()\n  Object.keys(obj).forEach(key => {\n    map.set(key, obj[key])\n  })\n  return map\n}\n\nconst mapToObject = map => {\n  const obj = {}\n  for (let [key, value] of map) {\n    obj[key] = value\n  }\n  return obj\n}\n\n// Read from cache the old node data.\nlet initialState = {}\ntry {\n  const file = fs.readFileSync(`${process.cwd()}/.cache/redux-state.json`)\n  // Apparently the file mocking in node-tracking-test.js\n  // can override the file reading replacing the mocked string with\n  // an already parsed object.\n  if (Buffer.isBuffer(file) || typeof file === `string`) {\n    initialState = JSON.parse(file)\n  }\n  if (initialState.staticQueryComponents) {\n    initialState.staticQueryComponents = objectToMap(\n      initialState.staticQueryComponents\n    )\n  }\n  if (initialState.components) {\n    initialState.components = objectToMap(initialState.components)\n  }\n  if (initialState.nodes) {\n    initialState.nodes = objectToMap(initialState.nodes)\n\n    initialState.nodesByType = new Map()\n    initialState.nodes.forEach(node => {\n      const { type } = node.internal\n      if (!initialState.nodesByType.has(type)) {\n        initialState.nodesByType.set(type, new Map())\n      }\n      initialState.nodesByType.get(type).set(node.id, node)\n    })\n  }\n} catch (e) {\n  // ignore errors.\n}\n\nconst store = Redux.createStore(\n  Redux.combineReducers({ ...reducers }),\n  initialState,\n  Redux.applyMiddleware(function multi({ dispatch }) {\n    return next => action =>\n      Array.isArray(action)\n        ? action.filter(Boolean).map(dispatch)\n        : next(action)\n  })\n)\n\n// Persist state.\nfunction saveState() {\n  const state = store.getState()\n  const pickedState = _.pick(state, [\n    `nodes`,\n    `status`,\n    `componentDataDependencies`,\n    `components`,\n    `staticQueryComponents`,\n    `webpackCompilationHash`,\n  ])\n\n  pickedState.staticQueryComponents = mapToObject(\n    pickedState.staticQueryComponents\n  )\n  pickedState.components = mapToObject(pickedState.components)\n  pickedState.nodes = pickedState.nodes ? mapToObject(pickedState.nodes) : []\n  const stringified = stringify(pickedState, null, 2)\n  return fs.writeFile(`${process.cwd()}/.cache/redux-state.json`, stringified)\n}\n\nexports.saveState = saveState\n\nstore.subscribe(() => {\n  const lastAction = store.getState().lastAction\n  emitter.emit(lastAction.type, lastAction)\n})\n\n/** Event emitter */\nexports.emitter = emitter\n\n/** Redux store */\nexports.store = store\n"],"file":"index.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/redux/machines/page-component.js b/node_modules/gatsby/dist/redux/machines/page-component.js
index 69f1806..fa63772 100644
--- a/node_modules/gatsby/dist/redux/machines/page-component.js
+++ b/node_modules/gatsby/dist/redux/machines/page-component.js
@@ -79,7 +79,7 @@ module.exports = Machine({
   },
   actions: {
     runPageComponentQueries: (context, event) => {
-      const _require2 = require(`../../internal-plugins/query-runner/query-watcher`),
+      const _require2 = require(`../../query/query-watcher`),
             queueQueriesForPageComponent = _require2.queueQueriesForPageComponent; // Wait a bit as calling this function immediately triggers
       // an Action call which Redux squawks about.
 
@@ -100,7 +100,7 @@ module.exports = Machine({
     setPage: assign({
       pages: (ctx, event) => {
         if (event.path) {
-          const _require3 = require(`../../internal-plugins/query-runner/query-watcher`),
+          const _require3 = require(`../../query/query-watcher`),
                 runQueryForPage = _require3.runQueryForPage; // Wait a bit as calling this function immediately triggers
           // an Action call which Redux squawks about.
 
diff --git a/node_modules/gatsby/dist/redux/machines/page-component.js.map b/node_modules/gatsby/dist/redux/machines/page-component.js.map
index 97d6efd..1d1fe63 100644
--- a/node_modules/gatsby/dist/redux/machines/page-component.js.map
+++ b/node_modules/gatsby/dist/redux/machines/page-component.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/redux/machines/page-component.js"],"names":["require","Machine","assign","actions","module","exports","id","initial","context","isInBootstrap","componentPath","query","on","BOOTSTRAP_FINISHED","DELETE_PAGE","NEW_PAGE_CREATED","QUERY_EXTRACTION_GRAPHQL_ERROR","QUERY_EXTRACTION_BABEL_ERROR","states","inactive","target","cond","inactiveWhileBootstrapping","QUERY_CHANGED","queryExtractionGraphQLError","QUERY_DID_NOT_CHANGE","queryExtractionBabelError","QUERY_EXTRACTION_BABEL_SUCCESS","runningPageQueries","onEntry","QUERIES_COMPLETE","idle","guards","isBootstrapping","isNotBootstrapping","runPageComponentQueries","event","queueQueriesForPageComponent","setTimeout","setQuery","ctx","setPage","pages","path","runQueryForPage","concat","deletePage","filter","p","page","setBootstrapFinished"],"mappings":"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","sourcesContent":["const {\n  Machine,\n  actions: { assign },\n} = require(`xstate`)\n\nmodule.exports = Machine(\n  {\n    id: `pageComponents`,\n    initial: `inactive`,\n    context: {\n      isInBootstrap: true,\n      componentPath: ``,\n      query: ``,\n    },\n    on: {\n      BOOTSTRAP_FINISHED: {\n        actions: `setBootstrapFinished`,\n      },\n      DELETE_PAGE: {\n        actions: `deletePage`,\n      },\n      NEW_PAGE_CREATED: {\n        actions: `setPage`,\n      },\n      QUERY_EXTRACTION_GRAPHQL_ERROR: `queryExtractionGraphQLError`,\n      QUERY_EXTRACTION_BABEL_ERROR: `queryExtractionBabelError`,\n    },\n    states: {\n      inactive: {\n        on: {\n          // Transient transition\n          // Will transition to either 'inactiveWhileBootstrapping' or idle\n          // immediately upon entering 'inactive' state if the condition is met.\n          \"\": [\n            { target: `inactiveWhileBootstrapping`, cond: `isBootstrapping` },\n            { target: `idle`, cond: `isNotBootstrapping` },\n          ],\n        },\n      },\n      inactiveWhileBootstrapping: {\n        on: {\n          BOOTSTRAP_FINISHED: {\n            target: `idle`,\n            actions: `setBootstrapFinished`,\n          },\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n      queryExtractionGraphQLError: {\n        on: {\n          QUERY_DID_NOT_CHANGE: `idle`,\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n      queryExtractionBabelError: {\n        on: {\n          QUERY_EXTRACTION_BABEL_SUCCESS: `idle`,\n        },\n      },\n      runningPageQueries: {\n        onEntry: [`setQuery`, `runPageComponentQueries`],\n        on: {\n          QUERIES_COMPLETE: `idle`,\n        },\n      },\n      idle: {\n        on: {\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n    },\n  },\n  {\n    guards: {\n      isBootstrapping: context => context.isInBootstrap,\n      isNotBootstrapping: context => !context.isInBootstrap,\n    },\n    actions: {\n      runPageComponentQueries: (context, event) => {\n        const {\n          queueQueriesForPageComponent,\n        } = require(`../../internal-plugins/query-runner/query-watcher`)\n        // Wait a bit as calling this function immediately triggers\n        // an Action call which Redux squawks about.\n        setTimeout(() => {\n          queueQueriesForPageComponent(context.componentPath)\n        }, 0)\n      },\n      setQuery: assign({\n        query: (ctx, event) => {\n          if (typeof event.query !== `undefined` || event.query !== null) {\n            return event.query\n          } else {\n            return ctx.query\n          }\n        },\n      }),\n      setPage: assign({\n        pages: (ctx, event) => {\n          if (event.path) {\n            const {\n              runQueryForPage,\n            } = require(`../../internal-plugins/query-runner/query-watcher`)\n            // Wait a bit as calling this function immediately triggers\n            // an Action call which Redux squawks about.\n            setTimeout(() => {\n              if (!ctx.isInBootstrap) {\n                runQueryForPage(event.path)\n              }\n            }, 0)\n\n            return ctx.pages.concat(event.path)\n          } else {\n            return ctx.pages\n          }\n        },\n      }),\n      deletePage: assign({\n        pages: (ctx, event) => ctx.pages.filter(p => p !== event.page.path),\n      }),\n      setBootstrapFinished: assign({\n        isInBootstrap: false,\n      }),\n    },\n  }\n)\n"],"file":"page-component.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/redux/machines/page-component.js"],"names":["require","Machine","assign","actions","module","exports","id","initial","context","isInBootstrap","componentPath","query","on","BOOTSTRAP_FINISHED","DELETE_PAGE","NEW_PAGE_CREATED","QUERY_EXTRACTION_GRAPHQL_ERROR","QUERY_EXTRACTION_BABEL_ERROR","states","inactive","target","cond","inactiveWhileBootstrapping","QUERY_CHANGED","queryExtractionGraphQLError","QUERY_DID_NOT_CHANGE","queryExtractionBabelError","QUERY_EXTRACTION_BABEL_SUCCESS","runningPageQueries","onEntry","QUERIES_COMPLETE","idle","guards","isBootstrapping","isNotBootstrapping","runPageComponentQueries","event","queueQueriesForPageComponent","setTimeout","setQuery","ctx","setPage","pages","path","runQueryForPage","concat","deletePage","filter","p","page","setBootstrapFinished"],"mappings":"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","sourcesContent":["const {\n  Machine,\n  actions: { assign },\n} = require(`xstate`)\n\nmodule.exports = Machine(\n  {\n    id: `pageComponents`,\n    initial: `inactive`,\n    context: {\n      isInBootstrap: true,\n      componentPath: ``,\n      query: ``,\n    },\n    on: {\n      BOOTSTRAP_FINISHED: {\n        actions: `setBootstrapFinished`,\n      },\n      DELETE_PAGE: {\n        actions: `deletePage`,\n      },\n      NEW_PAGE_CREATED: {\n        actions: `setPage`,\n      },\n      QUERY_EXTRACTION_GRAPHQL_ERROR: `queryExtractionGraphQLError`,\n      QUERY_EXTRACTION_BABEL_ERROR: `queryExtractionBabelError`,\n    },\n    states: {\n      inactive: {\n        on: {\n          // Transient transition\n          // Will transition to either 'inactiveWhileBootstrapping' or idle\n          // immediately upon entering 'inactive' state if the condition is met.\n          \"\": [\n            { target: `inactiveWhileBootstrapping`, cond: `isBootstrapping` },\n            { target: `idle`, cond: `isNotBootstrapping` },\n          ],\n        },\n      },\n      inactiveWhileBootstrapping: {\n        on: {\n          BOOTSTRAP_FINISHED: {\n            target: `idle`,\n            actions: `setBootstrapFinished`,\n          },\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n      queryExtractionGraphQLError: {\n        on: {\n          QUERY_DID_NOT_CHANGE: `idle`,\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n      queryExtractionBabelError: {\n        on: {\n          QUERY_EXTRACTION_BABEL_SUCCESS: `idle`,\n        },\n      },\n      runningPageQueries: {\n        onEntry: [`setQuery`, `runPageComponentQueries`],\n        on: {\n          QUERIES_COMPLETE: `idle`,\n        },\n      },\n      idle: {\n        on: {\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n    },\n  },\n  {\n    guards: {\n      isBootstrapping: context => context.isInBootstrap,\n      isNotBootstrapping: context => !context.isInBootstrap,\n    },\n    actions: {\n      runPageComponentQueries: (context, event) => {\n        const {\n          queueQueriesForPageComponent,\n        } = require(`../../query/query-watcher`)\n        // Wait a bit as calling this function immediately triggers\n        // an Action call which Redux squawks about.\n        setTimeout(() => {\n          queueQueriesForPageComponent(context.componentPath)\n        }, 0)\n      },\n      setQuery: assign({\n        query: (ctx, event) => {\n          if (typeof event.query !== `undefined` || event.query !== null) {\n            return event.query\n          } else {\n            return ctx.query\n          }\n        },\n      }),\n      setPage: assign({\n        pages: (ctx, event) => {\n          if (event.path) {\n            const { runQueryForPage } = require(`../../query/query-watcher`)\n            // Wait a bit as calling this function immediately triggers\n            // an Action call which Redux squawks about.\n            setTimeout(() => {\n              if (!ctx.isInBootstrap) {\n                runQueryForPage(event.path)\n              }\n            }, 0)\n\n            return ctx.pages.concat(event.path)\n          } else {\n            return ctx.pages\n          }\n        },\n      }),\n      deletePage: assign({\n        pages: (ctx, event) => ctx.pages.filter(p => p !== event.page.path),\n      }),\n      setBootstrapFinished: assign({\n        isInBootstrap: false,\n      }),\n    },\n  }\n)\n"],"file":"page-component.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/redux/reducers/index.js b/node_modules/gatsby/dist/redux/reducers/index.js
index 4ba6812..44d2ec2 100644
--- a/node_modules/gatsby/dist/redux/reducers/index.js
+++ b/node_modules/gatsby/dist/redux/reducers/index.js
@@ -35,6 +35,7 @@ module.exports = {
   flattenedPlugins: require(`./flattened-plugins`),
   config: require(`./config`),
   pages: require(`./pages`),
+  matchPaths: require(`./match-paths`),
   schema: require(`./schema`),
   status: require(`./status`),
   componentDataDependencies: require(`./component-data-dependencies`),
@@ -42,9 +43,9 @@ module.exports = {
   staticQueryComponents: require(`./static-query-components`),
   jobs: require(`./jobs`),
   webpack: require(`./webpack`),
+  webpackCompilationHash: require(`./webpack-compilation-hash`),
   redirects: require(`./redirects`),
   babelrc: require(`./babelrc`),
-  jsonDataPaths: require(`./json-data-paths`),
   schemaCustomization: require(`./schema-customization`),
   themes: require(`./themes`)
 };
diff --git a/node_modules/gatsby/dist/redux/reducers/index.js.map b/node_modules/gatsby/dist/redux/reducers/index.js.map
index 24e63ef..5afac34 100644
--- a/node_modules/gatsby/dist/redux/reducers/index.js.map
+++ b/node_modules/gatsby/dist/redux/reducers/index.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/redux/reducers/index.js"],"names":["reduxNodes","require","lokiNodes","reducer","backend","process","env","GATSBY_DB_NODES","getNodesReducer","nodesReducer","Error","module","exports","program","nodes","nodesByType","resolvedNodesCache","nodesTouched","lastAction","flattenedPlugins","config","pages","schema","status","componentDataDependencies","components","staticQueryComponents","jobs","webpack","redirects","babelrc","jsonDataPaths","schemaCustomization","themes"],"mappings":";;AAAA,MAAMA,UAAU,GAAGC,OAAO,CAAE,SAAF,CAA1B;;AACA,MAAMC,SAAS,GAAGD,OAAO,CAAE,qBAAF,CAAP,CAA+BE,OAAjD;;AAEA,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAR,CAAYC,eAAZ,IAAgC,OAAhD;;AAEA,SAASC,eAAT,GAA2B;AACzB,MAAIC,YAAJ;;AACA,UAAQL,OAAR;AACE,SAAM,OAAN;AACEK,MAAAA,YAAY,GAAGT,UAAf;AACA;;AACF,SAAM,MAAN;AACES,MAAAA,YAAY,GAAGP,SAAf;AACA;;AACF;AACE,YAAM,IAAIQ,KAAJ,CACH,iEADG,CAAN;AARJ;;AAYA,SAAOD,YAAP;AACD;;AAEDE,MAAM,CAACC,OAAP,GAAiB;AACfC,EAAAA,OAAO,EAAEZ,OAAO,CAAE,WAAF,CADD;AAEfa,EAAAA,KAAK,EAAEN,eAAe,EAFP;AAGfO,EAAAA,WAAW,EAAEd,OAAO,CAAE,iBAAF,CAHL;AAIfe,EAAAA,kBAAkB,EAAEf,OAAO,CAAE,kBAAF,CAJZ;AAKfgB,EAAAA,YAAY,EAAEhB,OAAO,CAAE,iBAAF,CALN;AAMfiB,EAAAA,UAAU,EAAEjB,OAAO,CAAE,eAAF,CANJ;AAOfkB,EAAAA,gBAAgB,EAAElB,OAAO,CAAE,qBAAF,CAPV;AAQfmB,EAAAA,MAAM,EAAEnB,OAAO,CAAE,UAAF,CARA;AASfoB,EAAAA,KAAK,EAAEpB,OAAO,CAAE,SAAF,CATC;AAUfqB,EAAAA,MAAM,EAAErB,OAAO,CAAE,UAAF,CAVA;AAWfsB,EAAAA,MAAM,EAAEtB,OAAO,CAAE,UAAF,CAXA;AAYfuB,EAAAA,yBAAyB,EAAEvB,OAAO,CAAE,+BAAF,CAZnB;AAafwB,EAAAA,UAAU,EAAExB,OAAO,CAAE,cAAF,CAbJ;AAcfyB,EAAAA,qBAAqB,EAAEzB,OAAO,CAAE,2BAAF,CAdf;AAef0B,EAAAA,IAAI,EAAE1B,OAAO,CAAE,QAAF,CAfE;AAgBf2B,EAAAA,OAAO,EAAE3B,OAAO,CAAE,WAAF,CAhBD;AAiBf4B,EAAAA,SAAS,EAAE5B,OAAO,CAAE,aAAF,CAjBH;AAkBf6B,EAAAA,OAAO,EAAE7B,OAAO,CAAE,WAAF,CAlBD;AAmBf8B,EAAAA,aAAa,EAAE9B,OAAO,CAAE,mBAAF,CAnBP;AAoBf+B,EAAAA,mBAAmB,EAAE/B,OAAO,CAAE,wBAAF,CApBb;AAqBfgC,EAAAA,MAAM,EAAEhC,OAAO,CAAE,UAAF;AArBA,CAAjB","sourcesContent":["const reduxNodes = require(`./nodes`)\nconst lokiNodes = require(`../../db/loki/nodes`).reducer\n\nconst backend = process.env.GATSBY_DB_NODES || `redux`\n\nfunction getNodesReducer() {\n  let nodesReducer\n  switch (backend) {\n    case `redux`:\n      nodesReducer = reduxNodes\n      break\n    case `loki`:\n      nodesReducer = lokiNodes\n      break\n    default:\n      throw new Error(\n        `Unsupported DB nodes backend (value of env var GATSBY_DB_NODES)`\n      )\n  }\n  return nodesReducer\n}\n\nmodule.exports = {\n  program: require(`./program`),\n  nodes: getNodesReducer(),\n  nodesByType: require(`./nodes-by-type`),\n  resolvedNodesCache: require(`./resolved-nodes`),\n  nodesTouched: require(`./nodes-touched`),\n  lastAction: require(`./last-action`),\n  flattenedPlugins: require(`./flattened-plugins`),\n  config: require(`./config`),\n  pages: require(`./pages`),\n  schema: require(`./schema`),\n  status: require(`./status`),\n  componentDataDependencies: require(`./component-data-dependencies`),\n  components: require(`./components`),\n  staticQueryComponents: require(`./static-query-components`),\n  jobs: require(`./jobs`),\n  webpack: require(`./webpack`),\n  redirects: require(`./redirects`),\n  babelrc: require(`./babelrc`),\n  jsonDataPaths: require(`./json-data-paths`),\n  schemaCustomization: require(`./schema-customization`),\n  themes: require(`./themes`),\n}\n"],"file":"index.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/redux/reducers/index.js"],"names":["reduxNodes","require","lokiNodes","reducer","backend","process","env","GATSBY_DB_NODES","getNodesReducer","nodesReducer","Error","module","exports","program","nodes","nodesByType","resolvedNodesCache","nodesTouched","lastAction","flattenedPlugins","config","pages","matchPaths","schema","status","componentDataDependencies","components","staticQueryComponents","jobs","webpack","webpackCompilationHash","redirects","babelrc","schemaCustomization","themes"],"mappings":";;AAAA,MAAMA,UAAU,GAAGC,OAAO,CAAE,SAAF,CAA1B;;AACA,MAAMC,SAAS,GAAGD,OAAO,CAAE,qBAAF,CAAP,CAA+BE,OAAjD;;AAEA,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAR,CAAYC,eAAZ,IAAgC,OAAhD;;AAEA,SAASC,eAAT,GAA2B;AACzB,MAAIC,YAAJ;;AACA,UAAQL,OAAR;AACE,SAAM,OAAN;AACEK,MAAAA,YAAY,GAAGT,UAAf;AACA;;AACF,SAAM,MAAN;AACES,MAAAA,YAAY,GAAGP,SAAf;AACA;;AACF;AACE,YAAM,IAAIQ,KAAJ,CACH,iEADG,CAAN;AARJ;;AAYA,SAAOD,YAAP;AACD;;AAEDE,MAAM,CAACC,OAAP,GAAiB;AACfC,EAAAA,OAAO,EAAEZ,OAAO,CAAE,WAAF,CADD;AAEfa,EAAAA,KAAK,EAAEN,eAAe,EAFP;AAGfO,EAAAA,WAAW,EAAEd,OAAO,CAAE,iBAAF,CAHL;AAIfe,EAAAA,kBAAkB,EAAEf,OAAO,CAAE,kBAAF,CAJZ;AAKfgB,EAAAA,YAAY,EAAEhB,OAAO,CAAE,iBAAF,CALN;AAMfiB,EAAAA,UAAU,EAAEjB,OAAO,CAAE,eAAF,CANJ;AAOfkB,EAAAA,gBAAgB,EAAElB,OAAO,CAAE,qBAAF,CAPV;AAQfmB,EAAAA,MAAM,EAAEnB,OAAO,CAAE,UAAF,CARA;AASfoB,EAAAA,KAAK,EAAEpB,OAAO,CAAE,SAAF,CATC;AAUfqB,EAAAA,UAAU,EAAErB,OAAO,CAAE,eAAF,CAVJ;AAWfsB,EAAAA,MAAM,EAAEtB,OAAO,CAAE,UAAF,CAXA;AAYfuB,EAAAA,MAAM,EAAEvB,OAAO,CAAE,UAAF,CAZA;AAafwB,EAAAA,yBAAyB,EAAExB,OAAO,CAAE,+BAAF,CAbnB;AAcfyB,EAAAA,UAAU,EAAEzB,OAAO,CAAE,cAAF,CAdJ;AAef0B,EAAAA,qBAAqB,EAAE1B,OAAO,CAAE,2BAAF,CAff;AAgBf2B,EAAAA,IAAI,EAAE3B,OAAO,CAAE,QAAF,CAhBE;AAiBf4B,EAAAA,OAAO,EAAE5B,OAAO,CAAE,WAAF,CAjBD;AAkBf6B,EAAAA,sBAAsB,EAAE7B,OAAO,CAAE,4BAAF,CAlBhB;AAmBf8B,EAAAA,SAAS,EAAE9B,OAAO,CAAE,aAAF,CAnBH;AAoBf+B,EAAAA,OAAO,EAAE/B,OAAO,CAAE,WAAF,CApBD;AAqBfgC,EAAAA,mBAAmB,EAAEhC,OAAO,CAAE,wBAAF,CArBb;AAsBfiC,EAAAA,MAAM,EAAEjC,OAAO,CAAE,UAAF;AAtBA,CAAjB","sourcesContent":["const reduxNodes = require(`./nodes`)\nconst lokiNodes = require(`../../db/loki/nodes`).reducer\n\nconst backend = process.env.GATSBY_DB_NODES || `redux`\n\nfunction getNodesReducer() {\n  let nodesReducer\n  switch (backend) {\n    case `redux`:\n      nodesReducer = reduxNodes\n      break\n    case `loki`:\n      nodesReducer = lokiNodes\n      break\n    default:\n      throw new Error(\n        `Unsupported DB nodes backend (value of env var GATSBY_DB_NODES)`\n      )\n  }\n  return nodesReducer\n}\n\nmodule.exports = {\n  program: require(`./program`),\n  nodes: getNodesReducer(),\n  nodesByType: require(`./nodes-by-type`),\n  resolvedNodesCache: require(`./resolved-nodes`),\n  nodesTouched: require(`./nodes-touched`),\n  lastAction: require(`./last-action`),\n  flattenedPlugins: require(`./flattened-plugins`),\n  config: require(`./config`),\n  pages: require(`./pages`),\n  matchPaths: require(`./match-paths`),\n  schema: require(`./schema`),\n  status: require(`./status`),\n  componentDataDependencies: require(`./component-data-dependencies`),\n  components: require(`./components`),\n  staticQueryComponents: require(`./static-query-components`),\n  jobs: require(`./jobs`),\n  webpack: require(`./webpack`),\n  webpackCompilationHash: require(`./webpack-compilation-hash`),\n  redirects: require(`./redirects`),\n  babelrc: require(`./babelrc`),\n  schemaCustomization: require(`./schema-customization`),\n  themes: require(`./themes`),\n}\n"],"file":"index.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/redux/reducers/json-data-paths.js b/node_modules/gatsby/dist/redux/reducers/json-data-paths.js
deleted file mode 100644
index 9f8893b..0000000
--- a/node_modules/gatsby/dist/redux/reducers/json-data-paths.js
+++ /dev/null
@@ -1,18 +0,0 @@
-"use strict";
-
-// const omit = require(`lodash/omit`)
-module.exports = (state = {}, action) => {
-  switch (action.type) {
-    // case `DELETE_ALL_JSON_DATA_PATHS`:
-    //   return {}
-    case `SET_JSON_DATA_PATH`:
-      state[action.payload.key] = action.payload.value;
-      return state;
-    // case `DELETE_JSON_DATA_PATH`:
-    //   return omit(state, action.payload)
-
-    default:
-      return state;
-  }
-};
-//# sourceMappingURL=json-data-paths.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/redux/reducers/json-data-paths.js.map b/node_modules/gatsby/dist/redux/reducers/json-data-paths.js.map
deleted file mode 100644
index 7f29738..0000000
--- a/node_modules/gatsby/dist/redux/reducers/json-data-paths.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"sources":["../../../src/redux/reducers/json-data-paths.js"],"names":["module","exports","state","action","type","payload","key","value"],"mappings":";;AAAA;AAEAA,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG,EAAT,EAAaC,MAAb,KAAwB;AACvC,UAAQA,MAAM,CAACC,IAAf;AACE;AACA;AACA,SAAM,oBAAN;AACEF,MAAAA,KAAK,CAACC,MAAM,CAACE,OAAP,CAAeC,GAAhB,CAAL,GAA4BH,MAAM,CAACE,OAAP,CAAeE,KAA3C;AACA,aAAOL,KAAP;AACF;AACA;;AACA;AACE,aAAOA,KAAP;AATJ;AAWD,CAZD","sourcesContent":["// const omit = require(`lodash/omit`)\n\nmodule.exports = (state = {}, action) => {\n  switch (action.type) {\n    // case `DELETE_ALL_JSON_DATA_PATHS`:\n    //   return {}\n    case `SET_JSON_DATA_PATH`:\n      state[action.payload.key] = action.payload.value\n      return state\n    // case `DELETE_JSON_DATA_PATH`:\n    //   return omit(state, action.payload)\n    default:\n      return state\n  }\n}\n"],"file":"json-data-paths.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/redux/reducers/match-paths.js b/node_modules/gatsby/dist/redux/reducers/match-paths.js
new file mode 100644
index 0000000..b23994b
--- /dev/null
+++ b/node_modules/gatsby/dist/redux/reducers/match-paths.js
@@ -0,0 +1,44 @@
+"use strict";
+
+const _ = require(`lodash`);
+
+module.exports = (state = {}, action) => {
+  switch (action.type) {
+    case `DELETE_CACHE`:
+      return {};
+
+    case `CREATE_PAGE`:
+      {
+        const page = action.payload;
+
+        if (page.matchPath) {
+          const oldPage = action.oldPage;
+          const newState = Object.assign({}, state);
+
+          if (oldPage && oldPage.matchPath !== page.matchPath) {
+            delete newState.matchMaths[oldPage.matchPath];
+          }
+
+          newState[page.matchPath] = page.path;
+          return newState;
+        } else {
+          return state;
+        }
+      }
+
+    case `DELETE_PAGE`:
+      {
+        const page = action.payload;
+
+        if (page.matchPath) {
+          return _.omit(state, [page.matchPath]);
+        } else {
+          return state;
+        }
+      }
+
+    default:
+      return state;
+  }
+};
+//# sourceMappingURL=match-paths.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/redux/reducers/match-paths.js.map b/node_modules/gatsby/dist/redux/reducers/match-paths.js.map
new file mode 100644
index 0000000..319ea7e
--- /dev/null
+++ b/node_modules/gatsby/dist/redux/reducers/match-paths.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../../src/redux/reducers/match-paths.js"],"names":["_","require","module","exports","state","action","type","page","payload","matchPath","oldPage","newState","matchMaths","path","omit"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AAEAC,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG,EAAT,EAAaC,MAAb,KAAwB;AACvC,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,cAAN;AACE,aAAO,EAAP;;AACF,SAAM,aAAN;AAAoB;AAClB,cAAMC,IAAI,GAAGF,MAAM,CAACG,OAApB;;AACA,YAAID,IAAI,CAACE,SAAT,EAAoB;AAAA,gBACVC,OADU,GACEL,MADF,CACVK,OADU;AAElB,gBAAMC,QAAQ,qBAAQP,KAAR,CAAd;;AACA,cAAIM,OAAO,IAAIA,OAAO,CAACD,SAAR,KAAsBF,IAAI,CAACE,SAA1C,EAAqD;AACnD,mBAAOE,QAAQ,CAACC,UAAT,CAAoBF,OAAO,CAACD,SAA5B,CAAP;AACD;;AACDE,UAAAA,QAAQ,CAACJ,IAAI,CAACE,SAAN,CAAR,GAA2BF,IAAI,CAACM,IAAhC;AACA,iBAAOF,QAAP;AACD,SARD,MAQO;AACL,iBAAOP,KAAP;AACD;AACF;;AACD,SAAM,aAAN;AAAoB;AAClB,cAAMG,IAAI,GAAGF,MAAM,CAACG,OAApB;;AACA,YAAID,IAAI,CAACE,SAAT,EAAoB;AAClB,iBAAOT,CAAC,CAACc,IAAF,CAAOV,KAAP,EAAc,CAACG,IAAI,CAACE,SAAN,CAAd,CAAP;AACD,SAFD,MAEO;AACL,iBAAOL,KAAP;AACD;AACF;;AACD;AACE,aAAOA,KAAP;AA1BJ;AA4BD,CA7BD","sourcesContent":["const _ = require(`lodash`)\n\nmodule.exports = (state = {}, action) => {\n  switch (action.type) {\n    case `DELETE_CACHE`:\n      return {}\n    case `CREATE_PAGE`: {\n      const page = action.payload\n      if (page.matchPath) {\n        const { oldPage } = action\n        const newState = { ...state }\n        if (oldPage && oldPage.matchPath !== page.matchPath) {\n          delete newState.matchMaths[oldPage.matchPath]\n        }\n        newState[page.matchPath] = page.path\n        return newState\n      } else {\n        return state\n      }\n    }\n    case `DELETE_PAGE`: {\n      const page = action.payload\n      if (page.matchPath) {\n        return _.omit(state, [page.matchPath])\n      } else {\n        return state\n      }\n    }\n    default:\n      return state\n  }\n}\n"],"file":"match-paths.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/redux/reducers/webpack-compilation-hash.js b/node_modules/gatsby/dist/redux/reducers/webpack-compilation-hash.js
new file mode 100644
index 0000000..2b6eeb9
--- /dev/null
+++ b/node_modules/gatsby/dist/redux/reducers/webpack-compilation-hash.js
@@ -0,0 +1,12 @@
+"use strict";
+
+module.exports = (state = ``, action) => {
+  switch (action.type) {
+    case `SET_WEBPACK_COMPILATION_HASH`:
+      return action.payload;
+
+    default:
+      return state;
+  }
+};
+//# sourceMappingURL=webpack-compilation-hash.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/redux/reducers/webpack-compilation-hash.js.map b/node_modules/gatsby/dist/redux/reducers/webpack-compilation-hash.js.map
new file mode 100644
index 0000000..86f68ad
--- /dev/null
+++ b/node_modules/gatsby/dist/redux/reducers/webpack-compilation-hash.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../../src/redux/reducers/webpack-compilation-hash.js"],"names":["module","exports","state","action","type","payload"],"mappings":";;AAAAA,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAI,EAAV,EAAaC,MAAb,KAAwB;AACvC,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,8BAAN;AACE,aAAOD,MAAM,CAACE,OAAd;;AACF;AACE,aAAOH,KAAP;AAJJ;AAMD,CAPD","sourcesContent":["module.exports = (state = ``, action) => {\n  switch (action.type) {\n    case `SET_WEBPACK_COMPILATION_HASH`:\n      return action.payload\n    default:\n      return state\n  }\n}\n"],"file":"webpack-compilation-hash.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/utils/api-browser-docs.js b/node_modules/gatsby/dist/utils/api-browser-docs.js
index 1142c62..0c25616 100644
--- a/node_modules/gatsby/dist/utils/api-browser-docs.js
+++ b/node_modules/gatsby/dist/utils/api-browser-docs.js
@@ -171,11 +171,12 @@ exports.onPrefetchPathname = true;
  * Called when prefetching for a pathname is successful. Allows
  * for plugins with custom prefetching logic.
  * @param {object} $0
- * @param {string} $0.pathname The pathname whose resources have now been prefetched
+ * @param {string} $0.path The pathname whose resources have now been prefetched
+ * @param {resourceUrls} $0.resourceUrls An array of resource URLs that have been prefetched for this path
  * @param {function} $0.getResourceURLsForPathname Function for fetching URLs for resources related to the pathname
  */
 
-exports.onPostPrefetchPathname = true;
+exports.onPostPrefetch = true;
 /**
  * Plugins can take over prefetching logic. If they do, they should call this
  * to disable the now duplicate core prefetching logic.
diff --git a/node_modules/gatsby/dist/utils/api-browser-docs.js.map b/node_modules/gatsby/dist/utils/api-browser-docs.js.map
index 9c420f6..06e7120 100644
--- a/node_modules/gatsby/dist/utils/api-browser-docs.js.map
+++ b/node_modules/gatsby/dist/utils/api-browser-docs.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/api-browser-docs.js"],"names":["exports","onClientEntry","onInitialClientRender","onPreRouteUpdate","onRouteUpdateDelayed","onRouteUpdate","shouldUpdateScroll","registerServiceWorker","replaceComponentRenderer","wrapPageElement","wrapRootElement","onPrefetchPathname","onPostPrefetchPathname","disableCorePrefetching","replaceHydrateFunction","onServiceWorkerInstalled","onServiceWorkerUpdateFound","onServiceWorkerUpdateReady","onServiceWorkerActive","onServiceWorkerRedundant"],"mappings":";;AAAA;;;;;;;;AAQAA,OAAO,CAACC,aAAR,GAAwB,IAAxB;AAEA;;;;;;;;AAOAD,OAAO,CAACE,qBAAR,GAAgC,IAAhC;AAEA;;;;;;;;;;;;AAWAF,OAAO,CAACG,gBAAR,GAA2B,IAA3B;AAEA;;;;;;;;;;;AAUAH,OAAO,CAACI,oBAAR,GAA+B,IAA/B;AAEA;;;;;;;;;;;;;;;;;;;;AAmBAJ,OAAO,CAACK,aAAR,GAAwB,IAAxB;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BAL,OAAO,CAACM,kBAAR,GAA6B,IAA7B;AAEA;;;;;;AAKAN,OAAO,CAACO,qBAAR,GAAgC,IAAhC;AAEA;;;;;;;;AAOAP,OAAO,CAACQ,wBAAR,GAAmC,IAAnC;AAEA;;;;;;;;;;;;;;;;;;;;;AAoBAR,OAAO,CAACS,eAAR,GAA0B,IAA1B;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;AAwBAT,OAAO,CAACU,eAAR,GAA0B,IAA1B;AAEA;;;;;;;;AAOAV,OAAO,CAACW,kBAAR,GAA6B,IAA7B;AAEA;;;;;;;;AAOAX,OAAO,CAACY,sBAAR,GAAiC,IAAjC;AAEA;;;;;;;AAMAZ,OAAO,CAACa,sBAAR,GAAiC,IAAjC;AAEA;;;;;;;;;;;;;AAYAb,OAAO,CAACc,sBAAR,GAAiC,IAAjC;AAEA;;;;;;AAKAd,OAAO,CAACe,wBAAR,GAAmC,IAAnC;AAEA;;;;;;AAKAf,OAAO,CAACgB,0BAAR,GAAqC,IAArC;AAEA;;;;;;;AAMAhB,OAAO,CAACiB,0BAAR,GAAqC,IAArC;AAEA;;;;;;AAKAjB,OAAO,CAACkB,qBAAR,GAAgC,IAAhC;AAEA;;;;;;AAKAlB,OAAO,CAACmB,wBAAR,GAAmC,IAAnC","sourcesContent":["/**\n * Called when the Gatsby browser runtime first starts.\n * @example\n * exports.onClientEntry = () => {\n *   console.log(\"We've started!\")\n *   callAnalyticsAPI()\n * }\n */\nexports.onClientEntry = true\n\n/**\n * Called when the initial (but not subsequent) render of Gatsby App is done on the client.\n * @example\n * exports.onInitialClientRender = () => {\n *   console.log(\"ReactDOM.render has executed\")\n * }\n */\nexports.onInitialClientRender = true\n\n/**\n * Called when changing location is started.\n * @param {object} $0\n * @param {object} $0.location A location object\n * @param {object|null} $0.prevLocation The previous location object\n * @example\n * exports.onPreRouteUpdate = ({ location, prevLocation }) => {\n *   console.log(\"Gatsby started to change location to\", location.pathname)\n *   console.log(\"Gatsby started to change location from\", prevLocation ? prevLocation.pathname : null)\n * }\n */\nexports.onPreRouteUpdate = true\n\n/**\n * Called when changing location is longer than 1 second.\n * @param {object} $0\n * @param {object} $0.location A location object\n * @param {object} $0.action The \"action\" that caused the route change\n * @example\n * exports.onRouteUpdateDelayed = () => {\n *   console.log(\"We can show loading indicator now\")\n * }\n */\nexports.onRouteUpdateDelayed = true\n\n/**\n * Called when the user changes routes\n * @param {object} $0\n * @param {object} $0.location A location object\n * @param {object|null} $0.prevLocation The previous location object\n * @example\n * exports.onRouteUpdate = ({ location, prevLocation }) => {\n *   console.log('new pathname', location.pathname)\n *   console.log('old pathname', prevLocation ? prevLocation.pathname : null)\n *\n *   // Track pageview with google analytics\n *   window.ga(\n *     `set`,\n *     `page`,\n *     location.pathname + location.search + location.hash,\n *   )\n *   window.ga(`send`, `pageview`)\n * }\n */\nexports.onRouteUpdate = true\n\n/**\n * Allow a plugin to decide if the scroll position should update or\n * not on a route change.\n * @param {object} $0\n * @param {object} $0.prevRouterProps The previous state of the router before the route change.\n * @param {object} $0.routerProps The current state of the router.\n * @param {string} $0.pathname The new pathname (for backwards compatibility with v1).\n * @param {function} $0.getSavedScrollPosition Takes a location and returns the\n * coordinates of the last scroll position for that location, or `null`. Gatsby\n * saves scroll positions for each route in `SessionStorage`, so they are\n * available after page reload.\n * @returns {(boolean|string|Array)} Should return either an [x, y] Array of\n * coordinates to scroll to, a string of the `id` or `name` of an element to\n * scroll to, `false` to not update the scroll position, or `true` for the\n * default behavior.\n * @example\n * exports.shouldUpdateScroll = ({\n *   routerProps: { location },\n *   getSavedScrollPosition\n * }) => {\n *   const currentPosition = getSavedScrollPosition(location)\n *   const queriedPosition = getSavedScrollPosition({ pathname: `/random` })\n *\n *   window.scrollTo(...(currentPosition || [0, 0]))\n *\n *   return false\n * }\n */\nexports.shouldUpdateScroll = true\n\n/**\n * Allow a plugin to register a Service Worker. Should be a function that returns true.\n * @example\n * exports.registerServiceWorker = () => true\n */\nexports.registerServiceWorker = true\n\n/**\n * Allow a plugin to replace the page component renderer. This api runner can be used to\n * implement page transitions. See https://github.com/gatsbyjs/gatsby/tree/master/examples/using-page-transitions for an example of this.\n * @param {object} $0\n * @param {object} $0.props The props of the page.\n * @param {object} $0.loader The gatsby loader.\n */\nexports.replaceComponentRenderer = true\n\n/**\n * Allow a plugin to wrap the page element.\n *\n * This is useful for setting wrapper component around pages that won't get\n * unmounted on page change. For setting Provider components use [wrapRootElement](#wrapRootElement).\n *\n * _Note:_ [There is equivalent hook in SSR API](/docs/ssr-apis/#wrapPageElement)\n * @param {object} $0\n * @param {ReactNode} $0.element The \"Page\" React Element built by Gatsby.\n * @param {object} $0.props Props object used by page.\n * @example\n * import React from \"react\"\n * import Layout from \"./src/components/layout\"\n *\n * export const wrapPageElement = ({ element, props }) => {\n *   // props provide same data to Layout as Page element will get\n *   // including location, data, etc - you don't need to pass it\n *   return <Layout {...props}>{element}</Layout>\n * }\n */\nexports.wrapPageElement = true\n\n/**\n * Allow a plugin to wrap the root element.\n *\n * This is useful to setup any Providers component that will wrap your application.\n * For setting persistent UI elements around pages use [wrapPageElement](#wrapPageElement).\n *\n * _Note:_ [There is equivalent hook in SSR API](/docs/ssr-apis/#wrapRootElement)\n * @param {object} $0\n * @param {ReactNode} $0.element The \"Root\" React Element built by Gatsby.\n * @example\n * import React from \"react\"\n * import { Provider } from \"react-redux\"\n *\n * import createStore from \"./src/state/createStore\"\n * const store = createStore()\n *\n * export const wrapRootElement = ({ element }) => {\n *   return (\n *     <Provider store={store}>\n *       {element}\n *     </Provider>\n *   )\n * }\n */\nexports.wrapRootElement = true\n\n/**\n * Called when prefetching for a pathname is triggered. Allows\n * for plugins with custom prefetching logic.\n * @param {object} $0\n * @param {string} $0.pathname The pathname whose resources should now be prefetched\n * @param {function} $0.getResourcesForPathname Function for fetching resources related to pathname\n */\nexports.onPrefetchPathname = true\n\n/**\n * Called when prefetching for a pathname is successful. Allows\n * for plugins with custom prefetching logic.\n * @param {object} $0\n * @param {string} $0.pathname The pathname whose resources have now been prefetched\n * @param {function} $0.getResourceURLsForPathname Function for fetching URLs for resources related to the pathname\n */\nexports.onPostPrefetchPathname = true\n\n/**\n * Plugins can take over prefetching logic. If they do, they should call this\n * to disable the now duplicate core prefetching logic.\n * @example\n * exports.disableCorePrefetching = () => true\n */\nexports.disableCorePrefetching = true\n\n/**\n * Allow a plugin to replace the ReactDOM.render function call by a custom renderer.\n * This method takes no param and should return a function with same signature as ReactDOM.render()\n * Note it's very important to call the callback after rendering, otherwise Gatsby will not be able to call `onInitialClientRender`\n * @example\n * exports.replaceHydrateFunction = () => {\n *   return (element, container, callback) => {\n *     console.log(\"rendering!\");\n *     ReactDOM.render(element, container, callback);\n *   };\n * };\n */\nexports.replaceHydrateFunction = true\n\n/**\n * Inform plugins when a service worker has been installed.\n * @param {object} $0\n * @param {object} $0.serviceWorker The service worker instance.\n */\nexports.onServiceWorkerInstalled = true\n\n/**\n * Inform plugins of when a service worker has an update available.\n * @param {object} $0\n * @param {object} $0.serviceWorker The service worker instance.\n */\nexports.onServiceWorkerUpdateFound = true\n\n/**\n * Inform plugins when a service worker has been updated in the background\n * and the page is ready to reload to apply changes.\n * @param {object} $0\n * @param {object} $0.serviceWorker The service worker instance.\n */\nexports.onServiceWorkerUpdateReady = true\n\n/**\n * Inform plugins when a service worker has become active.\n * @param {object} $0\n * @param {object} $0.serviceWorker The service worker instance.\n */\nexports.onServiceWorkerActive = true\n\n/**\n * Inform plugins when a service worker is redundant.\n * @param {object} $0\n * @param {object} $0.serviceWorker The service worker instance.\n */\nexports.onServiceWorkerRedundant = true\n"],"file":"api-browser-docs.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/api-browser-docs.js"],"names":["exports","onClientEntry","onInitialClientRender","onPreRouteUpdate","onRouteUpdateDelayed","onRouteUpdate","shouldUpdateScroll","registerServiceWorker","replaceComponentRenderer","wrapPageElement","wrapRootElement","onPrefetchPathname","onPostPrefetch","disableCorePrefetching","replaceHydrateFunction","onServiceWorkerInstalled","onServiceWorkerUpdateFound","onServiceWorkerUpdateReady","onServiceWorkerActive","onServiceWorkerRedundant"],"mappings":";;AAAA;;;;;;;;AAQAA,OAAO,CAACC,aAAR,GAAwB,IAAxB;AAEA;;;;;;;;AAOAD,OAAO,CAACE,qBAAR,GAAgC,IAAhC;AAEA;;;;;;;;;;;;AAWAF,OAAO,CAACG,gBAAR,GAA2B,IAA3B;AAEA;;;;;;;;;;;AAUAH,OAAO,CAACI,oBAAR,GAA+B,IAA/B;AAEA;;;;;;;;;;;;;;;;;;;;AAmBAJ,OAAO,CAACK,aAAR,GAAwB,IAAxB;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BAL,OAAO,CAACM,kBAAR,GAA6B,IAA7B;AAEA;;;;;;AAKAN,OAAO,CAACO,qBAAR,GAAgC,IAAhC;AAEA;;;;;;;;AAOAP,OAAO,CAACQ,wBAAR,GAAmC,IAAnC;AAEA;;;;;;;;;;;;;;;;;;;;;AAoBAR,OAAO,CAACS,eAAR,GAA0B,IAA1B;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;AAwBAT,OAAO,CAACU,eAAR,GAA0B,IAA1B;AAEA;;;;;;;;AAOAV,OAAO,CAACW,kBAAR,GAA6B,IAA7B;AAEA;;;;;;;;;AAQAX,OAAO,CAACY,cAAR,GAAyB,IAAzB;AAEA;;;;;;;AAMAZ,OAAO,CAACa,sBAAR,GAAiC,IAAjC;AAEA;;;;;;;;;;;;;AAYAb,OAAO,CAACc,sBAAR,GAAiC,IAAjC;AAEA;;;;;;AAKAd,OAAO,CAACe,wBAAR,GAAmC,IAAnC;AAEA;;;;;;AAKAf,OAAO,CAACgB,0BAAR,GAAqC,IAArC;AAEA;;;;;;;AAMAhB,OAAO,CAACiB,0BAAR,GAAqC,IAArC;AAEA;;;;;;AAKAjB,OAAO,CAACkB,qBAAR,GAAgC,IAAhC;AAEA;;;;;;AAKAlB,OAAO,CAACmB,wBAAR,GAAmC,IAAnC","sourcesContent":["/**\n * Called when the Gatsby browser runtime first starts.\n * @example\n * exports.onClientEntry = () => {\n *   console.log(\"We've started!\")\n *   callAnalyticsAPI()\n * }\n */\nexports.onClientEntry = true\n\n/**\n * Called when the initial (but not subsequent) render of Gatsby App is done on the client.\n * @example\n * exports.onInitialClientRender = () => {\n *   console.log(\"ReactDOM.render has executed\")\n * }\n */\nexports.onInitialClientRender = true\n\n/**\n * Called when changing location is started.\n * @param {object} $0\n * @param {object} $0.location A location object\n * @param {object|null} $0.prevLocation The previous location object\n * @example\n * exports.onPreRouteUpdate = ({ location, prevLocation }) => {\n *   console.log(\"Gatsby started to change location to\", location.pathname)\n *   console.log(\"Gatsby started to change location from\", prevLocation ? prevLocation.pathname : null)\n * }\n */\nexports.onPreRouteUpdate = true\n\n/**\n * Called when changing location is longer than 1 second.\n * @param {object} $0\n * @param {object} $0.location A location object\n * @param {object} $0.action The \"action\" that caused the route change\n * @example\n * exports.onRouteUpdateDelayed = () => {\n *   console.log(\"We can show loading indicator now\")\n * }\n */\nexports.onRouteUpdateDelayed = true\n\n/**\n * Called when the user changes routes\n * @param {object} $0\n * @param {object} $0.location A location object\n * @param {object|null} $0.prevLocation The previous location object\n * @example\n * exports.onRouteUpdate = ({ location, prevLocation }) => {\n *   console.log('new pathname', location.pathname)\n *   console.log('old pathname', prevLocation ? prevLocation.pathname : null)\n *\n *   // Track pageview with google analytics\n *   window.ga(\n *     `set`,\n *     `page`,\n *     location.pathname + location.search + location.hash,\n *   )\n *   window.ga(`send`, `pageview`)\n * }\n */\nexports.onRouteUpdate = true\n\n/**\n * Allow a plugin to decide if the scroll position should update or\n * not on a route change.\n * @param {object} $0\n * @param {object} $0.prevRouterProps The previous state of the router before the route change.\n * @param {object} $0.routerProps The current state of the router.\n * @param {string} $0.pathname The new pathname (for backwards compatibility with v1).\n * @param {function} $0.getSavedScrollPosition Takes a location and returns the\n * coordinates of the last scroll position for that location, or `null`. Gatsby\n * saves scroll positions for each route in `SessionStorage`, so they are\n * available after page reload.\n * @returns {(boolean|string|Array)} Should return either an [x, y] Array of\n * coordinates to scroll to, a string of the `id` or `name` of an element to\n * scroll to, `false` to not update the scroll position, or `true` for the\n * default behavior.\n * @example\n * exports.shouldUpdateScroll = ({\n *   routerProps: { location },\n *   getSavedScrollPosition\n * }) => {\n *   const currentPosition = getSavedScrollPosition(location)\n *   const queriedPosition = getSavedScrollPosition({ pathname: `/random` })\n *\n *   window.scrollTo(...(currentPosition || [0, 0]))\n *\n *   return false\n * }\n */\nexports.shouldUpdateScroll = true\n\n/**\n * Allow a plugin to register a Service Worker. Should be a function that returns true.\n * @example\n * exports.registerServiceWorker = () => true\n */\nexports.registerServiceWorker = true\n\n/**\n * Allow a plugin to replace the page component renderer. This api runner can be used to\n * implement page transitions. See https://github.com/gatsbyjs/gatsby/tree/master/examples/using-page-transitions for an example of this.\n * @param {object} $0\n * @param {object} $0.props The props of the page.\n * @param {object} $0.loader The gatsby loader.\n */\nexports.replaceComponentRenderer = true\n\n/**\n * Allow a plugin to wrap the page element.\n *\n * This is useful for setting wrapper component around pages that won't get\n * unmounted on page change. For setting Provider components use [wrapRootElement](#wrapRootElement).\n *\n * _Note:_ [There is equivalent hook in SSR API](/docs/ssr-apis/#wrapPageElement)\n * @param {object} $0\n * @param {ReactNode} $0.element The \"Page\" React Element built by Gatsby.\n * @param {object} $0.props Props object used by page.\n * @example\n * import React from \"react\"\n * import Layout from \"./src/components/layout\"\n *\n * export const wrapPageElement = ({ element, props }) => {\n *   // props provide same data to Layout as Page element will get\n *   // including location, data, etc - you don't need to pass it\n *   return <Layout {...props}>{element}</Layout>\n * }\n */\nexports.wrapPageElement = true\n\n/**\n * Allow a plugin to wrap the root element.\n *\n * This is useful to setup any Providers component that will wrap your application.\n * For setting persistent UI elements around pages use [wrapPageElement](#wrapPageElement).\n *\n * _Note:_ [There is equivalent hook in SSR API](/docs/ssr-apis/#wrapRootElement)\n * @param {object} $0\n * @param {ReactNode} $0.element The \"Root\" React Element built by Gatsby.\n * @example\n * import React from \"react\"\n * import { Provider } from \"react-redux\"\n *\n * import createStore from \"./src/state/createStore\"\n * const store = createStore()\n *\n * export const wrapRootElement = ({ element }) => {\n *   return (\n *     <Provider store={store}>\n *       {element}\n *     </Provider>\n *   )\n * }\n */\nexports.wrapRootElement = true\n\n/**\n * Called when prefetching for a pathname is triggered. Allows\n * for plugins with custom prefetching logic.\n * @param {object} $0\n * @param {string} $0.pathname The pathname whose resources should now be prefetched\n * @param {function} $0.getResourcesForPathname Function for fetching resources related to pathname\n */\nexports.onPrefetchPathname = true\n\n/**\n * Called when prefetching for a pathname is successful. Allows\n * for plugins with custom prefetching logic.\n * @param {object} $0\n * @param {string} $0.path The pathname whose resources have now been prefetched\n * @param {resourceUrls} $0.resourceUrls An array of resource URLs that have been prefetched for this path\n * @param {function} $0.getResourceURLsForPathname Function for fetching URLs for resources related to the pathname\n */\nexports.onPostPrefetch = true\n\n/**\n * Plugins can take over prefetching logic. If they do, they should call this\n * to disable the now duplicate core prefetching logic.\n * @example\n * exports.disableCorePrefetching = () => true\n */\nexports.disableCorePrefetching = true\n\n/**\n * Allow a plugin to replace the ReactDOM.render function call by a custom renderer.\n * This method takes no param and should return a function with same signature as ReactDOM.render()\n * Note it's very important to call the callback after rendering, otherwise Gatsby will not be able to call `onInitialClientRender`\n * @example\n * exports.replaceHydrateFunction = () => {\n *   return (element, container, callback) => {\n *     console.log(\"rendering!\");\n *     ReactDOM.render(element, container, callback);\n *   };\n * };\n */\nexports.replaceHydrateFunction = true\n\n/**\n * Inform plugins when a service worker has been installed.\n * @param {object} $0\n * @param {object} $0.serviceWorker The service worker instance.\n */\nexports.onServiceWorkerInstalled = true\n\n/**\n * Inform plugins of when a service worker has an update available.\n * @param {object} $0\n * @param {object} $0.serviceWorker The service worker instance.\n */\nexports.onServiceWorkerUpdateFound = true\n\n/**\n * Inform plugins when a service worker has been updated in the background\n * and the page is ready to reload to apply changes.\n * @param {object} $0\n * @param {object} $0.serviceWorker The service worker instance.\n */\nexports.onServiceWorkerUpdateReady = true\n\n/**\n * Inform plugins when a service worker has become active.\n * @param {object} $0\n * @param {object} $0.serviceWorker The service worker instance.\n */\nexports.onServiceWorkerActive = true\n\n/**\n * Inform plugins when a service worker is redundant.\n * @param {object} $0\n * @param {object} $0.serviceWorker The service worker instance.\n */\nexports.onServiceWorkerRedundant = true\n"],"file":"api-browser-docs.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/utils/page-data.js b/node_modules/gatsby/dist/utils/page-data.js
new file mode 100644
index 0000000..3caa684
--- /dev/null
+++ b/node_modules/gatsby/dist/utils/page-data.js
@@ -0,0 +1,123 @@
+"use strict";
+
+var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
+
+var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
+
+const fs = require(`fs-extra`);
+
+const path = require(`path`);
+
+const Queue = require(`better-queue`);
+
+const getFilePath = ({
+  publicDir
+}, pagePath) => {
+  const fixedPagePath = pagePath === `/` ? `index` : pagePath;
+  return path.join(publicDir, `page-data`, fixedPagePath, `page-data.json`);
+};
+
+const write =
+/*#__PURE__*/
+function () {
+  var _ref = (0, _asyncToGenerator2.default)(function* ({
+    publicDir
+  }, page, result, webpackCompilationHash) {
+    const filePath = getFilePath({
+      publicDir
+    }, page.path);
+    const body = Object.assign({
+      componentChunkName: page.componentChunkName,
+      path: page.path,
+      compilationHash: webpackCompilationHash
+    }, result);
+    yield fs.outputFile(filePath, JSON.stringify(body));
+  });
+
+  return function write(_x, _x2, _x3, _x4) {
+    return _ref.apply(this, arguments);
+  };
+}();
+
+const read =
+/*#__PURE__*/
+function () {
+  var _ref2 = (0, _asyncToGenerator2.default)(function* ({
+    publicDir
+  }, pagePath) {
+    const filePath = getFilePath({
+      publicDir
+    }, pagePath);
+    const rawPageData = yield fs.readFile(filePath);
+    return JSON.parse(rawPageData);
+  });
+
+  return function read(_x5, _x6) {
+    return _ref2.apply(this, arguments);
+  };
+}();
+
+const updateCompilationHash =
+/*#__PURE__*/
+function () {
+  var _ref3 = (0, _asyncToGenerator2.default)(function* ({
+    publicDir
+  }, pagePath, webpackCompilationHash) {
+    const filePath = getFilePath({
+      publicDir
+    }, pagePath);
+    const pageData = yield read({
+      publicDir
+    }, pagePath);
+    pageData.compilationHash = webpackCompilationHash;
+    yield fs.outputFile(filePath, JSON.stringify(pageData));
+  });
+
+  return function updateCompilationHash(_x7, _x8, _x9) {
+    return _ref3.apply(this, arguments);
+  };
+}(); // TODO We should move this to a worker model (like html page
+// rendering) for performance
+
+
+const rewriteCompilationHashes = ({
+  publicDir
+}, pagePaths, compilationHash) => {
+  if (pagePaths.length === 0) {
+    return Promise.resolve();
+  }
+
+  const queueOptions = {
+    concurrent: 4
+  };
+
+  const handler =
+  /*#__PURE__*/
+  function () {
+    var _ref4 = (0, _asyncToGenerator2.default)(function* (pagePath, callback) {
+      yield updateCompilationHash({
+        publicDir
+      }, pagePath, compilationHash);
+      callback(null);
+    });
+
+    return function handler(_x10, _x11) {
+      return _ref4.apply(this, arguments);
+    };
+  }();
+
+  const q = new Queue(handler, queueOptions);
+  const drainPromise = new Promise(resolve => {
+    q.once(`drain`, () => resolve());
+  });
+  pagePaths.forEach(pagePath => q.push(pagePath));
+  return drainPromise;
+};
+
+module.exports = {
+  write,
+  read,
+  updateCompilationHash,
+  rewriteCompilationHashes
+};
+//# sourceMappingURL=page-data.js.map
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/utils/page-data.js.map b/node_modules/gatsby/dist/utils/page-data.js.map
new file mode 100644
index 0000000..f652dfd
--- /dev/null
+++ b/node_modules/gatsby/dist/utils/page-data.js.map
@@ -0,0 +1 @@
+{"version":3,"sources":["../../src/utils/page-data.js"],"names":["fs","require","path","Queue","getFilePath","publicDir","pagePath","fixedPagePath","join","write","page","result","webpackCompilationHash","filePath","body","componentChunkName","compilationHash","outputFile","JSON","stringify","read","rawPageData","readFile","parse","updateCompilationHash","pageData","rewriteCompilationHashes","pagePaths","length","Promise","resolve","queueOptions","concurrent","handler","callback","q","drainPromise","once","forEach","push","module","exports"],"mappings":"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","sourcesContent":["const fs = require(`fs-extra`)\nconst path = require(`path`)\nconst Queue = require(`better-queue`)\n\nconst getFilePath = ({ publicDir }, pagePath) => {\n  const fixedPagePath = pagePath === `/` ? `index` : pagePath\n  return path.join(publicDir, `page-data`, fixedPagePath, `page-data.json`)\n}\n\nconst write = async ({ publicDir }, page, result, webpackCompilationHash) => {\n  const filePath = getFilePath({ publicDir }, page.path)\n  const body = {\n    componentChunkName: page.componentChunkName,\n    path: page.path,\n    compilationHash: webpackCompilationHash,\n    ...result,\n  }\n  await fs.outputFile(filePath, JSON.stringify(body))\n}\n\nconst read = async ({ publicDir }, pagePath) => {\n  const filePath = getFilePath({ publicDir }, pagePath)\n  const rawPageData = await fs.readFile(filePath)\n  return JSON.parse(rawPageData)\n}\n\nconst updateCompilationHash = async (\n  { publicDir },\n  pagePath,\n  webpackCompilationHash\n) => {\n  const filePath = getFilePath({ publicDir }, pagePath)\n  const pageData = await read({ publicDir }, pagePath)\n  pageData.compilationHash = webpackCompilationHash\n  await fs.outputFile(filePath, JSON.stringify(pageData))\n}\n\n// TODO We should move this to a worker model (like html page\n// rendering) for performance\nconst rewriteCompilationHashes = (\n  { publicDir },\n  pagePaths,\n  compilationHash\n) => {\n  if (pagePaths.length === 0) {\n    return Promise.resolve()\n  }\n  const queueOptions = {\n    concurrent: 4,\n  }\n  const handler = async (pagePath, callback) => {\n    await updateCompilationHash({ publicDir }, pagePath, compilationHash)\n    callback(null)\n  }\n  const q = new Queue(handler, queueOptions)\n  const drainPromise = new Promise(resolve => {\n    q.once(`drain`, () => resolve())\n  })\n  pagePaths.forEach(pagePath => q.push(pagePath))\n  return drainPromise\n}\n\nmodule.exports = {\n  write,\n  read,\n  updateCompilationHash,\n  rewriteCompilationHashes,\n}\n"],"file":"page-data.js"}
\ No newline at end of file
diff --git a/node_modules/gatsby/dist/utils/websocket-manager.js b/node_modules/gatsby/dist/utils/websocket-manager.js
index 2371f8a..863c7db 100644
--- a/node_modules/gatsby/dist/utils/websocket-manager.js
+++ b/node_modules/gatsby/dist/utils/websocket-manager.js
@@ -11,44 +11,23 @@ const _require = require(`../redux`),
 
 const fs = require(`fs`);
 
-/**
- * Get cached query result for given data path.
- * @param {string} dataFileName Cached query result filename.
- * @param {string} directory Root directory of current project.
- */
-const readCachedResults = (dataFileName, directory) => {
-  const filePath = path.join(directory, `public`, `static`, `d`, `${dataFileName}.json`);
-  return JSON.parse(fs.readFileSync(filePath, `utf-8`));
-};
 /**
  * Get cached page query result for given page path.
  * @param {string} pagePath Path to a page.
  * @param {string} directory Root directory of current project.
  */
-
-
 const getCachedPageData = (pagePath, directory) => {
-  const _store$getState = store.getState(),
-        jsonDataPaths = _store$getState.jsonDataPaths,
-        pages = _store$getState.pages;
-
-  const page = pages.get(pagePath);
+  const fixedPagePath = pagePath === `/` ? `index` : pagePath;
+  const filePath = path.join(directory, `public`, `page-data`, fixedPagePath, `page-data.json`);
 
-  if (!page) {
+  try {
+    const fileResult = fs.readFileSync(filePath, `utf-8`);
+    return Object.assign({}, JSON.parse(fileResult), {
+      id: pagePath
+    });
+  } catch (err) {
     return null;
   }
-
-  const dataPath = jsonDataPaths[page.jsonName];
-
-  if (typeof dataPath === `undefined`) {
-    console.log(`Error loading a result for the page query in "${pagePath}". Query was not run and no cached result was found.`);
-    return undefined;
-  }
-
-  return {
-    result: readCachedResults(dataPath, directory),
-    id: pagePath
-  };
 };
 /**
  * Get cached StaticQuery results for components that Gatsby didn't run query yet.
@@ -60,24 +39,24 @@ const getCachedPageData = (pagePath, directory) => {
 const getCachedStaticQueryResults = (resultsMap, directory) => {
   const cachedStaticQueryResults = new Map();
 
-  const _store$getState2 = store.getState(),
-        staticQueryComponents = _store$getState2.staticQueryComponents,
-        jsonDataPaths = _store$getState2.jsonDataPaths;
+  const _store$getState = store.getState(),
+        staticQueryComponents = _store$getState.staticQueryComponents;
 
   staticQueryComponents.forEach(staticQueryComponent => {
     // Don't read from file if results were already passed from query runner
     if (resultsMap.has(staticQueryComponent.hash)) return;
-    const dataPath = jsonDataPaths[staticQueryComponent.jsonName];
+    const filePath = path.join(directory, `public`, `static`, `d`, `${staticQueryComponent.hash}.json`);
+    const fileResult = fs.readFileSync(filePath, `utf-8`);
 
-    if (typeof dataPath === `undefined`) {
+    if (fileResult === `undefined`) {
       console.log(`Error loading a result for the StaticQuery in "${staticQueryComponent.componentPath}". Query was not run and no cached result was found.`);
       return;
     }
 
-    cachedStaticQueryResults.set(staticQueryComponent.hash, {
-      result: readCachedResults(dataPath, directory),
+    const jsonResult = JSON.parse(fileResult);
+    cachedStaticQueryResults.set(staticQueryComponent.hash, Object.assign({}, jsonResult, {
       id: staticQueryComponent.hash
-    });
+    }));
   });
   return cachedStaticQueryResults;
 };
diff --git a/node_modules/gatsby/dist/utils/websocket-manager.js.map b/node_modules/gatsby/dist/utils/websocket-manager.js.map
index 8f86eb2..88e19f4 100644
--- a/node_modules/gatsby/dist/utils/websocket-manager.js.map
+++ b/node_modules/gatsby/dist/utils/websocket-manager.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/websocket-manager.js"],"names":["path","require","store","fs","readCachedResults","dataFileName","directory","filePath","join","JSON","parse","readFileSync","getCachedPageData","pagePath","getState","jsonDataPaths","pages","page","get","dataPath","jsonName","console","log","undefined","result","id","getCachedStaticQueryResults","resultsMap","cachedStaticQueryResults","Map","staticQueryComponents","forEach","staticQueryComponent","has","hash","componentPath","set","getRoomNameFromPath","WebsocketManager","constructor","isInitialised","activePaths","Set","pageResults","staticQueryResults","errors","init","bind","getSocket","emitPageData","emitStaticQueryData","emitError","server","programDir","websocket","on","s","activePath","send","type","payload","message","errorID","leaveRoom","leave","leftRoom","sockets","adapter","rooms","length","delete","getDataForPath","why","add","data","manager","module","exports"],"mappings":"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","sourcesContent":["// @flow\n\nconst path = require(`path`)\nconst { store } = require(`../redux`)\nconst fs = require(`fs`)\n\ntype QueryResult = {\n  id: string,\n  result: object,\n}\n\ntype QueryResultsMap = Map<string, QueryResult>\n\n/**\n * Get cached query result for given data path.\n * @param {string} dataFileName Cached query result filename.\n * @param {string} directory Root directory of current project.\n */\nconst readCachedResults = (dataFileName: string, directory: string): object => {\n  const filePath = path.join(\n    directory,\n    `public`,\n    `static`,\n    `d`,\n    `${dataFileName}.json`\n  )\n  return JSON.parse(fs.readFileSync(filePath, `utf-8`))\n}\n\n/**\n * Get cached page query result for given page path.\n * @param {string} pagePath Path to a page.\n * @param {string} directory Root directory of current project.\n */\nconst getCachedPageData = (\n  pagePath: string,\n  directory: string\n): QueryResult => {\n  const { jsonDataPaths, pages } = store.getState()\n  const page = pages.get(pagePath)\n  if (!page) {\n    return null\n  }\n  const dataPath = jsonDataPaths[page.jsonName]\n  if (typeof dataPath === `undefined`) {\n    console.log(\n      `Error loading a result for the page query in \"${pagePath}\". Query was not run and no cached result was found.`\n    )\n    return undefined\n  }\n\n  return {\n    result: readCachedResults(dataPath, directory),\n    id: pagePath,\n  }\n}\n\n/**\n * Get cached StaticQuery results for components that Gatsby didn't run query yet.\n * @param {QueryResultsMap} resultsMap Already stored results for queries that don't need to be read from files.\n * @param {string} directory Root directory of current project.\n */\nconst getCachedStaticQueryResults = (\n  resultsMap: QueryResultsMap,\n  directory: string\n): QueryResultsMap => {\n  const cachedStaticQueryResults = new Map()\n  const { staticQueryComponents, jsonDataPaths } = store.getState()\n  staticQueryComponents.forEach(staticQueryComponent => {\n    // Don't read from file if results were already passed from query runner\n    if (resultsMap.has(staticQueryComponent.hash)) return\n\n    const dataPath = jsonDataPaths[staticQueryComponent.jsonName]\n    if (typeof dataPath === `undefined`) {\n      console.log(\n        `Error loading a result for the StaticQuery in \"${\n          staticQueryComponent.componentPath\n        }\". Query was not run and no cached result was found.`\n      )\n      return\n    }\n    cachedStaticQueryResults.set(staticQueryComponent.hash, {\n      result: readCachedResults(dataPath, directory),\n      id: staticQueryComponent.hash,\n    })\n  })\n  return cachedStaticQueryResults\n}\n\nconst getRoomNameFromPath = (path: string): string => `path-${path}`\n\nclass WebsocketManager {\n  pageResults: QueryResultsMap\n  staticQueryResults: QueryResultsMap\n  errors: Map<string, QueryResult>\n  isInitialised: boolean\n  activePaths: Set<string>\n  programDir: string\n\n  constructor() {\n    this.isInitialised = false\n    this.activePaths = new Set()\n    this.pageResults = new Map()\n    this.staticQueryResults = new Map()\n    this.errors = new Map()\n    // this.websocket\n    // this.programDir\n\n    this.init = this.init.bind(this)\n    this.getSocket = this.getSocket.bind(this)\n    this.emitPageData = this.emitPageData.bind(this)\n    this.emitStaticQueryData = this.emitStaticQueryData.bind(this)\n    this.emitError = this.emitError.bind(this)\n  }\n\n  init({ server, directory }) {\n    this.programDir = directory\n\n    const cachedStaticQueryResults = getCachedStaticQueryResults(\n      this.staticQueryResults,\n      this.programDir\n    )\n    this.staticQueryResults = new Map([\n      ...this.staticQueryResults,\n      ...cachedStaticQueryResults,\n    ])\n\n    this.websocket = require(`socket.io`)(server)\n\n    this.websocket.on(`connection`, s => {\n      let activePath = null\n      // Send already existing static query results\n      this.staticQueryResults.forEach(result => {\n        this.websocket.send({\n          type: `staticQueryResult`,\n          payload: result,\n        })\n      })\n      this.errors.forEach((message, errorID) => {\n        this.websocket.send({\n          type: `overlayError`,\n          payload: {\n            id: errorID,\n            message,\n          },\n        })\n      })\n\n      const leaveRoom = path => {\n        s.leave(getRoomNameFromPath(path))\n        const leftRoom = this.websocket.sockets.adapter.rooms[\n          getRoomNameFromPath(path)\n        ]\n        if (!leftRoom || leftRoom.length === 0) {\n          this.activePaths.delete(path)\n        }\n      }\n\n      const getDataForPath = path => {\n        if (!this.pageResults.has(path)) {\n          const result = getCachedPageData(path, this.programDir)\n          if (result) {\n            this.pageResults.set(path, result)\n          } else {\n            console.log(`Page not found`, path)\n            return\n          }\n        }\n\n        this.websocket.send({\n          type: `pageQueryResult`,\n          why: `getDataForPath`,\n          payload: this.pageResults.get(path),\n        })\n      }\n\n      s.on(`getDataForPath`, getDataForPath)\n\n      s.on(`registerPath`, path => {\n        s.join(getRoomNameFromPath(path))\n        activePath = path\n        this.activePaths.add(path)\n      })\n\n      s.on(`disconnect`, s => {\n        leaveRoom(activePath)\n      })\n\n      s.on(`unregisterPath`, path => {\n        leaveRoom(path)\n      })\n    })\n\n    this.isInitialised = true\n  }\n\n  getSocket() {\n    return this.isInitialised && this.websocket\n  }\n\n  emitStaticQueryData(data: QueryResult) {\n    this.staticQueryResults.set(data.id, data)\n    if (this.isInitialised) {\n      this.websocket.send({ type: `staticQueryResult`, payload: data })\n    }\n  }\n\n  emitPageData(data: QueryResult) {\n    this.pageResults.set(data.id, data)\n    if (this.isInitialised) {\n      this.websocket.send({ type: `pageQueryResult`, payload: data })\n    }\n  }\n  emitError(id: string, message?: string) {\n    if (message) {\n      this.errors.set(id, message)\n    } else {\n      this.errors.delete(id)\n    }\n\n    if (this.isInitialised) {\n      this.websocket.send({ type: `overlayError`, payload: { id, message } })\n    }\n  }\n}\n\nconst manager = new WebsocketManager()\n\nmodule.exports = manager\n"],"file":"websocket-manager.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/websocket-manager.js"],"names":["path","require","store","fs","getCachedPageData","pagePath","directory","fixedPagePath","filePath","join","fileResult","readFileSync","JSON","parse","id","err","getCachedStaticQueryResults","resultsMap","cachedStaticQueryResults","Map","getState","staticQueryComponents","forEach","staticQueryComponent","has","hash","console","log","componentPath","jsonResult","set","getRoomNameFromPath","WebsocketManager","constructor","isInitialised","activePaths","Set","pageResults","staticQueryResults","errors","init","bind","getSocket","emitPageData","emitStaticQueryData","emitError","server","programDir","websocket","on","s","activePath","result","send","type","payload","message","errorID","leaveRoom","leave","leftRoom","sockets","adapter","rooms","length","delete","getDataForPath","why","get","add","data","manager","module","exports"],"mappings":"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","sourcesContent":["// @flow\n\nconst path = require(`path`)\nconst { store } = require(`../redux`)\nconst fs = require(`fs`)\n\ntype QueryResult = {\n  id: string,\n  result: object,\n}\n\ntype QueryResultsMap = Map<string, QueryResult>\n\n/**\n * Get cached page query result for given page path.\n * @param {string} pagePath Path to a page.\n * @param {string} directory Root directory of current project.\n */\nconst getCachedPageData = (\n  pagePath: string,\n  directory: string\n): QueryResult => {\n  const fixedPagePath = pagePath === `/` ? `index` : pagePath\n  const filePath = path.join(\n    directory,\n    `public`,\n    `page-data`,\n    fixedPagePath,\n    `page-data.json`\n  )\n  try {\n    const fileResult = fs.readFileSync(filePath, `utf-8`)\n    return {\n      ...JSON.parse(fileResult),\n      id: pagePath,\n    }\n  } catch (err) {\n    return null\n  }\n}\n\n/**\n * Get cached StaticQuery results for components that Gatsby didn't run query yet.\n * @param {QueryResultsMap} resultsMap Already stored results for queries that don't need to be read from files.\n * @param {string} directory Root directory of current project.\n */\nconst getCachedStaticQueryResults = (\n  resultsMap: QueryResultsMap,\n  directory: string\n): QueryResultsMap => {\n  const cachedStaticQueryResults = new Map()\n  const { staticQueryComponents } = store.getState()\n  staticQueryComponents.forEach(staticQueryComponent => {\n    // Don't read from file if results were already passed from query runner\n    if (resultsMap.has(staticQueryComponent.hash)) return\n\n    const filePath = path.join(\n      directory,\n      `public`,\n      `static`,\n      `d`,\n      `${staticQueryComponent.hash}.json`\n    )\n    const fileResult = fs.readFileSync(filePath, `utf-8`)\n    if (fileResult === `undefined`) {\n      console.log(\n        `Error loading a result for the StaticQuery in \"${\n          staticQueryComponent.componentPath\n        }\". Query was not run and no cached result was found.`\n      )\n      return\n    }\n    const jsonResult = JSON.parse(fileResult)\n    cachedStaticQueryResults.set(staticQueryComponent.hash, {\n      ...jsonResult,\n      id: staticQueryComponent.hash,\n    })\n  })\n  return cachedStaticQueryResults\n}\n\nconst getRoomNameFromPath = (path: string): string => `path-${path}`\n\nclass WebsocketManager {\n  pageResults: QueryResultsMap\n  staticQueryResults: QueryResultsMap\n  errors: Map<string, QueryResult>\n  isInitialised: boolean\n  activePaths: Set<string>\n  programDir: string\n\n  constructor() {\n    this.isInitialised = false\n    this.activePaths = new Set()\n    this.pageResults = new Map()\n    this.staticQueryResults = new Map()\n    this.errors = new Map()\n    // this.websocket\n    // this.programDir\n\n    this.init = this.init.bind(this)\n    this.getSocket = this.getSocket.bind(this)\n    this.emitPageData = this.emitPageData.bind(this)\n    this.emitStaticQueryData = this.emitStaticQueryData.bind(this)\n    this.emitError = this.emitError.bind(this)\n  }\n\n  init({ server, directory }) {\n    this.programDir = directory\n\n    const cachedStaticQueryResults = getCachedStaticQueryResults(\n      this.staticQueryResults,\n      this.programDir\n    )\n    this.staticQueryResults = new Map([\n      ...this.staticQueryResults,\n      ...cachedStaticQueryResults,\n    ])\n\n    this.websocket = require(`socket.io`)(server)\n\n    this.websocket.on(`connection`, s => {\n      let activePath = null\n      // Send already existing static query results\n      this.staticQueryResults.forEach(result => {\n        this.websocket.send({\n          type: `staticQueryResult`,\n          payload: result,\n        })\n      })\n      this.errors.forEach((message, errorID) => {\n        this.websocket.send({\n          type: `overlayError`,\n          payload: {\n            id: errorID,\n            message,\n          },\n        })\n      })\n\n      const leaveRoom = path => {\n        s.leave(getRoomNameFromPath(path))\n        const leftRoom = this.websocket.sockets.adapter.rooms[\n          getRoomNameFromPath(path)\n        ]\n        if (!leftRoom || leftRoom.length === 0) {\n          this.activePaths.delete(path)\n        }\n      }\n\n      const getDataForPath = path => {\n        if (!this.pageResults.has(path)) {\n          const result = getCachedPageData(path, this.programDir)\n          if (result) {\n            this.pageResults.set(path, result)\n          } else {\n            console.log(`Page not found`, path)\n            return\n          }\n        }\n\n        this.websocket.send({\n          type: `pageQueryResult`,\n          why: `getDataForPath`,\n          payload: this.pageResults.get(path),\n        })\n      }\n\n      s.on(`getDataForPath`, getDataForPath)\n\n      s.on(`registerPath`, path => {\n        s.join(getRoomNameFromPath(path))\n        activePath = path\n        this.activePaths.add(path)\n      })\n\n      s.on(`disconnect`, s => {\n        leaveRoom(activePath)\n      })\n\n      s.on(`unregisterPath`, path => {\n        leaveRoom(path)\n      })\n    })\n\n    this.isInitialised = true\n  }\n\n  getSocket() {\n    return this.isInitialised && this.websocket\n  }\n\n  emitStaticQueryData(data: QueryResult) {\n    this.staticQueryResults.set(data.id, data)\n    if (this.isInitialised) {\n      this.websocket.send({ type: `staticQueryResult`, payload: data })\n    }\n  }\n\n  emitPageData(data: QueryResult) {\n    this.pageResults.set(data.id, data)\n    if (this.isInitialised) {\n      this.websocket.send({ type: `pageQueryResult`, payload: data })\n    }\n  }\n  emitError(id: string, message?: string) {\n    if (message) {\n      this.errors.set(id, message)\n    } else {\n      this.errors.delete(id)\n    }\n\n    if (this.isInitialised) {\n      this.websocket.send({ type: `overlayError`, payload: { id, message } })\n    }\n  }\n}\n\nconst manager = new WebsocketManager()\n\nmodule.exports = manager\n"],"file":"websocket-manager.js"}
\ No newline at end of file
